/*! genome-viewer July 22, 2014 17:05:12 */
function Region(a){this.chromosome=null,this.start=null,this.end=null,_.isObject(a)?this.load(a):_.isString(a)&&this.parse(a)}function Grid(a){_.extend(this,Backbone.Events),this.id=Utils.genId("Grid"),this.grid=null,this.store=null,this.model=null,_.extend(this,a)}function FeatureBinarySearchTree(){this._root=null}function FileWidget(a){_.extend(this,Backbone.Events),this.id=Utils.genId("FileWidget"),this.targetId,this.wum=!0,this.tags=[],this.viewer,this.title,this.dataAdapter,this.args=a,_.extend(this,a),this.on(this.handlers)}function BEDFileWidget(a){null==a&&(a=new Object),a.title="BED",a.tags=["bed"],FileWidget.prototype.constructor.call(this,a)}function GFFFileWidget(a){null==a&&(a={}),this.version="2",null!=a.version&&(this.version=a.version),a.title="GFF"+this.version,a.tags=["gff"],FileWidget.prototype.constructor.call(this,a)}function GTFFileWidget(a){null==a&&(a=new Object),a.title="GTF",a.tags=["gtf"],FileWidget.prototype.constructor.call(this,a)}function LegendPanel(a){this.width=200,this.height=250,null!=a&&(null!=a.title&&(this.title=a.title),null!=a.targetId&&(this.targetId=a.targetId),null!=a.width&&(this.width=a.width),null!=a.height&&(this.height=a.height))}function LegendWidget(a){this.width=300,this.height=300,this.title="Legend",null!=a&&(null!=a.title&&(this.title=a.title),null!=a.targetId&&(this.targetId=a.targetId),null!=a.width&&(this.width=a.width),null!=a.height&&(this.height=a.height)),this.legendPanel=new LegendPanel}function TrackSettingsWidget(a){this.id="TrackSettingsWidget"+Math.round(1e4*Math.random()),"undefined"!=typeof a&&(this.trackSvg=a.trackSvg||this.trackSvg,this.treeRecord=a.treeRecord||this.treeRecord),this.filtersConfig=this.trackSvg.getFiltersConfig(),this.filters=this.trackSvg.getFilters(),null!=this.filtersConfig&&this.draw()}function UrlWidget(a){_.extend(this,Backbone.Events),this.id=Utils.genId("UrlWidget"),this.targetId=null,this.title="Custom url",this.width=500,this.height=400,_.extend(this,a),this.on(this.handlers)}function VCFFileWidget(a){null==a&&(a=new Object),a.title="VCF",a.tags=["vcf"],FileWidget.prototype.constructor.call(this,a)}function InfoWidget(a,b,c){switch(this.id="InfoWidget_"+Math.round(1e7*Math.random()),this.targetId=null,this.species=b,this.title=null,this.featureId=null,this.width=800,this.height=460,this.feature=null,this.query=null,this.adapter=null,null!=a&&(this.targetId=a),null!=c&&(null!=c.title&&(this.title=c.title),null!=c.width&&(this.width=c.width),null!=c.height&&(this.height=c.height)),Utils.getSpeciesCode(b.text)){case"hsapiens":this.ensemblSpecie="Homo_sapiens",this.reactomeSpecie="48887",this.wikipathwaysSpecie="Homo+sapiens",this.omimSpecie="",this.uniprotSpecie="",this.intactSpecie="",this.dbsnpSpecie="",this.haphapSpecie="";break;case"mmusculus":this.ensemblSpecies="Mus_musculus",this.reactomeSpecies="48892",this.wikipathwaysSpecie="Mus+musculus",this.omimSpecie="",this.uniprotSpecie="",this.intactSpecie="",this.dbsnpSpecie="",this.haphapSpecie="";break;case"drerio":this.ensemblSpecie="Danio_rerio",this.reactomeSpecie="68323",this.wikipathwaysSpecie="Danio+rerio",this.omimSpecie="",this.uniprotSpecie="",this.intactSpecie="",this.dbsnpSpecie="",this.haphapSpecie=""}this.notFoundPanel=Ext.create("Ext.panel.Panel",{id:this.id+"notFoundPanel",cls:"ocb-border-left-lightgrey",border:!1,flex:3,bodyPadding:"40",html:"No results found"})}function GeneInfoWidget(a,b,c){null==c&&(c=new Object),c.title="Gene Info",InfoWidget.prototype.constructor.call(this,a,b,c)}function GeneOrangeInfoWidget(a,b,c){null==c&&(c=new Object),c.title="Gene Info",InfoWidget.prototype.constructor.call(this,a,b,c)}function MirnaInfoWidget(a,b,c){null==c&&(c=new Object),c.title="miRNA Information",InfoWidget.prototype.constructor.call(this,a,b,c)}function ProteinInfoWidget(a,b,c){null==c&&(c=new Object),c.title="Protein Info",InfoWidget.prototype.constructor.call(this,a,b,c)}function SnpInfoWidget(a,b,c){null==c&&(c=new Object),c.title="SNP Info",InfoWidget.prototype.constructor.call(this,a,b,c)}function TFInfoWidget(a,b,c){null==c&&(c=new Object),c.title="Transcription Factor Info",InfoWidget.prototype.constructor.call(this,a,b,c)}function TranscriptInfoWidget(a,b,c){null==c&&(c=new Object),c.title="Transcript",InfoWidget.prototype.constructor.call(this,a,b,c)}function TranscriptOrangeInfoWidget(a,b,c){null==c&&(c=new Object),c.title="Transcript",InfoWidget.prototype.constructor.call(this,a,b,c)}function VCFVariantInfoWidget(a,b,c){null==c&&(c=new Object),c.title="VCF variant Info",InfoWidget.prototype.constructor.call(this,a,b,c)}function ConsequenceTypeFilterFormPanel(a){_.extend(this,Backbone.Events),this.id=Utils.genId("ConsequenceTypeFilterFormPanel"),this.target,this.height=400,this.title="Consequence Type",this.border=!1,this.autoRender=!0,this.collapsible=!0,this.titleCollapse=!1,this.collapsed=!1,this.headerConfig,this.consequenceTypes=[],this.fields=[{name:"name",type:"string"},{name:"acc",type:"string"}],this.columns=[{xtype:"treecolumn",flex:2,sortable:!1,dataIndex:"name",tooltipType:"qtip"},{text:"",flex:1,dataIndex:"acc",renderer:function(a){var b="http://www.sequenceontology.org/miso/current_release/term/"+a;return" <a href="+b+' target="_blank">'+a+"</a>"}}],_.extend(this,a),this.on(this.handlers),this.rendered=!1,this.autoRender&&this.render(this.targetId)}function FormPanel(a){_.extend(this,Backbone.Events),this.id=Utils.genId("FormPanel"),this.target,this.autoRender=!0,this.height,this.width,this.title,this.collapsible=!1,this.titleCollapse=!1,this.submitButtonText="Search",this.clearButtonText="Clear",this.barItems=[],this.border=!0,this.filters=[],this.mode="accordion",this.toolbarPosition="top",this.headerConfig,_.extend(this,a),this.on(this.handlers),this.rendered=!1,this.autoRender&&this.render(this.targetId)}function MafFilterFormPanel(a){_.extend(this,Backbone.Events),this.id=Utils.genId("MafFilterFormPanel"),this.target,this.autoRender=!0,this.title="MAF",this.border=!1,this.collapsible=!0,this.titleCollapse=!1,this.headerConfig,this.testRegion="",_.extend(this,a),this.on(this.handlers),this.rendered=!1,this.autoRender&&this.render(this.targetId)}function PositionFilterFormPanel(a){_.extend(this,Backbone.Events),this.id=Utils.genId("PositionFilterFormPanel"),this.target,this.autoRender=!0,this.title="Position",this.border=!1,this.collapsible=!0,this.titleCollapse=!1,this.headerConfig,this.testRegion="",_.extend(this,a),this.on(this.handlers),this.rendered=!1,this.autoRender&&this.render(this.targetId)}function SegregationFilterFormPanel(a){_.extend(this,Backbone.Events),this.id=Utils.genId("SegregationFilterFormPanel"),this.target,this.autoRender=!0,this.title="Segregation",this.border=!1,this.collapsible=!0,this.titleCollapse=!1,this.headerConfig,this.testRegion="",_.extend(this,a),this.on(this.handlers),this.rendered=!1,this.autoRender&&this.render(this.targetId)}function StudyFilterFormPanel(a){_.extend(this,Backbone.Events),this.id=Utils.genId("StudyFilterFormPanel"),this.target,this.autoRender=!0,this.title="Select Studies",this.studiesStore,this.border=!0,this.height=300,_.extend(this,a),this.on(this.handlers),this.rendered=!1,this.autoRender&&this.render(this.targetId)}function VariantBrowserGrid(a){_.extend(this,Backbone.Events),this.id=Utils.genId("Widget"),this.target,this.data=[],this.dataParser,this.responseParser,this.columns,this.attributes,this.type,this.height=400,this.pageSize=10,this.title="VariantBrowserGrid",this.autoRender=!0,this.border=!1,this.responseRoot="response[0].result",this.responseTotal="response[0].numTotalResults",this.startParam="skip",_.extend(this,a),this.on(this.handlers),this.rendered=!1,this.autoRender&&this.render(this.targetId)}function VariantEffectGrid(a){_.extend(this,Backbone.Events),this.id=Utils.genId("VariantEffectGrid"),this.target,this.autoRender=!0,this.storeConfig={},this.gridConfig={},this.headerConfig,_.extend(this,a),this.on(this.handlers),this.rendered=!1,this.autoRender&&this.render()}function VariantFileBrowserPanel(a){_.extend(this,Backbone.Events),this.id=Utils.genId("VariantFileBrowserPanel"),this.target,this.title="File Browser",this.height=800,this.autoRender=!0,this.studies=[],_.extend(this,a),this.on(this.handlers),this.rendered=!1,this.autoRender&&this.render()}function VariantGenotypeGrid(a){_.extend(this,Backbone.Events),this.id=Utils.genId("VariantGenotypeGrid"),this.autoRender=!0,this.storeConfig={},this.gridConfig={},this.height=500,this.target,_.extend(this,a),this.on(this.handlers),this.rendered=!1,this.autoRender&&this.render(this.targetId)}function VariantStatsPanel(a){_.extend(this,Backbone.Events),this.id=Utils.genId("VariantStatsPanel"),this.target,this.title="Stats",this.height=500,this.autoRender=!0,_.extend(this,a),this.on(this.handlers),this.rendered=!1,this.autoRender&&this.render()}function VariantStudyBrowserPanel(a){_.extend(this,Backbone.Events),this.id=Utils.genId("VariantStudyBrowserPanel"),this.target,this.title="Study Browser",this.height=800,this.autoRender=!0,this.studiesStore,this.host,this.border=!1,this.speciesList=[{assembly:"GRCh37.p7",common:"human",id:"extModel256-1",sciAsembly:"Homo sapiens (GRCh37.p7)",scientific:"Homo sapiens",species:"hsa"}],_.extend(this,a),this.on(this.handlers),this.rendered=!1,this.autoRender&&this.render()}function VariantWidget(a){_.extend(this,Backbone.Events),this.id=Utils.genId("VariantWidget"),this.target,this.width,this.height,this.autoRender=!0,this.data=[],this.host,this.closable=!0,this.filters={segregation:!0,maf:!0,effect:!0,region:!0,gene:!0},this.headerConfig,this.attributes=[],this.columns=[],this.samples=[],this.defaultToolConfig={headerConfig:{baseCls:"ocb-title-2"},effect:!0,genomeViewer:!0,genotype:!0,stats:!0},this.tools=[],this.dataParser,this.responseParser,this.responseRoot="response[0].result",this.responseTotal="response[0].numTotalResults",this.startParam="skip",this.browserGridConfig={title:"variant browser grid",border:!1},this.toolPanelConfig={title:"Variant data",border:!1},this.toolsConfig={headerConfig:{baseCls:"ocb-title-2"}},_.extend(this.filters,a.filters),_.extend(this.browserGridConfig,a.browserGridConfig),_.extend(this.defaultToolConfig,a.defaultToolConfig),delete a.filters,delete a.defaultToolConfig,_.extend(this,a),this.selectedToolDiv,this.rendered=!1,this.autoRender&&this.render()}function NetworkFileWidget(a){_.extend(this,Backbone.Events),this.id=Utils.genId("NetworkFileWidget"),this.targetId,this.title="Network widget abstract class",this.width=600,this.height=300,this.layoutSelector=!0,_.extend(this,a),this.dataAdapter,this.content,this.on(this.handlers)}function AttributeLayoutConfigureWidget(a){_.extend(this,Backbone.Events),this.id=Utils.genId("AttributeLayoutConfigureWidget"),this.width=400,this.height=300,this.networkViewer,this.window,_.extend(this,a),this.on(this.handlers),this.network=this.networkViewer.network,this.autoRender&&this.render()}function AttributeNetworkFileWidget(a){_.extend(this,Backbone.Events),this.id=Utils.genId("AttributeNetworkFileWidget"),this.targetId,this.title="Open an attributes file",this.width=600,this.height=350,_.extend(this,a),this.dataAdapter,this.previewId=this.id+"-preview",this.on(this.handlers)}function AttributeEditWidget(a){_.extend(this,Backbone.Events),this.id=Utils.genId("AttributeEditWidget"),this.window,this.grid,this.accordionPanel,this.attrMan,this.type,this.selectedFilter=new Ext.util.Filter({filterFn:function(a){return a.data.Selected===!0}}),_.extend(this,a),this.on(this.handlers),this.autoRender&&this.render()}function AttributeFilterWidget(a){var b=this;_.extend(this,Backbone.Events),this.id=Utils.genId("AttributeFilterWidget"),this.attrMan,this.type,_.extend(this,a),this.attrMan.store.on("datachanged",function(){Ext.getCmp("filterAttrWindow")&&b.updateNumRowsLabel()}),this.on(this.handlers)}function DOTNetworkFileWidget(a){a.title="Import a Network DOT file",NetworkFileWidget.prototype.constructor.call(this,a)}function JSONNetworkFileWidget(a){NetworkFileWidget.prototype.constructor.call(this,a),this.title="Open a Network JSON file",this.id=Utils.genId("JSONNetworkFileWidget")}function LayoutConfigureWidget(a){_.extend(this,Backbone.Events),this.id=Utils.genId("LayoutConfigureWidget"),this.width=450,this.height=300,this.window,this.networkViewer,_.extend(this,a),this.on(this.handlers),this.network=this.networkViewer.network,this.autoRender&&this.render()}function NetworkEditWidget(a){_.extend(this,Backbone.Events),this.id=Utils.genId("NetworkEditWidget"),this.window,this.grid,this.network,this.networkViewer,_.extend(this,a),this.on(this.handlers),this.autoRender&&this.render()}function SIFNetworkFileWidget(a){NetworkFileWidget.prototype.constructor.call(this,a),this.title="Import a Network SIF file",this.id=Utils.genId("SIFNetworkFileWidget")}function TextNetworkFileWidget(a){NetworkFileWidget.prototype.constructor.call(this,a),this.title="Import a Network Text file",this.id=Utils.genId("TextNetworkFileWidget"),this.columnsNumberStore=Ext.create("Ext.data.Store",{fields:["name","num"],data:[]}),this.height=450,this.sourceColumnIndex,this.relationColumnIndex,this.targetColumnIndex}function XLSXNetworkFileWidget(a){NetworkFileWidget.prototype.constructor.call(this,a),this.title="Import a Network XLSX file",this.id=Utils.genId("XLSXNetworkFileWidget"),this.sheetStore=Ext.create("Ext.data.Store",{fields:["name"],data:[]}),this.columnsNumberStore=Ext.create("Ext.data.Store",{fields:["name","num"],data:[]}),this.height=450,this.textNetworkDataAdapter,this.sourceColumnIndex,this.relationColumnIndex,this.targetColumnIndex}function CheckBrowser(a){Ext.isIE&&window.console&&"undefined"==typeof window.console.time&&(console.time=function(a,b){if(a){var c=(new Date).getTime();console.timeCounters||(console.timeCounters={});var d="KEY"+a.toString();(b||!console.timeCounters[d])&&(console.timeCounters[d]=c)}},console.timeEnd=function(a){var b=(new Date).getTime();if(console.timeCounters){var c="KEY"+a.toString(),d=console.timeCounters[c];if(d){var e=b-d,f=a+": "+e+"ms";console.info(f),delete console.timeCounters[c]}return e}});var b=!1;switch(a){case"renato":Ext.chromeVersion>=16&&(b=!0),Ext.safariVersion>=5&&(b=!0),Ext.firefoxVersion>=10&&(b=!0);break;case"variant":Ext.chromeVersion>=16&&(b=!0),Ext.safariVersion>=5&&(b=!0),Ext.firefoxVersion>=10&&(b=!0);break;default:Ext.chromeVersion>=14&&(b=!0),Ext.safariVersion>=5&&(b=!0),Ext.isIE10>=5&&(b=!0)}0==b&&(console.log("--------------------------------------------"+b),$("#checkBrowser").html("This application provides the best user experience with Google Chrome and Apple Safari, otherwise some latencies may be experienced when browsing due to some problems in Firefox.").css("width","540px").css("height","40px").css("position","absolute").css("margin-left","300px").css("margin-top","26px").css("padding","5px").css("border","1px solid #F1D031").css("background","#FFFFA3").css("color","#555").css("position","absolute").css("z-index","50000").click(function(){$("#checkBrowser").fadeOut(function(){$(this).remove()})}))}function GenericFormPanel(a){var b=this;_.extend(this,Backbone.Events),this.analysis,this.form=null,this.paramsWS={},this.testing=!1,this.closable=!0,this.minimizable=!0,this.labelWidth=150,this.type,this.style,this.title,this.resizable,this.width=500,this.height,this.border=!0,this.formBorder=!0,this.taskbar,this.bodyPadding,this.headerConfig,this.buttonConfig={width:200,height:30},_.extend(this,a),this.runAnalysisSuccess=function(a){""!==a.errorMsg?Ext.Msg.show({title:"Error",msg:a.errorMsg,buttons:Ext.Msg.OK,icon:Ext.Msg.ERROR}):(Utils.msg("Job Launched","It will be listed soon"),b.testing||b.clean(),console.log(a),"window"==b.type&&b.panel.hide())},this.on(this.handlers)}function HeaderWidget(a){_.extend(this,Backbone.Events);this.id=Utils.genId("HeaderWidget"),this.target,this.accountData,this.appname="My new App",this.description="",this.suiteId=-1,this.checkTimeInterval=4e3,this.version="",this.allowLogin=!0,this.width,this.height=60,this.chunkedUpload=!1,this.enableTextModeUW=!0,this.applicationMenuEl,this.homeLink=".",this.helpLink=".",this.tutorialLink=".",this.aboutHTML=".",_.extend(this,a),this.els={},this.on(this.handlers),this.rendered=!1,this.autoRender&&this.render()}function JobListWidget(a){var b=this;_.extend(this,Backbone.Events),this.id=Utils.genId("JobListWidget"),this.target,this.autoRender=!0,this.RUNING_COLOR="#298c63",this.QUEUED_COLOR="Darkorange",this.FINISHED_COLOR="#0068cc",this.ERROR_COLOR="#b30000",_.extend(this,a),this.on(this.handlers),this.buttonFilterFunction=null,this.textFilterFunction=function(a){var c=Ext.getCmp(b.id+"searchField").getValue().toLowerCase();return a.data.name.toLowerCase().indexOf(c)<0?!1:!0},this.rendered=!1,this.autoRender&&this.render()}function LoginWidget(a){_.extend(this,Backbone.Events),this.id=Utils.genId("LoginWidget"),this.suiteId,_.extend(this,a),this.on(this.handlers),this.rendered=!1,this.autoRender&&this.render(this.targetId)}function OpencgaBrowserWidget(a){_.extend(this,Backbone.Events),this.id=Utils.genId("uploadWidget"),this.targetId,this.suiteId,this.chunkedUpload=!1,this.width=800,this.height=575,this.title="Cloud data",this.enableTextModeUW=!0,_.extend(this,a),this.on(this.handlers),this.rendered=!1,this.autoRender&&this.render(this.targetId)}function ProfileWidget(a){_.extend(this,Backbone.Events),this.id=Utils.genId("ProfileWidget"),this.suiteId,_.extend(this,a),this.on(this.handlers),this.rendered=!1,this.autoRender&&this.render(this.targetId)}function ResultTable(a,b,c,d){this.id="ResultTable"+Math.round(1e7*Math.random()),this.targetId=null,this.jobId=a,this.fileName=b,this.tags=c,this.numRows=10,this.flex=null,this.collapsible=!0,this.border=!0,this.cls=null,"undefined"!=typeof d&&(this.targetId=d.targetId||this.targetId,this.numRows=d.numRows||this.numRows,this.flex=d.flex||this.flex,this.collapsible=d.collapsible||this.collapsible,this.border=d.border||this.border,this.cls=d.cls||this.cls,this.tableLayout=d.tableLayout||this.tableLayout),this.table=null}function ResultWidget(a){this.extItems=[],this.collapseInformation=!1,this.drawIndex=!0,this.title="",_.extend(this,a),this.panelId=null,this.type,this.networkViewerId=null,this.genomeMapsId=null}function UploadWidget(a){var b=this;_.extend(this,Backbone.Events),this.id=Utils.genId("uploadWidget"),this.targetId=null,this.suiteId=null,this.chunkedUpload=!1,this.enableTextMode=!0,"undefined"!=typeof a&&(this.targetId=a.targetId||this.targetId,this.suiteId=a.suiteId||this.suiteId,this.opencgaBrowserWidget=a.opencgaBrowserWidget||this.opencgaBrowserWidget,this.chunkedUpload=a.chunkedUpload||this.chunkedUpload),this.uploadObjectToBucketSuccess=function(a){""===a.errorMsg?(Utils.msg("Object upload",'</span class="emph">'+a.result[0].msg+"</span>"),b.uploadComplete(a.result[0].msg)):(Ext.Msg.alert("Object upload",a.errorMsg),b.uploadFailed(a.errorMsg)),b.trigger("object:upload",{sender:b,data:a.result[0].msg})},this.uploadButtonId=this.id+"_uploadButton",this.uploadFieldId=this.id+"_uploadField",this.selectedDataType=null,_.extend(this,a),this.on(this.handlers)}function AttributeManagerIDB(){_.extend(this,Backbone.Events),this.id=Utils.genId("AttributeManager"),this.dbName="AttributeManager",this._deleteDatabase(),this._createDatabase()}function AttributeManagerStore(a){var b=this;_.extend(this,Backbone.Events),this.id=Utils.genId("AttributeManagerStore"),this.store=Ext.create("Ext.data.Store",{pageSize:50,proxy:{type:"memory"},fields:[],listeners:{update:function(a,c,d,e){e&&"Selected"!=e[0]&&(console.log("AttributeManagerStore - update"),b.trigger("change:recordsAttribute",{records:[c],attributeName:e[0],sender:this}))}}}),this.columnsGrid=[],this.attributes=[],this.filters={},_.extend(this,a),this.on(this.handlers),this._processAttribute({name:"Selected",type:"boolean",defaultValue:!1});for(var c=0;c<this.attributes.length;c++)this._processAttribute(this.attributes[c])}function CircosVertexRenderer(a){_.extend(this,Backbone.Events),this.complex=!1,this.shape="circle",this.size=30,this.color="#9fc6e7",this.strokeSize=1,this.strokeColor="#9fc6e7",this.opacity=.8,this.labelSize=12,this.labelColor="#111111",this.labelPositionX=0,this.labelPositionY=0,this.labelText="",this.sliceArea=1,this.pieSlices=[],this.donutSlices=[],this.shapeEl,this.vertexEl,this.targetEl,this.selectEl,this.groupEl,this.vertex,this.selected=!1,this.mid,this.figureSize,this.maxPieSize,this.maxDonutSize,this.labelX=0,this.labelY=0,_.extend(this,a)}function DefaultEdgeRenderer(a){_.extend(this,Backbone.Events),this.shape="undirected",this.size=1,this.color="#cccccc",this.strokeSize=2,this.strokeColor="#aaaaaa",this.opacity=1,this.labelSize=0,this.labelColor="#111111",this.labelText="",this.el,this.edgeEl,this.labelEl,this.targetEl,this.edge,this.selected=!1,this.sourceCoords,this.targetCoords,this.sourceRenderer,this.targetRenderer,_.extend(this,a)}function DefaultVertexRenderer(a){_.extend(this,Backbone.Events),this.shape="circle",this.size=20,this.color="#9fc6e7",this.strokeSize=1,this.strokeColor="#9fc6e7",this.opacity=.8,this.labelSize=12,this.labelColor="#111111",this.labelText="",this.el,this.vertexEl,this.targetEl,this.selectEl,this.groupEl,this.vertex,this.selected=!1,_.extend(this,a)}function EdgeConfig(a){this.id,this.rendererConfig={},this.renderer=new DefaultEdgeRenderer(this.rendererConfig),this.type,this.visible,_.extend(this,a),this.renderer.setConfig(this.rendererConfig)}function Edge(a){this.id="e"+Utils.genId(),this.relation="",this.source,this.target,this.weight,this.directed,this.overlapCount,_.extend(this,a)}function Graph(a){_.extend(this,Backbone.Events),this.id=Utils.genId("Graph"),this.vertices=[],this.edges=[],this.display={style:{},layouts:{}},this.numberOfVertices=0,this.numberOfEdges=0,this.graphType="",_.extend(this,a),this.verticesIndex={},this.edgesIndex={},this.edgeDraw={},this.on(this.handlers)}function NetworkConfig(a){_.extend(this,Backbone.Events),this.id=Utils.genId("NetworkConfig"),this.session,_.extend(this,a),this.vertices={},this.edges={},this.on(this.handlers)}function NetworkSession(){this.version=1,this.general={vertexDefaults:{shape:"circle",size:40,color:"#fff",strokeSize:2,strokeColor:"#888888",opacity:.8,labelSize:12,labelColor:"#111111"},edgeDefaults:{shape:"undirected",size:1,color:"#888888",opacity:1,labelSize:0,labelColor:"#111111"},visualSets:{},zoom:25,backgroundImages:[],backgroundColor:"#FFF",center:{x:0,y:0}},this.config={vertices:{},edges:{}},this.graph={vertices:{},edges:{}},this.attributes={vertices:{},edges:{}}}function Network(a){var b=this;_.extend(this,Backbone.Events),this.id=Utils.genId("Network"),_.extend(this,a),this.graph=new Graph,this.config=new NetworkConfig;var c=[{name:"id",type:"string",defaultValue:"none",locked:!0},{name:"Name",type:"string",defaultValue:"none"}],d=[{name:"id",type:"string",defaultValue:"none",locked:!0},{name:"Name",type:"string",defaultValue:"none"},{name:"Relation",type:"string",defaultValue:"none"}];this.vertexAttributeManager=new AttributeManagerStore({attributes:c,handlers:{"change:attributes":function(a){b.trigger("change:vertexAttributes",a)}}}),this.edgeAttributeManager=new AttributeManagerStore({attributes:d,handlers:{"change:attributes":function(a){b.trigger("change:edgeAttributes",a)}}}),this.batchFlag=!1,this.on(this.handlers)}function VertexConfig(a){var b=Math.floor(500*Math.random()+30),c=Math.floor(500*Math.random()+30),d=Math.floor(500*Math.random()+30);this.id,this.coords={x:b,y:c,z:d},this.rendererConfig={},this.renderer=new CircosVertexRenderer(this.rendererConfig),this.type,this.visible,_.extend(this,a),this.renderer.setConfig(this.rendererConfig)}function Vertex(a){this.id="v"+Utils.genId(),this.edges=[],this.edgesIndex={},_.extend(this,a)}function DataSource(){}function FileDataSource(a){DataSource.prototype.constructor.call(this),_.extend(this,Backbone.Events),this.file,this.maxSize=524288e3,this.type="text",_.extend(this,a)}function StringDataSource(a){DataSource.prototype.constructor.call(this),_.extend(this,Backbone.Events),this.str=a}function TabularDataAdapter(a,b){var c=this;if(this.dataSource=a,this.async=!0,null!=b&&null!=b.async&&(this.async=b.async),this.fileLines=[],this.async)this.dataSource.success.addEventListener(function(a,b){c.parse(b),c.onLoad.notify()}),this.dataSource.fetch(this.async);else{var d=this.dataSource.fetch(this.async);this.parse(d)}this.onLoad=new Event}function UrlDataSource(a,b){DataSource.prototype.constructor.call(this),this.url=a,this.proxy=CELLBASE_HOST+"/latest/utils/proxy?url=",null!=b&&null!=b.proxy&&("boolean"==typeof b.proxy?0==b.proxy?this.proxy=!1:this.url=this.proxy+a:"string"==typeof b.proxy&&(this.url=b.proxy+a)),this.success=new Event,this.error=new Event}function FeatureDataAdapter(a,b){_.extend(this,Backbone.Events),this.dataSource=a,this.gzip=!0,this.params={},null!=b&&(null!=b.gzip&&(this.gzip=b.gzip),null!=b.species&&(this.species=b.species),null!=b.params&&(this.params=b.params)),this.featureCache=new FileFeatureCache({chunkSize:1e4,gzip:this.gzip}),this.chromosomesLoaded={}}function BamAdapter(a){if(_.extend(this,Backbone.Events),"undefined"!=typeof a){this.host=a.host||this.host,this.category=a.category||this.category,this.resource=a.resource||this.resource,this.params=a.params||this.params,this.filters=a.filters||this.filters,this.options=a.options||this.options,this.species=a.species||this.species;var b=a.featureCache||{}}if(null!=a&&null!=a.featureConfig&&(null!=a.featureConfig.filters&&(this.filtersConfig=a.featureConfig.filters),null!=a.featureConfig.options)){this.optionsConfig=a.featureConfig.options;for(var c=0;c<this.optionsConfig.length;c++)1==this.optionsConfig[c].checked&&(this.options[this.optionsConfig[c].name]=!0,this.params[this.optionsConfig[c].name]=!0)}this.featureCache=new BamCache(b)}function BEDDataAdapter(a,b){FeatureDataAdapter.prototype.constructor.call(this,a,b);this.async=!0,this.parseFunction,null!=b&&null!=b.parseFunction&&(this.parseFunction=b.parseFunction),this.featuresCount=0,this.featuresByChromosome={},null!=b&&null!=b.async&&(this.async=b.async)}function CellBaseAdapter(a){_.extend(this,Backbone.Events),this.host,this.version,_.extend(this,a),this.on(this.handlers),this.cache={}}function DasAdapter(a){_.extend(this,Backbone.Events),this.id=Utils.genId("DasAdapter"),this.gzip=!0,this.proxy=CELLBASE_HOST+"/latest/utils/proxy?url=",this.url,this.species,this.featureCache,this.params={},_.extend(this,a),this.on(this.handlers),this.featureCache=new FeatureCache(this.featureCache)}function EnsemblAdapter(a){_.extend(this,Backbone.Events),_.extend(this,a),this.on(this.handlers),this.cache={}}function GFF2DataAdapter(a,b){FeatureDataAdapter.prototype.constructor.call(this,a,b);this.async=!0,this.featuresCount=0,this.featuresByChromosome={},null!=b&&null!=b.async&&(this.async=b.async)}function GFF3DataAdapter(a,b){FeatureDataAdapter.prototype.constructor.call(this,a,b);this.async=!0,this.featuresCount=0,this.featuresByChromosome={},null!=b&&null!=b.async&&(this.async=b.async)}function GTFDataAdapter(a,b){FeatureDataAdapter.prototype.constructor.call(this,a,b);this.async=!0,this.featuresCount=0,this.featuresByChromosome={},null!=b&&null!=b.async&&(this.async=b.async)}function OpencgaAdapter(a){_.extend(this,Backbone.Events),_.extend(this,a),this.on(this.handlers),this.cache={}}function SequenceAdapter(a){_.extend(this,Backbone.Events),this.id=Utils.genId("TrackListPanel"),this.host,this.version,this.gzip=!0,_.extend(this,a),this.sequence={},this.start={},this.end={},this.on(this.handlers)}function VCFDataAdapter(a,b){FeatureDataAdapter.prototype.constructor.call(this,a,b);this.async=!0,this.featuresCount=0,this.featuresByChromosome={},this.header="",this.samples=[],null!=b&&null!=b.async&&(this.async=b.async)}function AttributeNetworkDataAdapter(a){var b=this;if(_.extend(this,Backbone.Events),this.dataSource,this.async=!0,this.jsonObject,this.ignoreColumns={},_.extend(this,a),this.attributes=[],this.data=[],this.on(this.handlers),this.async)this.dataSource.on("success",function(a){b.parse(a)}),this.dataSource.fetch(this.async);else{var c=this.dataSource.fetch(this.async);b.parse(c)}}function DOTDataAdapter(a){NetworkDataAdapter.prototype.constructor.call(this,a),this.vertexSubgraph={},this.addedVertex={}}function JSONNetworkDataAdapter(a){var b=this;if(_.extend(this,Backbone.Events),this.dataSource,this.async=!0,this.jsonObject,_.extend(this,a),this.on(this.handlers),this.async)this.dataSource.on("success",function(a){b.parse(a)}),this.dataSource.fetch(this.async);else{var c=this.dataSource.fetch(this.async);this.jsonObject=JSON.parse(c)}}function SIFNetworkDataAdapter(a){var b=this;if(_.extend(this,Backbone.Events),this.dataSource,this.async=!0,this.separator="	",this.graph=new Graph,_.extend(this,a),this.on(this.handlers),this.async)this.dataSource.on("success",function(a){b.parse(a)}),this.dataSource.fetch(this.async);else{var c=this.dataSource.fetch(this.async);this.parse(c)}this.addedVertex,this.addedEdges}function TextNetworkDataAdapter(a){var b=this;if(_.extend(this,Backbone.Events),this.dataSource,this.async=!0,this.separator="	",this.graph=new Graph,_.extend(this,a),this.on(this.handlers),this.rawData,this.async)this.dataSource.on("success",function(a){b.rawData=a,b.parse(a)}),this.dataSource.fetch(this.async);else{var c=this.dataSource.fetch(this.async);b.rawData=c,this.parse(c)}this.columnLength,this.addedVertex,this.addedEdges}function XLSXNetworkDataAdapter(a){var b=this;if(_.extend(this,Backbone.Events),this.dataSource,this.async=!0,this.graph=new Graph,this.xlsx,_.extend(this,a),this.on(this.handlers),this.async)this.dataSource.on("success",function(a){b.parse(a)}),this.dataSource.fetch(this.async);else{var c=this.dataSource.fetch(this.async);this.parse(c)}}function MemoryStore(a){_.extend(this,Backbone.Events),_.extend(this,a),this.size=0,this.store={}}function FeatureChunkCache(a){_.extend(this,Backbone.Events),this.id=Utils.genId("FeatureChunkCache"),this.chunkSize=5e4,this.limit,_.extend(this,a),this.store=new MemoryStore({}),this.verbose=!1}function FileFeatureCache(a){this.args=a,this.id=Math.round(1e7*Math.random()),this.chunkSize=5e4,this.gzip=!0,this.maxSize=10485760,this.size=0,null!=a&&(null!=a.chunkSize&&(this.chunkSize=a.chunkSize),null!=a.gzip&&(this.gzip=a.gzip)),this.cache={},this.chunksDisplayed={},this.maxFeaturesInterval=0,this.gzip=!1}function BamCache(a){this.args=a,this.id=Math.round(1e7*Math.random()),this.chunkSize=5e4,this.gzip=!0,this.maxSize=10485760,this.size=0,null!=a&&(null!=a.chunkSize&&(this.chunkSize=a.chunkSize),null!=a.gzip&&(this.gzip=a.gzip)),this.cache={},this.maxFeaturesInterval=0,this.gzip=!1}function NavigationBar(a){_.extend(this,Backbone.Events);this.id=Utils.genId("NavigationBar"),this.cellBaseHost="http://www.ebi.ac.uk/cellbase/webservices/rest",this.cellBaseVersion="v3",this.species="Homo sapiens",this.increment=3,this.componentsConfig={leftSideButton:!1,restoreDefaultRegionButton:!0,regionHistoryButton:!0,speciesButton:!0,chromosomesButton:!0,karyotypeButton:!0,chromosomeButton:!0,regionButton:!0,zoomControl:!0,windowSizeControl:!0,positionControl:!0,moveControl:!0,autoheightButton:!0,compactButton:!0,searchControl:!0},this.zoom=100,_.extend(this.componentsConfig,a.componentsConfig),delete a.componentsConfig,_.extend(this,a),this.region=new Region(this.region),this.currentChromosomeList=[],this.on(this.handlers),this.els={},this.zoomChanging=!1,this.regionChanging=!1,this.rendered=!1,this.autoRender&&this.render()}function ChromosomePanel(a){_.extend(this,Backbone.Events),this.id=Utils.genId("ChromosomePanel"),this.target,this.autoRender=!0,this.cellBaseHost="http://www.ebi.ac.uk/cellbase/webservices/rest",this.cellBaseVersion="v3",this.pixelBase,this.species="hsapiens",this.width=600,this.height=75,this.collapsed=!1,this.collapsible=!1,_.extend(this,a),this.region=new Region(this.region),this.lastChromosome="",this.data,this.on(this.handlers),this.regionChanging=!1,this.rendered=!1,this.autoRender&&this.render()
}function KaryotypePanel(a){_.extend(this,Backbone.Events),this.target,this.autoRender=!0,this.id=Utils.genId("KaryotypePanel"),this.cellBaseHost="http://www.ebi.ac.uk/cellbase/webservices/rest",this.cellBaseVersion="v3",this.pixelBase,this.species,this.width=600,this.height=75,this.collapsed=!1,this.collapsible=!0,_.extend(this,a),this.region=new Region(this.region),this.lastSpecies=this.species,this.chromosomeList,this.data2,this.on(this.handlers),this.regionChanging=!1,this.rendered=!1,this.autoRender&&this.render()}function StatusBar(a){_.extend(this,Backbone.Events);this.id=Utils.genId("StatusBar"),this.target,this.autoRender=!0,_.extend(this,a),this.region=new Region(this.region),this.rendered=!1,this.autoRender&&this.render()}function TrackListPanel(a){_.extend(this,Backbone.Events),this.cellBaseHost="http://www.ebi.ac.uk/cellbase/webservices/rest",this.cellBaseVersion="v3",this.target,this.autoRender=!0,this.id=Utils.genId("TrackListPanel"),this.collapsed=!1,this.collapsible=!1,this.fontClass="ocb-font-sourcesanspro ocb-font-size-14",this.tracks=[],this.tracksIndex={},this.parentLayout,this.mousePosition,this.windowSize,this.zoomMultiplier=1,this.showRegionOverviewBox=!1,this.height=0,_.extend(this,a),this.region=new Region(this.region),this.width-=18,this.status,this.visualRegion=new Region(this.region),this._setPixelBase(),this.on(this.handlers),this.regionChanging=!1,this.rendered=!1,this.autoRender&&this.render()}function Track(a){if(this.id=Utils.genId("track"),this.dataAdapter,this.renderer,this.resizable=!0,this.autoHeight=!1,this.targetId,this.title,this.minHistogramRegionSize=3e8,this.maxLabelRegionSize=3e8,this.width=200,this.height=100,this.visibleRegionSize,this.visible=!0,this.closable=!1,this.fontClass="ocb-font-sourcesanspro ocb-font-size-14",_.extend(this,a),this.pixelBase,this.svgCanvasWidth=5e5,this.pixelPosition=this.svgCanvasWidth/2,this.svgCanvasOffset,this.svgCanvasFeatures,this.status,this.histogram,this.histogramLogarithm,this.histogramMax,this.interval,this.svgCanvasLeftLimit,this.svgCanvasRightLimit,this.invalidZoomText,this.renderedArea={},this.chunksDisplayed={},"handlers"in this)for(eventName in this.handlers)this.on(eventName,this.handlers[eventName]);this.rendered=!1,this.autoRender&&this.render()}function BamTrack(a){Track.call(this,a),_.extend(this,Backbone.Events),this.defaultRenderer=this.renderer,this.histogramRenderer=new HistogramRenderer,this.chunksDisplayed={},_.extend(this,a),this.dataType="features"}function FeatureTrack(a){Track.call(this,a),_.extend(this,Backbone.Events),this.defaultRenderer=this.renderer,this.histogramRenderer=new HistogramRenderer(a),this.featureType="Feature",_.extend(this,a),this.resource=this.dataAdapter.resource,this.species=this.dataAdapter.species,this.dataType="features"}function GeneTrack(a){Track.call(this,a),_.extend(this,Backbone.Events),this.minTranscriptRegionSize,this.defaultRenderer=this.renderer,this.histogramRenderer=new HistogramRenderer(a),_.extend(this,a),this.exclude}function SequenceTrack(a){a.resizable=!1,Track.call(this,a),_.extend(this,Backbone.Events),_.extend(this,a)}function Renderer(){}function BamRenderer(a){Renderer.call(this,a),_.extend(this,Backbone.Events),this.fontClass="ocb-font-sourcesanspro ocb-font-size-12",this.toolTipfontClass="ocb-tooltip-font",_.isObject(a)&&_.extend(this,a),this.on(this.handlers)}function ConservedRenderer(a){Renderer.call(this,a),_.extend(this,Backbone.Events),_.extend(this,a)}function FeatureClusterRenderer(a){Renderer.call(this,a),_.extend(this,Backbone.Events),this.histogramHeight=75,this.multiplier=7,this.fontClass="ocb-font-sourcesanspro ocb-font-size-12",this.toolTipfontClass="ocb-tooltip-font",_.extend(this,a)}function FeatureRenderer(a){Renderer.call(this,a),_.extend(this,Backbone.Events),this.fontClass="ocb-font-sourcesanspro ocb-font-size-12",this.toolTipfontClass="ocb-tooltip-font",_.isObject(a)&&_.extend(this,a),this.on(this.handlers)}function GeneRenderer(a){Renderer.call(this,a),_.extend(this,Backbone.Events),this.fontClass="ocb-font-sourcesanspro ocb-font-size-12",this.toolTipfontClass="ocb-tooltip-font",_.isObject(a)&&_.extend(this,a),this.on(this.handlers)}function HistogramRenderer(a){Renderer.call(this,a),_.extend(this,Backbone.Events),this.histogramHeight=75,this.maxValue=10,null!=a&&(null!=a.height&&(this.histogramHeight=.95*a.height),null!=a.histogramMaxFreqValue&&(this.maxValue=a.histogramMaxFreqValue)),this.multiplier=this.histogramHeight/this.maxValue,_.extend(this,a)}function SequenceRenderer(a){Renderer.call(this,a),_.extend(this,Backbone.Events),this.fontClass="ocb-font-ubuntumono ocb-font-size-16",this.toolTipfontClass="ocb-tooltip-font",_.extend(this,a)}function VcfMultisampleRenderer(a){Renderer.call(this,a),_.extend(this,Backbone.Events),this.fontClass="ocb-font-sourcesanspro ocb-font-size-12",this.toolTipfontClass="ocb-tooltip-font",_.isObject(a)&&_.extend(this,a),this.on(this.handlers)}function GenomeViewer(a){_.extend(this,Backbone.Events);this.id=Utils.genId("GenomeViewer"),this.autoRender=!0,this.version='Powered by <a target="_blank" href="http://www.genomemaps.org/">Genome Maps</a>',this.target,this.width,this.height,this.cellBaseHost="http://www.ebi.ac.uk/cellbase/webservices/rest",this.cellBaseVersion="v3",this.quickSearchResultFn,this.quickSearchDisplayKey,this.drawNavigationBar=!0,this.drawKaryotypePanel=!0,this.drawChromosomePanel=!0,this.drawOverviewTrackListPanel=!0,this.overviewZoomMultiplier=8,this.karyotypePanelConfig={collapsed:!1,collapsible:!0},this.chromosomePanelConfig={collapsed:!1,collapsible:!0},this.regionPanelConfig={collapsed:!1,collapsible:!0},this.navigationBarConfig={},this.drawStatusBar=!0,this.resizable=!0,this.sidePanel=!0,this.trackListTitle="Detailed information",this.trackPanelScrollWidth=18,this.availableSpecies={text:"Species",items:[{text:"Vertebrates",items:[{text:"Homo sapiens",assembly:"GRCh37.p10",region:{chromosome:"13",start:32889611,end:32889611},chromosomes:["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","X","Y","MT"],url:"ftp://ftp.ensembl.org/pub/release-71/"},{text:"Mus musculus",assembly:"GRCm38.p1",region:{chromosome:"1",start:18422009,end:18422009},chromosomes:["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","X","Y","MT"],url:"ftp://ftp.ensembl.org/pub/release-71/"}]}]},this.species=this.availableSpecies.items[0].items[0],this.zoom,this.chromosomes,this.chromosomeList,_.extend(this,a),this.defaultRegion=new Region(this.region),this.sidePanelWidth=this.sidePanel?25:0,this.on(this.handlers),this.fullscreen=!1,this.resizing=!1,this.changingRegion=!1,this.rendered=!1,this.autoRender&&this.render()}var Utils={characters:"abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789",number:{sign:function(a){return a?0>a?-1:1:0}},formatNumber:function(a){return a.toString().replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1,")},formatText:function(a,b){return a=a.replace(new RegExp(b,"gi")," "),a=a.charAt(0).toUpperCase()+a.slice(1)},isFunction:function(a){return"function"==typeof a||a instanceof Function},parseDate:function(a){return a.substring(0,4)+" "+a.substring(4,6)+" "+a.substring(6,8)+", "+a.substring(8,10)+":"+a.substring(10,12)+":"+a.substring(12,14)},genId:function(a){return a=a||"",a=0==a.length?a:a+"-",a+this.randomString()},randomString:function(a){a=a||10;for(var b="",c=0;a>c;c++)b+=this.characters.charAt(this.getRandomInt(0,this.characters.length-1));return b},getRandomInt:function(a,b){return Math.floor(Math.random()*(b-a+1))+a},endsWithIgnoreCase:function(a,b){var c=new RegExp("^.*\\.("+b+")$","i");return c.test(a)},endsWith:function(a,b){var c=new RegExp("^.*\\.("+b+")$");return c.test(a)},addQueryParamtersToUrl:function(a,b){var c="?";-1!=b.indexOf("?")&&(c="&");var d="";for(var e in a)null!=a[e]&&(d+=e+"="+a[e].toString()+"&");return""!=d&&(d=c+d.substring(0,d.length-1)),b+d},randomColor:function(){for(var a="",b=0;6>b;b++)a+=[0,1,2,3,4,5,6,7,8,9,"a","b","c","d","e","f"][Math.floor(16*Math.random())];return"#"+a},colorLuminance:function(a,b){a=String(a).replace(/[^0-9a-f]/gi,""),a=String(a).replace(/#/gi,""),a.length<6&&(a=a[0]+a[0]+a[1]+a[1]+a[2]+a[2]),b=b||0;var c,d,e="#";for(d=0;3>d;d++)c=parseInt(a.substr(2*d,2),16),c=Math.round(Math.min(Math.max(0,c+c*b),255)).toString(16),e+=("00"+c).substr(c.length);return e},getSpeciesFromAvailable:function(a,b){for(var c=0;c<a.items.length;c++)for(var d=a.items[c].items,e=0;e<d.length;e++){var f=d[e];if(this.getSpeciesCode(f.text)==b)return f}},getSpeciesCode:function(a){var b,c=a.split(" ");return b=c.length<3?(c[0].charAt(0)+c[1]).toLowerCase():(c[0].charAt(0)+c[1]+c[c.length-1].replace(/[/_().\-]/g,"")).toLowerCase()},test:function(){return this},cancelFullscreen:function(){document.cancelFullScreen?document.cancelFullScreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen()},launchFullScreen:function(a){a.requestFullScreen?a.requestFullScreen():a.mozRequestFullScreen?a.mozRequestFullScreen():a.webkitRequestFullScreen&&a.webkitRequestFullScreen()},parseJobCommand:function(a){var b={},c=a.commandLine.split(/ -{1,2}/g),d='<table cellspacing="0" style="max-width:400px;border-collapse: collapse;border:1px solid #ccc;"><tbody>';d+='<tr style="border-collapse: collapse;border:1px solid #ccc;font-weight:bold;">',d+='<td style="min-width:50px;border-collapse: collapse;border:1px solid #ccc;padding: 5px;background-color: whiteSmoke;">Parameter</td>',d+='<td style="border-collapse: collapse;border:1px solid #ccc;padding: 5px;background-color: whiteSmoke;">Value</td>',d+="</tr>";for(var e=1;e<c.length;e++){var f=c[e],g=f.split(/ {1}/g),h="",i="";g.length<2?(h=g[0],i="<span color:darkgray;font-weight:bold;>This paramenter is a flag</span>"):(h=g[0],i=g[1]),b[h]=i,i=i.replace(/\/httpd\/bioinfo\/opencga\/analysis\/.+\/examples\//,""),i=i.replace("/httpd/bioinfo/opencga/accounts/",""),i=i.replace(/,/g,", "),d+='<tr style="border-collapse: collapse;border:1px solid #ccc;">',d+='<td style="border-collapse: collapse;border:1px solid #ccc;padding: 5px;background-color: whiteSmoke;color:steelblue;font-weight:bold;white-space: nowrap;">'+h+"</td>",d+='<td style="border-collapse: collapse;border:1px solid #ccc;padding: 5px;background-color: whiteSmoke;">'+i+"</td>",d+="</tr>"}return d+="</tbody></table>",{html:d,data:b}},htmlTable:function(a){var b="";b+='<table cellspacing="0" style="border-collapse: collapse;border:1px solid #ccc;"><tbody>';for(var c in a)b+='<tr style="border-collapse: collapse;border:1px solid #ccc;">',b+='<td style="border-collapse: collapse;border:1px solid #ccc;padding: 5px;background-color: whiteSmoke;color:steelblue;font-weight:bold;white-space: nowrap;">'+c+"</td>",b+='<td style="border-collapse: collapse;border:1px solid #ccc;padding: 5px;background-color: whiteSmoke;">'+a[c]+"</td>",b+="</tr>";return b+="</tbody></table>"},camelCase:function(a){return a.toLowerCase().replace(/[.-_\s](.)/g,function(a,b){return b.toUpperCase()})},msg:function(a,b){var c=$('<div class="ocb-msg-hidden"><div>'+a+"</div><div>"+b+"</div></div>")[0];$("body").append(c),setTimeout(function(){$(c).addClass("ocb-msg-shown")},10),setTimeout(function(){$(c).removeClass("ocb-msg-shown")},2e3),setTimeout(function(){$(c).remove()},2200)}};Utils.images={add:"data:image/gif;base64,R0lGODlhEAAQAIcAAD2GNUKNNkOPOESMO0WNPEmPP0iNQUmPQlOVTFWWTVCZQVeeRV6cVmGeWGSgVWSgV2aiWGejW2WrVWirU2uqWGqsW2yqWm61WG+1WG+1WXS3W3S3XHC4WXK5W3O6XHG+X3asZ3iuaHe8YHi0ZH+yany6ZH28Zn2+Z3m9bn25an25a3+5bUD/QHDBY3nBZHrGa3zDa37BaX7Hb4K1boO1boa3cYi4d4y7doq5eYm+eI2+e5O/f4HMdYbJeobJfIXNeYrCeY/CfYnIf4rPfZW/gozLgY7MhI7Sg5LFgJXAgpfHhZfMhZPNiJjLhpjMh5jMipvBl5vBmJTTipbTiZXUipbUi5fVi5nRi53YkqTOlKbPlqbQlqDZlaDZlqXbm6rUnavUnKbIoKfJoa/fpa/fprPZpbTZpbTaprLbqLPdqbXbqLfaqrTdqrXfrLbdrLjVr7jdr7vcr7rWsbfgr77itr3ktsTcuMXducXowMvmw87pydTrz9fu0tzx2ODy3P///wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAMAACwALAAAAAAQABAAAAi/AFkIHEiwoME7SWrMwCHH4MAdWfLs0QNnRQiHN+L4qeOlyxg8QCAU3LGmDxYmRqpQOTJHRYSBdpTw4SJFyJ8/P2DIaLNAjEAibsgU8YHiZgURHq4gaSCQBh0rPW5K/cMhxpcCAkmkGcJj6k0OJ8AMEGjjyZQXLSR85dBhiY4EAt9MYOPig4ivFzacEQBlIIgUaJByyIBBQxkLBwo6GKHGiYkSTcxQAODwgYIgW7TkCGDAocAwDAoQQBDFs2mCAQEAOw==",del:"data:image/gif;base64,R0lGODlhEAAQAIcAAED/QLpSNL9TOr5WOb5cQL9cQMFNM8RQNMBVPcBZP8xSPNBPPttWS9ddUcJnTMRkTMdrVM1gUc5iVMxmVclrVs1oWNZgVNZuZNtpZdxraN5ratxuadRxZd14c955dOZWTOZYTOZZTulZTelbT+ZWUOZaUuddWepcUOxfVOBlXO5mUuljW+pmXO5qXvBkVvNzXeNrYeNuY+FvcOJwZuJ7deR4ceJ5eeN4eeJ/feN/fOl7cOh6del/ePJ3Y/N5Y+qDfe6Efe+Gfu6KdfaCaPaEbPCFcPCDe/CMd/GOeviGcPiMdvCRf/eRfveTfvmSfvqTf/iUf9ymltynl+6Mge2Tju6Sj/SOgfqah/qdi/GclvGdluGpnvSgnvSinvWjn/qjkfupnPqrneGroOqwrOuzr/Ono/WmoferofarovWsofWvpfKtqvivpPS0qvi2qPm5r/q6rvC1tfC2tvjDvvzHuvnLxPnTzPzUzf3b1P3c2P///wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAMAAAAALAAAAAAQABAAAAi6AAEIHEiwoEE5ODRk8EDG4EAbVObYqdNmxgWHMtbkgfMFCxg6OiQUvFEGz5UlSKA4UeImRoWBcX7cwdJECJGbRHywWSBGYA41YY6gGEq0hxUeFARuePOkiJ6nUEW00IJAIIYzSYZAjcoiywCBHaYweSGirNkRRmg8EDiGARoXKsyKAFHCy4EoAznASIPihIgQH0h0sVCgYIQUZoKsMAGES4MADico2FGlSg0DBBwK3AIhgQAHUjSLJhgQADs=",enable:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAKfSURBVDjLpZPrS1NhHMf9O3bOdmwDCWREIYKEUHsVJBI7mg3FvCxL09290jZj2EyLMnJexkgpLbPUanNOberU5taUMnHZUULMvelCtWF0sW/n7MVMEiN64AsPD8/n83uucQDi/id/DBT4Dolypw/qsz0pTMbj/WHpiDgsdSUyUmeiPt2+V7SrIM+bSss8ySGdR4abQQv6lrui6VxsRonrGCS9VEjSQ9E7CtiqdOZ4UuTqnBHO1X7YXl6Daa4yGq7vWO1D40wVDtj4kWQbn94myPGkCDPdSesczE2sCZShwl8CzcwZ6NiUs6n2nYX99T1cnKqA2EKui6+TwphA5k4yqMayopU5mANV3lNQTBdCMVUA9VQh3GuDMHiVcLCS3J4jSLhCGmKCjBEx0xlshjXYhApfMZRP5CyYD+UkG08+xt+4wLVQZA1tzxthm2tEfD3JxARH7QkbD1ZuozaggdZbxK5kAIsf5qGaKMTY2lAU/rH5HW3PLsEwUYy+YCcERmIjJpDcpzb6l7th9KtQ69fi09ePUej9l7cx2DJbD7UrG3r3afQHOyCo+V3QQzE35pvQvnAZukk5zL5qRL59jsKbPzdheXoBZc4saFhBS6AO7V4zqCpiawuptwQG+UAa7Ct3UT0hh9p9EnXT5Vh6t4C22QaUDh6HwnECOmcO7K+6kW49DKqS2DrEZCtfuI+9GrNHg4fMHVSO5kE7nAPVkAxKBxcOzsajpS4Yh4ohUPPWKTUh3PaQEptIOr6BiJjcZXCwktaAGfrRIpwblqOV3YKdhfXOIvBLeREWpnd8ynsaSJoyESFphwTtfjN6X1jRO2+FxWtCWksqBApeiFIR9K6fiTpPiigDoadqCEag5YUFKl6Yrciw0VOlhOivv/Ff8wtn0KzlebrUYwAAAABJRU5ErkJggg==",warning:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAIsSURBVDjLpVNLSJQBEP7+h6uu62vLVAJDW1KQTMrINQ1vPQzq1GOpa9EppGOHLh0kCEKL7JBEhVCHihAsESyJiE4FWShGRmauu7KYiv6Pma+DGoFrBQ7MzGFmPr5vmDFIYj1mr1WYfrHPovA9VVOqbC7e/1rS9ZlrAVDYHig5WB0oPtBI0TNrUiC5yhP9jeF4X8NPcWfopoY48XT39PjjXeF0vWkZqOjd7LJYrmGasHPCCJbHwhS9/F8M4s8baid764Xi0Ilfp5voorpJfn2wwx/r3l77TwZUvR+qajXVn8PnvocYfXYH6k2ioOaCpaIdf11ivDcayyiMVudsOYqFb60gARJYHG9DbqQFmSVNjaO3K2NpAeK90ZCqtgcrjkP9aUCXp0moetDFEeRXnYCKXhm+uTW0CkBFu4JlxzZkFlbASz4CQGQVBFeEwZm8geyiMuRVntzsL3oXV+YMkvjRsydC1U+lhwZsWXgHb+oWVAEzIwvzyVlk5igsi7DymmHlHsFQR50rjl+981Jy1Fw6Gu0ObTtnU+cgs28AKgDiy+Awpj5OACBAhZ/qh2HOo6i+NeA73jUAML4/qWux8mt6NjW1w599CS9xb0mSEqQBEDAtwqALUmBaG5FV3oYPnTHMjAwetlWksyByaukxQg2wQ9FlccaK/OXA3/uAEUDp3rNIDQ1ctSk6kHh1/jRFoaL4M4snEMeD73gQx4M4PsT1IZ5AfYH68tZY7zv/ApRMY9mnuVMvAAAAAElFTkSuQmCC",edit:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAB80lEQVR42o2T30tTURzArb8ioiAI6kHoZeF7CGE/IISCUDNCqAeL3rIWPfSwByskYUEJIhSChBhJFAiNqMVYPqRuc4tcW3NLt3C7u3d3d3c/+nS+0GRK0134cC6c8/ncc+7ltgFt6jqgcCg6duGQYq84deoBR6lU0iqVSq1arfI/1Dxut3u0Htke6BC5UChgmuYm+XyeXC5HOp1GIsnQNJHJi3x/7WJh/CSLT9r7Rd4jAVlgWRa2bSOjYBgGmqaRyWQwkq9Y8wyhLb0BI0VuaRrfo671xoDIwmakWCyi6zrr36bILt/HXp1l7cNDioEZqnEvgYmr1paAOgYy1u/l3NrqHNngPWpFL8XodTa+3CD8YoCvz/o078i5o1sC29FT78kG7lCzfJgrl7ESvejLThLPuxk8fbhP3KaBVFCdeX7on9yP9bOHfPAu0bEzmKkg4jQNpEKzhOduqW1/xIoNUEpcQlM7WXl6Cj39Q9Y0D4Q/TRJ662Tx3WOS/guYsV42Fm4THe/G/B2T97Jz4OVwJ+hxImPn8Tj381k91TfShfErIvLuAde1Y9g+N7Z/FL/rBDODR8gmgpTL5To7B3o69zF8pR3Pg7PMT90kn47LJ22kaeCPghapidP4Lxy3bduUiVZktdaQH7AxcFAiUm0Rhzji/gUhbp0s2Zf2xwAAAABJRU5ErkJggg==",info:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAIGNIUk0AAHolAACAgwAA+f8AAIDpAAB1MAAA6mAAADqYAAAXb5JfxUYAAAJ1SURBVHjafJJdSJNhFMd/z3QzLWdZrnQmSA2DPqRCK4KuhIq66kLoAy/qoqCguqqL6JsgLwoKKhCMSIy6CDKKRFZZYYQRVhJl02nWmG5uc19u7/vuPV0lW7QOnIsHnt+P8z/Pg4gw26aZ0263uzEUCn2IxWJjXq/3JqBETLIZ8gkePLhfKyKy/Z5HHJf7xe0Jic/n65mejizPK0inUiSTKUSE0dHRhxf6JoSDb4Rjr4QDz0REJBgMtmczFrJKKYVSCjCYnPR/W1FuAwQSGjbHXAA0LRXKZnIm0NJpgAKvd/hSOBz2iIj0eiPS2vtDYsmUPH/uPg9YshklIrOyCb+/eUG5ve3au5C99W2AqGbgKivk8R4X1lSkv2pJZaNmmBQVWWeZnAiGoa+3KovdyBjsW2kn/SvK4Jcgtaf7cDqrGkQMUDkBcgXVS2tOHjp8dG2jOXT1yo5lYOpgFTB0wKTAOqdQMlqOoDD7EE8kREwGXr/oWTg4HjxONAklBayuKSUeT/hFTxrwnwlAMa8I1qyrP3H95RiQgUiC/RsWM+wZ6jIME0M38wtSM0mmojM4nc6mzr5xKDQgnWb/pmoedT29EU3pTMUS+QVKKerq6kqnI3EVHwmAplO8qBh7WTFnzpz9bOg6FovlfxGEixfOrfT6YxCOQ1rDUaIAG4EJ38+PAwNb/95Bzj8ITAZwLHbMT0yHw3N33YVwEnQDqss41VzPkaalX6Iz+m6Xy/Xp34JAAICR7187nLWuvbe6h9C0DA2uRTTVV9J++87OlpaWJxUVFf9+xj+1cfOWls6OO93Nq1zblMVm9flG3pcvXNPm90+E/777ewB+UIqdqtYXHAAAAABJRU5ErkJggg==",bucket:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH3QkQDC8RTstxRAAAAGBJREFUOMtjYBgswIWBgeE/idiFgYGBgRFqwH8GBoYGEi1tYGBgYGRBE9QjUvMlGANmgCsDA8NuElzRANXDwAQV2ENGuO1BNoBsMGoAlQ3wJTIdNEDVYgU+ROQBH6rmQgAWgB19xco60wAAAABJRU5ErkJggg==",dir:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyRpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMy1jMDExIDY2LjE0NTY2MSwgMjAxMi8wMi8wNi0xNDo1NjoyNyAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNiAoTWFjaW50b3NoKSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDpDNzU0RUNBNzU3OEIxMUUyOEM3QzkxOEZDOTU1RTdFMCIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDpDNzU0RUNBODU3OEIxMUUyOEM3QzkxOEZDOTU1RTdFMCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkM3NTRFQ0E1NTc4QjExRTI4QzdDOTE4RkM5NTVFN0UwIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOkM3NTRFQ0E2NTc4QjExRTI4QzdDOTE4RkM5NTVFN0UwIi8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+S/WxbAAAAERJREFUeNpi/P//PwMlgJFSA1g2bNiAzYQLQOwIxB8IGcCEQ9wAiPcDsQBBF+CRAxnynlwXEA1GDRg1gCqZiWIDAAIMADidE0PBoGsZAAAAAElFTkSuQmCC",r:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAAXNSR0IArs4c6QAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB90CDRIvNbHTpbwAAADjSURBVDjLpZFBbsIwEEUfVRZYahcVK3qKXoauMFK5C91nkyUB+xC5BqeAA7SKq1B5ugl2EiC04UkjayzN17NnROTRWvvJFbTWL8CBHqbGWOlSlqVkWSbGWAGm3aGHZiMiAByPP6FOd1rP2W7NvhvSCvDe10E+VJPFQpPnm1ZIcsmgPgJVVZGmaejX63y/XL4/AV/JJYPTCeDcN7PZWyuwKAqA8wARqSsGKDVGqXGjV8H07AnRQPq21TK8+YSBAQMN4hb6Df7wB/5eA+4zmEyehxk451itPrhFksSxUeP+lf+z+wXwdayJk/mqtgAAAABJRU5ErkJggg==",box:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAAXNSR0IArs4c6QAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB9wMHAwRAVvTmTAAAAK/SURBVDjLpZM9bFxFGEXPNzPvZ+39sb2xHceREjDQBwlDCqqIiiotokAghYKEjvSkQkKJkEiB0lOkoAHaBAokFCQKUATIIOLIMbHWrHfX+7zvvZk3MzQODUgU3PJK5+g2F/5n5N/Kb66/1NNK3hAxr4HcFqVuvfju18V/Cu58sPmMVnJZ4K32Qr+t8za+KnCz4kCUuiGibm5euTv5h+CL958/nxj1XivVF+e6C9TVhPmFdbROgEhwNU1d4m09UaJuInLjhct3DgDUh5ee7j14PLxulLvYP/0seadPkub88Wib0eB3bDkmxgbRoFPpxeCuKvjsyQIzOyqImT7/y8Mh++NveW7jLFmrx6m1NlWxz6PHA7otQ7tloAmYJE9isOeeCJRtIrULLLUTjsqG7+//xs72z7jZgCTNONlVJKEiuobW0jqSaoiet19dFQATJcc2FSFEciNoLYwOHcPDASvdjM5cQntxlbR9gqacoFSK84VsnOrkH11Zdmp0FFXjobSeCFgXSDS0Eo11ge7yGXSaU092UUlCaEpC8FK4tDcu4rzZ2a/S+bWI94HSAgFigDQD24Cvp4gIOp0juBJvC2L07B1Uc/Mtg9k7sHMbywZrA3lLECV4AtaCpAp79CcmzXHlhOBrAJrGyNbOVBY7qTO1C9r5EKyPSttAiJEs01SuQStFkrdp6gKd5AzHjixVxCDxp+1paZRUxoc4Kp36bndYbS53U5WlCq0CMYIPMY7GI0mNpiqmGK0oK4jIveGkPgRqfTBt3A8Pqtvrq52HtglnGh9XIaKUkCQ6nj6RyWBsmdXCtFI/bu2Fq5c+3roGzIAgWokCDNACOhfOLb781Ip+vd+RC2dXWibROkxKvvp1z376yZe7d4HpMdz8/YVjiQYyoA30Ti6la2++0n/n83vTW/e3ix1gcgzXgPchBoC/AFu/UBF5InryAAAAAElFTkSuQmCC",bluebox:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAAXNSR0IArs4c6QAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB9wMHAwTE5pcivoAAALsSURBVDjLXZPPaxxlGMc/77wz+3N2k822tWsTIrQFe/BWEKxKCV5UohdFhJ60p6rgUfpP6C0K4kHx0ENEkV7aElHwUikhFVosRGoTm83+3pnZnXfed2beHtItIQ98+Z6+H57nga8AsNYKDkYcEofcHvKZEEJYcSTszPzqL3fmf3+w/+a51tytby9d6D0N5UecGeBZ8MPv/jh9fy/6dKzMpVPHmvWdbl/XCvKn5Wbl6+ufrNwGssMgYa2VgFj58sZr7VB/LqX3zlKrydJzTTzXxdqcx90hO+0Bk2l8Z74i1z6+cOba5VfOqGeAb3579M/NR53T40xwrDGHFALPEUjn4LoMi0ktwWTKXqCIqAVrbyycvHj2hHYBR+bO8Q/Ov0imEzZ2xrRDRalQwC9LLBalUgaJQy+tU6gvIBJbv3j2RA4IFxDdICFa9ulMCrz/UgOs5kEwpeh57I4Nt/dzsmLOYlEThgFjUePp33IHoD9SJAbuTVyudRweixJvnVtg3/i00wpLPiwQ0hkO6YYKawWj0UjONqAfKHwDkxTqqeW/RHA3hO2+Zqk05e5wTD9KmOqMKDEUqoLNzU0PyF2AQaBoaIhiw0h6TIwgUDCODb5NiWJNlKREyhAozXwOW1tbFSmlcAHbD2KaytCdGgyWglfEs4LeNKeaa4axYRgpwlgTTTXVDDqdTslaewAYh4kNlKUbZsTGonOwCYwm1vq5Ft1AMYgU08SQR5o0gziOcRxHuoCNtdl6uPHX6/Vmi3Yyh9I5IoEgMdkgT9x+qJhEGrdQo77cJMuy+4DJskwLa60DOCtf3HhZpfZKtVx+L3x+sfCv8CFxTINd72HfodQ4aQp5fP24/v/Hd4Nf/5RSJmma6lkXZn1wPvvq5qndsbhS9esf/Zy/UEtzxnURfn8+/fuHV7m353mecV1XSym1lDI72kaxvr5e3N7eruyP0tpG/e3LK/rW2mLNUb7vm3K5nFarVdNqtbJer2dXV1fzJ6cDpboAZRAGAAAAAElFTkSuQmCC",refresh:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAAXNSR0IArs4c6QAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAAK8AAACvABQqw0mAAAAAd0SU1FB90CFA8bKScXIjIAAAJ1SURBVDjLlVJdSJNRGH7es+/7NlduWFLTKAskwjJqZYiBglJhLKguqou6EFkFIkLQH9IPBFI3BsouzMJupGYRajcqmeBFhWBU5oUgpZikrSnzZ9v3nW/ndKEbziXUAwfOOe/7Puc9z/MCq1DwMmB1NX/rzfCNnsc/gK08lPgnnT8Cs33BULg0HI4YKdkHX9DqKwKArXXv1bTMTFcoyruC89E8MxaDw659t6rKhIUwRBLdP2t2v/5bBwQA+5pH8ibnIj3BucgWIQRASw8RERTGYFUtsGmWYUXKmqmr7t4UAnal54GQ8lq8MBlyOU0CEnA67MiwqfvHbhZ+Smgg6o9eV2L8Nhk6wI2lZeggrpvE+TTjxgxxQ4IbmJsJYSa00JQiotnguacJ8zIZOmDosAnzTpowt8tGj0s0ejZqprnDKmPHSNebjHDkUPatt4cTTbZ+LsmO79XK52dZxTNp9/ovAEDnaM62lo8HHrd9SVfiOelVryrSq9vrEx0s8sW2tuEzDgDgT875bcIsjy6owwAwHhjnYT5bGTL29PiHyuwAMO873aL/Ct5PiPjwXe5vq7KJW2hdJxENMFInGCkhIblLj80WRoyxGxZmh1XJGlSIlV8s6A8kuVDXn+MF6JHC7GBkBSNlOSRgiihMsQhAgJGGNNU1atc2HPG6O8YSBABwt2/nGyFlGSCSB4UIBMuyoQKMFNiUjIApRH5t8YfpFOOrO/JrhZBVUiJLxq2ipIkY8Z36uivpC6txqb3YbhqhIingFlLmxmLSKyXAGAaYqh13aFjfcHJwfE2ClSitK9psc85PMVC3M999orX4Kcf/wuPb27VW7A+O2QVVA1M1CQAAAABJRU5ErkJggg==",newitem:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAACXBIWXMAAAsTAAALEwEAmpwYAAAKT2lDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVNnVFPpFj333vRCS4iAlEtvUhUIIFJCi4AUkSYqIQkQSoghodkVUcERRUUEG8igiAOOjoCMFVEsDIoK2AfkIaKOg6OIisr74Xuja9a89+bN/rXXPues852zzwfACAyWSDNRNYAMqUIeEeCDx8TG4eQuQIEKJHAAEAizZCFz/SMBAPh+PDwrIsAHvgABeNMLCADATZvAMByH/w/qQplcAYCEAcB0kThLCIAUAEB6jkKmAEBGAYCdmCZTAKAEAGDLY2LjAFAtAGAnf+bTAICd+Jl7AQBblCEVAaCRACATZYhEAGg7AKzPVopFAFgwABRmS8Q5ANgtADBJV2ZIALC3AMDOEAuyAAgMADBRiIUpAAR7AGDIIyN4AISZABRG8lc88SuuEOcqAAB4mbI8uSQ5RYFbCC1xB1dXLh4ozkkXKxQ2YQJhmkAuwnmZGTKBNA/g88wAAKCRFRHgg/P9eM4Ors7ONo62Dl8t6r8G/yJiYuP+5c+rcEAAAOF0ftH+LC+zGoA7BoBt/qIl7gRoXgugdfeLZrIPQLUAoOnaV/Nw+H48PEWhkLnZ2eXk5NhKxEJbYcpXff5nwl/AV/1s+X48/Pf14L7iJIEyXYFHBPjgwsz0TKUcz5IJhGLc5o9H/LcL//wd0yLESWK5WCoU41EScY5EmozzMqUiiUKSKcUl0v9k4t8s+wM+3zUAsGo+AXuRLahdYwP2SycQWHTA4vcAAPK7b8HUKAgDgGiD4c93/+8//UegJQCAZkmScQAAXkQkLlTKsz/HCAAARKCBKrBBG/TBGCzABhzBBdzBC/xgNoRCJMTCQhBCCmSAHHJgKayCQiiGzbAdKmAv1EAdNMBRaIaTcA4uwlW4Dj1wD/phCJ7BKLyBCQRByAgTYSHaiAFiilgjjggXmYX4IcFIBBKLJCDJiBRRIkuRNUgxUopUIFVIHfI9cgI5h1xGupE7yAAygvyGvEcxlIGyUT3UDLVDuag3GoRGogvQZHQxmo8WoJvQcrQaPYw2oefQq2gP2o8+Q8cwwOgYBzPEbDAuxsNCsTgsCZNjy7EirAyrxhqwVqwDu4n1Y8+xdwQSgUXACTYEd0IgYR5BSFhMWE7YSKggHCQ0EdoJNwkDhFHCJyKTqEu0JroR+cQYYjIxh1hILCPWEo8TLxB7iEPENyQSiUMyJ7mQAkmxpFTSEtJG0m5SI+ksqZs0SBojk8naZGuyBzmULCAryIXkneTD5DPkG+Qh8lsKnWJAcaT4U+IoUspqShnlEOU05QZlmDJBVaOaUt2ooVQRNY9aQq2htlKvUYeoEzR1mjnNgxZJS6WtopXTGmgXaPdpr+h0uhHdlR5Ol9BX0svpR+iX6AP0dwwNhhWDx4hnKBmbGAcYZxl3GK+YTKYZ04sZx1QwNzHrmOeZD5lvVVgqtip8FZHKCpVKlSaVGyovVKmqpqreqgtV81XLVI+pXlN9rkZVM1PjqQnUlqtVqp1Q61MbU2epO6iHqmeob1Q/pH5Z/YkGWcNMw09DpFGgsV/jvMYgC2MZs3gsIWsNq4Z1gTXEJrHN2Xx2KruY/R27iz2qqaE5QzNKM1ezUvOUZj8H45hx+Jx0TgnnKKeX836K3hTvKeIpG6Y0TLkxZVxrqpaXllirSKtRq0frvTau7aedpr1Fu1n7gQ5Bx0onXCdHZ4/OBZ3nU9lT3acKpxZNPTr1ri6qa6UbobtEd79up+6Ynr5egJ5Mb6feeb3n+hx9L/1U/W36p/VHDFgGswwkBtsMzhg8xTVxbzwdL8fb8VFDXcNAQ6VhlWGX4YSRudE8o9VGjUYPjGnGXOMk423GbcajJgYmISZLTepN7ppSTbmmKaY7TDtMx83MzaLN1pk1mz0x1zLnm+eb15vft2BaeFostqi2uGVJsuRaplnutrxuhVo5WaVYVVpds0atna0l1rutu6cRp7lOk06rntZnw7Dxtsm2qbcZsOXYBtuutm22fWFnYhdnt8Wuw+6TvZN9un2N/T0HDYfZDqsdWh1+c7RyFDpWOt6azpzuP33F9JbpL2dYzxDP2DPjthPLKcRpnVOb00dnF2e5c4PziIuJS4LLLpc+Lpsbxt3IveRKdPVxXeF60vWdm7Obwu2o26/uNu5p7ofcn8w0nymeWTNz0MPIQ+BR5dE/C5+VMGvfrH5PQ0+BZ7XnIy9jL5FXrdewt6V3qvdh7xc+9j5yn+M+4zw33jLeWV/MN8C3yLfLT8Nvnl+F30N/I/9k/3r/0QCngCUBZwOJgUGBWwL7+Hp8Ib+OPzrbZfay2e1BjKC5QRVBj4KtguXBrSFoyOyQrSH355jOkc5pDoVQfujW0Adh5mGLw34MJ4WHhVeGP45wiFga0TGXNXfR3ENz30T6RJZE3ptnMU85ry1KNSo+qi5qPNo3ujS6P8YuZlnM1VidWElsSxw5LiquNm5svt/87fOH4p3iC+N7F5gvyF1weaHOwvSFpxapLhIsOpZATIhOOJTwQRAqqBaMJfITdyWOCnnCHcJnIi/RNtGI2ENcKh5O8kgqTXqS7JG8NXkkxTOlLOW5hCepkLxMDUzdmzqeFpp2IG0yPTq9MYOSkZBxQqohTZO2Z+pn5mZ2y6xlhbL+xW6Lty8elQfJa7OQrAVZLQq2QqboVFoo1yoHsmdlV2a/zYnKOZarnivN7cyzytuQN5zvn//tEsIS4ZK2pYZLVy0dWOa9rGo5sjxxedsK4xUFK4ZWBqw8uIq2Km3VT6vtV5eufr0mek1rgV7ByoLBtQFr6wtVCuWFfevc1+1dT1gvWd+1YfqGnRs+FYmKrhTbF5cVf9go3HjlG4dvyr+Z3JS0qavEuWTPZtJm6ebeLZ5bDpaql+aXDm4N2dq0Dd9WtO319kXbL5fNKNu7g7ZDuaO/PLi8ZafJzs07P1SkVPRU+lQ27tLdtWHX+G7R7ht7vPY07NXbW7z3/T7JvttVAVVN1WbVZftJ+7P3P66Jqun4lvttXa1ObXHtxwPSA/0HIw6217nU1R3SPVRSj9Yr60cOxx++/p3vdy0NNg1VjZzG4iNwRHnk6fcJ3/ceDTradox7rOEH0x92HWcdL2pCmvKaRptTmvtbYlu6T8w+0dbq3nr8R9sfD5w0PFl5SvNUyWna6YLTk2fyz4ydlZ19fi753GDborZ752PO32oPb++6EHTh0kX/i+c7vDvOXPK4dPKy2+UTV7hXmq86X23qdOo8/pPTT8e7nLuarrlca7nuer21e2b36RueN87d9L158Rb/1tWeOT3dvfN6b/fF9/XfFt1+cif9zsu72Xcn7q28T7xf9EDtQdlD3YfVP1v+3Njv3H9qwHeg89HcR/cGhYPP/pH1jw9DBY+Zj8uGDYbrnjg+OTniP3L96fynQ89kzyaeF/6i/suuFxYvfvjV69fO0ZjRoZfyl5O/bXyl/erA6xmv28bCxh6+yXgzMV70VvvtwXfcdx3vo98PT+R8IH8o/2j5sfVT0Kf7kxmTk/8EA5jz/GMzLdsAAAAgY0hSTQAAeiUAAICDAAD5/wAAgOkAAHUwAADqYAAAOpgAABdvkl/FRgAAAtxJREFUeNqM0llIVHEUBvDv3vlfZ8ac6zZtWpmamtliUUHRDlFJWlEYLdBLtG/QBlFJQUTSU089RZRlG4EvkS9NlqkpldHyYLk1OurcOzp30vHO/y6nBwsSIvzgvBw+fpyHA8MwwDmHbdsjQwSbCACkYDBYp6pqU3Fxcfyf/Z+eYRjQOQf+Bnw+30IiIsMwhizL4n3lV6mn7BzZtm1yzn8SETU0NKz+J2ARobe3t85/+SI1506j9hOHqTEO9FYEtR/ZTx/n5FDH6eOkquoni2g00NjUtEzTtBYioneLCulVHKg2yUkNmelUn5VOtUlueu0SqDE/m4iIIpFI64fm5vU65xAMIlicR9rOn/UEKytgmQbYuARAEDAqRLCiQxBFhtTNWzDzxk1LcjgkFhuKIhLR2qJKcN5Al/q7reF/cXUHoA0MtA9Gh4klJIxz6ro+PZiVC0uOw1jimJEDWZbTDhw8lCi0+/3PtUeV696ePIPUnIwxAf3fOjG/7AK8e/e9ZH2K0uWdPRdivANm3NguED1OJBYWQunvDwgAXIqifO54+CC7/tSxMQELL11B/r6D3cnJybniQDis25Ikfn1wD2GdQLIMISkF5JFhudwgjwySkyCkpILkRER0wpf7d2FJkqSoapQRRPCYjoLDR+EY70VXbS2YxCC4nAARbAAQBJBlwTIMZJRsQN7W7eA6t9O8XkE0jRhWLV2y+Gdm9q0dT6rMhLw8dPn7EAoEMBSLIcpjCPUEEPD3gU1Kw+6qZ6TPKrizq3TbAjUUIkFRVYAIkkfG99bWp4P1b7Z0vq5BXtFGPN6zE6Zuo7SiAh01PkycV4jJRRt96VOmrOHhMESHiBEAgMkNlGwqmXC78mG1DXtQdruTgx/eF5g6x9Tly1pCmtYjMSnxatnFTeXXyn8wxiCMAgxz5EmcTjCXCynxblf1C9910eFwrl254nh/dDhqcQ5zeBgAwBiDIAr4NQAWJarVjshqqgAAAABJRU5ErkJggg==",pathwayParent:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAVklEQVR42tVSQQoAIAza0/a0/bwuLUZJaJ0SPGSbSGZW4O5t5UnfMC4mqwHSocFTgkRENEWHg0l0pnG9KMX+szqYSqku020GLKGB0gJlIL8B2w4N9h90t4HQjSs2eNAAAAAASUVORK5CYII=",pathway:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAANklEQVR42mNgGCzgPxRTbADZBiFr/I9FjmTDGCgx5D8BcYLe/E8kpq0LqBoG/ymNRvonpCEGAFWvKtY210w0AAAAAElFTkSuQmCC"},Utils.genBamVariants=function(a,b,c,d){for(var e=a.length,f=b/6,g="",h=0;e>h;h++){switch(a.charAt(h)){case"A":g+="M"+(2.5*f+c)+","+d+"l-"+2.5*f+","+6*f+"l"+f+",0l"+.875*f+",-"+2*f+"l"+2.25*f+",0l"+.875*f+","+2*f+"l"+f+",0l-"+2.5*f+",-"+6*f+"l-"+.5*f+",0l0,"+f+"l"+.75*f+","+2*f+"l-"+1.5*f+",0l"+.75*f+",-"+2*f+"l0,-"+f+" ";break;case"T":g+="M"+(.5*f+c)+","+d+"l0,"+f+"l"+2*f+",0l0,"+5*f+"l"+f+",0l0,-"+5*f+"l"+2*f+",0l0,-"+f+" ";break;case"C":g+="M"+(5*f+c)+","+(0*f+d)+"l-"+2*f+",0l-"+1.5*f+","+.5*f+"l-"+.5*f+","+1.5*f+"l0,"+2*f+"l"+.5*f+","+1.5*f+"l"+1.5*f+","+.5*f+"l"+2*f+",0l0,-"+f+"l-"+2*f+",0l-"+.75*f+",-"+.25*f+"l-"+.25*f+",-"+.75*f+"l0,-"+2*f+"l"+.25*f+",-"+.75*f+"l"+.75*f+",-"+.25*f+"l"+2*f+",0 ";break;case"G":g+="M"+(5*f+c)+","+(0*f+d)+"l-"+2*f+",0l-"+1.5*f+","+.5*f+"l-"+.5*f+","+1.5*f+"l0,"+2*f+"l"+.5*f+","+1.5*f+"l"+1.5*f+","+.5*f+"l"+2*f+",0l0,-"+3*f+"l-"+f+",0l0,"+2*f+"l-"+f+",0l-"+.75*f+",-"+.25*f+"l-"+.25*f+",-"+.75*f+"l0,-"+2*f+"l"+.25*f+",-"+.75*f+"l"+.75*f+",-"+.25*f+"l"+2*f+",0 ";break;case"N":g+="M"+(.5*f+c)+","+(0*f+d)+"l0,"+6*f+"l"+f+",0l0,-"+4.5*f+"l"+3*f+","+4.5*f+"l"+f+",0l0,-"+6*f+"l-"+f+",0l0,"+4.5*f+"l-"+3*f+",-"+4.5*f+" ";break;case"d":g+="M"+(0*f+c)+","+(2.5*f+d)+"l"+6*f+",0l0,"+f+"l-"+6*f+",0l0,-"+f+" ";break;default:g+="M0,0"}c+=b}return g};var SVG={create:function(a,b){var c=document.createElementNS("http://www.w3.org/2000/svg",a);for(var d in b)c.setAttribute(d,b[d]);return c},addChild:function(a,b,c,d){var e=document.createElementNS("http://www.w3.org/2000/svg",b);for(var f in c)e.setAttribute(f,c[f]);return this._insert(a,e,d)},addChildImage:function(a,b,c){var d=document.createElementNS("http://www.w3.org/2000/svg","image");for(var e in b)"xlink:href"==e?d.setAttributeNS("http://www.w3.org/1999/xlink","href",b[e]):d.setAttribute(e,b[e]);return this._insert(a,d,c)},_insert:function(a,b,c){if(null==c)a.appendChild(b);else{var d=c+1;0==c&&(d=0);var e=a.childNodes[d];e?a.insertBefore(b,e):a.appendChild(b)}return b},init:function(a,b){return this.addChild(a,"svg",b)},_polarToCartesian:function(a,b,c,d){var e=(d-90)*Math.PI/180;return{x:a+c*Math.cos(e),y:b+c*Math.sin(e)}},describeArc:function(a,b,c,d,e){var f=this._polarToCartesian(a,b,c,e),g=this._polarToCartesian(a,b,c,d),h=180>=e-d?"0":"1",i=["M",f.x,f.y,"A",c,c,0,h,0,g.x,g.y].join(" ");return i}};Region.prototype={load:function(a){return _.isString(a)?this.parse(a):(this.chromosome=a.chromosome||this.chromosome,"undefined"!=typeof a.position&&(a.start=parseInt(a.position),a.end=a.start),this.start=parseInt(_.isUndefined(a.start)?this.start:a.start),void(this.end=parseInt(_.isUndefined(a.end)?this.end:a.end)))},parse:function(a){_.isObject(a)&&this.load(obj);var b=/^([a-zA-Z0-9_])+\:([0-9])+\-([0-9])+$/,c=/^([a-zA-Z0-9_])+\:([0-9])+$/;if(b.test(a)||c.test(a)){var d=a.split(":");if(2==d.length){var e=d[1].split("-");this.chromosome=d[0],this.start=parseInt(e[0]),this.end=2==e.length?parseInt(e[1]):this.start}return!0}return!1},center:function(){return this.start+Math.floor(this.length()/2)},length:function(){return this.end-this.start+1},toString:function(a){var b;return b=1==a?this.chromosome+":"+Utils.formatNumber(this.start)+"-"+Utils.formatNumber(this.end):this.chromosome+":"+this.start+"-"+this.end}},Grid.prototype={getPanel:function(){return this.grid},getStore:function(){return this.store},loadData:function(a){this.store.loadData(a)},remove:function(a){this.store.remove(a)},removeAll:function(){this.store.removeAll()
},clear:function(){this.store.removeAll()},add:function(a){this.store.add(a)},count:function(){return this.store.count()},getAt:function(a){return a>=0?this.store.getAt(a):void 0},refresh:function(){this.grid.getView().refresh()},getData:function(){for(var a=[],b=0;b<this.count();b++)a.push(this.getAt(b));return a},addAll:function(a){for(var b=0;b<a.length;b++)this.add(a[b])},insert:function(a,b){this.store.insert(a,b)},addColumn:function(a,b){for(var c=this.model.getFields(),d=0;d<c.length;d++)if(c.name==a&&c[d].type.type==b)return!1;var e=new Ext.create("Ext.data.Field",{name:"prueba",type:"auto"}),f=new Ext.create("Ext.grid.column.Column",{text:"Prueba",dataIndex:"prueba"});c.push(e),this.model.setFields(c),console.log(this.model.getFields()),this.grid.columns.push(f)},createModel:function(a,b){this.model=Ext.define(a,{extend:"Ext.data.Model",fields:b})},createStore:function(){this.store=Ext.create("Ext.data.Store",{model:this.model,data:[],autoLoad:!1})},setLoading:function(a){this.grid.setLoading(a)}},FeatureBinarySearchTree.prototype={constructor:FeatureBinarySearchTree,add:function(a){var b,c={value:a,left:null,right:null};if(null===this._root)return this._root=c,!0;for(b=this._root;;)if(c.value.end<b.value.start){if(null===b.left)return b.left=c,!0;b=b.left}else{if(!(c.value.start>b.value.end))return!1;if(null===b.right)return b.right=c,!0;b=b.right}},contains:function(a){for(var b={value:a,left:null,right:null},c=!1,d=this._root;!c&&d;)b.value.end<d.value.start?d=d.left:b.value.start>d.value.end?d=d.right:c=!0;return c}};var CellBaseManager={host:"http://www.ebi.ac.uk/cellbase/webservices/rest",version:"v3",get:function(a){var b=a.success,c=a.error,d=_.isUndefined(a.async)||_.isNull(a.async)?!0:a.async,e=_.omit(a,["success","error","async"]),f=CellBaseManager.url(e);if("undefined"!=typeof f){console.log(f);var g;return $.ajax({type:"GET",url:f,dataType:"json",async:d,success:function(a){$.isPlainObject(a)||$.isArray(a)?(_.isFunction(b)&&b(a),g=a):(console.log("Cellbase returned a non json object or list, please check the url."),console.log(f),console.log(a))},error:function(a,b,d){console.log("CellBaseManager: Ajax call returned : "+d+"	"+b+"	"+a.statusText+" END"),_.isFunction(c)&&c(a,b,d)}}),g}},url:function(a){$.isPlainObject(a)||(a={}),$.isPlainObject(a.params)||(a.params={});var b=this.version;"undefined"!=typeof a.version&&null!=a.version&&(b=a.version);var c=this.host;"undefined"!=typeof a.host&&null!=a.host&&(c=a.host),delete a.host,delete a.version;var d={host:c,version:b},e={of:"json"};_.extend(d,a),_.extend(d.params,e);var f="";"undefined"!=typeof d.query&&null!=d.query&&($.isArray(d.query)&&(d.query=d.query.toString()),f="/"+d.query),$.isPlainObject(d.species)&&(d.species=Utils.getSpeciesCode(d.species.text));var g=d.host+"/"+d.version+"/"+d.species+"/"+d.category+"/"+d.subCategory+f+"/"+d.resource;return g=Utils.addQueryParamtersToUrl(d.params,g)}},OpencgaManager={host:"undefined"==typeof OPENCGA_HOST?"http://ws.bioinfo.cipf.es/opencga/rest":OPENCGA_HOST,getHost:function(){return OpencgaManager.host},setHost:function(a){OpencgaManager.host=a},doGet:function(a,b,c){$.ajax({type:"GET",url:a,success:b,error:c})},doPost:function(a,b,c,d){$.ajax({type:"POST",url:a,data:b,processData:!1,contentType:!1,success:c,error:d})},getQuery:function(a){var b="";for(var c in a)null!=a[c]&&(b+=c+"="+a[c]+"&");return""!=b&&(b="?"+b.slice(0,-1)),b},getAccountUrl:function(a){return OpencgaManager.getHost()+"/account/"+a},getStorageUrl:function(a){return OpencgaManager.getAccountUrl(a)+"/storage"},getAdminProfileUrl:function(a){return OpencgaManager.getAccountUrl(a)+"/admin/profile"},getAdminBucketUrl:function(a,b){return OpencgaManager.getAccountUrl(a)+"/admin/bucket/"+b},getAdminProjectUrl:function(a,b){return OpencgaManager.getAccountUrl(a)+"/admin/project/"+b},getBucketUrl:function(a,b){return OpencgaManager.getStorageUrl(a)+"/"+b},getObjectUrl:function(a,b,c){return OpencgaManager.getStorageUrl(a)+"/"+b+"/"+c},getAnalysisUrl:function(a,b){return OpencgaManager.getAccountUrl(a)+"/analysis/"+b},getJobAnalysisUrl:function(a,b){return OpencgaManager.getAccountUrl(a)+"/analysis/job/"+b},getUtilsUrl:function(){return OpencgaManager.getHost()+"/utils"},createAccount:function(a){var b={name:a.name,email:a.email,password:a.password,suiteid:a.suiteId},c=OpencgaManager.getAccountUrl(a.accountId)+"/create"+OpencgaManager.getQuery(b);$.ajax({type:"GET",url:c,dataType:"json",success:function(b){a.success(b.response)},error:function(b){_.isFunction(a.error)&&a.error(b)}})},login:function(a){var b={password:a.password,suiteid:a.suiteId},c=OpencgaManager.getAccountUrl(a.accountId)+"/login"+OpencgaManager.getQuery(b);$.ajax({type:"GET",url:c,dataType:"json",success:function(b){a.success(b.response)},error:function(b){_.isFunction(a.error)&&a.error(b)}})},logout:function(a){var b={sessionid:a.sessionId},c=OpencgaManager.getAccountUrl(a.accountId)+"/logout"+OpencgaManager.getQuery(b);$.ajax({type:"GET",url:c,dataType:"json",success:function(b){a.success(b.response)},error:function(b){_.isFunction(a.error)&&a.error(b)}})},getAccountInfo:function(a){var b={last_activity:a.lastActivity,sessionid:a.sessionId},c=OpencgaManager.getAccountUrl(a.accountId)+"/info"+OpencgaManager.getQuery(b);$.ajax({type:"GET",url:c,dataType:"json",success:function(b){""===b.response.errorMsg?a.success(b.response.result[0]):($.cookie("bioinfo_sid",null),$.cookie("bioinfo_sid",null,{path:"/"}),$.cookie("bioinfo_account",null),$.cookie("bioinfo_account",null,{path:"/"}),console.log(b))},error:function(b){_.isFunction(a.error)&&a.error(b)}})},changePassword:function(a){var b={old_password:a.old_password,new_password1:a.new_password1,new_password2:a.new_password2,sessionid:a.sessionId},c=OpencgaManager.getAdminProfileUrl(a.accountId)+"/change_password"+OpencgaManager.getQuery(b);$.ajax({type:"GET",url:c,dataType:"json",success:function(b){a.success(b.response)},error:function(b){_.isFunction(a.error)&&a.error(b)}})},resetPassword:function(a){var b={email:a.email},c=OpencgaManager.getAdminProfileUrl(a.accountId)+"/reset_password"+OpencgaManager.getQuery(b);$.ajax({type:"GET",url:c,dataType:"json",success:function(b){a.success(b.response)},error:function(b){_.isFunction(a.error)&&a.error(b)}})},changeEmail:function(a){var b={new_email:a.new_email,sessionid:a.sessionId},c=OpencgaManager.getAdminProfileUrl(a.accountId)+"/change_email"+OpencgaManager.getQuery(b);$.ajax({type:"GET",url:c,dataType:"json",success:function(b){a.success(b.response)},error:function(b){_.isFunction(a.error)&&a.error(b)}})},getBuckets:function(){return"TODO"},createBucket:function(a){var b={description:a.description,sessionid:a.sessionId},c=OpencgaManager.getAdminBucketUrl(a.accountId,a.bucketId)+"/create"+OpencgaManager.getQuery(b);$.ajax({type:"GET",url:c,dataType:"json",success:function(b){a.success(b.response)},error:function(b){_.isFunction(a.error)&&a.error(b)}})},refreshBucket:function(a){var b={sessionid:a.sessionId},c=OpencgaManager.getAdminBucketUrl(a.accountId,a.bucketId)+"/refresh"+OpencgaManager.getQuery(b);$.ajax({type:"GET",url:c,dataType:"json",success:function(b){a.success(b.response)},error:function(b){_.isFunction(a.error)&&a.error(b)}})},renameBucket:function(a){var b={sessionid:a.sessionId},c=OpencgaManager.getAdminBucketUrl(a.accountId,a.bucketId)+"/rename/"+a.newBucketId+OpencgaManager.getQuery(b);$.ajax({type:"GET",url:c,dataType:"json",success:function(b){a.success(b.response)},error:function(b){_.isFunction(a.error)&&a.error(b)}})},deleteBucket:"TODO",shareBucket:"TODO",uploadObjectToBucket:function(a){var b={parents:a.parents||!1,sessionid:a.sessionId},c=OpencgaManager.getObjectUrl(a.accountId,a.bucketId,a.objectId)+"/upload"+OpencgaManager.getQuery(b);$.ajax({type:"POST",url:c,data:a.formData,processData:!1,contentType:!1,dataType:"json",success:function(b){a.success(b.response)},error:function(b){_.isFunction(a.error)&&a.error(b)}})},createDirectory:function(a){a.objectId=a.objectId.replace(new RegExp("/","gi"),":");var b={parents:a.parents||!1,sessionid:a.sessionId},c=OpencgaManager.getObjectUrl(a.accountId,a.bucketId,a.objectId)+"/create_directory"+OpencgaManager.getQuery(b);$.ajax({type:"GET",url:c,dataType:"json",success:function(b){a.success(b.response)},error:function(b){_.isFunction(a.error)&&a.error(b)}})},deleteObjectFromBucket:function(a){a.objectId=a.objectId.replace(new RegExp("/","gi"),":");var b={sessionid:a.sessionId},c=OpencgaManager.getObjectUrl(a.accountId,a.bucketId,a.objectId)+"/delete"+OpencgaManager.getQuery(b);$.ajax({type:"GET",url:c,dataType:"json",success:function(b){a.success(b.response)},error:function(b){_.isFunction(a.error)&&a.error(b)}})},pollObject:function(a){var b={start:a.start,limit:a.limit,sessionid:a.sessionId},c=OpencgaManager.getObjectUrl(a.accountId,a.bucketId,a.objectId)+"/poll"+OpencgaManager.getQuery(b);$.ajax({type:"GET",url:c,async:a.async,success:function(b){a.success(b)},error:function(b){_.isFunction(a.error)&&a.error(b)}})},grepObject:function(a){var b={pattern:encodeURIComponent(a.pattern),ignoreCase:a.ignoreCase,multi:a.multi,sessionid:a.sessionId},c=OpencgaManager.getObjectUrl(a.accountId,a.bucketId,a.objectId)+"/grep"+OpencgaManager.getQuery(b);$.ajax({type:"GET",url:c,async:a.async,success:function(b){a.success(b)},error:function(b){_.isFunction(a.error)&&a.error(b)}})},region:function(a){if(a.objectId=a.objectId.replace(new RegExp("/","gi"),":"),a.queryParams.sessionid=a.sessionId,a.queryParams.region=a.region,a.queryParams.cellbasehost=CELLBASE_HOST+"/"+CELLBASE_VERSION,-1!=OpencgaManager.host.indexOf("localhost")){a.queryParams.region=a.region,a.queryParams.filepath=a.objectId;var b=OpencgaManager.host+"/storage/fetch"+OpencgaManager.getQuery(a.queryParams)}else var b=OpencgaManager.getObjectUrl(a.accountId,a.bucketId,a.objectId)+"/fetch"+OpencgaManager.getQuery(a.queryParams);$.ajax({type:"GET",url:b,dataType:"json",success:function(b){if(-1==b.substr(0,5).indexOf("ERROR")){for(var c=JSON.parse(b),d={response:[]},e=0;e<a.region.length;e++){{c[e]}d.response.push({id:a.region[e],result:c[e]})}a.success(d)}},error:function(b){_.isFunction(a.error)&&a.error(b)}})},jobResult:function(a){var b={sessionid:a.sessionId},c=OpencgaManager.getJobAnalysisUrl(a.accountId,a.jobId)+"/result.js"+OpencgaManager.getQuery(b);$.ajax({type:"GET",url:c,dataType:"json",success:function(b){a.success(b.response)},error:function(b){_.isFunction(a.error)&&a.error(b)}})},jobResultUrl:function(a){var b={sessionid:a.sessionId};return OpencgaManager.getJobAnalysisUrl(a.accountId,a.jobId)+"/result.js"+OpencgaManager.getQuery(b)},jobStatus:function(a){var b={sessionid:a.sessionId},c=OpencgaManager.getJobAnalysisUrl(a.accountId,a.jobId)+"/status"+OpencgaManager.getQuery(b);$.ajax({type:"GET",url:c,dataType:"json",success:function(b){a.success(b.response)},error:function(b){_.isFunction(a.error)&&a.error(b)}})},table:function(a){var b={filename:a.filename,colNames:a.colNames,colVisibility:a.colVisibility,sessionid:a.sessionId},c=OpencgaManager.getJobAnalysisUrl(a.accountId,a.jobId)+"/table"+OpencgaManager.getQuery(b);$.ajax({type:"GET",url:c,dataType:"json",success:function(b){a.success(b.response)},error:function(b){_.isFunction(a.error)&&a.error(b)}})},tableurl:function(a){var b={filename:a.filename,colNames:a.colNames,colVisibility:a.colVisibility,sessionid:a.sessionId};return OpencgaManager.getJobAnalysisUrl(a.accountId,a.jobId)+"/table"+OpencgaManager.getQuery(b)},poll:function(a){var b,c={filename:a.filename,sessionid:a.sessionId};1==a.zip?(b=OpencgaManager.getJobAnalysisUrl(a.accountId,a.jobId)+"/poll"+OpencgaManager.getQuery(c),open(b)):(c.zip=!1,b=OpencgaManager.getJobAnalysisUrl(a.accountId,a.jobId)+"/poll"+OpencgaManager.getQuery(c),$.ajax({type:"GET",url:b,async:a.async,success:function(b){a.success(b)},error:function(b){_.isFunction(a.error)&&a.error(b)}}))},jobFileGrep:function(a){var b={pattern:encodeURIComponent(a.pattern),ignoreCase:a.ignoreCase,multi:a.multi,filename:a.filename,sessionid:a.sessionId},c=OpencgaManager.getJobAnalysisUrl(a.accountId,a.jobId)+"/grep"+OpencgaManager.getQuery(b);$.ajax({type:"GET",url:c,async:a.async,success:function(b){a.success(b)},error:function(b){_.isFunction(a.error)&&a.error(b)}})},pollurl:function(a){var b={filename:a.filename,sessionid:a.sessionId,zip:!1};return OpencgaManager.getJobAnalysisUrl(a.accountId,a.jobId)+"/poll"+OpencgaManager.getQuery(b)},deleteJob:function(a){var b={sessionid:a.sessionId},c=OpencgaManager.getJobAnalysisUrl(a.accountId,a.jobId)+"/delete"+OpencgaManager.getQuery(b);$.ajax({type:"GET",url:c,dataType:"json",success:function(b){a.success(b.response)},error:function(b){_.isFunction(a.error)&&a.error(b)}})},downloadJob:function(a){var b={sessionid:a.sessionId};open(OpencgaManager.getJobAnalysisUrl(a.accountId,a.jobId)+"/download"+OpencgaManager.getQuery(b))},jobInfo:function(a){var b={sessionid:a.sessionId},c=OpencgaManager.getJobAnalysisUrl(a.accountId,a.jobId)+"/info"+OpencgaManager.getQuery(b);$.ajax({type:"GET",url:c,dataType:"json",success:function(b){a.success(b.response)},error:function(b){_.isFunction(a.error)&&a.error(b)}})},runAnalysis:function(a){var b=a.paramsWS.accountid,c={},d=OpencgaManager.getAnalysisUrl(b,a.analysis)+"/run"+OpencgaManager.getQuery(c);console.log(d),$.ajax({type:"POST",url:d,data:a.paramsWS,dataType:"json",success:function(b){a.success(b.response)},error:function(b){_.isFunction(a.error)&&a.error(b)}})},indexer:function(a){var b={sessionid:a.sessionId},c=OpencgaManager.getObjectUrl(a.accountId,a.bucketId,a.objectId)+"/index"+OpencgaManager.getQuery(b);$.ajax({type:"GET",url:c,dataType:"json",success:function(b){a.success(b.response)},error:function(b){_.isFunction(a.error)&&a.error(b)}})},indexerStatus:function(a){function b(b){a.success(b)}function c(b){_.isFunction(a.error)&&a.error(b)}var d={sessionid:a.sessionId,indexerid:a.indexerId},e=OpencgaManager.getObjectUrl(a.accountId,a.bucketId,a.objectId)+"/index_status"+OpencgaManager.getQuery(d);console.log(e),OpencgaManager.doGet(e,b,c)},localFileList:function(a){function b(b){a.success(b)}function c(b){_.isFunction(a.error)&&a.error(b)}var d=OpencgaManager.host+"/getdirs";console.log(d),OpencgaManager.doGet(d,b,c)},variantsUrl:function(a){var b=OpencgaManager.getJobAnalysisUrl(a.accountId,a.jobId)+"/variantsMongo";return b},variantInfoMongo:function(a){function b(b){console.log(b),a.success(b)}function c(b){_.isFunction(a.error)&&a.error(b)}var d={sessionid:a.sessionId},e=OpencgaManager.getJobAnalysisUrl(a.accountId,a.jobId)+"/variantInfoMongo"+OpencgaManager.getQuery(d);$.ajax({type:"GET",url:e,async:a.async,success:b,error:c})},variant_effects:function(a){function b(b){a.success(b)}function c(b){_.isFunction(a.error)&&a.error(b)}var d={sessionid:a.sessionId,filename:a.filename},e=OpencgaManager.getJobAnalysisUrl(a.accountId,a.jobId)+"/variant_effects"+OpencgaManager.getQuery(d);$.ajax({type:"POST",url:e,data:a.formData,dataType:"json",success:b,error:c})},variantInfo:function(a){function b(b){console.log(b),a.success(b)}function c(b){_.isFunction(a.error)&&a.error(b)}var d={sessionid:a.sessionId,filename:a.filename},e=OpencgaManager.getJobAnalysisUrl(a.accountId,a.jobId)+"/variant_info"+OpencgaManager.getQuery(d);OpencgaManager.doGet(e,b,c)},variantStats:function(a){function b(b){a.success(b)}function c(b){_.isFunction(a.error)&&a.error(b)}var d={sessionid:a.sessionId,filename:a.fileName},e=OpencgaManager.getJobAnalysisUrl(a.accountId,a.jobId)+"/variant_stats"+OpencgaManager.getQuery(d);$.ajax({type:"POST",url:e,data:a.formData,dataType:"json",success:b,error:c})}},EnsemblManager={host:"http://beta.rest.ensembl.org",get:function(a){var b=a.success,c=a.error,d=_.isUndefined(a.async)||_.isNull(a.async)?!0:a.async,e=_.omit(a,["success","error","async"]),f=EnsemblManager.url(e);if("undefined"!=typeof f){console.log(f);var g;return $.ajax({type:"GET",url:f,dataType:"json",async:d,success:function(a){$.isPlainObject(a)||$.isArray(a)?(_.isFunction(b)&&b(a),g=a):(console.log("Cellbase returned a non json object or list, please check the url."),console.log(f),console.log(a))},error:function(a,b,d){console.log("CellBaseManager: Ajax call returned : "+d+"	"+b+"	"+a.statusText+" END"),_.isFunction(c)&&c(a,b,d)}}),g}},url:function(a){$.isPlainObject(a)||(a={}),$.isPlainObject(a.params)||(a.params={});var b=EnsemblManager.host;if("undefined"!=typeof a.host&&(b=a.host),"undefined"==typeof b)return void console.log("CELLBASE_HOST is not configured");delete a.host;var c={host:b},d={"content-type":"application/json"};_.extend(c,a),_.extend(c.params,d),$.isPlainObject(c.species)&&(c.species=Utils.getSpeciesCode(c.species.text));var e=c.host+"/"+c.category+"/"+c.subCategory+"/"+c.species+"/"+c.query;return e=Utils.addQueryParamtersToUrl(c.params,e)}};FileWidget.prototype.getTitleName=function(){return this.trackNameField.getValue()},FileWidget.prototype.getFileFromServer=function(){},FileWidget.prototype.loadFileFromLocal=function(){},FileWidget.prototype.getFileUpload=function(){var a=this;return this.uploadField=Ext.create("Ext.form.field.File",{msgTarget:"side",flex:1,padding:1,emptyText:"Choose a file",allowBlank:!1,anchor:"100%",buttonText:"Browse local",listeners:{change:{fn:function(){a.panel.setLoading();var b=document.getElementById(a.uploadField.fileInputEl.id).files[0];a.trackNameField.setValue(b.name),a.fileNameLabel.setText('<span class="emph">'+b.name+'</span> <span class="info">(local)</span>',!1),a.loadFileFromLocal(b),a.panel.setLoading(!1)}}}}),this.uploadField},FileWidget.prototype.draw=function(){var a=this;if(null==this.openDialog){var b=Ext.create("Ext.toolbar.Toolbar");this.featureCountLabel=Ext.create("Ext.toolbar.TextItem",{text:'<span class="dis">No file loaded</span>'}),b.add([this.featureCountLabel]);var c=Ext.create("Ext.toolbar.Toolbar");c.add(this.getFileUpload()),this.panel=Ext.create("Ext.panel.Panel",{border:!1,height:230,title:"Previsualization",bbar:b}),this.trackNameField=Ext.create("Ext.form.field.Text",{name:"file",fieldLabel:"Track Name",allowBlank:!1,value:"New track from "+this.title+" file",emptyText:"Choose a name",flex:1});var d=Ext.create("Ext.panel.Panel",{border:!1,layout:"hbox",bodyPadding:10,items:[this.trackNameField]});this.wum&&(null!=$.cookie("bioinfo_sid")?this.sessionInitiated():this.sessionFinished()),this.fileNameLabel=Ext.create("Ext.toolbar.TextItem",{}),this.btnOk=Ext.create("Ext.button.Button",{text:"Ok",disabled:!0,handler:function(){a.trigger("okButton:click",{fileName:a.file.name,adapter:a.adapter}),a.openDialog.close()}}),this.openDialog=Ext.create("Ext.window.Window",{title:"Open "+this.title+" file",width:600,resizable:!1,items:[c,d],buttons:[this.btnOk,{text:"Cancel",handler:function(){a.openDialog.close()}}],listeners:{scope:this,minimize:function(){this.openDialog.hide()},destroy:function(){delete this.openDialog}}})}this.openDialog.show()},FileWidget.prototype.sessionInitiated=function(){},FileWidget.prototype.sessionFinished=function(){},BEDFileWidget.prototype.getTitleName=FileWidget.prototype.getTitleName,BEDFileWidget.prototype.getFileUpload=FileWidget.prototype.getFileUpload,BEDFileWidget.prototype.draw=FileWidget.prototype.draw,BEDFileWidget.prototype.sessionInitiated=FileWidget.prototype.sessionInitiated,BEDFileWidget.prototype.sessionFinished=FileWidget.prototype.sessionFinished,BEDFileWidget.prototype.getChartItems=FileWidget.prototype.getChartItems,BEDFileWidget.prototype._loadChartInfo=FileWidget.prototype._loadChartInfo,BEDFileWidget.prototype.loadFileFromLocal=function(a){var b=this;this.file=a,this.adapter=new BEDDataAdapter(new FileDataSource({file:a}),{species:this.viewer.species}),this.adapter.on("file:load",function(){}),b.btnOk.enable()},BEDFileWidget.prototype.loadFileFromServer=function(a){this.file={name:a.filename},this.adapter=new BEDDataAdapter(new StringDataSource(a.data),{async:!1,species:this.viewer.species}),this._loadChartInfo(),this.btnOk.enable()},GFFFileWidget.prototype.getTitleName=FileWidget.prototype.getTitleName,GFFFileWidget.prototype.getFileUpload=FileWidget.prototype.getFileUpload,GFFFileWidget.prototype.draw=FileWidget.prototype.draw,GFFFileWidget.prototype.sessionInitiated=FileWidget.prototype.sessionInitiated,GFFFileWidget.prototype.sessionFinished=FileWidget.prototype.sessionFinished,GFFFileWidget.prototype.getChartItems=FileWidget.prototype.getChartItems,GFFFileWidget.prototype._loadChartInfo=FileWidget.prototype._loadChartInfo,GFFFileWidget.prototype.loadFileFromLocal=function(a){var b=this;switch(this.file=a,this.version){case"2":case 2:this.adapter=new GFF2DataAdapter(new FileDataSource({file:a}),{species:this.viewer.species});break;case"3":case 3:this.adapter=new GFF3DataAdapter(new FileDataSource({file:a}),{species:this.viewer.species});break;default:this.adapter=new GFF2DataAdapter(new FileDataSource({file:a}),{species:this.viewer.species})}this.adapter.on("file:load",function(){}),b.btnOk.enable()},GFFFileWidget.prototype.loadFileFromServer=function(a){switch(this.file={name:a.filename},this.version){case"2":case 2:this.adapter=new GFF2DataAdapter(new StringDataSource(a.data),{async:!1,species:this.viewer.species});break;case"3":case 3:this.adapter=new GFF3DataAdapter(new StringDataSource(a.data),{async:!1,species:this.viewer.species});break;default:this.adapter=new GFF2DataAdapter(new StringDataSource(a.data),{async:!1,species:this.viewer.species})}this._loadChartInfo(),this.btnOk.enable()},GTFFileWidget.prototype.getTitleName=FileWidget.prototype.getTitleName,GTFFileWidget.prototype.getFileUpload=FileWidget.prototype.getFileUpload,GTFFileWidget.prototype.draw=FileWidget.prototype.draw,GTFFileWidget.prototype.sessionInitiated=FileWidget.prototype.sessionInitiated,GTFFileWidget.prototype.sessionFinished=FileWidget.prototype.sessionFinished,GTFFileWidget.prototype.getChartItems=FileWidget.prototype.getChartItems,GTFFileWidget.prototype._loadChartInfo=FileWidget.prototype._loadChartInfo,GTFFileWidget.prototype.loadFileFromLocal=function(a){var b=this;this.file=a,this.adapter=new GTFDataAdapter(new FileDataSource({file:a}),{species:this.viewer.species}),this.adapter.onLoad.addEventListener(function(){console.log(b.adapter.featuresByChromosome),b._loadChartInfo()}),b.btnOk.enable()},GTFFileWidget.prototype.loadFileFromServer=function(a){this.file={name:a.filename},this.adapter=new GTFDataAdapter(new StringDataSource(a.data),{async:!1,species:this.viewer.species}),this._loadChartInfo(),this.btnOk.enable()},LegendPanel.prototype.getColorItems=function(a){panelsArray=new Array;for(var b in a){var c=15,d=Ext.create("Ext.draw.Component",{width:c,height:c,items:[{type:"rect",fill:a[b],x:0,y:0,width:c,height:c}]}),e=Utils.formatText(b,"_"),f=Ext.create("Ext.panel.Panel",{height:c,border:!1,flex:1,margin:"1 0 0 1",layout:{type:"hbox",align:"stretch"},items:[d,{xtype:"tbtext",text:e,margin:"1 0 0 3"}]});panelsArray.push(f)}return panelsArray},LegendPanel.prototype.getPanel=function(a){if(null==this.panel){var b=this.getColorItems(a);this.panel=Ext.create("Ext.panel.Panel",{bodyPadding:"0 0 0 2",border:!1,layout:{type:"vbox",align:"stretch"},items:b,width:this.width,height:20*b.length})}return this.panel},LegendPanel.prototype.getButton=function(a){return null==this.button&&(this.button=Ext.create("Ext.button.Button",{text:this.title,menu:{plain:!0,items:[this.getPanel(a)]}})),this.button},LegendWidget.prototype.draw=function(a){var b=this;if(null==this.panel){var c=this.legendPanel.getPanel(a);this.panel=Ext.create("Ext.ux.Window",{title:this.title,resizable:!1,constrain:!0,closable:!0,width:c.width+10,height:c.height+70,items:[c],buttonAlign:"right",layout:{type:"hbox",align:"stretch"},buttons:[{text:"Close",handler:function(){b.panel.close()}}]})}this.panel.show()},TrackSettingsWidget.prototype={setFilters:function(a){this.trackSvg.setFilters(a)},draw:function(){for(var a=this,b=[],c=[],d=0;d<this.filtersConfig.length;d++){var e,f=this.filtersConfig[d].text,g=this.filtersConfig[d].name,h=[];e=null!=this.filters[g]?!1:!0;for(var i=0;i<this.filtersConfig[d].values.length;i++)h.push({text:this.filtersConfig[d].values[i],leaf:!0,checked:e,iconCls:"icon-blue-box"});var j={text:g,expanded:!0,checked:e,iconCls:"icon-box",children:h},k=Ext.create("Ext.data.TreeStore",{root:j,fields:["text","name"]});b.push({xtype:"treepanel",useArrows:!0,bodyPadding:"10 0 10 0",title:f,border:!1,store:k,listeners:{checkchange:function(a,b){a.isRoot()&&a.eachChild(function(a){a.set("checked",b)})},afterrender:function(b){var c=b.getStore().getRootNode(),d=c.get("text");if(null!=a.filters[d])for(var e=0;e<a.filters[d].length;e++){var f=c.findChild("text",a.filters[d][e]);f.set("checked",!0),f.save}}}}),c.push(k)}var l=Ext.create("Ext.panel.Panel",{title:"Display settings",bodyPadding:10,items:[{xtype:"textfield",value:a.trackSvg.getTitle(),fieldLabel:"TrackName",allowBlank:!1,listeners:{change:function(b,c){b.isValid()&&(a.trackSvg.setTitle(c),a.treeRecord.set("text",c),a.treeRecord.save())}}}]}),m=Ext.create("Ext.tab.Panel",{title:"Filters",items:b});Ext.create("Ext.window.Window",{id:this.id+"window",title:"Settings",width:500,modal:!0,items:[l,m],buttons:[{text:"Ok",id:this.id+"okButton",handler:function(){for(var b={},d=0;d<c.length;d++){var e=c[d].getRootNode(),f=e.get("text"),g=[],h=0;e.eachChild(function(a){h++,a.data.checked&&g.push(a.get("text"))}),g.length==h&&(g=[]),b[f]=g}console.log(b),a.setFilters(b),Ext.getCmp(a.id+"window").destroy()}},{text:"Cancel",handler:function(){a.trackSvg.setTitle(n),a.treeRecord.set("text",n),a.treeRecord.save(),Ext.getCmp(a.id+"window").destroy()}}]}).show();var n=a.trackSvg.getTitle()}},UrlWidget.prototype.draw=function(){null==this.panel&&this.render(),this.panel.show()},UrlWidget.prototype.render=function(){var a=this;this.urlField=Ext.create("Ext.form.field.Text",{margin:"0 2 2 0",labelWidth:30,width:this.width-55,fieldLabel:"URL",emptyText:"enter a valid url",value:"http://www.ensembl.org/das/Homo_sapiens.GRCh37.gene/features",listeners:{change:{fn:function(){var b=this.value.split("/das/")[1].split("/")[0];a.trackNameField.setValue(b)}}}}),this.checkButton=Ext.create("Ext.button.Button",{text:"Check",handler:function(){a.form.setLoading();var b=new DasAdapter({url:a.urlField.getValue(),featureCache:{gzip:!1,chunkSize:1e4},handlers:{"url:check":function(b){console.log(b.data),a.contentArea.setValue(b.data),a.form.setLoading(!1)},error:function(){a.contentArea.setValue("XMLHttpRequest cannot load. This server is not allowed by Access-Control-Allow-Origin"),a.form.setLoading(!1)}}});b.checkUrl()}}),this.trackNameField=Ext.create("Ext.form.field.Text",{name:"file",allowBlank:!1,value:a.urlField.value.split("/das/")[1].split("/")[0],emptyText:"Choose a name",flex:1}),this.panelSettings=Ext.create("Ext.panel.Panel",{layout:"hbox",border:!1,title:"Track name",cls:"panel-border-top",bodyPadding:10,width:this.width-2,items:[this.trackNameField]}),this.contentArea=Ext.create("Ext.form.field.TextArea",{margin:"-1",width:this.width,height:this.height}),this.infobar=Ext.create("Ext.toolbar.Toolbar",{height:28,cls:"bio-border-false",items:[this.urlField,this.checkButton]}),this.form=Ext.create("Ext.panel.Panel",{border:!1,items:[this.infobar,this.contentArea,this.panelSettings]}),this.panel=Ext.create("Ext.ux.Window",{title:this.title,layout:"fit",resizable:!1,items:[this.form],buttons:[{text:"Add",handler:function(){a.trigger("addButton:click",{name:a.trackNameField.getValue(),url:a.urlField.getValue()}),a.panel.close()}},{text:"Cancel",handler:function(){a.panel.close()}}],listeners:{destroy:function(){delete a.panel}}})},VCFFileWidget.prototype.getTitleName=FileWidget.prototype.getTitleName,VCFFileWidget.prototype.getFileUpload=FileWidget.prototype.getFileUpload,VCFFileWidget.prototype.draw=FileWidget.prototype.draw,VCFFileWidget.prototype.sessionInitiated=FileWidget.prototype.sessionInitiated,VCFFileWidget.prototype.sessionFinished=FileWidget.prototype.sessionFinished,VCFFileWidget.prototype.getChartItems=FileWidget.prototype.getChartItems,VCFFileWidget.prototype._loadChartInfo=FileWidget.prototype._loadChartInfo,VCFFileWidget.prototype.loadFileFromLocal=function(a){var b=this;this.file=a,this.adapter=new VCFDataAdapter(new FileDataSource({file:a}),{species:this.viewer.species}),this.adapter.on("file:load",function(){console.log(b.adapter.featuresByChromosome)}),b.btnOk.enable()},VCFFileWidget.prototype.loadFileFromServer=function(a){this.file={name:a.filename},this.adapter=new VCFDataAdapter(new StringDataSource(a.data),{async:!1,species:this.viewer.species}),this.btnOk.enable()},InfoWidget.prototype.draw=function(a){console.log(a),this.query=a.query,this.feature=a.feature,this.adapter=a.adapter,this.panel=Ext.getCmp(this.title+" "+this.query),null==this.panel?(this.render(),this.panel.show(),this.getData()):this.panel.show()},InfoWidget.prototype.render=function(){this.panel=Ext.create("Ext.window.Window",{title:this.title+" "+this.query,id:this.title+" "+this.query,minimizable:!0,constrain:!0,closable:!0,height:this.height,width:this.width,layout:{type:"hbox",align:"stretch"},items:[this.getTreePanel()],buttonAlign:"right",listeners:{scope:this,minimize:function(){this.panel.hide()},destroy:function(){delete this.panel}}})},InfoWidget.prototype.getTreePanel=function(){var a=this.getdataTypes();this.checkDataTypes(a);var b=Ext.create("Ext.data.TreeStore",{root:{expanded:!0,text:"Options",children:a}}),c=Ext.create("Ext.tree.Panel",{title:"Detailed information",bodyPadding:10,flex:1,border:!1,store:b,useArrows:!0,rootVisible:!1,listeners:{scope:this,itemclick:function(a,b){this.optionClick(b.data)}}});return c},InfoWidget.prototype.doGrid=function(a,b,c,d){for(var e=Ext.create("Ext.grid.feature.Grouping",{groupHeaderTpl:'{[values.name]} ({rows.length} Item{[values.rows.length > 1 ? "s" : ""]})',startCollapsed:!0}),f=[],g=0;g<b.length;g++)f.push({type:"string",dataIndex:b[g]});var f={ftype:"filters",local:!0,filters:f};Ext.define(c,{extend:"Ext.data.Model",fields:b});var h=Ext.create("Ext.data.Store",{groupField:d,model:c}),i=Ext.create("Ext.grid.Panel",{id:this.id+c,store:h,title:c,border:!1,cls:"ocb-border-left-lightgrey",flex:3,features:[e,f],viewConfig:{enableTextSelection:!0},columns:a,bbar:["->",{text:"Clear Grouping",handler:function(){e.disable()}}]});return i},InfoWidget.prototype.checkDataTypes=function(a){for(var b=0;b<a.length;b++)null!=a[b].children?(a[b].iconCls="icon-box",a[b].expanded=!0,this.checkDataTypes(a[b].children)):(a[b].iconCls="icon-blue-box",a[b].leaf=!0)},InfoWidget.prototype.getdataTypes=function(){return[]},InfoWidget.prototype.optionClick=function(){},InfoWidget.prototype.getData=function(){},InfoWidget.prototype.getGeneTemplate=function(){return new Ext.XTemplate('<div><span class="panel-border-bottom"><span class="ssel s130">{name}</span> &nbsp; <span class="emph s120"> {id} </span></span>',' &nbsp; <a target="_blank" href="http://www.ensembl.org/'+this.ensemblSpecie+'/Location/View?g={id}">Ensembl</a>',' &nbsp; <a target="_blank" href="http://wikipathways.org//index.php?query={externalName}&species='+this.wikipathwaysSpecie+'&title=Special%3ASearchPathways&doSearch=1">Wikipathways</a>',"</div><br>",'<div><span class="w75 infokey s90">Location: </span> <span class="">{chromosome}:{start}-{end} </span><span style="margin-left:50px" class=" infokey s90">Strand: </span> {strand}</div>','<div><span class="w75 infokey s90">Biotype: </span> {biotype}</div>','<div><span class="w75 infokey s90">Description: </span> <span><tpl if="description == &quot;&quot;">No description available</tpl>{description}</span></div>','<div><span class="w75 infokey s90">Source: </span> <span class="s110">{source}</span></div>','<div><span class="w75 infokey s90">Status: </span> {status}</div>')},InfoWidget.prototype.getTranscriptTemplate=function(){return new Ext.XTemplate('<div><span class="panel-border-bottom"><span class="ssel s130">{name}</span> &nbsp; <span class="emph s120"> {id} </span></span>',' &nbsp; <a target="_blank" href="http://www.ensembl.org/'+this.ensemblSpecie+'/Transcript/Transcript?t={id}">Ensembl</a>',' &nbsp; <a target="_blank" href="http://wikipathways.org//index.php?query={externalName}&species='+this.wikipathwaysSpecie+'&title=Special%3ASearchPathways&doSearch=1">Wikipathways</a>',"</div><br>",'<div><span class="w100 infokey s90">Location: </span> <span class="">{chromosome}:{start}-{end} </span><span style="margin-left:50px" class=" infokey s90">Strand: </span> {strand}</div>','<div><span class="w100 infokey s90">Biotype: </span> {biotype}</div>','<div><span class="w100 infokey s90">Description: </span> <span><tpl if="description == &quot;&quot;">No description available</tpl>{description}</span></div>',"",'<div><span class="w100 infokey s90">CDS &nbsp; (start-end): </span> {genomicCodingStart}-{genomicCodingEnd} <span style="margin-left:50px" class="w100 infokey s90">CDNA (start-end): </span> {cdnaCodingStart}-{cdnaCodingEnd}</div>','<div><span class="w100 infokey s90">Protein: </span> {proteinID}</div>','<div><span class="w100 infokey s90">External DB: </span> {externalDb}</div>','<div><span class="w100 infokey s90">Status: </span> {status}</div><br>')
},InfoWidget.prototype.getSnpTemplate=function(){return new Ext.XTemplate('<div><span class="panel-border-bottom"><span class="ssel s130">{id}</span></span>',' &nbsp; <a target="_blank" href="http://www.ensembl.org/'+this.ensemblSpecie+'/Variation/Summary?v={id}">Ensembl</a>',"</div><br>",'<div><span class="w140 infokey s90">Location: </span> <span class="">{chromosome}:{start}-{end} </span><span style="margin-left:50px" class=" infokey s90">Strand: </span> {strand}</div>','<div><span class="w140 infokey s90">Source: </span> <span class="s110">{source}</span></div>','<div><span class="w140 infokey s90">Type: </span> <span class="s110">{type}</span></div>','<div><span class="w140 infokey s90">Allele string: </span> {alleleString}</div>','<div><span class="w140 infokey s90">Ancestral allele: </span> {ancestralAllele}</div>','<div><span class="w140 infokey s90">Display SO consequence type: </span> {displayConsequenceType}</div>','<div><span class="w140 infokey s90">SO consequence types: </span> {consequenceTypes}</div>')},InfoWidget.prototype.getExonTemplate=function(){return new Ext.XTemplate('<span><span class="panel-border-bottom"><span class="ssel s110">{id}</span></span></span><br><br>','<span><span class="infokey s90"> Location: </span> <span class="">{chromosome}:{start}-{end} </span></span><br>','<span><span class="infokey s90"> Genomic coding (start-end) : </span> <span class="">{genomicCodingStart}-{genomicCodingEnd} </span></span><br>','<span><span class="infokey s90"> cDNA (start-end) : </span> <span class="">{cdnaCodingStart}-{cdnaCodingEnd} </span></span><br>','<span><span class="infokey s90"> CDS (start-end) : </span> <span class="">{cdsStart}-{cdsEnd} </span></span><br>','<span><span class="infokey s90"> Phase: </span> {phase}</span><br>')},InfoWidget.prototype.getProteinTemplate=function(){return new Ext.XTemplate('<div><span class="panel-border-bottom"><span class="ssel s130">{name}</span> &nbsp; <span class="emph s120"> {primaryAccession} </span></span></div>',"<br>",'<div><span class="w100 infokey s90">Full name: </span> <span class="">{fullName}</span></div>','<div><span class="w100 infokey s90">Gene name: </span> <span class="">{geneName}</span></div>','<div><span class="w100 infokey s90">Organism: </span> <span class="">{organism}</span></div>')},InfoWidget.prototype.getVCFVariantTemplate=function(){return new Ext.XTemplate('<div><span><span class="panel-border-bottom"><span class="ssel s130">{chromosome}:{start}-{alternate}</span> &nbsp; <span class="emph s120"> {id} </span></span></span></div><br>','<div><span class="w75 infokey s90">Alt: </span> {alternate}</div>','<div><span class="w75 infokey s90">Ref: </span> {reference}</div>','<div><span class="w75 infokey s90">Quality: </span> {quality}</div>','<div><span class="w75 infokey s90">Format: </span> {format}</div>','<div><span class="w75 infokey s90">Samples: </span> {samples}</div>','<div><span class="w75 infokey s90">Info: <br></span> {info}</div>')},InfoWidget.prototype.getPWMTemplate=function(){return new Ext.XTemplate('<div><span class="panel-border-bottom"><span class="ssel s130">{accession}</span> &nbsp; <span class="emph s120"> {tfName} </span></span></div>',"<br>",'<div><span class="w100 infokey s90">Type: </span> <span class="">{source}</span></div>','<div><span class="w100 infokey s90">Source: </span> <span class="">{type}</span></div>','<div><span class="w100 infokey s90">Description: </span> <span class="">{description}</span></div>','<div><span class="w100 infokey s90">Length: </span> <span class="">{length}</span></div>','<div><span class="w100 infokey s90">Frequencies: </span> <span class="">{[this.parseFrequencies(values.frequencies)]}</span></div>',{parseFrequencies:function(a){return"<div>"+a.replace(/,/gi,"<br>")+"</div>"}})},InfoWidget.prototype.getProteinXrefTemplate=function(){return new Ext.XTemplate('<div><span class="w75 emph s100">{[values.source.toUpperCase()]}</span> &nbsp; <span class="emph w125 s100"> {[this.generateLink(values)]} <span class="info">&raquo;</span> </span></div>',{generateLink:function(a){if(null==a.source)return"";switch(a.source.toUpperCase()){case"GO":return'<a TARGET="_blank" href="http://amigo.geneontology.org/cgi-bin/amigo/term_details?term='+a.name+'">'+a.name+"</a>";case"REACTOME":return'<a TARGET="_blank" href="http://www.reactome.org/cgi-bin/eventbrowser_st_id?ST_ID='+a.name+'">'+a.name+"</a>";case"KEGG":return'<a TARGET="_blank" href="http://www.genome.jp/dbget-bin/www_bget?'+a.name+'">'+a.name+"</a>";case"INTACT":return'<a TARGET="_blank" href="http://www.ebi.ac.uk/intact/pages/interactions/interactions.xhtml?query='+a.name+'">'+a.name+"</a>";case"MINT":return'<a TARGET="_blank" href="http://mint.bio.uniroma2.it/mint/search/search.do?queryType=protein&interactorAc='+a.name+'">'+a.name+"</a>";case"DIP":return'<a TARGET="_blank" href="http://dip.doe-mbi.ucla.edu/dip/Browse.cgi?ID='+a.name+'">'+a.name+"</a>";case"STRING":return'<a TARGET="_blank" href="http://string-db.org/newstring_cgi/show_network_section.pl?identifier=P51587">'+a.name+"</a>";case"MIM":return'<a TARGET="_blank" href="http://www.omim.org/entry/'+a.name+'">'+a.name+"</a>";case"PHARMGKB":return'<a TARGET="_blank" href="http://www.pharmgkb.org/do/serve?objId='+a.name+'&objCls=Gene">'+a.name+"</a>";case"ORPHANET":return'<a TARGET="_blank" href="http://www.orpha.net/consor/cgi-bin/OC_Exp.php?lng=EN&Expert='+a.name+'">'+a.name+"</a>"}}})},InfoWidget.prototype.getSnpTranscriptTemplate=function(){return new Ext.XTemplate('<div><span class="panel-border-bottom"><span class="ssel s130">{[this.getStableId(values)]}</span></span>',' &nbsp; <a target="_blank" href="http://www.ensembl.org/'+this.ensemblSpecie+'/Transcript/Transcript?t={[this.getStableId(values)]}">Ensembl</a>',"</div><br>",'<div><span class="w140 infokey s90">CDS &nbsp; (start - end): </span> {cdsStart} - {cdsEnd} <span style="margin-left:50px" class="w100 infokey s90">cDNA (start - end): </span> {cdnaStart} - {cdnaEnd}</div>','<div><span class="w140 infokey s90">Translation (start - end): </span> {translationStart} - {translationEnd}</div>','<div><span class="w140 infokey s90">Peptide allele: </span> {peptideAlleleString}</div>','<div><span class="w140 infokey s90">Codon: </span> {codonAlleleString}</div>','<div><span class="w140 infokey s90">HGVS Genomic: </span> {hgvsGenomic}','<div><span class="w140 infokey s90">HGVS Protein: </span> {hgvsProtein}','<div><span class="w140 infokey s90">HGVS Transcript: </span> {hgvsTranscript}','<div><span class="w140 infokey s90">Polyphen prediction: </span> {polyphenPrediction}','<span style="margin-left:50px" class="w140 infokey s90">Polyphen score: </span> {polyphenScore}</div>','<div><span class="w140 infokey s90">Sift prediction: </span> {siftPrediction}','<span style="margin-left:50px" class="w140 infokey s90">Sift score: </span> {siftScore}</div>','<div><span class="w140 infokey s90">SO consequence types: </span> {consequenceTypes}</div><br>',{getStableId:function(a){return""!=a.transcriptId?a.transcriptId:"Intergenic SNP"}})},InfoWidget.prototype.getConsequenceTypeTemplate=function(){return new Ext.XTemplate('<div><span class="panel-border-bottom"><span class="ssel s130">{transcriptId}</span> &nbsp; </span></div><br>','<div><span class="w140 infokey s90">SO consequence types: </span> {consequenceTypes}</div><br>')},InfoWidget.prototype.getPhenotypeTemplate=function(){return new Ext.XTemplate('<div><span class="panel-border-bottom"><span class="ssel s130">{phenotypeDescription}</span> &nbsp; <span class="emph s120"> {source} </span></span></div><br>','<div><span class="w150 infokey s90">PValue: </span>{PValue}</div>','<div><span class="w150 infokey s90">Assoc. gene name: </span>{associatedGeneName}</div>','<div><span class="w150 infokey s90">Assoc. variant risk allele: </span>{associatedVariantRiskAllele}</div>','<div><span class="w150 infokey s90">Phenotype description: </span>{phenotypeDescription}</div>','<div><span class="w150 infokey s90">Phenotype name: </span>{phenotypeName}</div>','<div><span class="w150 infokey s90">Risk allele freq in controls: </span>{riskAlleleFrequencyInControls}</div>','<div><span class="w150 infokey s90">Source: </span>{source}</div>','<div><span class="w150 infokey s90">Study name: </span>{studyName}</div>','<div><span class="w150 infokey s90">Study type: </span>{studyType}</div>','<div><span class="w150 infokey s90">Study URL: </span>{studyUrl}</div>','<div><span class="w150 infokey s90">Study description: </span>{studyDescription}</div>')},InfoWidget.prototype.getPopulationTemplate=function(){return new Ext.XTemplate('<div><span class="panel-border-bottom"><span class="ssel s130">{population}</span> &nbsp; <span class="emph s120"> {source} </span></span></div><br>','<div><span class="w140 infokey s90">Ref allele:  </span>{refAllele} ({refAlleleFrequency})</div>','<div><span class="w140 infokey s90">Other allele:  </span>{otherAllele} ({otherAlleleFrequency})</div>','<div><span class="w140 infokey s90">Ref allele homozygote:  </span>{refAlleleHomozygote} ({refAlleleHomozygoteFrequency})</div>','<div><span class="w140 infokey s90">Allele heterozygote:  </span>{alleleHeterozygote} ({alleleHeterozygoteFrequency})</div>','<div><span class="w140 infokey s90">Other allele homozygote:  </span>{otherAlleleHomozygote} ({otherAlleleHeterozygoteFrequency})</div>','<div><span class="w140 infokey s90">Source:  </span>{source}</div>','<div><span class="w140 infokey s90">Population:  </span>{population}</div>')},InfoWidget.prototype.getVariantEffectTemplate=function(){return new Ext.XTemplate('<div><span class="panel-border-bottom"><span class="ssel s130">{consequenceTypeObo}</span> &nbsp; <span class="emph s120"> {featureBiotype} </span></span></div><br>')},GeneInfoWidget.prototype.draw=InfoWidget.prototype.draw,GeneInfoWidget.prototype.render=InfoWidget.prototype.render,GeneInfoWidget.prototype.getTreePanel=InfoWidget.prototype.getTreePanel,GeneInfoWidget.prototype.checkDataTypes=InfoWidget.prototype.checkDataTypes,GeneInfoWidget.prototype.doGrid=InfoWidget.prototype.doGrid,GeneInfoWidget.prototype.getGeneTemplate=InfoWidget.prototype.getGeneTemplate,GeneInfoWidget.prototype.getTranscriptTemplate=InfoWidget.prototype.getTranscriptTemplate,GeneInfoWidget.prototype.getdataTypes=function(){return dataTypes=[{text:"Genomic",children:[{text:"Information"},{text:"Transcripts"},{text:"Xrefs"}]},{text:"Functional information",children:[{text:"GO"},{text:"Reactome"},{text:"Interpro"}]},{text:"Protein",children:[{text:"Features"},{text:"3D structure"}]}]},GeneInfoWidget.prototype.optionClick=function(a){if(a.leaf)switch(null!=this.panel.getComponent(1)&&(this.panel.getComponent(1).hide(),this.panel.remove(1,!1)),a.text){case"Information":this.panel.add(this.getGenePanel(this.data).show());break;case"Transcripts":this.panel.add(this.getTranscriptPanel(this.data.transcripts).show());break;case"Xrefs":this.panel.add(this.getXrefGrid(this.data.transcripts,"Xref","transcript").show());break;case"GO":this.panel.add(this.getXrefGrid(this.data.transcripts,"GO","transcript").show());break;case"Interpro":this.panel.add(this.getXrefGrid(this.data.transcripts,"Interpro","transcript").show());break;case"Reactome":this.panel.add(this.getXrefGrid(this.data.transcripts,"Reactome","transcript").show());break;case"Features":this.panel.add(this.getProteinFeaturesGrid(this.data.proteinFeatures).show());break;case"3D structure":this.panel.add(this.get3Dprotein(this.data.snps).show())}},GeneInfoWidget.prototype.getGenePanel=function(a){if(null==a)return this.notFoundPanel;if(null==this.genePanel){var b=this.getGeneTemplate();this.genePanel=Ext.create("Ext.panel.Panel",{title:"Gene information",border:!1,cls:"ocb-border-left-lightgrey",flex:3,bodyPadding:10,data:a,tpl:b})}return this.genePanel},GeneInfoWidget.prototype.getTranscriptPanel=function(a){if(a.length<=0)return this.notFoundPanel;if(null==this.transcriptGrid){for(var b=this.getTranscriptTemplate(),c=[],d=0;d<a.length;d++){var e=Ext.create("Ext.container.Container",{padding:5,data:a[d],tpl:b});c.push(e)}this.transcriptGrid=Ext.create("Ext.panel.Panel",{title:"Transcripts ("+d+")",border:!1,cls:"ocb-border-left-lightgrey",flex:3,bodyPadding:5,autoScroll:!0,items:c})}return this.transcriptGrid},GeneInfoWidget.prototype.getXrefGrid=function(a,b,c){for(var d=[],e=0;e<a.length;e++)for(var f=0;f<a[e].xrefs.length;f++){var g=a[e].xrefs[f];if("Xref"==b){var h=g.dbName.toLowerCase();"go"!=h&&"interpro"!=h&&"reactome"!=h&&(g.transcript=a[e].id,d.push(g))}else g.dbName.toLowerCase()==b.toLowerCase()&&(g.transcript=a[e].id,d.push(g))}if(d.length<=0)return this.notFoundPanel;if(null==this[b+"Grid"]){var c=c,i=b,j=["description","id","dbName","transcript"],k=[{header:"Display Id",dataIndex:"id",flex:1},{header:"DB name",dataIndex:"dbName",flex:1},{header:"Description",dataIndex:"description",flex:3}];this[b+"Grid"]=this.doGrid(k,j,i,c),this[b+"Grid"].store.loadData(d)}return this[b+"Grid"]},GeneInfoWidget.prototype.getTfbsGrid=function(a){if(a.length<=0)return this.notFoundPanel;var b="";if(null!=a[0].id){var c=[];b="transcriptId";for(var d=0;d<a.length;d++)if(transcript=a[d],null!=transcript.tfbs){for(var e=0;e<transcript.tfbs.length;e++)transcript.tfbs[e].transcriptId=transcript.id;c=c.concat(transcript.tfbs)}a=c}if(null==this.tfbsGrid){var b=b,f="TFBS",g=["chromosome","start","end","strand","tfName","relativeStart","relativeEnd","targetGeneName","score","sequence","transcriptId"],h=[{header:"Name",dataIndex:"tfName",flex:1},{header:"Location: chr:start-end (strand)",xtype:"templatecolumn",tpl:"{chromosome}:{start}-{end} ({strand})",flex:2.5},{header:"Relative (start-end)",xtype:"templatecolumn",tpl:"{relativeStart}-{relativeEnd}",flex:1.5},{header:"Target gene",dataIndex:"targetGeneName",flex:1},{header:"Score",dataIndex:"score",flex:1},{header:"Sequence",dataIndex:"sequence",flex:1}];this.tfbsGrid=this.doGrid(h,g,f,b),this.tfbsGrid.store.loadData(a)}return this.tfbsGrid},GeneInfoWidget.prototype.getMirnaTargetGrid=function(a){if(a.length<=0)return this.notFoundPanel;if(null==this.mirnaTargetGrid){var b="",c="miRNA targets",d=["chromosome","start","end","strand","mirbaseId","score","experimentalMethod","source"],e=[{header:"Id",dataIndex:"mirbaseId",flex:1},{header:"Location: chr:start-end (strand)",xtype:"templatecolumn",tpl:"{chromosome}:{start}-{end} ({strand})",flex:2},{header:"Score",dataIndex:"score",flex:1},{header:"Exp. Method",dataIndex:"experimentalMethod",flex:1},{header:"source",dataIndex:"source",flex:1}];this.mirnaTargetGrid=this.doGrid(e,d,c,b),this.mirnaTargetGrid.store.loadData(a)}return this.mirnaTargetGrid},GeneInfoWidget.prototype.getProteinFeaturesGrid=function(a){if(a.length<=0)return this.notFoundPanel;if(null==this.proteinFeaturesGrid){var b="",c="Protein features",d=["identifier","start","end","original","type","description"],e=[{header:"Identifier",dataIndex:"identifier",flex:1},{header:"Location: (start-end)",xtype:"templatecolumn",tpl:"{start}-{end}",flex:1.2},{header:"Original",dataIndex:"original",flex:1},{header:"Type",dataIndex:"type",flex:1},{header:"Description",dataIndex:"description",flex:1.5}];this.proteinFeaturesGrid=this.doGrid(e,d,c,b),this.proteinFeaturesGrid.store.loadData(a)}return this.proteinFeaturesGrid},GeneInfoWidget.prototype.getProteinFeaturesGrid=function(a){if(a.length<=0)return this.notFoundPanel;if(null==this.proteinFeaturesGrid){var b="",c="Protein features",d=["identifier","start","end","original","type","description"],e=[{header:"Identifier",dataIndex:"identifier",flex:1},{header:"Location: (start-end)",xtype:"templatecolumn",tpl:"{start}-{end}",flex:1.2},{header:"Original",dataIndex:"original",flex:1},{header:"Type",dataIndex:"type",flex:1},{header:"Description",dataIndex:"description",flex:1.5}];this.proteinFeaturesGrid=this.doGrid(e,d,c,b),this.proteinFeaturesGrid.store.loadData(a)}return this.proteinFeaturesGrid},GeneInfoWidget.prototype.get3Dprotein=function(){var a=this;if(null==this.p3dProtein){this.p3dProtein=Ext.create("Ext.tab.Panel",{title:"3D Protein Viewer",border:!1,cls:"ocb-border-left-lightgrey",flex:3,autoScroll:!0});var b=[];$.ajax({url:(new CellBaseManager).host+"/v3/"+a.species+"/feature/id/"+this.query+"/xref?dbname=pdb&of=json",async:!1,success:function(c){if(""!=c){b=c[0];for(var d=0;d<b.length;d++){var e=b[d].id,f=Ext.create("Ext.panel.Panel",{title:e,bodyCls:"ocb-background-black",html:'<canvas class="ChemDoodleWebComponent" id="pdb_canvas_'+e+'" width="600" height="600" style="width: 600px; height: 600px; ">This browser does not support HTML5/Canvas.</canvas>',listeners:{afterrender:function(a){var b=a.title;ChemDoodle.default_backgroundColor="#000000";var c=new ChemDoodle.TransformCanvas3D("pdb_canvas_"+b,300,300);c.gl?(c.specs.set3DRepresentation("Ball and Stick"),c.specs.proteins_ribbonCartoonize=!0,c.handle=null,c.timeout=15,c.startAnimation=ChemDoodle._AnimatorCanvas.prototype.startAnimation,c.stopAnimation=ChemDoodle._AnimatorCanvas.prototype.stopAnimation,c.isRunning=ChemDoodle._AnimatorCanvas.prototype.isRunning,c.dblclick=ChemDoodle.RotatorCanvas.prototype.dblclick,c.nextFrame=function(a){var b=[];mat4.identity(b);var c=a/1e3,d=Math.PI/15;mat4.rotate(b,d*c,[1,0,0]),mat4.rotate(b,d*c,[0,1,0]),mat4.rotate(b,d*c,[0,0,1]),mat4.multiply(this.rotationMatrix,b)},$.get("http://www.rcsb.org/pdb/files/"+b+".pdb",function(a){var b=ChemDoodle.readPDB(a);c.loadMolecule(b),c.startAnimation()})):(c.emptyMessage="Your browser does not support WebGL",c.displayMessage())}}});a.p3dProtein.add(f)}}else a.p3dProtein.setTitle("No proteins found")}})}return this.p3dProtein},GeneInfoWidget.prototype.getEnsembleId=function(){},GeneInfoWidget.prototype.getData=function(){var a=this;this.panel.disable(),this.panel.setLoading("Getting information..."),CellBaseManager.get({species:this.species,category:"feature",subCategory:"gene",query:this.query,resource:"info",success:function(b){a.dataReceived(b.response[0].result[0])}})},GeneInfoWidget.prototype.dataReceived=function(a){this.data=a,console.log(this.data),this.optionClick({text:"Information",leaf:"true"}),this.panel.enable(),this.panel.setLoading(!1)},GeneOrangeInfoWidget.prototype.draw=InfoWidget.prototype.draw,GeneOrangeInfoWidget.prototype.render=InfoWidget.prototype.render,GeneOrangeInfoWidget.prototype.getTreePanel=InfoWidget.prototype.getTreePanel,GeneOrangeInfoWidget.prototype.checkDataTypes=InfoWidget.prototype.checkDataTypes,GeneOrangeInfoWidget.prototype.doGrid=InfoWidget.prototype.doGrid,GeneOrangeInfoWidget.prototype.getGeneTemplate=InfoWidget.prototype.getGeneTemplate,GeneOrangeInfoWidget.prototype.getTranscriptTemplate=InfoWidget.prototype.getTranscriptTemplate,GeneOrangeInfoWidget.prototype.getdataTypes=function(){return dataTypes=[{text:"Genomic",children:[{text:"Information"},{text:"Transcripts"}]},{text:"Functional information",children:[{text:"GO"},{text:"KEGG"},{text:"Interpro"}]}]},GeneOrangeInfoWidget.prototype.optionClick=function(a){if(a.leaf)switch(null!=this.panel.getComponent(1)&&(this.panel.getComponent(1).hide(),this.panel.remove(1,!1)),a.text){case"Information":this.panel.add(this.getGenePanel(this.data).show());break;case"Transcripts":this.panel.add(this.getTranscriptPanel(this.data.transcripts).show());break;case"GO":this.panel.add(this.getXrefGrid(this.data.go,"GO").show());break;case"Interpro":this.panel.add(this.getXrefGrid(this.data.interpro,"Interpro").show());break;case"KEGG":this.panel.add(this.getXrefGrid(this.data.kegg,"KEGG").show())}},GeneOrangeInfoWidget.prototype.getGenePanel=function(a){if(null==a)return this.notFoundPanel;if(null==this.genePanel){var b=this.getGeneTemplate();this.genePanel=Ext.create("Ext.panel.Panel",{title:"Gene information",border:!1,cls:"panel-border-left",flex:3,bodyPadding:10,data:a,tpl:b})}return this.genePanel},GeneOrangeInfoWidget.prototype.getTranscriptPanel=function(a){if(a.length<=0)return this.notFoundPanel;if(null==this.transcriptGrid){for(var b=this.getTranscriptTemplate(),c=[],d=0;d<a.length;d++){var e=Ext.create("Ext.container.Container",{padding:5,data:a[d],tpl:b});c.push(e)}this.transcriptGrid=Ext.create("Ext.panel.Panel",{title:"Transcripts ("+d+")",border:!1,cls:"panel-border-left",flex:3,bodyPadding:5,autoScroll:!0,items:c})}return this.transcriptGrid},GeneOrangeInfoWidget.prototype.getXrefGrid=function(a,b){if(a.length<=0)return this.notFoundPanel;if(null==this[b+"Grid"]){var c="",d=b,e=["description","displayId"],f=[{header:"Display Id",dataIndex:"displayId",flex:1},{header:"Description",dataIndex:"description",flex:3}];this[b+"Grid"]=this.doGrid(f,e,d,c),this[b+"Grid"].store.loadData(a)}return this[b+"Grid"]},GeneOrangeInfoWidget.prototype.getTfbsGrid=function(a){if(a.length<=0)return this.notFoundPanel;if(null==this.tfbsGrid){var b="",c="TFBS",d=["chromosome","start","end","strand","tfName","relativeStart","relativeEnd","targetGeneName","score","sequence"],e=[{header:"Name",dataIndex:"tfName",flex:1},{header:"Location: chr:start-end (strand)",xtype:"templatecolumn",tpl:"{chromosome}:{start}-{end} ({strand})",flex:2.5},{header:"Relative (start-end)",xtype:"templatecolumn",tpl:"{relativeStart}-{relativeEnd}",flex:1.5},{header:"Target gene",dataIndex:"targetGeneName",flex:1},{header:"Score",dataIndex:"score",flex:1},{header:"Sequence",dataIndex:"sequence",flex:1}];this.tfbsGrid=this.doGrid(e,d,c,b),this.tfbsGrid.store.loadData(a)}return this.tfbsGrid},GeneOrangeInfoWidget.prototype.getMirnaTargetGrid=function(a){if(a.length<=0)return this.notFoundPanel;if(null==this.mirnaTargetGrid){var b="",c="miRNA targets",d=["chromosome","start","end","strand","mirbaseId","score","experimentalMethod","source"],e=[{header:"Id",dataIndex:"mirbaseId",flex:1},{header:"Location: chr:start-end (strand)",xtype:"templatecolumn",tpl:"{chromosome}:{start}-{end} ({strand})",flex:2},{header:"Score",dataIndex:"score",flex:1},{header:"Exp. Method",dataIndex:"experimentalMethod",flex:1},{header:"source",dataIndex:"source",flex:1}];this.mirnaTargetGrid=this.doGrid(e,d,c,b),this.mirnaTargetGrid.store.loadData(a)}return this.mirnaTargetGrid},GeneOrangeInfoWidget.prototype.getProteinFeaturesGrid=function(a){if(a.length<=0)return this.notFoundPanel;if(null==this.proteinFeaturesGrid){var b="",c="Protein features",d=["identifier","start","end","original","type","description"],e=[{header:"Identifier",dataIndex:"identifier",flex:1},{header:"Location: (start-end)",xtype:"templatecolumn",tpl:"{start}-{end}",flex:1.2},{header:"Original",dataIndex:"original",flex:1},{header:"Type",dataIndex:"type",flex:1},{header:"Description",dataIndex:"description",flex:1.5}];this.proteinFeaturesGrid=this.doGrid(e,d,c,b),this.proteinFeaturesGrid.store.loadData(a)}return this.proteinFeaturesGrid},GeneOrangeInfoWidget.prototype.getProteinFeaturesGrid=function(a){if(a.length<=0)return this.notFoundPanel;if(null==this.proteinFeaturesGrid){var b="",c="Protein features",d=["identifier","start","end","original","type","description"],e=[{header:"Identifier",dataIndex:"identifier",flex:1},{header:"Location: (start-end)",xtype:"templatecolumn",tpl:"{start}-{end}",flex:1.2},{header:"Original",dataIndex:"original",flex:1},{header:"Type",dataIndex:"type",flex:1},{header:"Description",dataIndex:"description",flex:1.5}];this.proteinFeaturesGrid=this.doGrid(e,d,c,b),this.proteinFeaturesGrid.store.loadData(a)}return this.proteinFeaturesGrid},GeneOrangeInfoWidget.prototype.get3Dprotein=function(){var a=this;if(null==this.p3dProtein){this.p3dProtein=Ext.create("Ext.tab.Panel",{title:"3D Protein Viewer",border:!1,cls:"panel-border-left",flex:3,autoScroll:!0});var b=[];$.ajax({url:"http://ws.bioinfo.cipf.es/cellbase/rest/v1/hsa/feature/id/"+this.query+"/xref?dbname=pdb",async:!1,success:function(c){if(""!=c){b=c.trim().split("\n");for(var d=0;d<b.length;d++){var e=b[d].trim(),f=Ext.create("Ext.panel.Panel",{title:e,bodyCls:"ocb-background-black",html:'<canvas class="ChemDoodleWebComponent" id="pdb_canvas_'+e+'" width="600" height="600" style="width: 600px; height: 600px; ">This browser does not support HTML5/Canvas.</canvas>',listeners:{afterrender:function(a){var b=a.title;ChemDoodle.default_backgroundColor="#000000";var c=new ChemDoodle.TransformCanvas3D("pdb_canvas_"+b,300,300);c.gl?(c.specs.set3DRepresentation("Ball and Stick"),c.specs.proteins_ribbonCartoonize=!0,c.handle=null,c.timeout=15,c.startAnimation=ChemDoodle._AnimatorCanvas.prototype.startAnimation,c.stopAnimation=ChemDoodle._AnimatorCanvas.prototype.stopAnimation,c.isRunning=ChemDoodle._AnimatorCanvas.prototype.isRunning,c.dblclick=ChemDoodle.RotatorCanvas.prototype.dblclick,c.nextFrame=function(a){var b=[];mat4.identity(b);var c=a/1e3,d=Math.PI/15;mat4.rotate(b,d*c,[1,0,0]),mat4.rotate(b,d*c,[0,1,0]),mat4.rotate(b,d*c,[0,0,1]),mat4.multiply(this.rotationMatrix,b)},$.get("http://www.rcsb.org/pdb/files/"+b+".pdb",function(a){var b=ChemDoodle.readPDB(a);c.loadMolecule(b),c.startAnimation()})):(c.emptyMessage="Your browser does not support WebGL",c.displayMessage())}}});a.p3dProtein.add(f)}}else a.p3dProtein.setTitle("No proteins found")}})}return this.p3dProtein},GeneOrangeInfoWidget.prototype.getEnsembleId=function(){},GeneOrangeInfoWidget.prototype.getData=function(){var a=this;this.panel.disable(),this.panel.setLoading("Getting information...");var b=new CellBaseManager(this.species);b.success.addEventListener(function(b,c){a.dataReceived(JSON.parse(c.result))}),b.get("feature","gene",this.query,"fullinfo")},GeneOrangeInfoWidget.prototype.dataReceived=function(a){this.data=a[0][0],console.log(this.data),this.optionClick({text:"Information",leaf:"true"}),this.panel.enable(),this.panel.setLoading(!1)},MirnaInfoWidget.prototype.draw=InfoWidget.prototype.draw,MirnaInfoWidget.prototype.render=InfoWidget.prototype.render,MirnaInfoWidget.prototype.getTreePanel=InfoWidget.prototype.getTreePanel,MirnaInfoWidget.prototype.checkDataTypes=InfoWidget.prototype.checkDataTypes,MirnaInfoWidget.prototype.doGrid=InfoWidget.prototype.doGrid,MirnaInfoWidget.prototype.getTranscriptTemplate=InfoWidget.prototype.getTranscriptTemplate,MirnaInfoWidget.prototype.getGeneTemplate=InfoWidget.prototype.getGeneTemplate,MirnaInfoWidget.prototype.getdataTypes=function(){return dataTypes=[{text:"Information",children:[{text:"miRNA"},{text:"Transcript"},{text:"Gene"}]},{text:"Regulatory",children:[{text:"Target Genes"}]},{text:"Disease",children:[{text:"Related Diseases"}]}]},MirnaInfoWidget.prototype.optionClick=function(a){if(a.leaf)switch(null!=this.panel.getComponent(1)&&(this.panel.getComponent(1).hide(),this.panel.remove(1,!1)),a.text){case"miRNA":this.panel.add(this.getMirnaPanel(this.data.mirna).show());break;case"Transcript":this.panel.add(this.getTranscriptPanel(this.data.transcripts).show());break;case"Gene":this.panel.add(this.getGenePanel(this.data.genes).show());break;case"Target Genes":this.panel.add(this.getTargetGenesGrid(this.data.targetGenes).show());break;case"Related Diseases":this.panel.add(this.getMirnaDiseasesGrid(this.data.mirnaDiseases).show())}},MirnaInfoWidget.prototype.getMirnaPanel=function(a){if(a.mirnaMature.length<=0&&a.mirnaGenes.length<=0)return this.notFoundPanel;if(null==this.mirnaPanel){for(var b=this.getMirnaMatureTemplate(),c=this.getMirnaGeneTemplate(),d=[],e=0;e<a.mirnaMature.length;e++){var f=Ext.create("Ext.container.Container",{padding:5,data:a.mirnaMature[e],tpl:b});d.push(f)}for(var e=0;e<a.mirnaGenes.length;e++){var g=Ext.create("Ext.container.Container",{padding:5,data:a.mirnaGenes[e],tpl:c});d.push(g)}this.mirnaPanel=Ext.create("Ext.panel.Panel",{title:"miRNA",border:!1,cls:"ocb-border-left-lightgrey",flex:3,bodyPadding:5,autoScroll:!0,items:d})}return this.mirnaPanel},MirnaInfoWidget.prototype.getTranscriptPanel=function(a){if(a.length<=0)return this.notFoundPanel;if(null==this.transcriptGrid){for(var b=this.getTranscriptTemplate(),c=[],d=0;d<a.length;d++){var e=Ext.create("Ext.container.Container",{padding:5,data:a[d],tpl:b});c.push(e)}this.transcriptGrid=Ext.create("Ext.panel.Panel",{title:"Transcripts ("+d+")",border:!1,cls:"ocb-border-left-lightgrey",flex:3,bodyPadding:5,autoScroll:!0,items:c})}return this.transcriptGrid},MirnaInfoWidget.prototype.getGenePanel=function(a){if(a.length<=0)return this.notFoundPanel;if(null==this.genePanel){for(var b=this.getGeneTemplate(),c=[],d=0;d<a.length;d++){var e=Ext.create("Ext.container.Container",{padding:5,data:a[d],tpl:b});c.push(e)}this.genePanel=Ext.create("Ext.panel.Panel",{title:"Genes ("+d+")",border:!1,cls:"ocb-border-left-lightgrey",flex:3,bodyPadding:5,autoScroll:!0,items:c})}return this.genePanel},MirnaInfoWidget.prototype.getTargetGenesGrid=function(a){if(a.length<=0)return this.notFoundPanel;if(null==this.targetGenesGrid){var b="",c="targetGenes",d=["externalName","stableId","biotype","chromosome","start","end","strand","description"],e=[{header:"Name",dataIndex:"externalName",flex:1},{header:"Stable Id",dataIndex:"stableId",flex:2},{header:"Biotype",dataIndex:"biotype",flex:1.5},{header:"Chr",dataIndex:"chromosome",flex:.5},{header:"Start",dataIndex:"start",flex:1},{header:"End",dataIndex:"end",flex:1},{header:"Strand",dataIndex:"strand",flex:.5},{header:"Description",dataIndex:"description",flex:1}];this.targetGenesGrid=this.doGrid(e,d,c,b),this.targetGenesGrid.store.loadData(a)}return this.targetGenesGrid},MirnaInfoWidget.prototype.getMirnaDiseasesGrid=function(a){if(a.length<=0)return this.notFoundPanel;if(null==this.mirnaDiseasesGrid){var b="",c="mirnaDiseases",d=["mirnaDiseaseId","mirnaGene","mirbaseId","diseaseName","pubmedId","description"],e=[{header:"Name",dataIndex:"mirbaseId",flex:1.5},{header:"Disease",dataIndex:"diseaseName",flex:1.5},{header:"PubMed id",dataIndex:"pubmedId",flex:1},{header:"Description",dataIndex:"description",flex:3}];this.mirnaDiseasesGrid=this.doGrid(e,d,c,b),this.mirnaDiseasesGrid.store.loadData(a)}return this.mirnaDiseasesGrid},MirnaInfoWidget.prototype.getData=function(){var a=this;this.panel.disable(),this.panel.setLoading("Getting information...");var b=new CellBaseDataAdapter(this.species);b.successed.addEventListener(function(){a.dataReceived(b.toJSON())}),b.fill("regulatory","mirna_mature",this.feature.getName(),"fullinfo"),console.log(this.feature.getName())},MirnaInfoWidget.prototype.dataReceived=function(a){var b=JSON.parse(a);this.data=b[0],console.log(this.data),this.optionClick({text:"miRNA",leaf:"true"}),this.panel.enable(),this.panel.setLoading(!1)},MirnaInfoWidget.prototype.getMirnaMatureTemplate=function(){return new Ext.XTemplate('<p><span class="panel-border-bottom"><span class="ssel s130">miRNA mature</span> &nbsp; <span class="emph s120"> {mirbaseId} </span></span></p>',"<br>",'<p><span class="w140 dis s90">miRBase Accession: </span> <span class="">{mirbaseAcc}</span></p>','<span class="w140 dis s90">Sequence: </span> <span class="">{sequence}</span>')},MirnaInfoWidget.prototype.getMirnaGeneTemplate=function(){return new Ext.XTemplate('<p><span class="panel-border-bottom"><span class="ssel s130">miRNA gene</span> &nbsp; <span class="emph s120"> {mirbaseId} </span></span></p>',"<br>",'<p><span class="w140 dis s90">miRBase Accession: </span> <span class="">{mirbaseAcc}</span></p>','<span class="w140 dis s90">Sequence: </span> <span class="">{sequence}</span>','<p><span class="w140 dis s90">Status: </span> <span class="">{status}</span></p>')},ProteinInfoWidget.prototype.draw=InfoWidget.prototype.draw,ProteinInfoWidget.prototype.render=InfoWidget.prototype.render,ProteinInfoWidget.prototype.getTreePanel=InfoWidget.prototype.getTreePanel,ProteinInfoWidget.prototype.checkDataTypes=InfoWidget.prototype.checkDataTypes,ProteinInfoWidget.prototype.doGrid=InfoWidget.prototype.doGrid,ProteinInfoWidget.prototype.getdataTypes=function(){return dataTypes=[{text:"Sumary",children:[{text:"Long"},{text:"Seq"}]},{text:"Functional information",children:[{text:"GO"},{text:"Reactome"},{text:"Interpro"}]},{text:"Interactions"},{text:"Variations"}]},ProteinInfoWidget.prototype.optionClick=function(a){if(a.leaf)switch(null!=this.panel.getComponent(1)&&(this.panel.getComponent(1).hide(),this.panel.remove(1,!1)),a.text){case"":break;
case"":break;case"Reactome":break;case"Interpro":break;case"":break;case"":break;case"":}},SnpInfoWidget.prototype.draw=InfoWidget.prototype.draw,SnpInfoWidget.prototype.render=InfoWidget.prototype.render,SnpInfoWidget.prototype.getTreePanel=InfoWidget.prototype.getTreePanel,SnpInfoWidget.prototype.checkDataTypes=InfoWidget.prototype.checkDataTypes,SnpInfoWidget.prototype.doGrid=InfoWidget.prototype.doGrid,SnpInfoWidget.prototype.getSnpTemplate=InfoWidget.prototype.getSnpTemplate,SnpInfoWidget.prototype.getSnpTranscriptTemplate=InfoWidget.prototype.getSnpTranscriptTemplate,SnpInfoWidget.prototype.getConsequenceTypeTemplate=InfoWidget.prototype.getConsequenceTypeTemplate,SnpInfoWidget.prototype.getPhenotypeTemplate=InfoWidget.prototype.getPhenotypeTemplate,SnpInfoWidget.prototype.getPopulationTemplate=InfoWidget.prototype.getPopulationTemplate,SnpInfoWidget.prototype.getdataTypes=function(){return dataTypes=[{text:"Genomic",children:[{text:"Information"},{text:"Transcripts"}]},{text:"Consequence type"},{text:"Annotated phenotype"}]},SnpInfoWidget.prototype.optionClick=function(a){if(a.leaf)switch(null!=this.panel.getComponent(1)&&(this.panel.getComponent(1).hide(),this.panel.remove(1,!1)),a.text){case"Information":this.panel.add(this.getInfoPanel(this.data).show());break;case"Transcripts":this.panel.add(this.getSnpTranscriptPanel(this.data.transcriptVariations).show());break;case"Consequence type":this.panel.add(this.getConsequenceTypePanel(this.data.transcriptVariations).show());break;case"Annotated phenotype":this.panel.add(this.getPhenotypePanel(this.data.phenotype).show())}},SnpInfoWidget.prototype.getInfoPanel=function(a){if(null==a)return this.notFoundPanel;if(null==this.infoPanel){var b=this.getSnpTemplate();this.infoPanel=Ext.create("Ext.panel.Panel",{title:"Information",border:!1,cls:"ocb-border-left-lightgrey",flex:3,bodyPadding:10,data:a,tpl:b})}return this.infoPanel},SnpInfoWidget.prototype.getSnpTranscriptPanel=function(a){if(a.length<=0)return this.notFoundPanel;if(null==this.snpTranscriptGrid){for(var b=this.getSnpTranscriptTemplate(),c=[],d=0;d<a.length;d++){var e=Ext.create("Ext.container.Container",{padding:5,data:a[d],tpl:b});c.push(e)}this.snpTranscriptGrid=Ext.create("Ext.panel.Panel",{title:"Transcripts ("+d+")",border:!1,cls:"ocb-border-left-lightgrey",flex:3,bodyPadding:5,autoScroll:!0,items:c})}return this.snpTranscriptGrid},SnpInfoWidget.prototype.getConsequenceTypePanel=function(a){if(a.length<=0)return this.notFoundPanel;if(null==this.consequencePanel){for(var b=(this.getConsequenceTypeTemplate(),[]),c=0;c<a.length;c++)for(var d=0;d<a[c].consequenceTypes.length;d++){var e=a[c].consequenceTypes[d];a[c].consequenceType=e,b.push(a[c])}var f="consequenceType",g="transcriptVariation",h=["transcriptId","consequenceType"],i=[{header:"Transcript id",dataIndex:"transcriptId",flex:1},{header:"Consequence type",dataIndex:"consequenceType",flex:1}];this.consequencePanel=this.doGrid(i,h,g,f),this.consequencePanel.store.loadData(b)}return this.consequencePanel},SnpInfoWidget.prototype.getPhenotypePanel=function(a){if(a.length<=0)return this.notFoundPanel;if(null==this.phenotypePanel){for(var b=this.getPhenotypeTemplate(),c=[],d=0;d<a.length;d++){var e=Ext.create("Ext.container.Container",{padding:5,data:a[d],tpl:b});c.push(e)}this.phenotypePanel=Ext.create("Ext.panel.Panel",{title:"Phenotype ("+d+")",border:!1,cls:"ocb-border-left-lightgrey",flex:3,bodyPadding:5,autoScroll:!0,items:c})}return this.phenotypePanel},SnpInfoWidget.prototype.getPopulationPanel=function(a){if(a.length<=0)return this.notFoundPanel;if(null==this.populationPanel){for(var b=this.getPopulationTemplate(),c=[],d=0;d<a.length;d++){var e=Ext.create("Ext.container.Container",{padding:5,data:a[d],tpl:b});c.push(e)}this.populationPanel=Ext.create("Ext.panel.Panel",{title:"Population ("+d+")",border:!1,cls:"ocb-border-left-lightgrey",flex:3,bodyPadding:5,autoScroll:!0,items:c})}return this.populationPanel},SnpInfoWidget.prototype.getData=function(){var a=this;this.panel.disable(),this.panel.setLoading("Getting information..."),CellBaseManager.get({species:this.species,category:"feature",subCategory:"snp",query:this.query,resource:"info",success:function(b){a.dataReceived(b.response[0].result[0])}})},SnpInfoWidget.prototype.dataReceived=function(a){this.data=a,console.log(this.data),this.optionClick({text:"Information",leaf:"true"}),this.panel.enable(),this.panel.setLoading(!1)},TFInfoWidget.prototype.draw=InfoWidget.prototype.draw,TFInfoWidget.prototype.render=InfoWidget.prototype.render,TFInfoWidget.prototype.getTreePanel=InfoWidget.prototype.getTreePanel,TFInfoWidget.prototype.checkDataTypes=InfoWidget.prototype.checkDataTypes,TFInfoWidget.prototype.doGrid=InfoWidget.prototype.doGrid,TFInfoWidget.prototype.getTranscriptTemplate=InfoWidget.prototype.getTranscriptTemplate,TFInfoWidget.prototype.getProteinTemplate=InfoWidget.prototype.getProteinTemplate,TFInfoWidget.prototype.getGeneTemplate=InfoWidget.prototype.getGeneTemplate,TFInfoWidget.prototype.getPWMTemplate=InfoWidget.prototype.getPWMTemplate,TFInfoWidget.prototype.getProteinXrefTemplate=InfoWidget.prototype.getProteinXrefTemplate,TFInfoWidget.prototype.getdataTypes=function(){return dataTypes=[{text:"Information",children:[{text:"Protein"},{text:"Transcript"},{text:"Gene"}]},{text:"Regulatory",children:[{text:"PWM"},{text:"Target Genes"}]},{text:"Protein Features",children:[{text:"Protein profile"},{text:"Mutation sites"},{text:"Pathways"},{text:"Protein interactions"},{text:"Related Diseases"}]}]},TFInfoWidget.prototype.optionClick=function(a){if(a.leaf)switch(null!=this.panel.getComponent(1)&&(this.panel.getComponent(1).hide(),this.panel.remove(1,!1)),a.text){case"Protein":this.panel.add(this.getProteinPanel(this.data.proteins).show());break;case"Transcript":this.panel.add(this.getTranscriptPanel(this.data.transcripts).show());break;case"Gene":this.panel.add(this.getGenePanel(this.data.gene).show());break;case"PWM":this.panel.add(this.getPWMPanel(this.data.pwm).show());break;case"Target Genes":this.panel.add(this.getTargetGenesGrid(this.data.targetGenes).show());break;case"Protein profile":this.panel.add(this.getProteinFeatureGrid(this.data.protein_feature,"Protein profile").show());break;case"Mutation sites":this.panel.add(this.getProteinFeatureGrid(this.data.protein_feature,"Mutation sites").show());break;case"Pathways":this.panel.add(this.getProteinXrefPanel(this.data.protein_xref,"Pathway").show());break;case"Protein interactions":this.panel.add(this.getProteinXrefPanel(this.data.protein_xref,"Interaction").show());break;case"Related Diseases":this.panel.add(this.getProteinXrefPanel(this.data.protein_xref,"Disease").show())}},TFInfoWidget.prototype.getProteinPanel=function(a){if(null==a)return this.notFoundPanel;if(null==this.proteinPanel){var b=this.getProteinTemplate();this.proteinPanel=Ext.create("Ext.panel.Panel",{title:"Protein",border:!1,cls:"ocb-border-left-lightgrey",flex:3,bodyPadding:10,data:a[0],tpl:b})}return this.proteinPanel},TFInfoWidget.prototype.getTranscriptPanel=function(a){if(a.length<=0)return this.notFoundPanel;if(null==this.transcriptGrid){for(var b=this.getTranscriptTemplate(),c=[],d=0;d<a.length;d++){var e=Ext.create("Ext.container.Container",{padding:5,data:a[d],tpl:b});c.push(e)}this.transcriptGrid=Ext.create("Ext.panel.Panel",{title:"Transcripts ("+d+")",border:!1,cls:"ocb-border-left-lightgrey",flex:3,bodyPadding:5,autoScroll:!0,items:c})}return this.transcriptGrid},TFInfoWidget.prototype.getGenePanel=function(a){if(null==a)return this.notFoundPanel;if(null==this.genePanel){var b=this.getGeneTemplate();this.genePanel=Ext.create("Ext.panel.Panel",{title:"Gene information",border:!1,cls:"ocb-border-left-lightgrey",flex:3,bodyPadding:10,data:a,tpl:b})}return this.genePanel},TFInfoWidget.prototype.getPWMPanel=function(a){if(a.length<=0)return this.notFoundPanel;if(null==this.pwmPanel){for(var b=this.getPWMTemplate(),c=[],d=0;d<a.length;d++){var e=Ext.create("Ext.container.Container",{padding:5,data:a[d],tpl:b});c.push(e)}this.pwmPanel=Ext.create("Ext.panel.Panel",{title:"PWM ("+d+")",border:!1,cls:"ocb-border-left-lightgrey",flex:3,bodyPadding:5,autoScroll:!0,items:c})}return this.pwmPanel},TFInfoWidget.prototype.getTargetGenesGrid=function(a){if(a.length<=0)return this.notFoundPanel;if(null==this.targetGenesGrid){var b="",c="targetGenes",d=["externalName","stableId","biotype","chromosome","start","end","strand","description"],e=[{header:"Name",dataIndex:"externalName",flex:1},{header:"Stable Id",dataIndex:"stableId",flex:2},{header:"Biotype",dataIndex:"biotype",flex:1.5},{header:"Chr",dataIndex:"chromosome",flex:.5},{header:"Start",dataIndex:"start",flex:1},{header:"End",dataIndex:"end",flex:1},{header:"Strand",dataIndex:"strand",flex:.5},{header:"Description",dataIndex:"description",flex:1}];this.targetGenesGrid=this.doGrid(e,d,c,b),this.targetGenesGrid.store.loadData(a)}return this.targetGenesGrid},TFInfoWidget.prototype.getProteinFeatureGrid=function(a,b){if(null==this[b+"Grid"]){for(var c=new Array,d=new Array,e=0;e<a.length;e++)"mutagenesis site"==a[e].type?d.push(a[e]):c.push(a[e]);if(null!=b){if("Protein profile"==b)var a=c;if("Mutation sites"==b)var a=d}if(a.length<=0)return this.notFoundPanel;var f="",g=b,h=["type","start","end","original","variation","description"],i=[{header:"Type",dataIndex:"type",flex:1.5},{header:"Start",dataIndex:"start",flex:.5},{header:"End",dataIndex:"end",flex:.5},{header:"Original",dataIndex:"original",flex:.7},{header:"Variation",dataIndex:"variation",flex:.7},{header:"Description",dataIndex:"description",flex:3}];this[b+"Grid"]=this.doGrid(i,h,g,f),this[b+"Grid"].store.loadData(a)}return this[b+"Grid"]},TFInfoWidget.prototype.getProteinXrefPanel=function(a,b){if(a.length<=0)return this.notFoundPanel;if(null==this[b+"panel"]){for(var c=this.getProteinXrefTemplate(),d=new Array,e=new Array,f=new Array,g=0;g<a.length;g++){var h=a[g].source;("Go"==h||"Reactome"==h||"KEGG"==h)&&d.push(a[g]),("IntAct"==h||"MINT"==h||"DIP"==h||"String"==h)&&e.push(a[g]),("MIN"==h||"PharmGKB"==h||"Orphanet"==h)&&f.push(a[g])}if(null!=b)switch(b){case"Pathway":a=d;break;case"Interaction":a=e;break;case"Disease":a=f}for(var i=[],g=0;g<a.length;g++){var j=Ext.create("Ext.panel.Panel",{border:!1,bodyPadding:5,data:a[g],tpl:c});i.push(j)}this[b+"panel"]=Ext.create("Ext.panel.Panel",{title:b+" ("+g+")",border:!1,cls:"ocb-border-left-lightgrey",flex:3,bodyPadding:5,autoScroll:!0,items:i})}return this[b+"panel"]},TFInfoWidget.prototype.getData=function(){var a=this;this.panel.disable(),this.panel.setLoading("Getting information...");var b=new CellBaseDataAdapter(this.species);b.successed.addEventListener(function(){a.dataReceived(b.toJSON())}),b.fill("regulatory","tf",this.feature.getName(),"fullinfo"),console.log(this.feature.getName())},TFInfoWidget.prototype.dataReceived=function(a){var b=JSON.parse(a);this.data=b[0],console.log(this.data),this.optionClick({text:"Protein",leaf:"true"}),this.panel.enable(),this.panel.setLoading(!1)},TranscriptInfoWidget.prototype.draw=InfoWidget.prototype.draw,TranscriptInfoWidget.prototype.render=InfoWidget.prototype.render,TranscriptInfoWidget.prototype.getTreePanel=InfoWidget.prototype.getTreePanel,TranscriptInfoWidget.prototype.checkDataTypes=InfoWidget.prototype.checkDataTypes,TranscriptInfoWidget.prototype.doGrid=InfoWidget.prototype.doGrid,TranscriptInfoWidget.prototype.getGeneTemplate=InfoWidget.prototype.getGeneTemplate,TranscriptInfoWidget.prototype.getTranscriptTemplate=InfoWidget.prototype.getTranscriptTemplate,TranscriptInfoWidget.prototype.getExonTemplate=InfoWidget.prototype.getExonTemplate,TranscriptInfoWidget.prototype.get3Dprotein=GeneInfoWidget.prototype.get3Dprotein,TranscriptInfoWidget.prototype.getGenePanel=GeneInfoWidget.prototype.getGenePanel,TranscriptInfoWidget.prototype.getXrefGrid=GeneInfoWidget.prototype.getXrefGrid,TranscriptInfoWidget.prototype.getTfbsGrid=GeneInfoWidget.prototype.getTfbsGrid,TranscriptInfoWidget.prototype.getMirnaTargetGrid=GeneInfoWidget.prototype.getMirnaTargetGrid,TranscriptInfoWidget.prototype.getProteinFeaturesGrid=GeneInfoWidget.prototype.getProteinFeaturesGrid,TranscriptInfoWidget.prototype.getdataTypes=function(){return dataTypes=[{text:"Genomic",children:[{text:"Information"},{text:"Gene"},{text:"Exons"},{text:"Xrefs"}]},{text:"Functional information",children:[{text:"GO"},{text:"Reactome"},{text:"Interpro"}]},{text:"Variation",children:[{text:"SNPs"},{text:"Mutations"}]},{text:"Regulatory",children:[{text:"TFBS"},{text:"miRNA targets"}]},{text:"Protein",children:[{text:"Features"},{text:"3D structure"}]}]},TranscriptInfoWidget.prototype.optionClick=function(a){if(a.leaf)switch(null!=this.panel.getComponent(1)&&(this.panel.getComponent(1).hide(),this.panel.remove(1,!1)),a.text){case"Information":this.panel.add(this.getInfoPanel(this.data).show());break;case"Gene":this.panel.add(this.getGenePanel(this.data.gene).show());break;case"Exons":this.panel.add(this.getExonsGrid(this.data.exons).show());break;case"Xrefs":this.panel.add(this.getXrefGrid([this.data],"Xref","dbName").show());break;case"GO":this.panel.add(this.getXrefGrid([this.data],"GO").show());break;case"Interpro":this.panel.add(this.getXrefGrid([this.data],"Interpro").show());break;case"Reactome":this.panel.add(this.getXrefGrid([this.data],"Reactome").show());break;case"SNPs":this.panel.add(this.getSnpsGrid(this.data.snps).show());break;case"Mutations":this.panel.add(this.getMutationsGrid(this.data.mutations).show());break;case"TFBS":this.panel.add(this.getTfbsGrid(this.data.tfbs).show());break;case"miRNA targets":this.panel.add(this.getMirnaTargetGrid(this.data.mirnaTargets).show());break;case"Features":this.panel.add(this.getProteinFeaturesGrid(this.data.proteinFeatures).show());break;case"3D structure":this.panel.add(this.get3Dprotein(this.data.snps).show())}},TranscriptInfoWidget.prototype.getInfoPanel=function(a){if(null==a)return this.notFoundPanel;if(null==this.infoPanel){var b=this.getTranscriptTemplate();this.infoPanel=Ext.create("Ext.panel.Panel",{title:"Information",border:!1,cls:"ocb-border-left-lightgrey",flex:3,bodyPadding:10,autoScroll:!0,data:a,tpl:b})}return this.infoPanel},TranscriptInfoWidget.prototype.getExonsGrid=function(a){if(a.length<=0)return this.notFoundPanel;if(null==this.exonsGrid){for(var b=this.getExonTemplate(),c=[],d=0;d<a.length;d++){var e=Ext.create("Ext.container.Container",{padding:5,data:a[d],tpl:b});c.push(e)}this.exonsGrid=Ext.create("Ext.panel.Panel",{title:"Exons ("+d+")",border:!1,cls:"ocb-border-left-lightgrey",flex:3,bodyPadding:5,autoScroll:!0,items:c})}return this.exonsGrid},TranscriptInfoWidget.prototype.getSnpsGrid=function(a){if(a.length<=0)return this.notFoundPanel;if(null==this.snpsGrid){var b="",c="SNPs",d=["chromosome","start","end","name","strand","alleleString","displaySoConsequence"],e=[{header:"Name",dataIndex:"name",flex:2},{header:"Location: chr:start-end (strand)",xtype:"templatecolumn",tpl:"{chromosome}:{start}-{end} ({strand})",flex:2},{header:"Alleles",dataIndex:"alleleString",flex:.7},{header:"Most severe SO term",dataIndex:"displaySoConsequence",flex:2}];this.snpsGrid=this.doGrid(e,d,c,b),this.snpsGrid.store.loadData(a)}return this.snpsGrid},TranscriptInfoWidget.prototype.getMutationsGrid=function(a){if(a.length<=0)return this.notFoundPanel;if(null==this.mutationsGrid){var b="",c="Mutations",d=["chromosome","start","end","mutationAa","mutationCds","primaryHistology","source"],e=[{header:"Mutation AA",dataIndex:"mutationAa",flex:1},{header:"Mutation CDS",dataIndex:"mutationCds",flex:1.5},{header:"Location: chr:start-end",xtype:"templatecolumn",tpl:"{chromosome}:{start}-{end}",flex:1.7},{header:"Primary histology",dataIndex:"primaryHistology",flex:1},{header:"Source",dataIndex:"source",flex:1}];this.mutationsGrid=this.doGrid(e,d,c,b),this.mutationsGrid.store.loadData(a)}return this.mutationsGrid},TranscriptInfoWidget.prototype.getData=function(){var a=this;this.panel.disable(),this.panel.setLoading("Getting information..."),CellBaseManager.get({species:this.species,category:"feature",subCategory:"transcript",query:this.query,resource:"info",success:function(b){a.dataReceived(b.response[0].result[0].transcripts)}})},TranscriptInfoWidget.prototype.dataReceived=function(a){this.data=a,console.log(this.data),this.optionClick({text:"Information",leaf:"true"}),this.panel.enable(),this.panel.setLoading(!1)},TranscriptOrangeInfoWidget.prototype.draw=InfoWidget.prototype.draw,TranscriptOrangeInfoWidget.prototype.render=InfoWidget.prototype.render,TranscriptOrangeInfoWidget.prototype.getTreePanel=InfoWidget.prototype.getTreePanel,TranscriptOrangeInfoWidget.prototype.checkDataTypes=InfoWidget.prototype.checkDataTypes,TranscriptOrangeInfoWidget.prototype.doGrid=InfoWidget.prototype.doGrid,TranscriptOrangeInfoWidget.prototype.getGeneTemplate=InfoWidget.prototype.getGeneTemplate,TranscriptOrangeInfoWidget.prototype.getTranscriptTemplate=InfoWidget.prototype.getTranscriptTemplate,TranscriptOrangeInfoWidget.prototype.getExonTemplate=InfoWidget.prototype.getExonTemplate,TranscriptOrangeInfoWidget.prototype.getGenePanel=GeneOrangeInfoWidget.prototype.getGenePanel,TranscriptOrangeInfoWidget.prototype.getXrefGrid=GeneOrangeInfoWidget.prototype.getXrefGrid,TranscriptOrangeInfoWidget.prototype.getdataTypes=function(){return dataTypes=[{text:"Genomic",children:[{text:"Information"},{text:"Gene"},{text:"Exons"}]},{text:"Functional information",children:[{text:"GO"},{text:"KEGG"},{text:"Interpro"}]}]},TranscriptOrangeInfoWidget.prototype.optionClick=function(a){if(a.leaf)switch(null!=this.panel.getComponent(1)&&(this.panel.getComponent(1).hide(),this.panel.remove(1,!1)),a.text){case"Information":this.panel.add(this.getInfoPanel(this.data).show());break;case"Gene":this.panel.add(this.getGenePanel(this.data.gene).show());break;case"Exons":this.panel.add(this.getExonsGrid(this.data.exons).show());break;case"GO":this.panel.add(this.getXrefGrid(this.data.go,"GO").show());break;case"Interpro":this.panel.add(this.getXrefGrid(this.data.interpro,"Interpro").show());break;case"KEGG":this.panel.add(this.getXrefGrid(this.data.kegg,"KEGG").show())}},TranscriptOrangeInfoWidget.prototype.getInfoPanel=function(a){if(null==a)return this.notFoundPanel;if(null==this.infoPanel){var b=this.getTranscriptTemplate();this.infoPanel=Ext.create("Ext.panel.Panel",{title:"Information",border:!1,cls:"panel-border-left",flex:3,bodyPadding:10,autoScroll:!0,data:a,tpl:b})}return this.infoPanel},TranscriptOrangeInfoWidget.prototype.getExonsGrid=function(a){if(a.length<=0)return this.notFoundPanel;if(null==this.exonsGrid){for(var b=this.getExonTemplate(),c=[],d=0;d<a.length;d++){var e=Ext.create("Ext.container.Container",{padding:5,data:a[d],tpl:b});c.push(e)}this.exonsGrid=Ext.create("Ext.panel.Panel",{title:"Exons ("+d+")",border:!1,cls:"panel-border-left",flex:3,bodyPadding:5,autoScroll:!0,items:c})}return this.exonsGrid},TranscriptOrangeInfoWidget.prototype.getSnpsGrid=function(a){if(a.length<=0)return this.notFoundPanel;if(null==this.snpsGrid){var b="",c="SNPs",d=["chromosome","start","end","name","strand","alleleString","displaySoConsequence"],e=[{header:"Name",dataIndex:"name",flex:2},{header:"Location: chr:start-end (strand)",xtype:"templatecolumn",tpl:"{chromosome}:{start}-{end} ({strand})",flex:2},{header:"Alleles",dataIndex:"alleleString",flex:.7},{header:"Most severe SO term",dataIndex:"displaySoConsequence",flex:2}];this.snpsGrid=this.doGrid(e,d,c,b),this.snpsGrid.store.loadData(a)}return this.snpsGrid},TranscriptOrangeInfoWidget.prototype.getMutationsGrid=function(a){if(a.length<=0)return this.notFoundPanel;if(null==this.mutationsGrid){var b="",c="Mutations",d=["chromosome","start","end","mutationAa","mutationCds","primaryHistology","source"],e=[{header:"Mutation AA",dataIndex:"mutationAa",flex:1},{header:"Mutation CDS",dataIndex:"mutationCds",flex:1.5},{header:"Location: chr:start-end",xtype:"templatecolumn",tpl:"{chromosome}:{start}-{end}",flex:1.7},{header:"Primary histology",dataIndex:"primaryHistology",flex:1},{header:"Source",dataIndex:"source",flex:1}];this.mutationsGrid=this.doGrid(e,d,c,b),this.mutationsGrid.store.loadData(a)}return this.mutationsGrid},TranscriptOrangeInfoWidget.prototype.getData=function(){var a=this;this.panel.disable(),this.panel.setLoading("Getting information...");var b=new CellBaseManager(this.species);b.success.addEventListener(function(b,c){a.dataReceived(JSON.parse(c.result))}),b.get("feature","transcript",this.query,"fullinfo")},TranscriptOrangeInfoWidget.prototype.dataReceived=function(a){this.data=a[0],console.log(this.data),this.optionClick({text:"Information",leaf:"true"}),this.panel.enable(),this.panel.setLoading(!1)},VCFVariantInfoWidget.prototype.draw=InfoWidget.prototype.draw,VCFVariantInfoWidget.prototype.render=InfoWidget.prototype.render,VCFVariantInfoWidget.prototype.getTreePanel=InfoWidget.prototype.getTreePanel,VCFVariantInfoWidget.prototype.checkDataTypes=InfoWidget.prototype.checkDataTypes,VCFVariantInfoWidget.prototype.doGrid=InfoWidget.prototype.doGrid,VCFVariantInfoWidget.prototype.getVCFVariantTemplate=InfoWidget.prototype.getVCFVariantTemplate,VCFVariantInfoWidget.prototype.getVariantEffectTemplate=InfoWidget.prototype.getVariantEffectTemplate,VCFVariantInfoWidget.prototype.getdataTypes=function(){return dataTypes=[{text:"Genomic",children:[{text:"Information"},{text:"Variant effect"},{text:"Header"},{text:"Samples"}]}]},VCFVariantInfoWidget.prototype.optionClick=function(a){if(a.leaf)switch(null!=this.panel.getComponent(1)&&(this.panel.getComponent(1).hide(),this.panel.remove(1,!1)),a.text){case"Information":this.panel.add(this.getInfoPanel(this.data.feature).show());break;case"Variant effect":this.panel.add(this.getEffectPanel(this.data.consequenceType).show());break;case"Header":this.panel.add(this.getHeaderPanel(this.data.header).show());break;case"Samples":this.panel.add(this.getSamplesGrid(this.data.feature.sampleData,this.data.samples,this.data.feature.format).show());break;case"Population":}},VCFVariantInfoWidget.prototype.getInfoPanel=function(a){if(null==a)return this.notFoundPanel;if(null==this.infoPanel){var b=this.getVCFVariantTemplate();this.infoPanel=Ext.create("Ext.panel.Panel",{title:"Information",border:!1,cls:"ocb-border-left-lightgrey",flex:3,bodyPadding:10,data:a,tpl:b})}return this.infoPanel},VCFVariantInfoWidget.prototype.getEffectPanel=function(a){if(a.length<=0)return this.notFoundPanel;for(var b=0;b<a.length;b++)a[b].consequence=a[b].consequenceType+" - "+a[b].consequenceTypeObo,""==a[b].featureName&&(a[b].featureName="-"),""==a[b].geneId&&(a[b].geneId="-"),""==a[b].transcriptId&&(a[b].transcriptId="-"),""==a[b].featureBiotype&&(a[b].featureBiotype="-"),""==a[b].aaPosition&&(a[b].aaPosition="-"),""==a[b].aminoacidChange&&(a[b].aminoacidChange="-");if(null==this.effectGrid){var c="consequence",d="effectGridModel",e=["featureName","geneId","transcriptId","featureBiotype","aaPosition","aminoacidChange","consequence"],f=[{header:"Feature",dataIndex:"featureName",flex:1},{header:"Gene Id",dataIndex:"geneId",flex:1.5},{header:"Transcript Id",dataIndex:"transcriptId",flex:1.5},{header:"Feat.Biotype",dataIndex:"featureBiotype",flex:1},{header:"aa Position",dataIndex:"aaPosition",flex:1},{header:"aa Change",dataIndex:"aminoacidChange",flex:1}];this.effectGrid=this.doGrid(f,e,d,c),this.effectGrid.store.loadData(a)}return this.effectGrid},VCFVariantInfoWidget.prototype.getHeaderPanel=function(a){return""==a?this.notFoundPanel:(null==this.headerPanel&&(this.headerPanel=Ext.create("Ext.panel.Panel",{title:"Information",border:!1,cls:"ocb-border-left-lightgrey",flex:3,bodyPadding:10,html:a})),this.headerPanel)},VCFVariantInfoWidget.prototype.getSamplesGrid=function(a,b,c){var d=a.split("	").slice(9);if(d.length<=0)return this.notFoundPanel;for(var e=new Array(b.length),f=0,g=e.length;g>f;f++)e[f]={id:b[f],info:d[f]};if(null==this.samplesGrid){var h="",i="VCF samples",j=["id","info"],k=[{header:"Identifier",dataIndex:"id",flex:1},{header:c,dataIndex:"info",flex:5}];this.samplesGrid=this.doGrid(k,j,i,h),this.samplesGrid.store.loadData(e)}return this.samplesGrid},VCFVariantInfoWidget.prototype.getData=function(){var a=this;this.panel.disable(),this.panel.setLoading("Getting information...");var b=this.feature.chromosome+":"+this.feature.start+":"+this.feature.reference+":"+this.feature.alternate;CellBaseManager.get({host:"http://ws-beta.bioinfo.cipf.es/cellbase/rest",version:"v2",species:Utils.getSpeciesCode(this.species.text).substring(0,3),category:"genomic",subCategory:"variant",query:b,resource:"consequence_type",success:function(b){a.dataReceived(b)}})},VCFVariantInfoWidget.prototype.dataReceived=function(a){this.data=new Object,this.data.header=this.adapter.header,this.data.samples=this.adapter.samples,this.data.feature=this.feature,this.data.consequenceType=a,this.optionClick({text:"Information",leaf:"true"}),this.panel.enable(),this.panel.setLoading(!1)},ConsequenceTypeFilterFormPanel.prototype={render:function(){console.log("Initializing "+this.id),this.div=document.createElement("div"),this.div.setAttribute("id",this.id),this.panel=this._createPanel()},draw:function(){return this.targetDiv=this.target instanceof HTMLElement?this.target:document.querySelector("#"+this.target),this.targetDiv?(this.targetDiv.appendChild(this.div),void this.panel.render(this.div)):void console.log("target not found")},clear:function(){var a=this.panel.getRootNode();a.cascadeBy(function(a){a.set("checked",!1)})},getValues:function(){var a=this.panel.getRootNode(),b=[];return a.cascadeBy(function(a){a.get("checked")&&a.isLeaf()&&b.push(a.get("name"))}),b.length>0?{ct:b}:{}},_createPanel:function(){Ext.define("Tree Model",{extend:"Ext.data.Model",fields:this.fields});var a=Ext.create("Ext.data.TreeStore",{model:"Tree Model",proxy:{type:"memory",data:this.consequenceTypes,reader:{type:"json"}}}),b=Ext.create("Ext.tree.Panel",{title:this.title,border:this.border,useArrows:!0,rootVisible:!1,store:a,multiSelect:!0,singleExpand:!0,hideHeaders:!0,height:this.height,collapsible:this.collapsible,titleCollapse:this.titleCollapse,collapsed:this.collapsed,header:this.headerConfig,columns:this.columns,listeners:{checkchange:function(a,b){a.cascadeBy(function(a){a.set("checked",b)})}}});return b},getPanel:function(){return this.panel}},FormPanel.prototype={render:function(){console.log("Initializing "+this.id),this.div=document.createElement("div"),this.div.setAttribute("id",this.id);for(var a=[],b=0;b<this.filters.length;b++){var c=this.filters[b];a.push(c.getPanel())}this.panel=this._createPanel(),this.filtersPanel.add(a),"tabs"==this.mode&&this.filtersPanel.setActiveTab(0)},draw:function(){return this.targetDiv=this.target instanceof HTMLElement?this.target:document.querySelector("#"+this.target),this.targetDiv?(this.targetDiv.appendChild(this.div),void this.panel.render(this.div)):void console.log("target not found")},clear:function(){for(var a=0;a<this.filters.length;a++){var b=this.filters[a];b.clear()}},getValues:function(){for(var a={},b=0;b<this.filters.length;b++){var c=this.filters[b];_.extend(a,c.getValues())}return a},update:function(){this.panel&&this.panel.update()},_createPanel:function(){var a=this,b=[{xtype:"button",text:this.clearButtonText,tooltip:this.clearButtonText,handler:function(){a.clear(),Utils.msg("Clear","Sucessfully")}},{xtype:"button",text:this.submitButtonText,tooltip:this.submitButtonText,formBind:!0,flex:1,handler:function(){a.trigger("submit",{values:a.getValues(),sender:a})}}];b=b.concat(this.barItems);switch(this.mode){case"tabs":this.filtersPanel=Ext.create("Ext.tab.Panel",{border:!1,plain:!0});break;case"accordion":this.filtersPanel=Ext.create("Ext.container.Container",{layout:{type:"accordion",titleCollapse:!0,multi:!0}});break;case"vbox":this.filtersPanel=Ext.create("Ext.container.Container",{margin:"20 0 0 0",layout:{type:"vbox",align:"stretch"},defaults:{margin:"20 0 0 0"}})}var c=Ext.create("Ext.form.Panel",{border:this.border,height:this.height,width:this.width,title:this.title,header:this.headerConfig,collapsible:this.collapsible,titleCollapse:this.titleCollapse,margin:"0 20 0 0",autoScroll:!0,items:[{xtype:"container",width:"100%",bodyPadding:5,defaults:{margin:"10"},layout:{type:"hbox"},items:b},this.filtersPanel]});return c}},MafFilterFormPanel.prototype={render:function(){console.log("Initializing "+this.id),this.div=document.createElement("div"),this.div.setAttribute("id",this.id),this.panel=this._createPanel()},draw:function(){return this.targetDiv=this.target instanceof HTMLElement?this.target:document.querySelector("#"+this.target),this.targetDiv?(this.targetDiv.appendChild(this.div),void this.panel.render(this.div)):void console.log("target not found")},_createPanel:function(){var a=Ext.create("Ext.form.FieldContainer",{layout:{type:"vbox",align:"stretch"},items:[{xtype:"textfield",labelAlign:"right",fieldLabel:"1000G MAF < ",name:"maf_1000g_controls",labelWidth:110},{xtype:"textfield",labelAlign:"right",fieldLabel:"EVS MAF < ",labelWidth:110,name:"maf_evs_controls"}]}),b=Ext.create("Ext.form.FieldContainer",{layout:{type:"vbox",align:"stretch"},items:[{xtype:"box",margin:"0 20 0 0",html:'<span style="color:gray">1000G Populations</span>'},{xtype:"textfield",labelAlign:"right",fieldLabel:"African MAF < ",labelWidth:110,name:"maf_1000g_afr_controls"},{xtype:"textfield",labelAlign:"right",fieldLabel:"American MAF < ",labelWidth:110,name:"maf_1000g_ame_controls"},{xtype:"textfield",labelAlign:"right",fieldLabel:"Asian MAF < ",labelWidth:110,name:"maf_1000g_asi_controls"},{xtype:"textfield",labelAlign:"right",fieldLabel:"European MAF < ",labelWidth:110,name:"maf_1000g_eur_controls"}]});return Ext.create("Ext.form.Panel",{title:this.title,border:this.border,collapsible:this.collapsible,titleCollapse:this.titleCollapse,header:this.headerConfig,bodyPadding:5,margin:"0 0 5 0",buttonAlign:"center",layout:{type:"vbox",align:"stretch"},allowBlank:!1,items:[a,b]})},getPanel:function(){return this.panel},getValues:function(){var a=this.panel.getValues();for(key in a)""==a[key]&&delete a[key];return a},clear:function(){this.panel.reset()}},PositionFilterFormPanel.prototype={render:function(){console.log("Initializing "+this.id),this.div=document.createElement("div"),this.div.setAttribute("id",this.id),this.panel=this._createPanel()},draw:function(){return this.targetDiv=this.target instanceof HTMLElement?this.target:document.querySelector("#"+this.target),this.targetDiv?(this.targetDiv.appendChild(this.div),void this.panel.render(this.div)):void console.log("target not found")},_createPanel:function(){var a=Ext.create("Ext.form.field.TextArea",{id:this.id+"snp",name:"snp",margin:"0 0 0 5",width:"100%",fieldLabel:"SNP id",labelAlign:"top",regex:/^[rs]s\d+$/}),b=Ext.create("Ext.form.field.TextArea",{id:this.id+"region",name:"region",emptyText:"1:1-1000000,2:1-1000000",margin:"0 0 0 5",width:"100%",fieldLabel:"Chromosomal Location",labelAlign:"top",value:this.testRegion}),c=Ext.create("Ext.form.field.TextArea",{id:this.id+"gene",name:"gene",margin:"0 0 0 5",width:"100%",fieldLabel:"Gene / Transcript",labelAlign:"top"});return Ext.create("Ext.form.Panel",{bodyPadding:"5",margin:"0 0 5 0",buttonAlign:"center",layout:"vbox",title:this.title,border:this.border,collapsible:this.collapsible,titleCollapse:this.titleCollapse,header:this.headerConfig,allowBlank:!1,items:[a,b,c]})},getPanel:function(){return this.panel},getValues:function(){var a=this.panel.getValues();for(key in a)""==a[key]&&delete a[key];return a},clear:function(){this.panel.reset()}},SegregationFilterFormPanel.prototype={render:function(){console.log("Initializing "+this.id),this.div=document.createElement("div"),this.div.setAttribute("id",this.id),this.panel=this._createPanel()},draw:function(){return this.targetDiv=this.target instanceof HTMLElement?this.target:document.querySelector("#"+this.target),this.targetDiv?(this.targetDiv.appendChild(this.div),void this.panel.render(this.div)):void console.log("target not found")
},_createPanel:function(){for(var a=Ext.create("Ext.form.FieldContainer",{margin:"0 0 0 100",flex:1,layout:{type:"hbox",align:"stretch"},items:[{xtype:"label",text:"0/0",flex:1},{xtype:"label",text:"0/1",flex:1},{xtype:"label",text:"1/1",flex:1}]}),b=[a],c=0;c<this.samples.length;c++){var d=this.samples[c];b.push(Ext.create("Ext.form.FieldContainer",{fieldLabel:d,labelWidth:100,flex:1,layout:{type:"hbox",align:"stretch"},items:[{xtype:"checkbox",name:"sampleGT_"+d,inputValue:"0/0,0|0",flex:1},{xtype:"checkbox",name:"sampleGT_"+d,inputValue:"0/1,1/0, 0|1,1|0",flex:1},{xtype:"checkbox",name:"sampleGT_"+d,inputValue:"1/1,1|1",flex:1}]}))}return Ext.create("Ext.form.Panel",{title:this.title,border:this.border,collapsible:this.collapsible,titleCollapse:this.titleCollapse,header:this.headerConfig,bodyPadding:"5",margin:"0 0 5 0",buttonAlign:"center",layout:{type:"vbox",align:"stretch"},allowBlank:!1,items:b})},getPanel:function(){return this.panel},getValues:function(){var a=this.panel.getValues();for(key in a)""==a[key]&&delete a[key];return a},clear:function(){this.panel.reset()}},StudyFilterFormPanel.prototype={render:function(){console.log("Initializing "+this.id),this.div=document.createElement("div"),this.div.setAttribute("id",this.id),this.panel=this._createPanel()},draw:function(){return this.targetDiv=this.target instanceof HTMLElement?this.target:document.querySelector("#"+this.target),this.targetDiv?(this.targetDiv.appendChild(this.div),void this.panel.render(this.div)):void console.log("target not found")},_createPanel:function(){var a=this,b=Ext.create("Ext.form.field.Text",{emptyText:"search",listeners:{change:function(){var b=this.getValue();if(""==b)a.studiesStore.clearFilter();else{var c=new RegExp(b,"i");a.studiesStore.filterBy(function(a){return c.test(a.get("studyName"))})}}}}),c=Ext.create("Ext.grid.Panel",{store:this.studiesStore,border:this.border,loadMask:!0,hideHeaders:!0,plugins:"bufferedrenderer",features:[{ftype:"summary"}],height:this.height-70,viewConfig:{emptyText:"No studies found",enableTextSelection:!0,markDirty:!1,listeners:{itemclick:function(){},itemcontextmenu:function(){}}},selModel:{listeners:{selectionchange:function(){}}},columns:[{text:"Active",xtype:"checkcolumn",dataIndex:"uiactive",width:50},{text:"Name",dataIndex:"studyName",flex:10}]}),d=Ext.create("Ext.form.Panel",{bodyPadding:"5",margin:"0 0 5 0",buttonAlign:"center",border:!1,title:this.title,height:this.height,layout:{type:"vbox",align:"stretch"},items:[b,c]});return d},getPanel:function(){return this.panel},getValues:function(){for(var a=[],b=this.studiesStore.query().items,c=0;c<b.length;c++){var d=b[c],e=d.get("uiactive");e&&a.push(d.get("studyId"))}var f={};return a.length>0&&(f.studies=a),f},clear:function(){this.panel.reset()}},VariantBrowserGrid.prototype={render:function(){console.log("Initializing "+this.id),this.div=document.createElement("div"),this.div.setAttribute("id",this.id),this.panel=this._createPanel()},draw:function(){return this.targetDiv=this.target instanceof HTMLElement?this.target:document.querySelector("#"+this.target),this.targetDiv?(this.targetDiv.appendChild(this.div),void this.panel.render(this.div)):void console.log("target not found")},_createPanel:function(){var a=this;this.model=Ext.define("Variant",{extend:"Ext.data.Model",idProperty:"iid",fields:this.attributes}),this.store=Ext.create("Ext.data.Store",{pageSize:this.pageSize,model:this.model,remoteSort:!0,proxy:{type:"memory",enablePaging:!0},listeners:{beforeload:function(){a.trigger("variant:clear",{sender:a})}}});for(var b=0;b<this.samples.length;b++){var c=this.samples[b];this._addSampleColumn(c)}this.paging=Ext.create("Ext.PagingToolbar",{store:a.store,id:a.id+"_pagingToolbar",pageSize:a.pageSize,displayInfo:!0,displayMsg:"Variants {0} - {1} of {2}",emptyMsg:"No variants to display"});var d=Ext.create("Ext.grid.Panel",{title:this.title,store:this.store,border:this.border,header:this.headerConfig,loadMask:!0,columns:this.columns,plugins:"bufferedrenderer",animCollapse:!1,height:this.height,features:[{ftype:"summary"}],viewConfig:{emptyText:"No records to display",enableTextSelection:!0},tbar:this.paging});return d.getSelectionModel().on("selectionchange",function(b,c){if(c.length){var d=c[0].data;a.trigger("variant:change",{sender:a,args:d})}}),this.grid=d,d},load:function(a){var b=this;this.store.destroy(),"undefined"!=typeof this.dataParser?this.dataParser(a):this._parserFunction(a),this.store=Ext.create("Ext.data.Store",{pageSize:this.pageSize,model:this.model,data:a,remoteSort:!0,proxy:{type:"memory",enablePaging:!0},listeners:{beforeload:function(){b.trigger("variant:clear",{sender:b})},load:function(){b.setLoading(!1)}}}),this.grid.reconfigure(this.store,this.columnsGrid),this.paging.bindStore(this.store),this.paging.doRefresh()},loadUrl:function(a,b){var c=this;this.store.destroy(),console.log("filter"),console.log(b),this.store=Ext.create("Ext.data.Store",{pageSize:this.pageSize,model:this.model,remoteSort:!0,proxy:{url:a,type:"ajax",startParam:this.startParam,reader:{root:this.responseRoot,totalProperty:this.responseTotal,transform:function(a){var b=[];return"undefined"!=typeof c.responseParser&&(b=c.responseParser(a)),"undefined"!=typeof c.dataParser?c.dataParser(b):c._parserFunction(b),a}},extraParams:b,actionMethods:{create:"GET",read:"GET",update:"GET",destroy:"GET"}},listeners:{load:function(a,b){console.log(b),"undefined"!=typeof this.dataParser?c.dataParser(b):c._parserFunction(b),console.log(b),c.setLoading(!1)},beforeload:function(){c.trigger("variant:clear",{sender:c})}}}),this.grid.reconfigure(this.store,this.columnsGrid),this.paging.bindStore(this.store),this.store.load()},_parserFunction:function(a){for(var b=0;b<a.length;b++){var c=a[b];c.hgvs&&c.hgvs.genomic&&c.hgvs.genomic.length>0&&(c.hgvs_name=c.hgvs.genomic[0])}},setLoading:function(a){this.panel.setLoading(a)},_addSampleColumn:function(a){for(var b=this,c=0;c<b.attributes.length;c++)if(b.attributes[c].name==a)return!1;b.attributes.push({name:a,type:"string"});for(var c=0;c<b.columns.length;c++){var d=b.columns[c];"Samples"==d.text&&d.columns.push({text:a,dataIndex:a,flex:1,sortable:!1})}this.store.setFields(this.attributes)}},VariantEffectGrid.prototype={render:function(){this.div=document.createElement("div"),this.div.setAttribute("id",this.id),this.chartDiv=document.createElement("div"),$(this.chartDiv).css({height:"200px"}),this.panel=this._createPanel()},draw:function(){return this.targetDiv=this.target instanceof HTMLElement?this.target:document.querySelector("#"+this.target),this.targetDiv?(this.targetDiv.appendChild(this.div),void this.panel.render(this.div)):void console.log("target not found")},clear:function(){this.store.removeAll(),this._updateChart([],[])},load:function(a){var b=this,c=b._prepareEffectData(a);b.grid.setLoading(!0),b.clear(),this.store.loadData(c);var d=[],e=[];this._updateChart(d,e),this.trigger("load:finish",{sender:b}),this.grid.setLoading(!1)},_updateChart:function(a,b){var c=$(this.chartDiv).highcharts();c&&(c.xAxis[0].setCategories(a,!1),c.series[0].setData(b,!1),c.redraw())},_createPanel:function(){var a={storeId:"EffectStore",groupField:"featureId",pageSize:10,fields:[{name:"position",type:"string"},{name:"allele",type:"string"},{name:"cDnaPosition",type:"int"},{name:"canonical",type:"boolean"},{name:"cdsPosition",type:"int"},{name:"consequenceTypes",type:"string"},{name:"featureBiotype",type:"string"},{name:"featureId",type:"string"},{name:"featureStrand",type:"string"},{name:"featureType",type:"string"},{name:"geneId",type:"string"},{name:"geneName",type:"string"},{name:"geneNameSource",type:"string"},{name:"proteinPosition",type:"int"},{name:"variantToTranscriptDistance",type:"int"},{name:"polyphenScore",type:"number"},{name:"siftScore",type:"number"}],data:[],autoLoad:!1,proxy:{type:"memory"}};_.extend(a,this.storeConfig),this.store=Ext.create("Ext.data.Store",a);var b={title:"Effects",store:this.store,loadMask:!0,border:!0,height:200,header:this.headerConfig,viewConfig:{emptyText:"No records to display",enableTextSelection:!0},plugins:["bufferedrenderer"],columns:[{text:"Location",dataIndex:"position",flex:1},{text:"Conseq. Types",dataIndex:"consequenceTypes",flex:1},{text:"Feature",columns:[{text:"Id",dataIndex:"featureId",flex:1},{text:"Strand",dataIndex:"featureStrand",flex:1},{text:"Biotype",dataIndex:"featureBiotype",flex:1},{text:"Type",dataIndex:"featureType",flex:1}]},{text:"Genes",columns:[{text:"Id",dataIndex:"geneId",flex:1},{text:"Name",dataIndex:"geneName",flex:1},{text:"Source",dataIndex:"geneNameSource",flex:1}]},{text:"Protein Position",dataIndex:"proteinPosition",flex:1},{text:"Distance to Transcript",dataIndex:"variantToTranscriptDistance",flex:1},{text:"Scores",columns:[{text:"Polyphen",dataIndex:"polyphenScore",flex:1},{text:"SIFT",dataIndex:"siftScore",flex:1}]}],viewConfig:{emptyText:"No records to display"}};_.extend(b,this.gridConfig),this.grid=Ext.create("Ext.grid.Panel",b),$(this.chartDiv).highcharts({chart:{type:"bar"},title:{text:null},xAxis:{title:{text:"Populations",align:"high"}},yAxis:{min:0,max:1,title:{text:"Minimum Allele Frequency",align:"high"},labels:{overflow:"justify"}},plotOptions:{bar:{dataLabels:{enabled:!0}}},legend:{layout:"vertical",align:"right",verticalAlign:"top",x:-40,y:100,floating:!0,borderWidth:1,backgroundColor:Highcharts.theme&&Highcharts.theme.legendBackgroundColor||"#FFFFFF",shadow:!0},credits:{enabled:!1},series:[{name:"MAF"}]});var c=Ext.create("Ext.container.Container",{layout:{type:"vbox",align:"stretch"},overflowY:!0,padding:10,items:[this.grid,{xtype:"panel",margin:"10 0 0 0",border:!1,title:"Population Frequencies",header:this.headerConfig,contentEl:this.chartDiv}],height:this.height});return c},_prepareEffectData:function(a){var b=[],c=a.chromosome,d=a.start,e=a.referenceAllele;console.log(a);for(var f in a.effects)for(var g=0,h=a.effects[f].length;h>g;g++){var i=a.effects[f][g];i.position=c+":"+d+" "+e+" > "+f,i.consequenceTypes=i.consequenceTypes.join(","),i.polyphenScore=a.proteinSubstitutionScores.polyphenScore,i.siftScore=a.proteinSubstitutionScores.siftScore,b.push(i)}return b},_prepareFrequencyData:function(){var a=[];return a.push({name:"maf1000G",maf:Math.random()}),a.push({name:"maf1000GAfrican",maf:Math.random()}),a.push({name:"maf1000GAmerican",maf:Math.random()}),a.push({name:"maf1000GAsian",maf:Math.random()}),a.push({name:"maf1000GEuropean",maf:Math.random()}),a.push({name:"mafNhlbiEspAfricanAmerican",maf:Math.random()}),a.push({name:"mafNhlbiEspEuropeanAmerican",maf:Math.random()}),a}},VariantFileBrowserPanel.prototype={render:function(){this.div=document.createElement("div"),this.div.setAttribute("id",this.id),this.panel=this._createPanel()},draw:function(){return this.targetDiv=this.target instanceof HTMLElement?this.target:document.querySelector("#"+this.target),this.targetDiv?(this.targetDiv.appendChild(this.div),void this.panel.render(this.div)):void console.log("target not found")},load:function(a){this.panel.removeAll(!0);for(var b=[],c=0;c<a.length;c++){var d=a[c];b.push(this._createStudyPanel(d))}this.panel.add(b)},_createPanel:function(){var a=Ext.create("Ext.container.Container",{layout:{type:"vbox",align:"stretch"}});return this.studies.length>0&&this.load(this.studies),a},_createStudyPanel:function(a){for(var b=[],c=0;c<a.files.length;c++){var d=a.files[c];b.push(this._createFilePanel(d))}var e=Ext.create("Ext.container.Container",{layout:{type:"vbox",align:"stretch"},overflowY:!0,padding:10,items:b}),f=Ext.create("Ext.container.Container",{items:[{xtype:"box",cls:"eva-header-3",overCls:"eva-pointer eva-underline",html:a.studyName,listeners:{afterrender:function(){this.getEl().on("click",function(){e.isHidden()?e.show():e.hide()})}}},e]});return f},_createFilePanel:function(a){var b=Ext.create("Ext.container.Container",{layout:"vbox",items:[{xtype:"box",cls:"eva-header-5",margin:"5 5 5 10",html:a.fileName},{xtype:"container",layout:"hbox",items:[{xtype:"container",data:a.stats,tpl:new Ext.XTemplate('<table class="eva-stats-table"><tr><td class="header">Variants count:</td><td>{variantsCount}</td></tr>','<tr><td class="header">Samples count:</td><td>{samplesCount}</td></tr>','<tr><td class="header">SNPs count:</td><td>{snpsCount}</td></tr>','<tr><td class="header">Indels count:</td><td>{indelsCount}</td></tr>','<tr><td class="header">Pass count:</td><td>{passCount}</td></tr>','<tr><td class="header">Ti/Tv Ratio:</td><td>{[this.titv(values)]}</td></tr>','<tr><td class="header">Mean quality:</td><td>{meanQuality}</td></tr>',"</table>",{titv:function(a){var b=a.transitionsCount/a.transversionsCount;return b.toFixed(2)}}),margin:"5 5 5 10"}]}]});return b},setLoading:function(a){this.panel.setLoading(a)}},VariantGenotypeGrid.prototype={render:function(){this.div=document.createElement("div"),this.div.setAttribute("id",this.id),this.panel=this._createPanel()},draw:function(){return this.targetDiv=this.target instanceof HTMLElement?this.target:document.querySelector("#"+this.target),this.targetDiv?(this.targetDiv.appendChild(this.div),void this.panel.render(this.div)):void console.log("target not found")},clear:function(){this.studiesContainer.removeAll(!0)},load:function(a){this.clear();var b=[];for(var c in a){var d=a[c];Object.keys(d.samplesData).length>0&&b.push(this._createStudyPanel(d))}this.studiesContainer.add(b)},_createPanel:function(){this.studiesContainer=Ext.create("Ext.container.Container",{layout:{type:"accordion",titleCollapse:!0,multi:!0}});var a=Ext.create("Ext.container.Container",{layout:{type:"vbox",align:"stretch"},overflowY:!0,padding:10,items:[{xtype:"box",cls:"ocb-header-4",html:"Studies",margin:"5 0 10 10"},this.studiesContainer],height:this.height});return a},_createStudyPanel:function(a){var b=a.stats?a.stats:{},c=a.samplesData?a.samplesData:{},d=[];for(var e in c){var f=c[e];d.push({sample:e,genotype:f.GT})}console.log(d);var g,h=Ext.create("Ext.data.Store",{pageSize:10,fields:[{name:"sample",type:"string"},{name:"genotype",type:"string"},{name:"sex",type:"string"},{name:"phenotype",type:"string"}],data:d,proxy:{type:"memory"}}),i=Ext.create("Ext.grid.Panel",{store:h,loadMask:!0,width:400,height:300,margin:20,viewConfig:{emptyText:"No records to display",enableTextSelection:!0},plugins:["bufferedrenderer"],columns:[{text:"Sample",dataIndex:"sample",flex:1},{text:"Genotype",dataIndex:"genotype",flex:1},{text:"Sex",dataIndex:"sex",flex:1},{text:"Phenotype",dataIndex:"phenotype",flex:1}]}),j=this._getGenotypeCount(b.genotypesCount);if(j.length>0){var h=Ext.create("Ext.data.Store",{fields:["genotype","count"],data:j});g=Ext.create("Ext.chart.Chart",{xtype:"chart",width:200,height:130,store:h,animate:!0,shadow:!0,legend:{position:"right"},theme:"Base:gradients",series:[{type:"pie",field:"count",showInLegend:!0,tips:{trackMouse:!0,renderer:function(a){var b=a.get("genotype");this.setTitle(b+": "+a.get("count"))}},highlight:{segment:{margin:20}},label:{field:"genotype",display:"rotate",contrast:!0,font:"10px Arial"}}]})}var k=Ext.create("Ext.panel.Panel",{title:a.studyId,border:!0,layout:{type:"hbox",align:"stretch"},items:[i,g]});return k},_getGenotypeCount:function(a){var b=[];for(var c in a)b.push({genotype:c,count:a[c]});return b}},VariantStatsPanel.prototype={render:function(){this.div=document.createElement("div"),this.div.setAttribute("id",this.id),this.panel=this._createPanel()},draw:function(){return this.targetDiv=this.target instanceof HTMLElement?this.target:document.querySelector("#"+this.target),this.targetDiv?(this.targetDiv.appendChild(this.div),void this.panel.render(this.div)):void console.log("target not found")},clear:function(){this.studiesContainer.removeAll(!0)},load:function(a){this.clear();var b=[];for(var c in a){var d=a[c],e=this._createStudyPanel(d);b.push(e)}this.studiesContainer.add(b)},_createPanel:function(){this.studiesContainer=Ext.create("Ext.container.Container",{layout:{type:"accordion",titleCollapse:!0,multi:!0}});var a=Ext.create("Ext.container.Container",{layout:{type:"vbox",align:"stretch"},overflowY:!0,padding:10,items:[{xtype:"box",cls:"ocb-header-4",html:"Studies",margin:"5 0 10 10"},this.studiesContainer],height:this.height});return a},_createStudyPanel:function(a){var b=a.stats?a.stats:{},c=a.attributes?a.attributes:{},d=Ext.create("Ext.panel.Panel",{title:a.studyId,border:!1,layout:"vbox",items:[{xtype:"container",data:c,tpl:new Ext.XTemplate('<table class="ocb-attributes-table"><tr>','<tpl foreach=".">','<td class="header">{$}</td>',"</tpl></tr><tr>",'<tpl foreach=".">',"<td>{.}</td>","</tpl>","</tr></table>"),margin:"10 5 5 10"},{xtype:"box",cls:"ocb-header-5",margin:"5 5 5 10",html:"Stats"},{xtype:"container",layout:"hbox",items:[{xtype:"container",data:b,tpl:new Ext.XTemplate('<table class="ocb-stats-table"><tr><td class="header">Minor Allele Frequency:</td><td>{maf} ({mafAllele})</td></tr>','<tr><td class="header">Minor Genotype Frequency:</td><td>{mgf} ({mgfAllele})</td></tr>','<tr><td class="header">Mendelian Errors:</td><td>{mendelianErrors}</td></tr>','<tr><td class="header">Missing Alleles:</td><td>{missingAlleles}</td></tr>','<tr><td class="header">Missing Genotypes:</td><td>{missingGenotypes}</td></tr>',"</table>"),margin:"5 5 5 10"}]}]}),e=this._getGenotypeCount(b.genotypesCount);if(e.length>0){var f=Ext.create("Ext.data.Store",{fields:["genotype","count"],data:e}),g=Ext.create("Ext.chart.Chart",{xtype:"chart",width:200,height:130,store:f,animate:!0,shadow:!0,legend:{position:"right"},theme:"Base:gradients",series:[{type:"pie",field:"count",showInLegend:!0,tips:{trackMouse:!0,renderer:function(a){var b=a.get("genotype");this.setTitle(b+": "+a.get("count"))}},highlight:{segment:{margin:20}},label:{field:"genotype",display:"rotate",contrast:!0,font:"10px Arial"}}]});d.down().nextSibling().nextSibling().add(g)}return d},_getGenotypeCount:function(a){var b=[];for(var c in a)b.push({genotype:c,count:a[c]});return b}},VariantStudyBrowserPanel.prototype={render:function(){this.div=document.createElement("div"),this.div.setAttribute("id",this.id),this.panel=this._createPanel()},draw:function(){return this.targetDiv=this.target instanceof HTMLElement?this.target:document.querySelector("#"+this.target),this.targetDiv?(this.targetDiv.appendChild(this.div),void this.panel.render(this.div)):void console.log("target not found")},load:function(){},_createPanel:function(){var a=this,b=Ext.create("Ext.data.Store",{autoLoad:!0,fields:["species","common","scientific","assembly","sciAsembly"],data:this.speciesList}),c=Ext.create("Ext.form.field.ComboBox",{fieldLabel:"Choose Species",labelAlign:"top",name:"species",displayField:"scientific",valueField:"species",editable:!1,allowBlank:!1,store:b,listeners:{change:function(){this.getValue()}}}),d=Ext.create("Ext.form.field.Text",{fieldLabel:"Name Search",labelAlign:"top",emptyText:"search",listeners:{change:function(){var b=this.getValue();if(""==b)a.studiesStore.clearFilter();else{var c=new RegExp(b,"i");a.studiesStore.filterBy(function(a){return c.test(a.get("studyName"))})}}}});this.grid=Ext.create("Ext.grid.Panel",{title:"Studies",store:this.studiesStore,header:this.headerConfig,loadMask:!0,plugins:"bufferedrenderer",height:500,features:[{ftype:"summary"}],viewConfig:{emptyText:"No studies found",enableTextSelection:!0,markDirty:!1,listeners:{itemclick:function(){},itemcontextmenu:function(){}}},selModel:{listeners:{selectionchange:function(b,c){if(c.length){var d=c[0].data;a.trigger("variant:change",{sender:a,args:d})}}}},columns:[{text:"Active",xtype:"checkcolumn",dataIndex:"uiactive",flex:1},{text:"Name",dataIndex:"studyName",flex:10},{text:"ID",dataIndex:"studyId",flex:3}]}),this.leftPanel=Ext.create("Ext.container.Container",{flex:1,layout:{type:"vbox",align:"stretch"},defaults:{margin:10},items:[c,d]}),this.rightPanel=Ext.create("Ext.container.Container",{flex:4,layout:{type:"vbox",align:"stretch"},defaults:{margin:10},items:[this.grid]});var e=Ext.create("Ext.panel.Panel",{title:this.title,border:this.border,header:this.headerConfig,layout:{type:"hbox",align:"stretch"},defaults:{margin:10},items:[this.leftPanel,this.rightPanel]});return e},setLoading:function(a){this.panel.setLoading(a)},update:function(){this.panel&&this.panel.update()}},VariantWidget.prototype={render:function(){var a=this;this.div=document.createElement("div"),this.div.setAttribute("id",this.id),this.variantBrowserGridDiv=document.createElement("div"),this.variantBrowserGridDiv.setAttribute("class","ocb-variant-widget-grid"),this.div.appendChild(this.variantBrowserGridDiv),this.variantBrowserGrid=this._createVariantBrowserGrid(this.variantBrowserGridDiv),this.tabPanelDiv=document.createElement("div"),this.tabPanelDiv.setAttribute("class","ocb-variant-tab-panel"),this.div.appendChild(this.tabPanelDiv),this.toolTabPanel=Ext.create("Ext.tab.Panel",{title:this.toolPanelConfig.title,border:this.toolPanelConfig.border,layout:"fit",margin:"10 0 0 0",plain:!0,animCollapse:!1,header:this.headerConfig,collapseDirection:Ext.Component.DIRECTION_BOTTOM,titleCollapse:!0,overlapHeader:!0,height:540,defaults:{hideMode:"offsets",autoShow:!0},listeners:{tabchange:function(b,c){a.selectedToolDiv=c.contentEl,a.lastVariant&&a.trigger("variant:change",{variant:a.lastVariant,sender:a})}}});var b=[];this.defaultToolConfig.stats&&(this.variantStatsPanelDiv=document.createElement("div"),this.variantStatsPanelDiv.setAttribute("class","ocb-variant-stats-panel"),this.variantStatsPanel=this._createVariantStatsPanel(this.variantStatsPanelDiv),b.push({title:"File and Stats",contentEl:this.variantStatsPanelDiv})),this.defaultToolConfig.effect&&(this.variantEffectGridDiv=document.createElement("div"),this.variantEffectGridDiv.setAttribute("class","ocb-variant-effect-grid"),this.variantEffectGrid=this._createVariantEffectGrid(this.variantEffectGridDiv),b.push({title:"Effect and Annotation",contentEl:this.variantEffectGridDiv})),this.defaultToolConfig.genotype&&(this.variantGenotypeGridDiv=document.createElement("div"),this.variantGenotypeGridDiv.setAttribute("class","ocb-variant-genotype-grid"),this.variantGenotypeGrid=this._createVariantGenotypeGrid(this.variantGenotypeGridDiv),b.push({title:"Genotype",contentEl:this.variantGenotypeGridDiv})),this.defaultToolConfig.genomeViewer&&(this.genomeViewerDiv=document.createElement("div"),this.genomeViewerDiv.setAttribute("class","ocb-gv"),this.genomeViewer=this._createGenomeViewer(this.genomeViewerDiv),b.push({title:"Genomic Context",contentEl:this.genomeViewerDiv,autoScroll:!0}));for(var c=0;c<this.tools.length;c++){var d=this.tools[c],e=document.createElement("div");d.tool.target=e,b.push({title:d.title,contentEl:e})}this.toolTabPanel.add(b),this.rendered=!0},draw:function(){if(this.targetDiv=this.target instanceof HTMLElement?this.target:document.querySelector("#"+this.target),!this.targetDiv)return void console.log("target not found");this.targetDiv.appendChild(this.div),this.variantBrowserGrid.draw(),this.toolTabPanel.render(this.tabPanelDiv);for(var a=0;a<this.toolTabPanel.items.items.length;a++)this.toolTabPanel.setActiveTab(a);this.defaultToolConfig.effect&&this.variantEffectGrid.draw(),this.defaultToolConfig.genotype&&this.variantGenotypeGrid.draw(),this.defaultToolConfig.genomeViewer&&this.genomeViewer.draw(),this.defaultToolConfig.stats&&this.variantStatsPanel.draw();for(var a=0;a<this.tools.length;a++){var b=this.tools[a];b.tool.draw()}this.toolTabPanel.setActiveTab(0)},_createVariantBrowserGrid:function(a){var b=this,c=new VariantBrowserGrid({title:this.browserGridConfig.title,target:a,data:this.data,border:this.browserGridConfig.border,dataParser:this.dataParser,responseRoot:this.responseRoot,responseTotal:this.responseTotal,responseParser:this.responseParser,startParam:this.startParam,attributes:this.attributes,columns:this.columns,samples:this.samples,headerConfig:this.headerConfig,handlers:{"variant:change":function(a){b.lastVariant=a.args,b.trigger("variant:change",{variant:b.lastVariant,sender:b})},"variant:clear":function(){b.trigger("variant:clear",{sender:b})}}});return c},_createVariantEffectGrid:function(a){var b=this,c=new VariantEffectGrid({target:a,headerConfig:this.defaultToolConfig.headerConfig,gridConfig:{flex:1,layout:{align:"stretch"}},handlers:{"load:finish":function(){}}});return this.variantBrowserGrid.on("variant:clear",function(){c.clear(!0)}),this.on("variant:change",function(d){if(a===b.selectedToolDiv){var e=(d.variant,b._loadExampleData());c.load(e)}}),c},_createVariantStatsPanel:function(a){var b=this,c=new VariantStatsPanel({target:a,headerConfig:this.defaultToolConfig.headerConfig,handlers:{"load:finish":function(){}}});return this.variantBrowserGrid.on("variant:clear",function(){c.clear(!0)}),this.on("variant:change",function(d){if(a===b.selectedToolDiv){var e=d.variant;e.files&&c.load(e.files)}}),c},_createVariantGenotypeGrid:function(a){var b=this,c=new VariantGenotypeGrid({target:a,headerConfig:this.defaultToolConfig.headerConfig,gridConfig:{flex:1,layout:{align:"stretch"}},handlers:{"load:finish":function(){}}});return this.variantBrowserGrid.on("variant:clear",function(){c.clear(!0)}),b.on("variant:change",function(d){if(a===b.selectedToolDiv){var e=d.variant;e.files&&c.load(e.files)}}),c},_createGenomeViewer:function(a){var b=this,c=new Region({chromosome:"13",start:32889611,end:32889611}),d=new GenomeViewer({sidePanel:!1,target:a,border:!1,resizable:!0,width:this.width-20,region:c,trackListTitle:"",drawNavigationBar:!0,drawKaryotypePanel:!1,drawChromosomePanel:!1,drawRegionOverviewPanel:!0,overviewZoomMultiplier:50,navigationBarConfig:{componentsConfig:{restoreDefaultRegionButton:!1,regionHistoryButton:!1,speciesButton:!1,chromosomesButton:!1,karyotypeButton:!1,chromosomeButton:!1,regionButton:!1,windowSizeControl:!1}}}),e=new FeatureRenderer(FEATURE_TYPES.gene);e.on({"feature:click":function(a){console.log(a)}});var f=new FeatureTrack({minHistogramRegionSize:2e7,maxLabelRegionSize:1e7,height:100,renderer:e,dataAdapter:new CellBaseAdapter({category:"genomic",subCategory:"region",resource:"gene",params:{exclude:"transcripts,chunkIds"},species:d.species,cacheConfig:{chunkSize:1e5}})}),g=new SequenceTrack({height:30,visibleRegionSize:200,renderer:new SequenceRenderer,dataAdapter:new SequenceAdapter({category:"genomic",subCategory:"region",resource:"sequence",species:d.species})}),h=new GeneTrack({title:"Gene",minHistogramRegionSize:2e7,maxLabelRegionSize:1e7,minTranscriptRegionSize:2e5,height:140,renderer:new GeneRenderer,dataAdapter:new CellBaseAdapter({category:"genomic",subCategory:"region",resource:"gene",species:d.species,params:{exclude:"transcripts.tfbs,transcripts.xrefs,transcripts.exons.sequence"},cacheConfig:{chunkSize:1e5}})}),i=new FeatureTrack({title:"SNP",featureType:"SNP",minHistogramRegionSize:1e4,maxLabelRegionSize:3e3,height:100,renderer:new FeatureRenderer(FEATURE_TYPES.snp),dataAdapter:new CellBaseAdapter({category:"genomic",subCategory:"region",resource:"snp",params:{exclude:"transcriptVariations,xrefs,samples"},species:d.species,cacheConfig:{chunkSize:1e4}})});return d.addOverviewTrack(f),d.addTrack([g,h,i]),this.on("variant:change",function(c){if(a===b.selectedToolDiv){var e=c.variant,f=new Region(e);_.isUndefined(d)||d.setRegion(f)}}),d},retrieveData:function(a,b){this.variantBrowserGrid.loadUrl(a,b)},setLoading:function(a){this.variantBrowserGrid.setLoading(a)},_loadExampleData:function(){var a={chromosome:"1",start:10001,end:10001,referenceAllele:"T",genes:[],effects:{G:[{allele:"G",geneId:"ENSG00000223972",geneName:"DDX11L1",geneNameSource:"HGNC",featureId:"ENST00000456328",featureType:"Transcript",featureBiotype:"processed_transcript",featureStrand:"1",cDnaPosition:-1,cdsPosition:-1,proteinPosition:-1,consequenceTypes:[1631],canonical:!0,variantToTranscriptDistance:1868},{allele:"G",geneId:"ENSG00000227232",geneName:"WASH7P",geneNameSource:"HGNC",featureId:"ENST00000488147",featureType:"Transcript",featureBiotype:"unprocessed_pseudogene",featureStrand:"-1",cDnaPosition:-1,cdsPosition:-1,proteinPosition:-1,consequenceTypes:[1632],canonical:!1,variantToTranscriptDistance:4403},{allele:"G",geneId:"ENSG00000227232",geneName:"WASH7P",geneNameSource:"HGNC",featureId:"ENST00000541675",featureType:"Transcript",featureBiotype:"unprocessed_pseudogene",featureStrand:"-1",cDnaPosition:-1,cdsPosition:-1,proteinPosition:-1,consequenceTypes:[1632],canonical:!1,variantToTranscriptDistance:4362},{allele:"G",geneId:"ENSG00000223972",geneName:"DDX11L1",geneNameSource:"HGNC",featureId:"ENST00000450305",featureType:"Transcript",featureBiotype:"transcribed_unprocessed_pseudogene",featureStrand:"1",cDnaPosition:-1,cdsPosition:-1,proteinPosition:-1,consequenceTypes:[1631],canonical:!1,variantToTranscriptDistance:2009},{allele:"G",geneId:"ENSG00000223972",geneName:"DDX11L1",geneNameSource:"HGNC",featureId:"ENST00000515242",featureType:"Transcript",featureBiotype:"transcribed_unprocessed_pseudogene",featureStrand:"1",cDnaPosition:-1,cdsPosition:-1,proteinPosition:-1,consequenceTypes:[1631],canonical:!1,variantToTranscriptDistance:1871},{allele:"G",geneId:"ENSG00000227232",geneName:"WASH7P",geneNameSource:"HGNC",featureId:"ENST00000538476",featureType:"Transcript",featureBiotype:"unprocessed_pseudogene",featureStrand:"-1",cDnaPosition:-1,cdsPosition:-1,proteinPosition:-1,consequenceTypes:[1632],canonical:!1,variantToTranscriptDistance:4410},{allele:"G",geneId:"ENSG00000223972",geneName:"DDX11L1",geneNameSource:"HGNC",featureId:"ENST00000518655",featureType:"Transcript",featureBiotype:"transcribed_unprocessed_pseudogene",featureStrand:"1",cDnaPosition:-1,cdsPosition:-1,proteinPosition:-1,consequenceTypes:[1631],canonical:!1,variantToTranscriptDistance:1873},{allele:"G",geneId:"ENSG00000227232",geneName:"WASH7P",geneNameSource:"HGNC",featureId:"ENST00000438504",featureType:"Transcript",featureBiotype:"unprocessed_pseudogene",featureStrand:"-1",cDnaPosition:-1,cdsPosition:-1,proteinPosition:-1,consequenceTypes:[1632],canonical:!0,variantToTranscriptDistance:4362},{allele:"G",geneId:"ENSG00000227232",geneName:"WASH7P",geneNameSource:"HGNC",featureId:"ENST00000423562",featureType:"Transcript",featureBiotype:"unprocessed_pseudogene",featureStrand:"-1",cDnaPosition:-1,cdsPosition:-1,proteinPosition:-1,consequenceTypes:[1632],canonical:!1,variantToTranscriptDistance:4362},{allele:"G",featureId:"ENSR00000668495",featureType:"RegulatoryFeature",cDnaPosition:-1,cdsPosition:-1,proteinPosition:-1,consequenceTypes:[1566],canonical:!1,variantToTranscriptDistance:-1}],A:[{allele:"A",geneId:"ENSG00000223972",geneName:"DDX11L1",geneNameSource:"HGNC",featureId:"ENST00000456328",featureType:"Transcript",featureBiotype:"processed_transcript",featureStrand:"1",cDnaPosition:-1,cdsPosition:-1,proteinPosition:-1,consequenceTypes:[1631],canonical:!0,variantToTranscriptDistance:1868},{allele:"A",geneId:"ENSG00000227232",geneName:"WASH7P",geneNameSource:"HGNC",featureId:"ENST00000488147",featureType:"Transcript",featureBiotype:"unprocessed_pseudogene",featureStrand:"-1",cDnaPosition:-1,cdsPosition:-1,proteinPosition:-1,consequenceTypes:[1632],canonical:!1,variantToTranscriptDistance:4403},{allele:"A",geneId:"ENSG00000227232",geneName:"WASH7P",geneNameSource:"HGNC",featureId:"ENST00000541675",featureType:"Transcript",featureBiotype:"unprocessed_pseudogene",featureStrand:"-1",cDnaPosition:-1,cdsPosition:-1,proteinPosition:-1,consequenceTypes:[1632],canonical:!1,variantToTranscriptDistance:4362},{allele:"A",geneId:"ENSG00000223972",geneName:"DDX11L1",geneNameSource:"HGNC",featureId:"ENST00000450305",featureType:"Transcript",featureBiotype:"transcribed_unprocessed_pseudogene",featureStrand:"1",cDnaPosition:-1,cdsPosition:-1,proteinPosition:-1,consequenceTypes:[1631],canonical:!1,variantToTranscriptDistance:2009},{allele:"A",geneId:"ENSG00000223972",geneName:"DDX11L1",geneNameSource:"HGNC",featureId:"ENST00000515242",featureType:"Transcript",featureBiotype:"transcribed_unprocessed_pseudogene",featureStrand:"1",cDnaPosition:-1,cdsPosition:-1,proteinPosition:-1,consequenceTypes:[1631],canonical:!1,variantToTranscriptDistance:1871},{allele:"A",geneId:"ENSG00000227232",geneName:"WASH7P",geneNameSource:"HGNC",featureId:"ENST00000538476",featureType:"Transcript",featureBiotype:"unprocessed_pseudogene",featureStrand:"-1",cDnaPosition:-1,cdsPosition:-1,proteinPosition:-1,consequenceTypes:[1632],canonical:!1,variantToTranscriptDistance:4410},{allele:"A",geneId:"ENSG00000223972",geneName:"DDX11L1",geneNameSource:"HGNC",featureId:"ENST00000518655",featureType:"Transcript",featureBiotype:"transcribed_unprocessed_pseudogene",featureStrand:"1",cDnaPosition:-1,cdsPosition:-1,proteinPosition:-1,consequenceTypes:[1631],canonical:!1,variantToTranscriptDistance:1873},{allele:"A",geneId:"ENSG00000227232",geneName:"WASH7P",geneNameSource:"HGNC",featureId:"ENST00000438504",featureType:"Transcript",featureBiotype:"unprocessed_pseudogene",featureStrand:"-1",cDnaPosition:-1,cdsPosition:-1,proteinPosition:-1,consequenceTypes:[1632],canonical:!0,variantToTranscriptDistance:4362},{allele:"A",geneId:"ENSG00000227232",geneName:"WASH7P",geneNameSource:"HGNC",featureId:"ENST00000423562",featureType:"Transcript",featureBiotype:"unprocessed_pseudogene",featureStrand:"-1",cDnaPosition:-1,cdsPosition:-1,proteinPosition:-1,consequenceTypes:[1632],canonical:!1,variantToTranscriptDistance:4362},{allele:"A",featureId:"ENSR00000668495",featureType:"RegulatoryFeature",cDnaPosition:-1,cdsPosition:-1,proteinPosition:-1,consequenceTypes:[1566],canonical:!1,variantToTranscriptDistance:-1}],C:[{allele:"C",geneId:"ENSG00000223972",geneName:"DDX11L1",geneNameSource:"HGNC",featureId:"ENST00000456328",featureType:"Transcript",featureBiotype:"processed_transcript",featureStrand:"1",cDnaPosition:-1,cdsPosition:-1,proteinPosition:-1,consequenceTypes:[1631],canonical:!0,variantToTranscriptDistance:1868},{allele:"C",geneId:"ENSG00000227232",geneName:"WASH7P",geneNameSource:"HGNC",featureId:"ENST00000488147",featureType:"Transcript",featureBiotype:"unprocessed_pseudogene",featureStrand:"-1",cDnaPosition:-1,cdsPosition:-1,proteinPosition:-1,consequenceTypes:[1632],canonical:!1,variantToTranscriptDistance:4403},{allele:"C",geneId:"ENSG00000227232",geneName:"WASH7P",geneNameSource:"HGNC",featureId:"ENST00000541675",featureType:"Transcript",featureBiotype:"unprocessed_pseudogene",featureStrand:"-1",cDnaPosition:-1,cdsPosition:-1,proteinPosition:-1,consequenceTypes:[1632],canonical:!1,variantToTranscriptDistance:4362},{allele:"C",geneId:"ENSG00000223972",geneName:"DDX11L1",geneNameSource:"HGNC",featureId:"ENST00000450305",featureType:"Transcript",featureBiotype:"transcribed_unprocessed_pseudogene",featureStrand:"1",cDnaPosition:-1,cdsPosition:-1,proteinPosition:-1,consequenceTypes:[1631],canonical:!1,variantToTranscriptDistance:2009},{allele:"C",geneId:"ENSG00000223972",geneName:"DDX11L1",geneNameSource:"HGNC",featureId:"ENST00000515242",featureType:"Transcript",featureBiotype:"transcribed_unprocessed_pseudogene",featureStrand:"1",cDnaPosition:-1,cdsPosition:-1,proteinPosition:-1,consequenceTypes:[1631],canonical:!1,variantToTranscriptDistance:1871},{allele:"C",geneId:"ENSG00000227232",geneName:"WASH7P",geneNameSource:"HGNC",featureId:"ENST00000538476",featureType:"Transcript",featureBiotype:"unprocessed_pseudogene",featureStrand:"-1",cDnaPosition:-1,cdsPosition:-1,proteinPosition:-1,consequenceTypes:[1632],canonical:!1,variantToTranscriptDistance:4410},{allele:"C",geneId:"ENSG00000223972",geneName:"DDX11L1",geneNameSource:"HGNC",featureId:"ENST00000518655",featureType:"Transcript",featureBiotype:"transcribed_unprocessed_pseudogene",featureStrand:"1",cDnaPosition:-1,cdsPosition:-1,proteinPosition:-1,consequenceTypes:[1631],canonical:!1,variantToTranscriptDistance:1873},{allele:"C",geneId:"ENSG00000227232",geneName:"WASH7P",geneNameSource:"HGNC",featureId:"ENST00000438504",featureType:"Transcript",featureBiotype:"unprocessed_pseudogene",featureStrand:"-1",cDnaPosition:-1,cdsPosition:-1,proteinPosition:-1,consequenceTypes:[1632],canonical:!0,variantToTranscriptDistance:4362},{allele:"C",geneId:"ENSG00000227232",geneName:"WASH7P",geneNameSource:"HGNC",featureId:"ENST00000423562",featureType:"Transcript",featureBiotype:"unprocessed_pseudogene",featureStrand:"-1",cDnaPosition:-1,cdsPosition:-1,proteinPosition:-1,consequenceTypes:[1632],canonical:!1,variantToTranscriptDistance:4362},{allele:"C",featureId:"ENSR00000668495",featureType:"RegulatoryFeature",cDnaPosition:-1,cdsPosition:-1,proteinPosition:-1,consequenceTypes:[1566],canonical:!1,variantToTranscriptDistance:-1}],"-":[{allele:"-",geneId:"ENSG00000223972",geneName:"DDX11L1",geneNameSource:"HGNC",featureId:"ENST00000456328",featureType:"Transcript",featureBiotype:"processed_transcript",featureStrand:"1",cDnaPosition:-1,cdsPosition:-1,proteinPosition:-1,consequenceTypes:[1631],canonical:!0,variantToTranscriptDistance:1868},{allele:"-",geneId:"ENSG00000227232",geneName:"WASH7P",geneNameSource:"HGNC",featureId:"ENST00000488147",featureType:"Transcript",featureBiotype:"unprocessed_pseudogene",featureStrand:"-1",cDnaPosition:-1,cdsPosition:-1,proteinPosition:-1,consequenceTypes:[1632],canonical:!1,variantToTranscriptDistance:4403},{allele:"-",geneId:"ENSG00000227232",geneName:"WASH7P",geneNameSource:"HGNC",featureId:"ENST00000541675",featureType:"Transcript",featureBiotype:"unprocessed_pseudogene",featureStrand:"-1",cDnaPosition:-1,cdsPosition:-1,proteinPosition:-1,consequenceTypes:[1632],canonical:!1,variantToTranscriptDistance:4362},{allele:"-",geneId:"ENSG00000223972",geneName:"DDX11L1",geneNameSource:"HGNC",featureId:"ENST00000450305",featureType:"Transcript",featureBiotype:"transcribed_unprocessed_pseudogene",featureStrand:"1",cDnaPosition:-1,cdsPosition:-1,proteinPosition:-1,consequenceTypes:[1631],canonical:!1,variantToTranscriptDistance:2009},{allele:"-",geneId:"ENSG00000223972",geneName:"DDX11L1",geneNameSource:"HGNC",featureId:"ENST00000515242",featureType:"Transcript",featureBiotype:"transcribed_unprocessed_pseudogene",featureStrand:"1",cDnaPosition:-1,cdsPosition:-1,proteinPosition:-1,consequenceTypes:[1631],canonical:!1,variantToTranscriptDistance:1871},{allele:"-",geneId:"ENSG00000227232",geneName:"WASH7P",geneNameSource:"HGNC",featureId:"ENST00000538476",featureType:"Transcript",featureBiotype:"unprocessed_pseudogene",featureStrand:"-1",cDnaPosition:-1,cdsPosition:-1,proteinPosition:-1,consequenceTypes:[1632],canonical:!1,variantToTranscriptDistance:4410},{allele:"-",geneId:"ENSG00000223972",geneName:"DDX11L1",geneNameSource:"HGNC",featureId:"ENST00000518655",featureType:"Transcript",featureBiotype:"transcribed_unprocessed_pseudogene",featureStrand:"1",cDnaPosition:-1,cdsPosition:-1,proteinPosition:-1,consequenceTypes:[1631],canonical:!1,variantToTranscriptDistance:1873},{allele:"-",geneId:"ENSG00000227232",geneName:"WASH7P",geneNameSource:"HGNC",featureId:"ENST00000438504",featureType:"Transcript",featureBiotype:"unprocessed_pseudogene",featureStrand:"-1",cDnaPosition:-1,cdsPosition:-1,proteinPosition:-1,consequenceTypes:[1632],canonical:!0,variantToTranscriptDistance:4362},{allele:"-",geneId:"ENSG00000227232",geneName:"WASH7P",geneNameSource:"HGNC",featureId:"ENST00000423562",featureType:"Transcript",featureBiotype:"unprocessed_pseudogene",featureStrand:"-1",cDnaPosition:-1,cdsPosition:-1,proteinPosition:-1,consequenceTypes:[1632],canonical:!1,variantToTranscriptDistance:4362},{allele:"-",featureId:"ENSR00000668495",featureType:"RegulatoryFeature",cDnaPosition:-1,cdsPosition:-1,proteinPosition:-1,consequenceTypes:[1566],canonical:!1,variantToTranscriptDistance:-1}]},frequencies:{maf1000G:.6,maf1000GAfrican:.5,maf1000GAmerican:.4,maf1000GAsian:.3,maf1000GEuropean:.2,mafNhlbiEspAfricanAmerican:.1,mafNhlbiEspEuropeanAmerican:.2},proteinSubstitutionScores:{polyphenScore:-1,siftScore:-1},regulatoryEffect:{motifPosition:0,motifScoreChange:0,highInformationPosition:!1}};
return a}},NetworkFileWidget.prototype.getTitleName=function(){return Ext.getCmp(this.id+"_title").getValue()},NetworkFileWidget.prototype.getFileUpload=function(){},NetworkFileWidget.prototype.addCustomComponents=function(){},NetworkFileWidget.prototype.draw=function(){var a=this;if(null==this.panel){var b=Ext.create("Ext.toolbar.Toolbar",{dock:"top"});b.add(this.getFileUpload()),this.infoLabel=Ext.create("Ext.toolbar.TextItem",{text:"Please select a network saved file"}),this.countLabel=Ext.create("Ext.toolbar.TextItem"),this.infobar=Ext.create("Ext.toolbar.Toolbar",{dock:"bottom"}),this.infobar.add(["->",this.infoLabel,this.countLabel]),this.gridStore=Ext.create("Ext.data.Store",{pageSize:50,proxy:{type:"memory"},fields:["0","1","2"]}),this.grid=Ext.create("Ext.grid.Panel",{border:!1,flex:1,store:this.gridStore,loadMask:!0,plugins:["bufferedrenderer"],dockedItems:[this.infobar],columns:[{header:"Source node",dataIndex:"0",flex:1},{header:"Relation",dataIndex:"1",flex:1,menuDisabled:!0},{header:"Target node",dataIndex:"2",flex:1}]});var c;if(this.layoutSelector)var c=Ext.create("Ext.form.field.ComboBox",{margin:"0 0 0 5",width:240,editable:!1,labelWidth:90,fieldLabel:"Apply layout",displayField:"name",valueField:"name",value:"Force directed",store:new Ext.data.SimpleStore({fields:["name"],data:[["Force directed"],["Random"],["Circle"],["none"]]})});this.panel=Ext.create("Ext.window.Window",{title:this.title,resizable:!1,items:{border:!1,width:this.width,height:this.height,layout:{type:"vbox",align:"stretch"},items:[this.grid],tbar:b,bbar:{defaults:{width:100},items:[c,"->",{text:"Ok",handler:function(){var b;c&&(b=c.getValue()),a.trigger("okButton:click",{content:a.content,layout:b,sender:a}),a.panel.close()}},{text:"Cancel",handler:function(){a.panel.close()}}]}},listeners:{scope:this,minimize:function(){this.panel.hide()},destroy:function(){delete this.panel}}}),this.addCustomComponents()}this.panel.show()},AttributeLayoutConfigureWidget.prototype={render:function(){var a=this;this.vertexAttributeManager=this.networkViewer.network.vertexAttributeManager,this.vertexAttributeStore=Ext.create("Ext.data.Store",{fields:["name"],data:this.vertexAttributeManager.attributes}),this.vertexAttributeManager.on("change:attributes",function(){a.vertexAttributeStore.loadData(a.vertexAttributeManager.attributes)}),this.xAtributeCombo=Ext.create("Ext.form.field.ComboBox",{labelWidth:70,fieldLabel:"X",store:this.vertexAttributeStore,allowBlank:!1,editable:!1,displayField:"name",valueField:"name",queryMode:"local",forceSelection:!0,listeners:{afterrender:function(){this.select(this.getStore().getAt(0))},change:function(a){a.getValue()}}}),this.yAtributeCombo=Ext.create("Ext.form.field.ComboBox",{labelWidth:70,fieldLabel:"Y",store:this.vertexAttributeStore,allowBlank:!1,editable:!1,displayField:"name",valueField:"name",queryMode:"local",forceSelection:!0,listeners:{afterrender:function(){this.select(this.getStore().getAt(0))},change:function(a){a.getValue()}}}),this.normalizeCheckBox=Ext.create("Ext.form.field.Checkbox",{fieldLabel:"Normalize",labelWidth:70,checked:!0}),this.window=Ext.create("Ext.window.Window",{id:this.id+"window",title:"Attribute layout configuration",closable:!1,minimizable:!0,constrain:!0,collapsible:!0,items:{bodyPadding:10,width:this.width,layout:{type:"vbox",align:"stretch"},items:[{xtype:"box",style:{fontSize:"13px",fontWeight:"bold",borderBottom:"1px solid lightgray",marginBottom:"10px"},html:"Select attribute as node position"},{xtype:"container",style:{marginBottom:"20px"},layout:{type:"vbox",align:"stretch"},defaults:{margin:"1 0 1 0"},items:[this.xAtributeCombo,this.yAtributeCombo,this.normalizeCheckBox]}],bbar:{layout:{pack:"end"},defaults:{width:100},items:[{text:"Apply",handler:function(){a.setLayout()}}]}},listeners:{minimize:function(){this.hide()}}})},draw:function(){},show:function(){this.window.show()},hide:function(){this.window.hide()},setLayout:function(){var a=this,b=this.xAtributeCombo.getValue(),c=this.yAtributeCombo.getValue(),d=this.normalizeCheckBox.getValue();if(d){var e,f,g,h;this.vertexAttributeManager.eachRecord(function(a){var d=parseFloat(a.get(b)),i=parseFloat(a.get(c));isNaN(d)||("undefined"==typeof e&&(e=d,f=d),e=Math.max(d,e),f=Math.min(d,f)),isNaN(i)||("undefined"==typeof g&&(g=i,h=i),g=Math.max(i,g),h=Math.min(i,h))});var i=e===f?1:e-f,j=g===h?1:g-h,k=this.networkViewer.getLayoutWidth(),l=this.networkViewer.getLayoutHeight();this.vertexAttributeManager.eachRecord(function(d){var e=parseFloat(d.get(b)),g=parseFloat(d.get(c));e=(e-f)*k/i,g=(g-h)*l/j,isNaN(e)||isNaN(g)||a.network.setVertexCoordsById(d.get("id"),e,g)})}else this.vertexAttributeManager.eachRecord(function(d){var e=parseFloat(d.get(b)),f=parseFloat(d.get(c));isNaN(e)||isNaN(f)||a.network.setVertexCoordsById(d.get("id"),e,f)})}},AttributeNetworkFileWidget.prototype.getTitleName=function(){return Ext.getCmp(this.id+"_title").getValue()},AttributeNetworkFileWidget.prototype.getFileUpload=function(){var a=this;return this.fileUpload=Ext.create("Ext.form.field.File",{msgTarget:"side",allowBlank:!1,emptyText:"Attributes tabular file",flex:1,buttonText:"Browse local",listeners:{change:function(b,c){var d=document.getElementById(b.fileInputEl.id).files[0],e=Ext.DomQuery.selectNode("input[id="+b.getInputId()+"]");e.value=c.replace("C:\\fakepath\\","");var f=new AttributeNetworkDataAdapter({dataSource:new FileDataSource({file:d}),handlers:{"data:load":function(){a.processData(f)},"error:parse":function(b){a.infoLabel.setText('<span class="err">'+b.errorMsg+"</span>",!1),a.panel.setLoading(!1)}}})}}}),this.fileUpload},AttributeNetworkFileWidget.prototype.processData=function(a){var b=this;this.content=a.getAttributesJSON(),this.gridTbar.removeAll(),this.infoLabel.setText("",!1);var c=!1,d=[];this.columnsGrid=[],this.gridColumnNameFields=[];for(var e=0;e<b.content.attributes.length;e++){var f=this.content.attributes[e].name;this.columnsGrid.push({text:f,dataIndex:f,flex:1,editor:{xtype:"textfield",allowBlank:!0}}),this.gridColumnNameFields.push({xtype:"textfield",value:f,index:e,vtype:"alphanum",flex:1,readOnly:"Id"===f?!0:!1,listeners:{change:function(a,c){var e=b.grid.down("headercontainer").getGridColumns();e[a.index].setText(c),b.columnsGrid[a.index].text=c,b.content.attributes[a.index].name=c,d[a.index].setBoxLabel(c),d[a.index].updateLayout()}}});var g=!1;"id"==f&&(g=!0,c=!0),d.push(Ext.create("Ext.form.field.Checkbox",{boxLabel:f,name:"attr",margin:"0 0 0 5",checked:!0,disabled:g}))}for(var h=!0,i={},e=0;e<this.content.data.length;e++){var f=this.content.data[e][0];if(i[f]){h=!1;break}i[f]=!0}c?h?(this.cbgAttributes.add(d),this.fieldContainer.show(),Ext.getCmp(this.id+"okBtn").setDisabled(!1)):this.infoLabel.setText("<span class='err'>Invalid file. The values for 'id' column must be uniques.</span>",!1):this.infoLabel.setText("<span class='err'>Invalid file. The column 'id' is required.</span>",!1),this.gridTbar.add(this.gridColumnNameFields),this.gridStore.setFields(this.content.attributes),this.grid.reconfigure(this.gridStore,this.columnsGrid),this.gridStore.loadData(this.content.data)},AttributeNetworkFileWidget.prototype.filterColumnsToImport=function(){var a=this.cbgAttributes.getChecked(),b={},c=[],d={};if(b.content={},b.createNodes=this.createNodesCkb.getValue(),a.length<this.content.attributes.length){for(var e={},f=0;f<a.length;f++)e[a[f].boxLabel]=!0;for(var f=0;f<this.content.attributes.length;f++){var g=this.content.attributes[f].name;e[g]&&(c.push(this.content.attributes[f]),d[f]=!0)}b.content.data=[];for(var f=0;f<this.content.data.length;f++){b.content.data.push([]);for(var h=0;h<this.content.data[f].length;h++)d[h]&&b.content.data[f].push(this.content.data[f][h])}b.content.attributes=c}else b.content=this.content;return b},AttributeNetworkFileWidget.prototype.draw=function(){var a=this;if(null==this.panel){var b=Ext.create("Ext.toolbar.Toolbar",{cls:"bio-border-false",dock:"top"});b.add(this.getFileUpload()),this.infoLabel=Ext.create("Ext.toolbar.TextItem",{html:"Please select a network saved File"}),this.countLabel=Ext.create("Ext.toolbar.TextItem");var c=Ext.create("Ext.toolbar.Toolbar",{cls:"bio-border-false",dock:"bottom"});c.add([this.infoLabel,"->",this.countLabel]),this.cbgAttributes=Ext.create("Ext.form.CheckboxGroup",{fieldLabel:"Import",labelWidth:40,layout:"hbox",autoScroll:!0,defaultType:"checkboxfield"}),this.createNodesCkb=Ext.create("Ext.form.field.Checkbox",{margin:"2 2 2 2",boxLabel:"Create nodes for unrecognized names."}),this.fieldContainer=Ext.create("Ext.form.FieldContainer",{margin:"0 0 0 10",hidden:!0,items:[this.cbgAttributes,this.createNodesCkb]}),this.columnsGrid=[],this.gridStore=Ext.create("Ext.data.Store",{pageSize:50,proxy:{type:"memory"},fields:[]}),this.gridTbar=Ext.create("Ext.toolbar.Toolbar",{items:[]}),this.grid=Ext.create("Ext.grid.Panel",{border:!1,flex:1,tbar:this.gridTbar,store:this.gridStore,columns:this.columnsGrid,loadMask:!0,plugins:["bufferedrenderer"],hideHeaders:!0,dockedItems:[c]}),this.panel=Ext.create("Ext.window.Window",{title:this.title,resizable:!1,modal:!0,items:{layout:{type:"vbox",align:"stretch"},width:this.width,height:this.height,border:0,items:[this.grid,this.fieldContainer],dockedItems:[b],bbar:{layout:{pack:"end"},defaults:{width:100},items:[{id:a.id+"okBtn",text:"Ok",disabled:!0,handler:function(){a.trigger("okButton:click",{content:a.filterColumnsToImport(),sender:a}),a.panel.close()}},{text:"Cancel",handler:function(){a.panel.close()}}]}},listeners:{scope:this,minimize:function(){this.panel.hide()},destroy:function(){delete this.panel}}})}this.panel.show()},AttributeEditWidget.prototype={render:function(){var a=this;this.attrMan.on("change:attributes",function(){a.reconfigureComponents()}),this.comboStore=Ext.create("Ext.data.Store",{fields:["name"],data:this.attrMan.attributes});var b=Ext.create("Ext.form.Panel",{title:"Edit multiple values",bodyPadding:10,layout:"vbox",border:0,defaults:{width:"100%",labelWidth:55},dockedItems:[{xtype:"toolbar",dock:"top",items:[{text:"Select all rows",handler:function(){a.grid.getSelectionModel().selectAll()}},{text:"Deselect all rows",handler:function(){a.grid.getSelectionModel().deselectAll()}}]}],items:[this.createAttributesCombo(),this.createValueField(),{xtype:"button",text:"Apply on selected rows",formBind:!0,disabled:!0,handler:function(b){var c=b.prev().getValue(),d=b.prev().prev().getValue(),e=a.grid.getSelectionModel().getSelection();a.attrMan.setRecordsAttribute(e,d,c)}}]}),c=Ext.create("Ext.form.Panel",{title:"Add attribute",bodyPadding:10,layout:"vbox",border:0,style:{borderTopColor:"lightgray",borderTopStyle:"solid",borderTopWidth:"1px"},defaults:{width:"100%",labelWidth:55},items:[{xtype:"textfield",fieldLabel:"Name",allowBlank:!1},{xtype:"combo",hidden:!0,store:["string","int","float"],value:"string",fieldLabel:"Type",editable:!1,queryMode:"local",allowBlank:!1},{xtype:"button",text:"Apply",formBind:!0,disabled:!0,handler:function(b){var c=b.previousSibling("textfield[fieldLabel=Name]").getValue(),d=b.previousSibling("combo[fieldLabel=Type]").getValue(),e=a.attrMan.addAttribute({name:c,type:d,defaultValue:""}),f=e===!1?'<span class="err">Name already exists.</span>':"";b.next().update(f)}},{xtype:"box",margin:"10 0 0 0",html:""}]}),d=Ext.create("Ext.form.Panel",{title:"Remove attribute",bodyPadding:10,layout:"vbox",border:0,style:{borderTopColor:"lightgray",borderTopStyle:"solid",borderTopWidth:"1px"},defaults:{width:"100%",labelWidth:55},items:[this.createAttributesCombo(),{xtype:"button",text:"Apply",formBind:!0,disabled:!0,handler:function(b){var c=b.prev().getValue(),d=a.attrMan.removeAttribute(c),e=d===!1?'<span class="err">Impossible to remove.</span>':"";b.next().update(e)}},{xtype:"box",margin:"10 0 0 0"}]}),e=Ext.create("Ext.toolbar.Toolbar",{dock:"top",items:[{xtype:"button",text:'<span style="font-size: 12px">Columns <span class="caret"></span></span>',handler:function(b){var c=a.grid.headerCt.getMenu().down("menuitem[text=Columns]").menu;c.showBy(b)}},"-",{xtype:"radiogroup",id:this.id+"selectMode",fieldLabel:"Show",labelWidth:30,width:230,margin:"0 0 0 10",defaults:{margin:"0 0 0 10"},layout:"hbox",items:[{boxLabel:"All",checked:!0,name:this.id+"selection",inputValue:"all"},{boxLabel:"Network selection",name:this.id+"selection",inputValue:"selected"}],listeners:{change:function(){a.checkSelectedFilter()}}},"->",{xtype:"tbtext",text:'<span style="color:gray">Use double-click to edit</span>'},{xtype:"button",text:'<i class="fa fa-download"></i> Download as file',handler:function(b){var c=(b.getEl(),a.attrMan.getAsFile()),d=new Blob([c],{type:"data:text/tsv"}),e=URL.createObjectURL(d),f=document.createElement("a");f.href=e,f.download=a.type+".attr";var g=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!0});f.dispatchEvent(g)}}]});this.grid=Ext.create("Ext.grid.Panel",{store:this.attrMan.store,columns:this.attrMan.columnsGrid,flex:1,border:0,selModel:{selType:"rowmodel",mode:"MULTI"},loadMask:!0,plugins:["bufferedrenderer",Ext.create("Ext.grid.plugin.CellEditing",{clicksToEdit:2})],listeners:{},dockedItems:[e]}),this.accordionPanel=Ext.create("Ext.container.Container",{layout:{type:"vbox",align:"stretch"},width:230,border:"0 1 0 0",style:{borderColor:"lightgray",borderStyle:"solid",backgroundColor:"#ffffff"},items:[b,c,d]}),this.window=Ext.create("Ext.window.Window",{id:"edit"+this.type+"AttrWindow",title:"Edit "+this.type.toLowerCase()+" attributes",width:850,height:600,closable:!1,minimizable:!0,maximizable:!0,constrain:!0,collapsible:!0,layout:{type:"hbox",align:"stretch"},renderTo:Ext.getBody(),items:[this.accordionPanel,this.grid],listeners:{minimize:function(){this.hide()}}})},draw:function(){this.window.show(),this.checkSelectedFilter()},show:function(){this.window.show()},hide:function(){this.window.hide()},reconfigureComponents:function(){this.grid.reconfigure(this.attrMan.store,this.attrMan.columnsGrid),this.reloadComboStore()},reloadComboStore:function(){this.comboStore.loadData(this.attrMan.attributes)},checkSelectedFilter:function(){this.attrMan.store.clearFilter();var a=Ext.getCmp(this.id+"selectMode").getValue();"selected"===a[this.id+"selection"]&&this.attrMan.store.setFilters(this.selectedFilter)},createAttributesCombo:function(){return{xtype:"combo",store:this.comboStore,displayField:"name",valueField:"name",allowBlank:!1,fieldLabel:"Attribute",editable:!1,queryMode:"local"}},createValueField:function(){return{xtype:"textfield",fieldLabel:"Value",allowBlank:!1}}},AttributeFilterWidget.prototype.draw=function(a){var b=this,c=Ext.create("Ext.data.Store",{id:this.id+"attrNameStore",fields:["name"],data:this.getAttributeNames()}),d=Ext.create("Ext.form.Panel",{title:"Add new filter",border:!1,bodyStyle:"background: #dedcd8",bodyPadding:"10 5 10 5",layout:"hbox",items:[{xtype:"text",margin:"4 0 0 0",text:"Filter name:"},{xtype:"textfield",id:this.id+"filterName",width:105,margin:"0 0 0 4",allowBlank:!1},{xtype:"text",margin:"4 0 0 10",text:"Attribute:"},{xtype:"combo",id:this.id+"selectedAttr",margin:"0 0 0 4",width:105,allowBlank:!1,mode:"local",editable:!1,displayField:"name",valueField:"name",store:c},{xtype:"text",margin:"4 0 0 10",text:"Attr. value:"},{xtype:"textfield",id:this.id+"attrValue",width:105,margin:"0 0 0 4",allowBlank:!1},{xtype:"button",text:"Add",iconCls:"icon-add",margin:"0 15 0 10",formBind:!0,disabled:!0,handler:function(){var a=Ext.getCmp(b.id+"filterName").getValue(),c=Ext.getCmp(b.id+"selectedAttr").getValue(),d=Ext.getCmp(b.id+"attrValue").getValue();b.attrMan.addFilter(a,c,d)?(Ext.getCmp(b.id+"filterMenu").menu.add({id:a,text:a,checked:!0,handler:function(){this.checked?(b.attrMan.enableFilter(this.text),b.selectNodesOnGraph(),Ext.getCmp(this.id+"_main").setChecked(!0)):(b.attrMan.disableFilter(this.text),b.deselectNodesOnGraph(),Ext.getCmp(this.id+"_main").setChecked(!1))}}),Ext.getCmp("filters"+b.type+"AttrMenu").add({id:a+"_main",text:a,checked:!0,handler:function(){this.checked?(b.attrMan.enableFilter(this.text),b.selectNodesOnGraph(),Ext.getCmp(this.text)&&Ext.getCmp(this.text).setChecked(!0)):(b.attrMan.disableFilter(this.text),b.deselectNodesOnGraph(),Ext.getCmp(this.text)&&Ext.getCmp(this.text).setChecked(!1))}}),Ext.getCmp(b.id+"rmFilterMenu").menu.add({text:a,handler:function(){var a=this;Ext.Msg.show({title:"Delete",msg:"Confirm delete. Are you sure?",buttons:Ext.Msg.YESNO,icon:Ext.Msg.QUESTION,fn:function(c){"yes"==c&&(b.attrMan.removeFilter(a.text),Ext.getCmp(b.id+"rmFilterMenu").menu.remove(a),Ext.getCmp(b.id+"filterMenu").menu.remove(a.text),Ext.getCmp("filters"+b.type+"AttrMenu").remove(Ext.getCmp(a.text+"_main")),b.deselectNodesOnGraph())}})}}),b.selectNodesOnGraph()):Ext.Msg.show({title:"Error",msg:"Already exists a filter with this name.",buttons:Ext.Msg.OK,icon:Ext.Msg.ERROR})}}]}),e=Ext.create("Ext.Button",{disabled:!0,text:"Restore original graph",handler:function(){this.setDisabled(!0),b.trigger("vertices:restore",{sender:b})}});this.grid=Ext.create("Ext.grid.Panel",{store:this.attrMan.store,columns:this.attrMan.columnsGrid,height:400,width:400,selModel:{selType:"rowmodel",mode:"MULTI"},border:0,dockedItems:[{xtype:"toolbar",dock:"bottom",items:[{xtype:"tbtext",id:this.id+"numRowsLabel"},"->",{xtype:"button",text:"Export...",handler:function(){if(!Ext.getCmp("exportWindow")){var a=[],c=b.attrMan.getAttrNameList();a.push({boxLabel:c[1],name:"attr",inputValue:c[1],checked:!0,disabled:!0});for(var d=2;d<c.length;d++)a.push({boxLabel:c[d],name:"attr",inputValue:c[d],checked:!0});Ext.create("Ext.window.Window",{id:"exportWindow",title:"Export attributes",height:250,maxHeight:250,width:400,autoScroll:!0,layout:"vbox",modal:!0,items:[{xtype:"checkboxgroup",id:b.id+"cbgAttributes",layout:"vbox",items:a}],buttons:[{xtype:"textfield",id:b.id+"fileName",emptyText:"enter file name",flex:1},{text:"Download",href:"none",handler:function(){var a=Ext.getCmp(b.id+"fileName").getValue();""==a&&(a="attributes");var c=Ext.getCmp(b.id+"cbgAttributes").getChecked(),d=b.attrMan.exportToTab(c,!1);this.getEl().child("em").child("a").set({href:"data:text/csv,"+encodeURIComponent(d),download:a+".txt"})}}]}).show()}}}]},{xtype:"toolbar",dock:"bottom",items:d},{xtype:"toolbar",dock:"top",layout:{pack:"hbox",align:"right"},items:[{id:this.id+"filterMenu",text:"Active filters",menu:[]},{id:this.id+"rmFilterMenu",text:"Remove filter",menu:[]},{xtype:"button",text:"Select on graph",handler:function(){b.selectNodesOnGraph()}},{xtype:"button",text:"Filter on graph",handler:function(){e.setDisabled(!1),b.grid.getSelectionModel().selectAll();for(var a=b.grid.getSelectionModel().getSelection(),c={},d=0;d<a.length;d++)c[a[d].getData().Id]=!0;b.trigger("vertices:filter",{vertices:c,sender:b})}},e]}],plugins:[Ext.create("Ext.grid.plugin.CellEditing",{clicksToEdit:2})],renderTo:Ext.getBody(),listeners:{afterrender:function(){var a=this.headerCt.getMenu();a.add([{text:"Reset to default",handler:function(){var b=a.activeHeader.dataIndex;alert('custom item for column "'+b+'" was pressed')}}])},selectionchange:function(a,c){for(var d=[],e=0;e<c.length;e++)d.push(c[e].getData().Id);b.trigger("vertices:select",{vertices:d,sender:b})}}}),Ext.create("Ext.window.Window",{id:"filter"+this.type+"AttrWindow",title:"Filter "+this.type.toLowerCase()+" attributes",height:450,width:600,layout:"fit",items:this.grid}).show();for(var f in this.attrMan.filters)Ext.getCmp(this.id+"filterMenu").menu.add({id:f,text:f,checked:this.attrMan.filters[f].active,handler:function(){this.checked?(b.attrMan.enableFilter(this.text),b.selectNodesOnGraph(),Ext.getCmp(this.id+"_main").setChecked(!0)):(b.attrMan.disableFilter(this.text),b.deselectNodesOnGraph(),Ext.getCmp(this.id+"_main").setChecked(!1))}}),Ext.getCmp(this.id+"rmFilterMenu").menu.add({text:f,handler:function(){b.attrMan.removeFilter(this.text),Ext.getCmp(b.id+"rmFilterMenu").menu.remove(this),Ext.getCmp(b.id+"filterMenu").menu.remove(this.text),Ext.getCmp("filters"+b.type+"AttrMenu").remove(Ext.getCmp(this.text+"_main")),b.deselectNodesOnGraph()}});this.selectRowsById(a),this.updateNumRowsLabel()},AttributeFilterWidget.prototype.getAttributeNames=function(){for(var a=[],b=this.attrMan.getAttrNameList(),c=0;c<b.length;c++){var d=b[c];"Id"!=d&&a.push({name:d})}return a},AttributeFilterWidget.prototype.selectNodesOnGraph=function(){Ext.getCmp("filterAttrWindow")&&this.grid.getSelectionModel().selectAll();var a=[];this.attrMan.store.each(function(b){a.push(b.getData().Id)}),this.trigger("vertices:select",{vertices:a,sender:this})},AttributeFilterWidget.prototype.deselectNodesOnGraph=function(){this.trigger("vertices:deselect",{sender:this})},AttributeFilterWidget.prototype.selectRowsById=function(a){this.grid.getSelectionModel().deselectAll();for(var b=0;b<a.length;b++){var c=this.attrMan.store.find("Id",a[b]);this.grid.getSelectionModel().select(c,!0)}},AttributeFilterWidget.prototype.updateNumRowsLabel=function(){Ext.getCmp(this.id+"numRowsLabel").setText(this.attrMan.getNumberOfRows()+" rows")},DOTNetworkFileWidget.prototype.getFileUpload=function(){var a=this;return this.fileUpload=Ext.create("Ext.form.field.File",{msgTarget:"side",allowBlank:!1,emptyText:"DOT network file",flex:1,buttonText:"Browse local",listeners:{change:function(b,c){a.panel.setLoading(!0);var d=document.getElementById(a.fileUpload.fileInputEl.id).files[0],e=Ext.DomQuery.selectNode("input[id="+b.getInputId()+"]");e.value=c.replace("C:\\fakepath\\",""),a.dataAdapter=new DOTDataAdapter({dataSource:new FileDataSource({file:d}),handlers:{"data:load":function(b){try{var c=b.network;a.content=c;for(var d=c.graph.vertices.length,e=c.graph.edges.length,f=c.graph.edges,g=0;g<f.length;g++){var h=f[g],i=c.getEdgeConfig(h),j=(i.type="directed")?"->":"--";a.gridStore.loadData([[h.source.name,j,h.target.name]],!0)}a.infoLabel.setText('<span class="ok">File loaded sucessfully</span>',!1),a.countLabel.setText('Vertices:<span class="info">'+d+'</span> edges:<span class="info">'+e+"</span>",!1)}catch(k){a.infoLabel.setText('<span class="err">File not valid </span>'+k,!1)}a.panel.setLoading(!1)}}})}}}),this.fileUpload},JSONNetworkFileWidget.prototype=new NetworkFileWidget,JSONNetworkFileWidget.prototype.getFileUpload=function(){var a=this;return this.fileUpload=Ext.create("Ext.form.field.File",{msgTarget:"side",allowBlank:!1,emptyText:"JSON network file",flex:1,buttonText:"Browse local",listeners:{change:function(){a.panel.setLoading(!0);var b=document.getElementById(a.fileUpload.fileInputEl.id).files[0];a.dataAdapter=new JSONNetworkDataAdapter({dataSource:new FileDataSource({file:b}),handlers:{"data:load":function(b){try{var c=b.jsonObject;a.content=c;for(var d=[],e=0;e<c.graph.edges.length;e++){var f=c.graph.edges[e];d.push([f.source.id,f.relation,f.target.id])}a.gridStore.loadData(d);var g=c.graph.vertices.length,h=c.graph.edges.length;a.infoLabel.setText('<span class="ok">File loaded sucessfully</span>',!1),a.countLabel.setText('Vertices:<span class="info">'+g+'</span>&nbsp;&nbsp; Edges:<span class="info">'+h+"</span>",!1)}catch(i){a.infoLabel.setText('<span class="err">File not valid </span>'+i,!1)}a.panel.setLoading(!1)},"error:parse":function(b){a.infoLabel.setText('<span class="err">'+b.errorMsg+"</span>",!1),a.panel.setLoading(!1)}}})}}}),this.fileUpload},LayoutConfigureWidget.prototype={render:function(){var a=this;this.edgeAttributeManager=this.network.edgeAttributeManager,this.edgeAttributeStore=Ext.create("Ext.data.Store",{fields:["name"],data:[{name:"Non weighted"}].concat(this.edgeAttributeManager.attributes)}),this.edgeAttributeManager.on("change:attributes",function(){a.edgeAttributeStore.loadData([{name:"Non weighted"}].concat(a.edgeAttributeManager.attributes))}),this.vertexAttributeManager=this.network.vertexAttributeManager,this.vertexAttributeStore=Ext.create("Ext.data.Store",{fields:["name"],data:[{name:"Non weighted"}].concat(this.vertexAttributeManager.attributes)}),this.vertexAttributeManager.on("change:attributes",function(){a.vertexAttributeStore.loadData([{name:"Non weighted"}].concat(a.vertexAttributeManager.attributes))});var b=this.createComponent({text:"Charge",store:this.vertexAttributeStore,value:-30,step:1,changeNumberField:function(){},changeCombo:function(){}}),c=this.createComponent({text:"Link distance",store:this.edgeAttributeStore,value:20,minValue:0,step:1,changeNumberField:function(){},changeCombo:function(){}}),d=this.createComponent({text:"Link strength",store:this.edgeAttributeStore,value:1,maxValue:1,minValue:0,step:.1,changeNumberField:function(){},changeCombo:function(){}}),e=Ext.create("Ext.form.field.Number",{xtype:"numberfield",fieldLabel:'<span style="font-family: Oxygen">Friction</span>',value:.9,maxValue:1,minValue:0,step:.1,listeners:{change:{buffer:100,fn:function(a,b){null!=b&&console.log(b)}}}}),f=Ext.create("Ext.form.field.Number",{xtype:"numberfield",fieldLabel:'<span style="font-family: Oxygen">Gravity</span>',value:.1,minValue:0,step:.1,listeners:{change:{buffer:100,fn:function(a,b){null!=b&&console.log(b)}}}}),g=Ext.create("Ext.form.field.Number",{xtype:"numberfield",fieldLabel:'<span style="font-family: Oxygen">Charge distance</span>',value:500,minValue:0,step:1,listeners:{change:{buffer:100,fn:function(a,b){null!=b&&console.log(b)}}}});this.window=Ext.create("Ext.window.Window",{id:this.id+"window",title:"Force directed layout configuration",closable:!1,minimizable:!0,constrain:!0,collapsible:!0,layout:"fit",items:{layout:{type:"vbox",align:"stretch"},width:this.width,bodyPadding:10,border:!1,items:[{xtype:"box",style:{textAlign:"right"},html:'<a target="_blank" href="https://github.com/mbostock/d3/wiki/Force-Layout">About force directed layout </a>'},{xtype:"box",style:{fontSize:"13px",fontWeight:"bold",borderBottom:"1px solid lightgray",marginBottom:"10px"},html:"Node related settings"},{xtype:"container",style:{marginBottom:"20px"},layout:{type:"vbox",align:"stretch"},defaults:{margin:"1 0 1 0"},items:[b]},{xtype:"box",style:{fontSize:"13px",fontWeight:"bold",borderBottom:"1px solid lightgray",marginBottom:"10px"},html:"Edge related settings"},{xtype:"container",layout:{type:"vbox",align:"stretch"},defaults:{margin:"1 0 1 0"},items:[c,d]},{xtype:"box",style:{fontSize:"13px",fontWeight:"bold",borderBottom:"1px solid lightgray",marginBottom:"10px",marginTop:"20px"},html:"Global settings"},{xtype:"container",layout:{type:"vbox",align:"stretch"},defaults:{margin:"1 0 1 0"},items:[e,f,g]}],bbar:{layout:{pack:"end"},defaults:{width:100},items:[{text:"Apply",handler:function(){var h=c.down("combo").getValue(),i=d.down("combo").getValue(),j=b.down("combo").getValue(),k=c.down("numberfield").getValue(),l=d.down("numberfield").getValue(),m=b.down("numberfield").getValue();h="Non weighted"===h?k:h,i="Non weighted"===i?l:i,j="Non weighted"===j?m:j,GraphLayout.force({network:a.network,width:a.networkViewer.networkSvgLayout.getWidth(),height:a.networkViewer.networkSvgLayout.getHeight(),linkDistance:h,linkStrength:i,charge:j,multipliers:{linkDistance:k,linkStrength:l,charge:m},friction:e.getValue(),gravity:f.getValue(),chargeDistance:g.getValue(),simulation:!1,end:function(b){for(var c=0,d=b.length;d>c;c++){var e=b[c];a.networkViewer.setVertexCoords(e.id,e.x,e.y)}}})}}]}},listeners:{minimize:function(){this.hide()}}})},draw:function(){},show:function(){this.window.show()},hide:function(){this.window.hide()},createComponent:function(a){return Ext.create("Ext.container.Container",{layout:"hbox",defaults:{margin:"0 1 0 1"},items:[{xtype:"numberfield",fieldLabel:'<span style="font-family: Oxygen">'+a.text+"</span>",value:a.value,maxValue:a.maxValue,minValue:a.minValue,step:a.step,margin:"0 10 0 0",listeners:{change:{buffer:100,fn:function(b,c){null!=c&&a.changeNumberField(c)}}}},{xtype:"combo",store:a.store,displayField:"name",valueField:"name",width:100,queryMode:"local",forceSelection:!0,editable:!1,listeners:{afterrender:function(){this.select(this.getStore().getAt(0))},change:function(b){var c=b.getValue();null!=c&&a.changeCombo(c)}}}]})}},NetworkEditWidget.prototype={render:function(){var a=this;this.store=Ext.create("Ext.data.Store",{id:this.id+"store",pageSize:50,proxy:{type:"memory"},fields:[{name:"relation",type:"string"}],data:this.getElements()}),this.network.on("add:vertex add:edge remove:vertex remove:edge remove:vertices load:json clean draw batch:end",function(){a.store.loadRawData(a.getElements())})},draw:function(){var a=this;this.sourceTextfield=Ext.create("Ext.form.field.Text",{xtype:"textfield",vtype:"alphanum",emptyText:"Source id",flex:1}),this.relationTextfield=Ext.create("Ext.form.field.Text",{xtype:"textfield",vtype:"alphanum",emptyText:"Relation",flex:1}),this.targetTextfield=Ext.create("Ext.form.field.Text",{xtype:"textfield",vtype:"alphanum",emptyText:"Target id",flex:1}),this.grid=Ext.create("Ext.grid.Panel",{id:this.id+"grid",store:this.store,columns:[{header:"Source node",xtype:"templatecolumn",tpl:"{source.id}",flex:1,editor:{allowBlank:!1}},{header:"Relation",dataIndex:"relation",flex:1,editor:{allowBlank:!1}},{header:"Target node",xtype:"templatecolumn",tpl:"{target.id}",flex:1,editor:{allowBlank:!1}}],flex:1,border:0,loadMask:!0,selModel:{selType:"rowmodel",mode:"MULTI"},plugins:["bufferedrenderer"],listeners:{},dockedItems:[{xtype:"toolbar",dock:"top",items:[{xtype:"button",text:"Remove selected interactions",handler:function(){var b=(a.grid,a.grid.getSelectionModel().getSelection());a.network.batchStart();for(var c=0;c<b.length;c++){var d=b[c],e=a.network.getEdgeById(d.get("id"));if("undefined"!=typeof e)a.network.removeEdge(e),a.network.removeVertex(a.network.getVertexById(d.get("source").id)),a.network.removeVertex(a.network.getVertexById(d.get("target").id));else{var f=a.network.getVertexById(d.get("source").id);a.network.removeVertex(f)}}a.network.batchEnd(),a.network.vertexAttributeManager.trigger("change:data",{sender:this}),a.network.edgeAttributeManager.trigger("change:data",{sender:this})}},"->",{xtype:"button",text:"Download as SIF file",handler:function(b){var c=(b.getEl(),a.network.graph.getAsSIF()),d=new Blob([c],{type:"data:text/tsv"}),e=URL.createObjectURL(d),f=document.createElement("a");f.href=e,f.download="network.sif";var g=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!0});f.dispatchEvent(g)}}]}]}),this.window=Ext.create("Ext.window.Window",{id:this.id+"window",title:"Network editor",width:800,height:600,closable:!1,minimizable:!0,constrain:!0,collapsible:!0,layout:{type:"hbox",align:"stretch"},items:[{xtype:"panel",title:"Add interaction",width:200,border:0,bodyPadding:10,style:{borderRight:"1px solid lightgray"},defaults:{width:"100%",labelWidth:55},items:[this.sourceTextfield,this.relationTextfield,this.targetTextfield,{xtype:"button",text:"Add interaction",handler:function(){var b=a.sourceTextfield.getValue(),c=a.targetTextfield.getValue(),d=a.relationTextfield.getValue();if(""!==b&&""!==c&&""!==d){var e=b+"_"+d+"_"+c,f=a.network.getVertexById(b);"undefined"==typeof f&&(f=new Vertex({id:b}),a.network.addVertex({vertex:f,vertexConfig:new VertexConfig({rendererConfig:a.networkViewer.session.getVertexDefaults()})},!0));var g=a.network.getVertexById(c);"undefined"==typeof g&&(g=new Vertex({id:c}),a.network.addVertex({vertex:g,vertexConfig:new VertexConfig({rendererConfig:a.networkViewer.session.getVertexDefaults()})},!0));var h=new Edge({id:e,relation:d,source:f,target:g,weight:1,directed:!0});a.network.addEdge({edge:h,edgeConfig:new EdgeConfig({rendererConfig:a.networkViewer.session.getEdgeDefaults()})}),a.networkViewer.refreshNetwork()}}}]},this.grid],listeners:{minimize:function(){this.hide()}}})},getElements:function(){for(var a=this.network.graph.edges,b=this.network.graph.vertices,c=[],d={},e=0,f=a.length;f>e;e++){var g=a[e];"undefined"!=typeof g&&(c.push(g),d[g.source.id]=g.source,d[g.target.id]=g.target)}for(var e=0;e<b.length;e++){var h=b[e];"undefined"!=typeof h&&0==h.edges.length&&"undefined"==typeof d[h.id]&&c.push({source:h})}return c},show:function(){this.window.show()},hide:function(){this.window.hide()
}},SIFNetworkFileWidget.prototype=new NetworkFileWidget,SIFNetworkFileWidget.prototype.getFileUpload=function(){var a=this;return this.fileUpload=Ext.create("Ext.form.field.File",{msgTarget:"side",allowBlank:!1,emptyText:"SIF network file",flex:1,buttonText:"Browse local",listeners:{change:function(b,c){a.panel.setLoading(!0);var d=document.getElementById(a.fileUpload.fileInputEl.id).files[0],e=Ext.DomQuery.selectNode("input[id="+b.getInputId()+"]");e.value=c.replace("C:\\fakepath\\",""),a.dataAdapter=new SIFNetworkDataAdapter({dataSource:new FileDataSource({file:d}),handlers:{"data:load":function(b){a.processData(b.graph)},"error:parse":function(b){a.infoLabel.setText('<span class="err">'+b.errorMsg+"</span>",!1),a.panel.setLoading(!1)}}})}}}),this.fileUpload},SIFNetworkFileWidget.prototype.processData=function(a){try{this.content=a;for(var b=a.vertices.length,c=a.edges.length,d=a.edges,e=[],f=0;f<d.length;f++){var g=d[f];e.push([g.source.id,g.relation,g.target.id])}this.gridStore.loadData(e),this.infoLabel.setText('<span class="ok">File loaded sucessfully</span>',!1),this.countLabel.setText('Vertices:<span class="info">'+b+'</span> edges:<span class="info">'+c+"</span>",!1)}catch(h){this.infoLabel.setText('<span class="err">File not valid </span>'+h,!1)}this.panel.setLoading(!1)},TextNetworkFileWidget.prototype=new NetworkFileWidget,TextNetworkFileWidget.prototype.getFileUpload=function(){var a=this;return this.fileUpload=Ext.create("Ext.form.field.File",{msgTarget:"side",allowBlank:!1,emptyText:"Text network file",flex:1,buttonText:"Browse local",listeners:{change:function(b,c){a.panel.setLoading(!0);var d=document.getElementById(a.fileUpload.fileInputEl.id).files[0],e=Ext.DomQuery.selectNode("input[id="+b.getInputId()+"]");e.value=c.replace("C:\\fakepath\\",""),a.dataAdapter=new TextNetworkDataAdapter({dataSource:new FileDataSource({file:d}),handlers:{"data:load":function(b){a._processColumns(b.sender),a.parsePanel.show()},"error:parse":function(b){a.infoLabel.setText('<span class="err">'+b.errorMsg+"</span>",!1),a.panel.setLoading(!1)}}})}}}),this.fileUpload},TextNetworkFileWidget.prototype.addCustomComponents=function(){var a=this;this.sourceCombo=Ext.create("Ext.form.field.ComboBox",{labelAlign:"top",flex:1,fieldLabel:"Choose source column",emptyText:"Choose column",store:this.columnsNumberStore,allowBlank:!1,editable:!1,displayField:"name",valueField:"num",queryMode:"local",forceSelection:!0,listeners:{change:function(b){var c=b.getValue();console.log(c),null!=c&&(a.sourceColumnIndex=c,a.processColumnNumbers())}}}),this.relationCombo=Ext.create("Ext.form.field.ComboBox",{labelAlign:"top",flex:1,fieldLabel:"Choose relation column",emptyText:"Choose column",store:this.columnsNumberStore,displayField:"name",allowBlank:!1,valueField:"num",queryMode:"local",value:"none",listeners:{change:function(b){var c=b.getValue();null!==c&&(a.relationColumnIndex=c,a.processColumnNumbers())}}}),this.targetCombo=Ext.create("Ext.form.field.ComboBox",{labelAlign:"top",fieldLabel:"Choose target column",flex:1,emptyText:"Choose column",store:this.columnsNumberStore,allowBlank:!1,editable:!1,displayField:"name",valueField:"num",queryMode:"local",forceSelection:!0,listeners:{change:function(b){var c=b.getValue();console.log(c),null!=c&&(a.targetColumnIndex=c,a.processColumnNumbers())}}});var b=Ext.create("Ext.data.Store",{fields:["name","value"],data:[{name:"Tab",value:"	"},{name:"Comma",value:","},{name:"Semicolon",value:";"}]});this.separatorCombo=Ext.create("Ext.form.field.ComboBox",{xtype:"combo",labelAlign:"top",width:185,labelWidth:125,fieldLabel:"Choose field separator",store:b,allowBlank:!1,editable:!1,displayField:"name",valueField:"value",queryMode:"local",forceSelection:!0,listeners:{afterrender:function(){this.select(this.getStore().getAt(0))},change:function(b){var c=b.getValue();null!=c&&"undefined"!=typeof a.dataAdapter&&(a.dataAdapter.separator=c,a.dataAdapter.parse(),a._processColumns(a.dataAdapter),a.grid.store.removeAll())}}}),this.parsePanel=Ext.create("Ext.panel.Panel",{dock:"top",hidden:!0,border:!1,layout:{type:"vbox",align:"stretch"},bodyPadding:5,items:[{xtype:"container",margin:3,layout:{type:"hbox",align:"stretch"},items:[this.separatorCombo]},{xtype:"container",layout:{type:"hbox",align:"stretch"},defaults:{margin:3},items:[this.sourceCombo,this.relationCombo,this.targetCombo]}]}),this.panel.down().addDocked(this.parsePanel)},TextNetworkFileWidget.prototype._processColumns=function(a){for(var b=[],c=0;c<a.columnLength;c++)b.push({name:"Column "+(c+1),num:c+1});this.columnsNumberStore.loadData(b),delete this.sourceColumnIndex,delete this.relationColumnIndex,delete this.targetColumnIndex,this.sourceCombo.reset(),this.relationCombo.reset(),this.targetCombo.reset(),this.infoLabel.setText('<span class="info">Parse complete using <span class="key">'+this.separatorCombo.getRawValue()+"</span> character.</span>",!1),this.panel.setLoading(!1)},TextNetworkFileWidget.prototype.processColumnNumbers=function(){if("undefined"!=typeof this.sourceColumnIndex&&"undefined"!=typeof this.targetColumnIndex){this.panel.setLoading(!0);var a=this.relationCombo.getValue();isNaN(this.relationColumnIndex)||""==this.relationColumnIndex?this.relationColumnIndex=-1:this.relationColumnIndex-=1,""===a&&(a="none");var b=this.dataAdapter.parseColumns(this.sourceColumnIndex-1,this.targetColumnIndex-1,this.relationColumnIndex,a);this.processData(b)}},TextNetworkFileWidget.prototype.processData=function(a){try{this.content=a;for(var b=a.vertices.length,c=a.edges.length,d=a.edges,e=[],f=0;f<d.length;f++){var g=d[f];e.push([g.source.id,g.relation,g.target.id])}this.gridStore.loadData(e),this.infoLabel.setText('<span class="ok">File loaded sucessfully</span>',!1),this.countLabel.setText('Vertices:<span class="info">'+b+'</span> edges:<span class="info">'+c+"</span>",!1)}catch(h){this.infoLabel.setText('<span class="err">File not valid </span>'+h,!1)}this.panel.setLoading(!1)},XLSXNetworkFileWidget.prototype=new NetworkFileWidget,XLSXNetworkFileWidget.prototype.getFileUpload=function(){var a=this;return this.fileUpload=Ext.create("Ext.form.field.File",{msgTarget:"side",allowBlank:!1,emptyText:"XLSX network file",flex:1,buttonText:"Browse local",listeners:{change:function(b,c){a.panel.setLoading(!0);var d=document.getElementById(a.fileUpload.fileInputEl.id).files[0],e=Ext.DomQuery.selectNode("input[id="+b.getInputId()+"]");e.value=c.replace("C:\\fakepath\\",""),a.dataAdapter=new XLSXNetworkDataAdapter({dataSource:new FileDataSource({file:d,type:"binary"}),handlers:{"data:load":function(b){a.processWorkbook(b.sender),a.parsePanel.show()},"error:parse":function(b){a.infoLabel.setText('<span class="err">'+b.errorMsg+"</span>",!1),a.panel.setLoading(!1)}}})}}}),this.fileUpload},XLSXNetworkFileWidget.prototype.addCustomComponents=function(){var a=this;this.sheetCombo=Ext.create("Ext.form.field.ComboBox",{labelAlign:"top",fieldLabel:"Select Sheet",labelWidth:40,store:this.sheetStore,allowBlank:!1,editable:!1,displayField:"name",valueField:"name",queryMode:"local",forceSelection:!0,listeners:{change:function(b){var c=b.getValue();null!=c&&a.processSheet(c)}}}),this.sourceCombo=Ext.create("Ext.form.field.ComboBox",{labelAlign:"top",flex:1,fieldLabel:"Choose source column",emptyText:"Choose column",store:this.columnsNumberStore,allowBlank:!1,editable:!1,displayField:"name",valueField:"num",queryMode:"local",forceSelection:!0,listeners:{change:function(b){var c=b.getValue();console.log(c),null!=c&&(a.sourceColumnIndex=c,a.processColumnNumbers())}}}),this.relationCombo=Ext.create("Ext.form.field.ComboBox",{labelAlign:"top",flex:1,fieldLabel:"Choose relation column",emptyText:"Choose column",store:this.columnsNumberStore,allowBlank:!1,editable:!1,displayField:"name",valueField:"num",queryMode:"local",forceSelection:!0,listeners:{change:function(b){var c=b.getValue();console.log(c),null!=c&&(a.relationColumnIndex=c,a.processColumnNumbers())}}}),this.targetCombo=Ext.create("Ext.form.field.ComboBox",{labelAlign:"top",fieldLabel:"Choose target column",flex:1,emptyText:"Choose column",store:this.columnsNumberStore,allowBlank:!1,editable:!1,displayField:"name",valueField:"num",queryMode:"local",forceSelection:!0,listeners:{change:function(b){var c=b.getValue();console.log(c),null!=c&&(a.targetColumnIndex=c,a.processColumnNumbers())}}}),this.parsePanel=Ext.create("Ext.panel.Panel",{dock:"top",hidden:!0,layout:{type:"vbox",align:"stretch"},bodyPadding:5,items:[{xtype:"container",margin:3,layout:{type:"hbox",align:"stretch"},items:[this.sheetCombo]},{xtype:"container",layout:{type:"hbox",align:"stretch"},defaults:{margin:3},items:[this.sourceCombo,this.relationCombo,this.targetCombo]}]}),this.panel.addDocked(this.parsePanel)},XLSXNetworkFileWidget.prototype.processWorkbook=function(a){var b=[];for(var c in a.xlsx.Sheets)b.push({name:c});this.sheetStore.loadData(b),this.panel.setLoading(!1)},XLSXNetworkFileWidget.prototype.processSheet=function(a){var b=this;this.panel.setLoading(!0),delete this.sourceColumnIndex,delete this.relationColumnIndex,delete this.targetColumnIndex,this.sourceCombo.reset(),this.relationCombo.reset(),this.targetCombo.reset(),this.grid.store.removeAll();var c=this.dataAdapter.parseSheet(a);this.textNetworkDataAdapter=new TextNetworkDataAdapter({dataSource:new StringDataSource(c),separator:",",handlers:{"data:load":function(a){b._processColumns(a.sender)},"error:parse":function(a){b.infoLabel.setText('<span class="err">'+a.errorMsg+"</span>",!1),b.panel.setLoading(!1)}}})},XLSXNetworkFileWidget.prototype._processColumns=function(a){for(var b=[],c=0;c<a.columnLength;c++)b.push({name:"Column "+(c+1),num:c+1});this.columnsNumberStore.loadData(b),delete this.sourceColumnIndex,delete this.relationColumnIndex,delete this.targetColumnIndex,this.sourceCombo.reset(),this.relationCombo.reset(),this.targetCombo.reset(),this.infoLabel.setText('<span class="info">Parse complete',!1),this.panel.setLoading(!1)},XLSXNetworkFileWidget.prototype.processColumnNumbers=function(){if("undefined"!=typeof this.sourceColumnIndex&&"undefined"!=typeof this.relationColumnIndex&&"undefined"!=typeof this.targetColumnIndex){this.panel.setLoading(!0);var a=this.textNetworkDataAdapter.parseColumns(this.sourceColumnIndex-1,this.relationColumnIndex-1,this.targetColumnIndex-1);this.processData(a)}},XLSXNetworkFileWidget.prototype.processData=function(a){try{this.content=a;for(var b=a.vertices.length,c=a.edges.length,d=a.edges,e=[],f=0;f<d.length;f++){var g=d[f];e.push([g.source.id,g.relation,g.target.id])}this.gridStore.loadData(e),this.infoLabel.setText('<span class="ok">File loaded sucessfully</span>',!1),this.countLabel.setText('Vertices:<span class="info">'+b+'</span> edges:<span class="info">'+c+"</span>",!1)}catch(h){this.infoLabel.setText('<span class="err">File not valid </span>'+h,!1)}this.panel.setLoading(!1)},GenericFormPanel.prototype.draw=function(){var a=this;return null==this.panel&&(this.panel="window"==this.type?Ext.create("Ext.window.Window",{title:this.title,closable:this.closable,minimizable:this.minimizable,resizable:this.resizable,layout:"fit",items:{border:0,items:[this.getForm()]},listeners:{minimize:function(){this.hide()},close:function(){this.hide()}}}):Ext.create("Ext.panel.Panel",{title:this.title,closable:this.closable,style:this.style,overflowY:"auto",items:[this.getForm()],border:this.border,bodyPadding:this.bodyPadding,header:this.headerConfig,listeners:{beforeclose:function(){return a.panel.up().remove(a.panel,!1),console.log("closing"),!1}}}),this.panelId=this.panel.getId()),this.panel},GenericFormPanel.prototype.show=function(){"undefined"!=typeof this.panel&&this.panel.show()},GenericFormPanel.prototype.hide=function(){"undefined"!=typeof this.panel&&this.panel.hide()},GenericFormPanel.prototype.getForm=function(){if(null==this.form){var a=this.getPanels();a.push(this.getJobPanel()),this.form=Ext.create("Ext.form.Panel",{border:0,width:this.width,trackResetOnLoad:!0,padding:5,layout:{type:"vbox",align:"stretch"},items:a,bbar:{layout:{pack:"end"},items:[this.getRunButton()]}})}return this.form},GenericFormPanel.prototype.getPanels=function(){},GenericFormPanel.prototype.getJobPanel=function(){this.jobNameField=Ext.create("Ext.form.field.Text",{id:this.id+"jobname",name:"jobname",fieldLabel:"Name",labelWidth:this.labelWidth,emptyText:"Job name",allowBlank:!1}),this.jobDescriptionField=Ext.create("Ext.form.field.TextArea",{id:this.id+"jobdescription",name:"jobdescription",labelWidth:this.labelWidth,fieldLabel:"Description",emptyText:"Description"});var a=(this.createOpencgaBrowserCmp({id:Utils.genId("jobFolder"),fieldLabel:"Folder",dataParamName:"outdir",mode:"folderSelection",defaultFileLabel:"Default job folder",allowBlank:!0}),Ext.create("Ext.panel.Panel",{title:"Job information",header:this.headerFormConfig,border:this.formBorder,bodyPadding:10,defaults:{margin:"5 0 0 0"},buttonAlign:"center",items:[this.jobNameField,this.jobDescriptionField]}));return a},GenericFormPanel.prototype.getRunButton=function(){var a=this;return Ext.create("Ext.button.Button",{text:"Run",width:this.buttonConfig.width,height:this.buttonConfig.height,disabled:!0,cls:"btn btn-default",formBind:!0,handler:function(){a.paramsWS={};var b=a.getForm().getForm().getValues();for(var c in b)a.paramsWS[c]=b[c];a.beforeRun(),a.run()}})},GenericFormPanel.prototype.setAccountParams=function(){this.paramsWS.sessionid=$.cookie("bioinfo_sid"),this.paramsWS.accountid=$.cookie("bioinfo_account")},GenericFormPanel.prototype.beforeRun=function(){},GenericFormPanel.prototype.run=function(){delete this.paramsWS.browseFieldLabel,this.setAccountParams(),""===this.paramsWS.outdir&&delete this.paramsWS.outdir,this.testing?console.log("@@ Watch out!!! testing flag is on, so job will not launched."):(OpencgaManager.runAnalysis({analysis:this.analysis,paramsWS:this.paramsWS,success:this.runAnalysisSuccess}),this.trigger("after:run",{sender:this})),console.log("@@ Form paramsWS"),console.log(this.paramsWS)},GenericFormPanel.prototype.clean=function(){for(var a=this.form.query("field"),b=0;b<a.length;b++){var c=a[b];c.reset()}},GenericFormPanel.prototype.createCombobox=function(a,b,c,d,e,f){return Ext.create("Ext.form.field.ComboBox",{id:a,name:a,fieldLabel:b,store:c,queryMode:"local",displayField:"name",valueField:"value",value:c.getAt(d).get("value"),labelWidth:e,margin:f,editable:!1,allowBlank:!1})},GenericFormPanel.prototype.createCheckBox=function(a,b,c,d,e){return Ext.create("Ext.form.field.Checkbox",{id:a,name:a,boxLabel:b,checked:c||!1,disabled:e,margin:d||"0 0 0 0"})},GenericFormPanel.prototype.createRadio=function(a,b,c,d){var e=Ext.create("Ext.form.field.Radio",{id:a+"_"+this.id,boxLabel:a,inputValue:a,checked:c,name:b,hidden:d});return e},GenericFormPanel.prototype.createLabel=function(a,b){var c=Ext.create("Ext.form.Label",{id:a+"_"+this.id,margin:b||"15 0 0 0",html:'<span class="emph">'+a+"</span>"});return c},GenericFormPanel.prototype.createTextFields=function(a){var b=Ext.create("Ext.form.field.Text",{id:a+"_"+this.id,fieldLabel:a,name:a});return b},GenericFormPanel.prototype.createOpencgaBrowserCmp=function(a){var b=this,c=Ext.create("Ext.form.field.Text",{id:a.id,fieldLabel:a.fieldLabel,labelWidth:b.labelWidth,editable:!1,name:"browseFieldLabel",value:a.defaultFileLabel||"browse file...",allowBlank:a.allowBlank||!1,listeners:{focus:function(){null!=a.beforeClick&&a.beforeClick(a),b.opencgaBrowserWidget.once("select",function(b){"undefined"!=typeof b&&(c.setValue(b.id),d.setValue(b.pathQuery),a.onSelect&&a.onSelect(b))}),b.opencgaBrowserWidget.show({mode:a.mode,allowedTypes:a.allowedTypes})}}}),d=Ext.create("Ext.form.field.Text",{id:a.id+"hidden",editable:!1,hidden:!0,name:a.dataParamName,value:"",allowBlank:a.allowBlank||!1});return Ext.create("Ext.form.FieldContainer",{hidden:a.hidden,items:[c,d]})},HeaderWidget.prototype={render:function(){var a=this,b="";this.applicationMenuEl&&(b='<li id="appMenu" class="menu">&nbsp;<i class="fa fa-chevron-right"></i>&nbsp; <span class="">Menu</span></li>');var c='<div>   <ul class="ocb-header">'+b+'       <li class="title"> &nbsp; '+this.appname+'       </li>       <li id="description" class="description">'+this.description+'       </li>       <li id="support" class="right"><i class="fa fa-support"></i> &nbsp;support        </li>       <li id="signin" class="right"><i class="fa fa-sign-in"></i> &nbsp;sign in       </li>       <li id="jobs" class="right hidden"><i class="fa fa-tasks"></i> &nbsp;jobs       </li>       <li id="profile" class="right hidden"><i class="fa fa-user"></i> &nbsp;profile       </li>       <li id="upload" class="right hidden"><i class="fa fa-cloud-upload"></i> &nbsp;upload & manage       </li>       <li id="logout" class="right hidden"><i class="fa fa-sign-out"></i> &nbsp;logout       </li>       <li id="user" class="right hidden text">       </li>   </ul>',d='   <ul class="ocb-help-menu unselectable">       <li id="homeHelp" class="right"><i class="fa fa-home"></i> &nbsp;home       </li>       <li id="documentation" class="right"><i class="fa fa-book"></i> &nbsp;documentation       </li>       <li id="tutorial" class="right"><i class="fa fa-list-alt"></i> &nbsp;tutorial       </li>       <li id="about" class="right"><i class="fa fa-info"></i> &nbsp; about       </li>   </ul>';this.div=$('<div class="unselectable">'+c+"</div>")[0],$(this.div).css({height:this.height+"px",position:"relative"}),this.supportMenuEl=$(d)[0],$(this.div).append(this.supportMenuEl),this.applicationMenuEl&&$(this.div).append(this.applicationMenuEl);for(var e=$(this.div).find("ul").children(),f=0;f<e.length;f++){var g=e[f].getAttribute("id");g&&(this.els[g]=e[f])}$(this.div).mouseleave(function(){a.toogleSupportMenu(!1)}),$(this.div).click(function(b){$(b.target).attr("id")!==$(a.els.support).attr("id")?a.toogleSupportMenu(!1):a.toogleSupportMenu()}),$(this.els.appMenu).click(function(){a.toogleAppMenu()}),$(this.els.homeHelp).click(function(){window.location.href=a.homeLink}),$(this.els.documentation).click(function(){window.open(a.helpLink)}),$(this.els.tutorial).click(function(){window.open(a.tutorialLink)}),$(this.els.about).click(function(){a.trigger("about:click",{sender:a})}),$(this.els.signin).click(function(){a.loginWidget.show()}),$(this.els.logout).click(function(){OpencgaManager.logout({accountId:$.cookie("bioinfo_account"),sessionId:$.cookie("bioinfo_sid"),success:a.logoutSuccess,error:a.logoutSuccess})}),$(this.els.profile).click(function(){a.profileWidget.show()}),$(this.els.upload).click(function(){a.opencgaBrowserWidget.show({mode:"manager"})}),$(this.els.jobs).click(function(){a.trigger("jobs:click",{sender:a})}),this.logoutSuccess=function(b){console.log(b),$.cookie("bioinfo_sid",null),$.cookie("bioinfo_sid",null,{path:"/"}),$.cookie("bioinfo_account",null),$.cookie("bioinfo_account",null,{path:"/"}),a.sessionFinished(),a.trigger("logout",{sender:this})},this.getAccountInfoSuccess=function(b){null!=b.accountId&&(a.setAccountData(b),a.trigger("account:change",{sender:this,response:b}),console.log("accountData has been modified since last call"))},this.loginWidget=this._createLoginWidget(),this.profileWidget=this._createProfileWidget(),this.opencgaBrowserWidget=this._createOpencgaBrowserWidget(),this.rendered=!0},draw:function(){return this.targetDiv=this.target instanceof HTMLElement?this.target:document.querySelector("#"+this.target),this.targetDiv?(this.targetDiv.appendChild(this.div),this.loginWidget.draw(),this.profileWidget.draw(),this.opencgaBrowserWidget.draw(),void(null!=$.cookie("bioinfo_sid")?this.sessionInitiated():this.sessionFinished())):void console.log("target not found")},getHeight:function(){return this.height},toogleAppMenu:function(a){this.applicationMenuEl&&(a===!0?($(this.applicationMenuEl).addClass("ocb-app-menu-shown"),$(this.els.appMenu).children("i").removeClass("fa-chevron-right"),$(this.els.appMenu).children("i").addClass("fa-chevron-left")):a===!1?($(this.applicationMenuEl).removeClass("ocb-app-menu-shown"),$(this.els.appMenu).children("i").addClass("fa-chevron-right"),$(this.els.appMenu).children("i").removeClass("fa-chevron-left")):($(this.applicationMenuEl).toggleClass("ocb-app-menu-shown"),$(this.els.appMenu).children("i").toggleClass("fa-chevron-right"),$(this.els.appMenu).children("i").toggleClass("fa-chevron-left")))},toogleSupportMenu:function(a){this.supportMenuEl&&(a===!0?$(this.supportMenuEl).addClass("ocb-help-menu-shown"):a===!1?$(this.supportMenuEl).removeClass("ocb-help-menu-shown"):$(this.supportMenuEl).toggleClass("ocb-help-menu-shown"))},_createLoginWidget:function(){var a=this,b=new LoginWidget({suiteId:this.suiteId,autoRender:!0,handlers:{"session:initiated":function(){a.sessionInitiated(),a.trigger("login",{sender:this})}}});return b},_createProfileWidget:function(){var a=new ProfileWidget({autoRender:!0});return a},_createOpencgaBrowserWidget:function(){var a=this,b=new OpencgaBrowserWidget({suiteId:this.suiteId,chunkedUpload:this.chunkedUpload,enableTextModeUW:this.enableTextModeUW,autoRender:!0,handlers:{"need:refresh":function(){a.getAccountInfo()}}});return b},setAccountData:function(a){this.accountData=a,this.opencgaBrowserWidget.setAccountData(a),$(this.els.user).html(this._getAccountText())},getAccountInfo:function(){var a=null;null!=this.accountData&&(a=this.accountData.lastActivity),$.cookie("bioinfo_account")?OpencgaManager.getAccountInfo({accountId:$.cookie("bioinfo_account"),sessionId:$.cookie("bioinfo_sid"),lastActivity:a,success:this.getAccountInfoSuccess,error:this.logoutSuccess}):(console.log("cookie: bioinfo_account, is not set, session will be finished..."),this.sessionFinished())},_getAccountText:function(){var a=this.accountData.accountId;return-1!=a.indexOf("anonymous_")&&(a="anonymous"),'logged in as <span style="color:darkred">'+a+"</span>"},sessionInitiated:function(){var a=this;this.loginWidget.hide(),$(this.els.signin).addClass("hidden"),$(this.els.logout).removeClass("hidden"),$(this.els.profile).removeClass("hidden"),$(this.els.upload).removeClass("hidden"),$(this.els.user).removeClass("hidden"),$(this.els.jobs).removeClass("hidden"),this.accountInfoInterval||(this.getAccountInfo(),this.accountInfoInterval=setInterval(function(){a.getAccountInfo()},this.checkTimeInterval))},sessionFinished:function(){$(this.els.logout).addClass("hidden"),$(this.els.profile).addClass("hidden"),$(this.els.upload).addClass("hidden"),$(this.els.user).addClass("hidden"),$(this.els.jobs).addClass("hidden"),$(this.els.signin).removeClass("hidden"),$(this.els.user).html(""),$(this.els.user).removeClass("hidden"),clearInterval(this.accountInfoInterval),delete this.accountInfoInterval,this.profileWidget.hide(),this.opencgaBrowserWidget.hide(),this.opencgaBrowserWidget.removeAccountData()},setDescription:function(a){$(this.els.description).html(a)},setWidth:function(a){this.width=a}},JobListWidget.prototype={render:function(){this.div=$("<div></div>")[0],this.panel=this._createPanel()},draw:function(){return this.targetDiv=this.target instanceof HTMLElement?this.target:document.querySelector("#"+this.target),this.targetDiv?(this.targetDiv.appendChild(this.div),void this.panel.render(this.div)):void console.log("target not found")},show:function(){this.panel.show()},hide:function(){this.panel.hide()},toggle:function(){this.panel.isVisible()?this.panel.hide():this.panel.show()},setAccountData:function(a){this.accountData=a;for(var b,c=[],d=0;d<this.accountData.projects.length;d++)for(var e=0;e<this.accountData.projects[d].jobs.length;e++)b=this.accountData.projects[d].jobs[e],"undefined"!=typeof this.tools[b.toolName]&&(b.date=Utils.parseDate(b.date),c.push(b));this.store.loadData(c),this._updateButtons(c)},_createPanel:function(){var a=this,b=new Ext.XTemplate(['<tpl for=".">','<div class="ocb-job-list-widget-item">','<div style="color:#596F8F">{[ this.getNewIcon(values) ]} {name}</div>','<div> <span class="{[ this.getClass(values) ]}">{toolName}{execution} </span> </div>','<div><span style="color: {[ this.getStatusColor(values) ]};">{status}</span> <span style="color: dimgray;font-size:12px;"> &nbsp; &nbsp; {date} </span> </div>',"</div>","</tpl>",{getStatusColor:function(b){var c="#000000";switch(b.status){case"running":c=a.RUNING_COLOR;break;case"finished":c=a.FINISHED_COLOR;break;case"queued":c=a.QUEUED_COLOR;break;case"execution_error":case"queue_error":c=a.ERROR_COLOR}return c}},{getNewIcon:function(b){var c="";switch(0===b.visites&&(c+='<i style="color:'+a.FINISHED_COLOR+'" class="fa fa-exclamation-circle"></i> '),b.status){case"running":c+='<i style="color:'+a.RUNING_COLOR+'" class="fa fa-cog"></i>';break;case"queued":c+='<i style="color:'+a.QUEUED_COLOR+'" class="fa fa-clock-o"></i>';break;case"finished":c+='<i style="color:'+a.FINISHED_COLOR+'" class="fa fa-check-circle"></i>';break;case"execution_error":case"queue_error":c+='<i style="color:'+a.ERROR_COLOR+'" class="fa fa-times-circle"></i>'}return c}},{getClass:function(a){return a.toolName.replace(".","_")}}]);this.store=Ext.create("Ext.data.Store",{fields:["commandLine","date","description","diskUsage","status","finishTime","inputData","jobId","message","name","outputData","ownerId","percentage","projectId","toolName","visites"],sorters:[{property:"date",direction:"DESC"}],autoLoad:!1});var c=Ext.create("Ext.view.View",{padding:15,store:this.store,tpl:b,trackOver:!0,autoScroll:!0,overItemCls:"ocb-job-list-widget-item-hover",itemSelector:".ocb-job-list-widget-item",listeners:{itemclick:function(b,c){console.log(c.data),console.log(c.data.id),a.trigger("item:click",{sender:a,item:c})},itemcontextmenu:function(b,c,d,e,f){f.stopEvent();var g={sender:a,record:c,originalEvent:f};return a._itemContextMenuHandler(g),a.trigger("item:contextmenu",g),!1}}});this.searchField=Ext.create("Ext.form.field.Text",{id:this.id+"searchField",emptyText:"enter search term",enableKeyEvents:!0,flex:1,listeners:{change:function(){a._setFilters()}}}),this.btnAllId=this.id+"_btnAll",this.btnFinishedId=this.id+"_btnFinished",this.btnVisitedId=this.id+"_btnVisited",this.btnRunningId=this.id+"_btnRunning",this.btnQueuedId=this.id+"_btnQueued",this.btnErrorId=this.id+"_btnError";var d=Ext.create("Ext.panel.Panel",{height:this.height,width:this.width,layout:"fit",items:[c],dockedItems:[{xtype:"toolbar",dock:"top",height:39,items:[{xtype:"button",id:this.id+"btnSort",tooltip:"Change order",margin:"0 15 0 0",text:'<i class="fa fa-sort"></i>',handler:function(){"DESC"==a.sort?(a.sort="ASC",a.store.sort("date","ASC")):(a.sort="DESC",a.store.sort("date","DESC"))}},this.searchField,{xtype:"button",id:this.id+"btnClear",text:"Clear",tooltip:"Clear search box",handler:function(){a.searchField.reset()}}]},{xtype:"toolbar",docked:"top",height:39,items:[{id:this.btnAllId,text:" ",tooltip:"Total jobs",handler:function(){a._setButtonFilterFunction(this)}},{id:this.btnFinishedId,text:" ",tooltip:"Finished jobs",handler:function(){a._setButtonFilterFunction(this)}},{id:this.btnVisitedId,text:" ",tooltip:"Visited jobs",handler:function(){a._setButtonFilterFunction(this)}},{id:this.btnRunningId,text:" ",tooltip:"Running jobs",handler:function(){a._setButtonFilterFunction(this)}},{id:this.btnQueuedId,text:" ",tooltip:"Queued jobs",handler:function(){a._setButtonFilterFunction(this)}},{id:this.btnErrorId,text:" ",tooltip:"Error jobs",handler:function(){a._setButtonFilterFunction(this)}}]}]});return d},_setButtonFilterFunction:function(a){switch(a.id){case this.btnFinishedId:this.buttonFilterFunction=function(a){return 0==a.data.visites};break;case this.btnVisitedId:this.buttonFilterFunction=function(a){return a.data.visites>0&&-1===a.data.status.indexOf("error")};break;case this.btnRunningId:this.buttonFilterFunction=function(a){return-1==a.data.visites};break;case this.btnQueuedId:this.buttonFilterFunction=function(a){return-2==a.data.visites};break;case this.btnErrorId:this.buttonFilterFunction=function(a){return-1!=a.data.status.indexOf("error")};break;default:this.buttonFilterFunction=null}this._setFilters()},_setFilters:function(){this.store.clearFilter(),this.store.addFilter("function"==typeof this.buttonFilterFunction?[this.buttonFilterFunction,this.textFilterFunction]:this.textFilterFunction)},_updateButtons:function(a){var b=this._getJobCounter(a);0==b.all?Ext.getCmp(this.btnAllId).hide():Ext.getCmp(this.btnAllId).show(),0==b.finished?Ext.getCmp(this.btnFinishedId).hide():Ext.getCmp(this.btnFinishedId).show(),0==b.visited?Ext.getCmp(this.btnVisitedId).hide():Ext.getCmp(this.btnVisitedId).show(),0==b.running?Ext.getCmp(this.btnRunningId).hide():Ext.getCmp(this.btnRunningId).show(),0==b.queued?Ext.getCmp(this.btnQueuedId).hide():Ext.getCmp(this.btnQueuedId).show(),0==b.error?Ext.getCmp(this.btnErrorId).hide():Ext.getCmp(this.btnErrorId).show(),Ext.getCmp(this.btnAllId).setText(b.all),Ext.getCmp(this.btnFinishedId).setText('<i style="color:'+this.FINISHED_COLOR+'" class="fa fa-exclamation-circle"></i> '+b.finished),Ext.getCmp(this.btnVisitedId).setText('<i style="color:'+this.FINISHED_COLOR+'" class="fa fa-check-circle"></i> '+b.visited),Ext.getCmp(this.btnRunningId).setText('<i style="color:'+this.RUNING_COLOR+'" class="fa fa-cog"></i> '+b.running),Ext.getCmp(this.btnQueuedId).setText('<i style="color:'+this.QUEUED_COLOR+'" class="fa fa-clock-o"></i> '+b.queued),Ext.getCmp(this.btnErrorId).setText('<i style="color:'+this.ERROR_COLOR+'" class="fa fa-times-circle"></i> '+b.error)},_getJobCounter:function(a){for(var b=0,c=0,d=0,e=0,f=0,g=0;g<a.length;g++){var h=a[g];h.visites>0?-1!=h.status.indexOf("error")?f++:c++:(0==h.visites&&(-1!=h.status.indexOf("error")?f++:b++),-1==h.visites&&d++,-2==h.visites&&e++)}return{all:a.length,visited:c,finished:b,running:d,queued:e,error:f}},_itemContextMenuHandler:function(a){var b=a.record,c=Ext.create("Ext.menu.Menu",{plain:!0,items:[{text:"Delete Job",icon:Utils.images.del,handler:function(){b&&Ext.Msg.confirm("Delete job","Are you sure you want to delete this job?",function(a){"yes"==a&&OpencgaManager.deleteJob({accountId:$.cookie("bioinfo_account"),sessionId:$.cookie("bioinfo_sid"),jobId:b.data.id,success:function(a){""===a.errorMsg?Utils.msg("Delete job",'</span class="emph">'+a.result[0].msg+"</span>"):Ext.Msg.alert("Delete job, try again later.",a.errorMsg)}})})}}]});c.showAt(a.originalEvent.getXY())}},LoginWidget.prototype={show:function(){this.panel.show()},hide:function(){this.panel.hide(),this.ShowBack()},render:function(){var a=this;this.loginSuccess=function(b){if(null!=a.panel&&a.panel.setLoading(!1),console.log(b),""===b.errorMsg){var c=b.result[0];$.cookie("bioinfo_sid",c.sessionId),$.cookie("bioinfo_account",c.accountId),$.cookie("bioinfo_bucket",c.bucketId),a.trigger("session:initiated",{sender:a})}else Ext.getCmp(a.labelEmailId).setText('<span class="err">'+b.errorMsg+"</span>",!1),$.cookie("bioinfo_sid",null),$.cookie("bioinfo_sid",null,{path:"/"}),$.cookie("bioinfo_account",null),$.cookie("bioinfo_account",null,{path:"/"})},this.createAccountSuccess=function(b){if(a.panel.setLoading(!1),""===b.errorMsg){var c=b.result[0].accountId;Ext.getCmp(a.labelEmailId).setText('<span class="ok">'+c+" account created</span>",!1)}else Ext.getCmp(a.labelEmailId).setText('<span class="err">'+b.errorMsg+"</span>",!1),$.cookie("bioinfo_sid",null),$.cookie("bioinfo_sid",null,{path:"/"}),$.cookie("bioinfo_account",null),$.cookie("bioinfo_account",null,{path:"/"})},this.resetPasswordSuccess=function(b){a.panel.setLoading(!1),""===b.errorMsg?Ext.getCmp(a.labelEmailId).setText('<span class="emph">'+b.result[0].msg+"</span>",!1):Ext.getCmp(a.labelEmailId).setText('<span class="err">'+b.errorMsg+"</span>",!1)},this.labelEmailId=this.id+"labelEmail",this.labelPassId=this.id+"labelPass",this.fldEmailId=this.id+"fldEmail",this.fldPasswordId=this.id+"fldPassword",this.fldNpass1Id=this.id+"fldNpass1",this.fldNpass2Id=this.id+"fldNpass2",this.btnSignId=this.id+"fldSign",this.btnAnonymousId=this.id+"btnAnonymous",this.btnForgotId=this.id+"btnForgot",this.btnNewaccId=this.id+"btnNewacc",this.btnSendId=this.id+"btnSend",this.btnBackId=this.id+"btnBack",this.btnRegisterId=this.id+"btnRegister",this.rendered=!0
},draw:function(){return this.rendered?void(this.panel=this._createPanel(this.targetId)):void console.info("Login Widget is not rendered yet")},_createPanel:function(){var a=this,b=Ext.create("Ext.toolbar.TextItem",{id:this.labelEmailId,padding:3,text:'<span class="info">Type your account ID and password</span>'}),c=Ext.create("Ext.form.Panel",{id:this.id+"formPanel",bodyPadding:20,height:225,width:350,border:0,bbar:{items:[b]},items:[{id:this.id+"accountId",xtype:"textfield",value:$.cookie("bioinfo_user"),fieldLabel:"account ID",hidden:!1,listeners:{scope:this,change:this.checkAccountId}},{id:this.fldPasswordId,xtype:"textfield",fieldLabel:"password",inputType:"password",listeners:{specialkey:function(b,c){c.getKey()==c.ENTER&&a.sign()}}},{id:this.fldEmailId,xtype:"textfield",fieldLabel:"e-mail",hidden:!0,listeners:{change:function(){a.checkemail()},specialkey:function(b,c){c.getKey()==c.ENTER&&a.sign()}}},{id:this.id+"accountName",xtype:"textfield",fieldLabel:"name",hidden:!0,listeners:{scope:this,change:this.checkName}},{id:this.fldNpass1Id,xtype:"textfield",fieldLabel:"password",inputType:"password",hidden:!0,listeners:{scope:this,change:this.checkpass}},{id:this.fldNpass2Id,xtype:"textfield",fieldLabel:"re-password",inputType:"password",hidden:!0,listeners:{scope:this,change:this.checkpass}},{id:this.btnAnonymousId,xtype:"checkboxfield",padding:"10 0 0 0",boxLabel:'Anonymous login <p class="tip s90">Your work will be lost after logout</p>',margin:"0 0 0 50",listeners:{change:function(b,c){c?(Ext.getCmp(a.id+"accountId").disable(),Ext.getCmp(a.fldPasswordId).disable()):(Ext.getCmp(a.id+"accountId").enable(),Ext.getCmp(a.fldPasswordId).enable())}}}]}),d=Ext.create("Ext.window.Window",{id:this.id+"windowPanel",title:"Sign in",resizable:!1,minimizable:!0,constrain:!0,closable:!1,modal:!0,items:{border:0,layout:{type:"vbox",align:"stretch"},items:[c],bbar:{layout:{pack:"center"},items:[{id:this.btnSignId,text:"Sign in"},{id:this.btnForgotId,text:"Forgot yout password?"},{id:this.btnNewaccId,text:"New account"},{id:this.btnSendId,text:"Send",hidden:!0},{id:this.btnRegisterId,text:"Register",hidden:!0},{id:this.btnBackId,text:"Back",hidden:!0}]}},listeners:{minimize:function(){a.panel.hide()}}});return Ext.getCmp(this.btnForgotId).on("click",this.ShowForgot,this),Ext.getCmp(this.btnBackId).on("click",this.ShowBack,this),Ext.getCmp(this.btnNewaccId).on("click",this.ShowNewacc,this),Ext.getCmp(this.btnSignId).on("click",this.sign,this),Ext.getCmp(this.btnSendId).on("click",this.sendRecover,this),Ext.getCmp(this.btnRegisterId).on("click",this.register,this),Ext.getCmp(this.btnAnonymousId).on("change",this.anonymousSelected,this),d}},LoginWidget.prototype.sign=function(){Ext.getCmp(this.btnAnonymousId).getValue()?(this.anonymousSign(),this.panel.setLoading("Waiting server...")):this.checkAccountId()&&(OpencgaManager.login({accountId:this.getLogin(),password:this.getPassword(),suiteId:this.suiteId,success:this.loginSuccess}),this.panel.setLoading("Waiting server..."),$.cookie("bioinfo_user",null,{path:"/"}),$.cookie("bioinfo_user",this.getLogin(),{expires:7}))},LoginWidget.prototype.anonymousSign=function(){OpencgaManager.login({accountId:"anonymous",password:"",suiteId:this.suiteId,success:this.loginSuccess})},LoginWidget.prototype.register=function(){this.checkAccountId()&&this.checkemail()&&this.checkName()&&this.checkpass()?OpencgaManager.createAccount({accountId:this.getLogin(),email:this.getEmail(),name:this.getAccountName(),password:this.getPasswordReg(),suiteId:this.suiteId,success:this.createAccountSuccess}):Ext.getCmp(this.labelEmailId).setText('<span class="info">Fill all fields</span>',!1)},LoginWidget.prototype.sendRecover=function(){this.checkAccountId()&&this.checkemail()&&(OpencgaManager.resetPassword({accountId:this.getLogin(),email:this.getEmail(),success:this.resetPasswordSuccess}),this.panel.setLoading("Waiting server..."))},LoginWidget.prototype.getLogin=function(){return Ext.getCmp(this.id+"accountId").getValue()},LoginWidget.prototype.getAccountName=function(){return Ext.getCmp(this.id+"accountName").getValue()},LoginWidget.prototype.getEmail=function(){return Ext.getCmp(this.fldEmailId).getValue()},LoginWidget.prototype.getPassword=function(){return $.sha1(Ext.getCmp(this.fldPasswordId).getValue())},LoginWidget.prototype.getPasswordReg=function(){return $.sha1(Ext.getCmp(this.fldNpass1Id).getValue())},LoginWidget.prototype.ShowForgot=function(){Ext.getCmp(this.fldEmailId).reset(),Ext.getCmp(this.fldEmailId).show(),Ext.getCmp(this.fldPasswordId).reset(),Ext.getCmp(this.btnAnonymousId).reset(),Ext.getCmp(this.fldNpass1Id).reset(),Ext.getCmp(this.fldNpass2Id).reset(),Ext.getCmp(this.fldPasswordId).hide(),Ext.getCmp(this.btnAnonymousId).hide(),Ext.getCmp(this.fldNpass1Id).hide(),Ext.getCmp(this.fldNpass2Id).hide(),Ext.getCmp(this.btnSignId).hide(),Ext.getCmp(this.btnForgotId).hide(),Ext.getCmp(this.btnNewaccId).hide(),Ext.getCmp(this.btnSendId).show(),Ext.getCmp(this.btnBackId).show(),Ext.getCmp(this.btnRegisterId).hide(),Ext.getCmp(this.id+"accountId").reset(),Ext.getCmp(this.id+"accountName").hide(),Ext.getCmp(this.labelEmailId).setText('<span class="info">Type your account ID and email to send a new password</span>',!1),Ext.getCmp(this.id+"accountId").setFieldLabel("account ID",!1),Ext.getCmp(this.fldEmailId).setFieldLabel("e-mail",!1)},LoginWidget.prototype.ShowBack=function(){Ext.getCmp(this.fldEmailId).hide(),Ext.getCmp(this.fldPasswordId).reset(),Ext.getCmp(this.btnAnonymousId).reset(),Ext.getCmp(this.fldNpass1Id).reset(),Ext.getCmp(this.fldNpass2Id).reset(),Ext.getCmp(this.fldPasswordId).show(),Ext.getCmp(this.btnAnonymousId).show(),Ext.getCmp(this.fldNpass1Id).hide(),Ext.getCmp(this.fldNpass2Id).hide(),Ext.getCmp(this.btnSignId).show(),Ext.getCmp(this.btnForgotId).show(),Ext.getCmp(this.btnNewaccId).show(),Ext.getCmp(this.btnSendId).hide(),Ext.getCmp(this.btnBackId).hide(),Ext.getCmp(this.btnRegisterId).hide(),Ext.getCmp(this.id+"accountId").reset(),Ext.getCmp(this.id+"accountName").hide(),Ext.getCmp(this.labelEmailId).setText('<span class="info">Type your account ID and password</span>',!1),Ext.getCmp(this.id+"accountId").setFieldLabel("account ID",!1)},LoginWidget.prototype.ShowNewacc=function(){Ext.getCmp(this.fldEmailId).reset(),Ext.getCmp(this.fldEmailId).show(),Ext.getCmp(this.fldPasswordId).reset(),Ext.getCmp(this.btnAnonymousId).reset(),Ext.getCmp(this.fldNpass1Id).reset(),Ext.getCmp(this.fldNpass2Id).reset(),Ext.getCmp(this.fldPasswordId).hide(),Ext.getCmp(this.btnAnonymousId).hide(),Ext.getCmp(this.fldNpass1Id).show(),Ext.getCmp(this.fldNpass2Id).show(),Ext.getCmp(this.btnSignId).hide(),Ext.getCmp(this.btnForgotId).hide(),Ext.getCmp(this.btnNewaccId).hide(),Ext.getCmp(this.btnSendId).hide(),Ext.getCmp(this.btnBackId).show(),Ext.getCmp(this.btnRegisterId).show(),Ext.getCmp(this.id+"accountId").reset(),Ext.getCmp(this.id+"accountName").reset(),Ext.getCmp(this.id+"accountName").show(),Ext.getCmp(this.labelEmailId).setText("&nbsp;",!1),Ext.getCmp(this.id+"accountName").setFieldLabel("name",!1),Ext.getCmp(this.id+"accountId").setFieldLabel("account ID",!1),Ext.getCmp(this.fldEmailId).setFieldLabel("e-mail",!1),Ext.getCmp(this.fldNpass1Id).setFieldLabel("password",!1),Ext.getCmp(this.fldNpass2Id).setFieldLabel("re-password",!1),Ext.getCmp(this.id+"accountId").setValue("")},LoginWidget.prototype.checkpass=function(){var a=Ext.getCmp(this.fldNpass1Id).getValue(),b=Ext.getCmp(this.fldNpass2Id).getValue(),c=new RegExp("[ *]");return!c.test(a)&&a.length>3?a==b?(Ext.getCmp(this.fldNpass1Id).setFieldLabel('<span class="ok">password</span>',!1),Ext.getCmp(this.fldNpass2Id).setFieldLabel('<span class="ok">re-password</span>',!1),Ext.getCmp(this.labelEmailId).setText("&nbsp;",!1),!0):(Ext.getCmp(this.fldNpass1Id).setFieldLabel('<span class="err">password</span>',!1),Ext.getCmp(this.fldNpass2Id).setFieldLabel('<span class="err">re-password</span>',!1),Ext.getCmp(this.labelEmailId).setText('<span class="err">Password does not match</span>',!1),!1):(Ext.getCmp(this.fldNpass1Id).setFieldLabel('<span class="err">password</span>',!1),Ext.getCmp(this.fldNpass2Id).setFieldLabel('<span class="err">re-password</span>',!1),Ext.getCmp(this.labelEmailId).setText('<span class="err">Password minimum length is 4</span>',!1),!1)},LoginWidget.prototype.anonymousSelected=function(a,b){b?Ext.getCmp(this.labelEmailId).setText('<span class="ok">Anonymous selected</span>',!1):Ext.getCmp(this.labelEmailId).setText('<span class="info">Type your account ID and password</span>',!1)},LoginWidget.prototype.checkemail=function(){Ext.getCmp(this.btnAnonymousId).reset();var a=Ext.getCmp(this.fldEmailId).getValue(),b=/^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/;return b.test(a)?(Ext.getCmp(this.fldEmailId).setFieldLabel('<span class="ok">e-mail</span>',!1),!0):(Ext.getCmp(this.fldEmailId).setFieldLabel('<span class="err">e-mail</span>',!1),!1)},LoginWidget.prototype.checkName=function(){var a=Ext.getCmp(this.id+"accountName").getValue();return""!=a&&null!=a?(Ext.getCmp(this.id+"accountName").setFieldLabel('<span class="ok">name</span>',!1),!0):(Ext.getCmp(this.id+"accountName").setFieldLabel('<span class="err">name</span>',!1),!1)},LoginWidget.prototype.checkAccountId=function(){var a=Ext.getCmp(this.id+"accountId").getValue();return""!=a&&null!=a?(Ext.getCmp(this.id+"accountId").setFieldLabel('<span class="ok">account ID</span>',!1),!0):(Ext.getCmp(this.id+"accountId").setFieldLabel('<span class="err">account ID</span>',!1),!1)},OpencgaBrowserWidget.prototype={show:function(a){_.isUndefined(a)||(this.mode=a.mode,this.allowedTypes=a.allowedTypes),console.log(this.mode),console.log(this.allowedTypes),this.panel.show()},hide:function(){this.panel.hide()},render:function(){this.searchFieldId=this.id+"_searchField",this.rendered=!0},draw:function(){return this.rendered?(this.uploadWidget=this._createUploadWidget(),void(this.panel=this._createPanel(this.targetId))):void console.info("Login Widget is not rendered yet")},_createUploadWidget:function(){var a=this,b=new UploadWidget({suiteId:this.suiteId,opencgaBrowserWidget:this,chunkedUpload:this.chunkedUpload,enableTextMode:this.enableTextModeUW,handlers:{"object:upload":function(b){"done"==b.data.status&&a.trigger("need:refresh",{sender:a})}}});return b},_createPanel:function(){var a=this;this.filesStore=Ext.create("Ext.data.Store",{fields:["oid","fileBioType","fileType","fileFormat","fileName","multiple","diskUsage","creationTime","responsible","organization","date","description","status","statusMessage","members"],data:[]}),this.refreshBucketAction=Ext.create("Ext.Action",{icon:Utils.images.refresh,text:"Refresh bucket",handler:function(){var b=a.folderTree.getSelectionModel().getSelection()[0];b&&b.data.isBucket&&OpencgaManager.refreshBucket({accountId:$.cookie("bioinfo_account"),bucketId:b.data.text,sessionId:$.cookie("bioinfo_sid"),success:function(b){""===b.errorMsg?(Utils.msg("Refresh Bucket",'</span class="emph">'+b.result[0].msg+"</span>"),a.trigger("need:refresh",{sender:a})):Ext.Msg.alert("Refresh bucket",b.errorMsg)}})}}),this.renameBucketAction=Ext.create("Ext.Action",{text:"Rename bucket",handler:function(){var b=a.folderTree.getSelectionModel().getSelection()[0];b&&b.data.isBucket&&Ext.Msg.prompt("Rename bucket","Please enter a new name:",function(c,d){"ok"==c&&(d=d.replace(/[^a-z0-9-_.\/\s]/gi,"").trim(),OpencgaManager.renameBucket({accountId:$.cookie("bioinfo_account"),bucketId:b.data.bucketId,newBucketId:d,sessionId:$.cookie("bioinfo_sid"),success:function(b){""===b.errorMsg?(a.trigger("need:refresh",{sender:a}),Utils.msg("Rename bucket",'</span class="emph">'+b.result[0].msg+"</span>")):Ext.Msg.alert("Rename bucket",b.errorMsg)}}))},null,null,"new name")}});var b=Ext.create("Ext.Action",{icon:Utils.images.info,text:"Create index",handler:function(){var b=a.filesGrid.getSelectionModel().getSelection()[0];b&&OpencgaManager.indexer({accountId:$.cookie("bioinfo_account"),sessionId:$.cookie("bioinfo_sid"),bucketId:b.data.bucketId,objectId:b.data.oid,success:function(a){console.log(a),Utils.msg("indexer",a),b.data.indexerId=a}})}}),c=(Ext.create("Ext.Action",{text:"Show name",handler:function(){var b=a.filesGrid.getSelectionModel().getSelection()[0];b&&Utils.msg("objectId",""+b.get("oid"))}}),Ext.create("Ext.Action",{icon:Utils.images.del,text:"Delete this file",handler:function(){var b=a.filesGrid.getSelectionModel().getSelection()[0];b&&Ext.MessageBox.confirm("Confirm",'Are you sure you want to delete this file?<p class="emph">'+b.data.fileName+"<p>",function(c){"yes"==c&&(console.log("deleting"),OpencgaManager.deleteObjectFromBucket({accountId:$.cookie("bioinfo_account"),sessionId:$.cookie("bioinfo_sid"),bucketId:b.data.bucketId,objectId:b.data.oid,success:function(c){""===c.errorMsg?(Utils.msg("Deleting",'</span class="emph">'+c.result[0].msg+"</span>"),a.filesGrid.store.remove(b)):Ext.Msg.alert("Deleting",c.errorMsg)}}))})}}));this.filesGrid=Ext.create("Ext.grid.Panel",{store:this.filesStore,flex:3,border:!1,viewConfig:{listeners:{itemcontextmenu:function(a,d,e,f,g){g.stopEvent();var h=[];console.log(d),("bam"==d.data.fileFormat||"vcf"==d.data.fileFormat)&&h.push(b),h.push(c);var i=Ext.create("Ext.menu.Menu",{plain:!0,items:h});return i.showAt(g.getXY()),!1}}},selModel:{mode:"SINGLE",listeners:{selectionchange:function(b,c){if(a.selectButton.disable(),c.length>0){a.selectedFileNode=c[0].data;var d=c[0].data.fileType,e=c[0].data.fileFormat;if("fileSelection"===a.mode&&"dir"===d)return;if(console.log(a.allowedTypes),"undefined"!=typeof a.allowedTypes&&-1==a.allowedTypes.indexOf(e))return a.selectButton.disable(),void console.log("file format NOT allowed -"+e+"- ");if("folderSelection"===a.mode&&"dir"!==d)return;console.log("file format allowed -"+e+"- "),a.selectButton.enable()}else a.selectButton.disable()}}},columns:[{text:"File type",xtype:"actioncolumn",menuDisabled:!0,align:"center",width:54,icon:Utils.images.bluebox,renderer:function(a,b,c){this.icon=Utils.images[c.data.fileType],this.tooltip=c.data.fileType}},{text:"Name",dataIndex:"fileName",flex:2},{text:"Creation time",dataIndex:"creationTime",flex:1}]}),this.container=Ext.create("Ext.panel.Panel",{title:" ",border:!1,minWidth:125,flex:3,layout:{type:"hbox",align:"stretch"},items:[this.folderTree,this.filesGrid]}),this.selectButton=Ext.create("Ext.button.Button",{text:"Ok",disabled:!0,handler:function(){var b=a.selectedFileNode.oid.replace(/\//g,":");a.trigger("select",{id:a.selectedFileNode.oid,idQuery:b,pathQuery:"buckets:"+a.selectedFileNode.bucketId+":"+b,path:"buckets/"+a.selectedFileNode.bucketId+"/"+a.selectedFileNode.oid,bucketId:a.selectedFileNode.bucketId}),a.panel.hide()}}),this.activeUploadsCont=Ext.create("Ext.panel.Panel",{title:"Active uploads",animCollapse:!1,hidden:!0,bodyPadding:"10 0 10 0",autoScroll:!0,height:125,border:0,cls:"ocb-border-top-lightgrey",items:[]});var d={items:[]};switch(this.mode){case"folderSelection":var e;e={text:"New folder",handler:function(){a.createFolder()}},d.items.splice(0,0,e),e={text:"New bucket",handler:function(){a.createBucket()}},d.items.splice(0,0,e),this.filesStore.filter("fileType",/dir/);break;case"manager":var e;e={text:"Upload local file",handler:function(){a.drawUploadWidget()}},d.items.splice(0,0,e),e={text:"New folder",handler:function(){a.createFolder()}},d.items.splice(0,0,e),e={text:"New bucket",handler:function(){a.createBucket()}},d.items.splice(0,0,e),this.selectButton.hide();break;default:var e;e={text:"Upload local file",handler:function(){a.drawUploadWidget()}},d.items.push(e),e={text:"New folder",handler:function(){a.createFolder()}},d.items.push(e),e={text:"New bucket",handler:function(){a.createBucket()}},d.items.push(e)}1==this.chunkedUpload&&d.items.push({id:this.id+"activeUploadsButton",text:"Active uploads",enableToggle:!0,pressed:!1,toggleHandler:function(){this.pressed?a.activeUploadsCont.show():a.activeUploadsCont.hide()}});var f=Ext.create("Ext.window.Window",{title:"Upload & Manage",resizable:!1,minimizable:!0,constrain:!0,closable:!1,modal:!0,height:this.height,minHeight:this.height,width:this.width,minWidth:this.width,resizable:!0,layout:"fit",items:{border:0,layout:{type:"vbox",align:"stretch"},items:[this.container,this.activeUploadsCont],tbar:d,bbar:{layout:{pack:"end"},defaults:{width:100},items:[{text:"Close",handler:function(){a.filesGrid.getSelectionModel().deselectAll(),a.trigger("select"),a.panel.hide()}},this.selectButton]}},listeners:{scope:this,minimize:function(){this.panel.hide()},destroy:function(){delete this.panel}}});return this._updateFolderTree(),f},setAccountData:function(a){this.accountData=a,this.rendered&&this._updateFolderTree()},removeAccountData:function(){this.folderStore.getRootNode().removeAll(),this.allStore.getRootNode().removeAll(),this.filesStore.removeAll()},_updateFolderTree:function(){var a=function(a,b){for(var c=0;c<b.length;c++)if(b[c].text==a)return c;return-1},b=[],c=[];if(null!=this.accountData&&null!=this.accountData.accountId){this.filesStore.removeAll();for(var d=0;d<this.accountData.buckets.length;d++){for(var e=[],f=[],g=0;g<this.accountData.buckets[d].objects.length;g++){var h=this.accountData.buckets[d].objects[g];h.bucketId=this.accountData.buckets[d].id,null!=h.id&&(h.oid=h.id,delete h.id);var i=h.oid.split("/");"dir"==h.fileType?(h.expanded=!0,h.icon=Utils.images.dir):(h.leaf=!0,h.icon=Utils.images.r);for(var j=e,k=f,l=0;l<i.length;l++){var m=a(i[l],j);if(-1!=m)j=j[m].children;else{var n=[],o=j.push({text:i[l],children:n})-1;if("undefined"==typeof i[l+1])for(key in h)"children"!=key&&(j[o][key]=h[key]);j=n}var m=a(i[l],k);if(-1!=m)k=k[m].children;else{var n=[];if("dir"==h.fileType){var o=k.push({text:i[l],children:n})-1;if("undefined"==typeof i[l+1])for(key in h)"children"!=key&&(k[o][key]=h[key])}k=n}}}c.push({text:this.accountData.buckets[d].name,bucketId:this.accountData.buckets[d].name,oid:"",expanded:!0,isBucket:!0,children:e}),b.push({text:this.accountData.buckets[d].name,bucketId:this.accountData.buckets[d].name,oid:"",expanded:!0,isBucket:!0,children:f})}}if(this._createFolderTree(b,c),null!=this.selectedFolderNode){var p=this.folderTree.getRootNode().findChild(this.selectedFolderNode.field,this.selectedFolderNode.value,!0);null!=p&&this.folderTree.getSelectionModel().select(p)}if(null!=this.selectedFileNode){var q=this.filesGrid.getStore().findExact("oid",this.selectedFileNode.oid);-1!=q&&this.filesGrid.getSelectionModel().select(q)}},addUpload:function(a,b){var c=Ext.create("Ext.ProgressBar",{text:"Ready",width:250,margin:"4 6 0 6"}),d=Ext.create("Ext.Component",{html:a.name.substr(0,67),width:430,margin:"7 6 0 6"}),e=Ext.create("Ext.Button",{text:'<span style="color:#1155cc">Cancel</span>',margin:"3 6 0 4",width:50,handler:function(){b.terminate(),f.destroy()}}),f=Ext.create("Ext.container.Container",{padding:"3 6 0 6",layout:"hbox",items:[d,c,e]});b.onmessage=function(a){var b=a.data;console.log("@@@@@@@@@@@@@@@@ WORKER event message"),console.log(b),c.updateProgress((b.chunkId+1)/b.total,"uploading part "+(b.chunkId+1)+" of "+b.total,!1),1==b.finished&&e.setText('<span style="color:#1155cc">Done </span>')},this.activeUploadsCont.add(f),Ext.getCmp(this.id+"activeUploadsButton").toggle(!0)},viewBuckets:function(){var a=this;a.panel.removeAll(!1),a.panel.add(a.container)},viewUploads:function(){var a=this;a.panel.removeAll(!1),a.panel.add(a.activeUploadsCont)}},OpencgaBrowserWidget.prototype.setFilter=function(){var a=this,b=this.viewOrigin.getSelectionModel().getSelection()[0],c=this.viewSuite.getSelectionModel().getSelection()[0];if(this.folderStore.clearFilter(),null!=b)switch(b.data.suiteId){case"all":break;case"Uploaded Data":this.folderStore.filter(function(a){return a.data.jobId<0});break;case"Job Generated":this.folderStore.filter(function(a){return a.data.jobId>0})}if(null!=c)switch(c.data.suiteId){case 1:break;default:this.folderStore.filter(function(a){return a.data.suiteId==c.data.suiteId})}this.folderStore.filter(function(b){var c=Ext.getCmp(a.searchFieldId).getValue().toLowerCase();return b.data.name.toLowerCase().indexOf(c)<0?!1:!0})},OpencgaBrowserWidget.prototype.checkTags=function(a){for(var b=0;b<this.tags.length;b++)if(this.tags[b].indexOf("|")>-1){for(var c=this.tags[b].split("|"),d=!1,e=0;e<c.length;e++)a.indexOf(c[e])>-1&&(d=!0);if(!d)return!1}else if(-1==a.indexOf(this.tags[b]))return!1;return!0},OpencgaBrowserWidget.prototype.createBucket=function(){var a=this;Ext.Msg.prompt("New Bucket","Please enter a name and description for the new bucket:",function(b,c){"ok"==b&&(c=c.replace(/[^a-z0-9-_.\s]/gi,"").trim(),OpencgaManager.createBucket({bucketId:c,description:"",accountId:$.cookie("bioinfo_account"),sessionId:$.cookie("bioinfo_sid"),success:function(b){""===b.errorMsg?a.trigger("need:refresh",{sender:a}):Utils.msg("Create project",b.errorMsg),a.panel.setLoading(!1),Ext.getBody().unmask()}}))},null,null,"New bucket")},OpencgaBrowserWidget.prototype._getFolderTreeSelection=function(){var a=this.folderTree.getSelectionModel().getSelection();if(a.length<1)return Utils.msg("No folder selected","Please select a bucket or a folder."),null;var b,c=a[0],d="";if(null!=c.data.fileType&&"dir"==c.data.fileType){var e=c.getPath("text","/").substr(1),f=e.split("/",2);d=e.replace(f.join("/"),"").substr(1)+"/",b=f[1]}else b=c.data.text;return{bucketId:b,directory:d}},OpencgaBrowserWidget.prototype.drawUploadWidget=function(){var a=this,b=this._getFolderTreeSelection();null!=b&&a.uploadWidget.draw(b)},OpencgaBrowserWidget.prototype.createFolder=function(){var a=this;if(this.accountData.buckets.length<1)Ext.MessageBox.alert("No buckets found","Please create and select a bucket.");else{var b=this._getFolderTreeSelection();null!=b&&Ext.Msg.prompt("New folder","Please enter a name for the new folder:",function(c,d){"ok"==c&&(d=d.replace(/[^a-z0-9-_.\s]/gi,""),d=d.trim()+"/",OpencgaManager.createDirectory({accountId:$.cookie("bioinfo_account"),sessionId:$.cookie("bioinfo_sid"),bucketId:b.bucketId,objectId:b.directory+d,success:function(b){""===b.errorMsg?(Utils.msg("Create folder",'</span class="emph">'+b.result[0].msg+"</span>"),a.trigger("need:refresh",{sender:a})):Ext.Msg.alert("Create folder",b.errorMsg)}}))},null,null,"New Folder")}},OpencgaBrowserWidget.prototype._createFolderTree=function(a,b){var c=this;if(this.container){var d=this.container.child("treepanel");d&&this.container.remove(d,!1).destroy(),this.allStore=Ext.create("Ext.data.TreeStore",{id:this.id+"allStore",fields:["text","oid"],root:{expanded:!0,text:"Drive",children:b}});var e=Ext.create("Ext.data.TreeStore",{fields:["text","oid"],root:{expanded:!0,text:"Drive",children:a},listeners:{beforeinsert:function(a,b){return b.isLeaf()?!1:void 0}}});this.folderStore=e;var f=Ext.create("Ext.tree.Panel",{border:!1,autoScroll:!0,useArrows:!0,rootVisible:!1,hideHeaders:!0,expanded:!0,flex:1,style:{borderColor:"lightgray",borderStyle:"solid",borderWidth:"0px 1px 0 0"},columns:[{xtype:"treecolumn",dataIndex:"text",flex:1,editor:{xtype:"textfield",allowBlank:!1}}],viewConfig:{markDirty:!1,plugins:{ptype:"treeviewdragdrop"},listeners:{drop:function(a,b){var d=b.records[0];if(d.isLeaf()&&d.data.index!=d.removedFrom&&d.data.checked){var e=d.data.trackId;c.setTrackIndex(e,d.data.index)}},itemcontextmenu:function(a,b,d,e,f){f.stopEvent();var g=[];if(console.log(b),b.data.isBucket){g.push(c.refreshBucketAction),g.push(c.renameBucketAction);var h=Ext.create("Ext.menu.Menu",{plain:!0,items:g});h.showAt(f.getXY())}return!1}}},listeners:{selectionchange:function(a,b){var d=b[0];if("undefined"!=typeof d){var e,f;null!=d.data.isBucket?(e="text",f=!1):(e="oid",f=!0);var g=c.allStore.getRootNode().findChild(e,d.data[e],f),h=[];c.selectedFolderNode={value:g.data[e],field:e};for(var i in g.data.children)h.push(g.data.children[i]);c.container.setTitle(g.getPath("text"," / ")),c.filesStore.loadData(h),"folderSelection"==c.mode&&(c.selectedFileNode=g.data,c.selectButton.enable())}},viewready:function(a){if("undefined"==typeof c.selectedFolderNode){var b=a.getRootNode().getChildAt(0);"undefined"!=typeof b&&a.getSelectionModel().select(b)}},checkchange:function(){},itemmouseenter:function(){},itemmouseleave:function(){}},store:e});this.folderTree=f}this.container&&(this.container.getLayout().animate=!1,this.container.insert(0,f),f.expand(),this.container.getLayout().animate=!0)},ProfileWidget.prototype={show:function(){this.panel.show()},hide:function(){this.panel.hide()},render:function(){var a=this;this.changePasswordSuccess=function(b){a.panel.setLoading(!1),""===b.errorMsg?(Ext.getCmp(a.id+"fldOld").setValue(null),Ext.getCmp(a.id+"fldNew1").setValue(null),Ext.getCmp(a.id+"fldNew2").setValue(null),Ext.getCmp(a.id+"labelPass").update('<span class="info">'+b.result[0].msg+"</span>",!1)):Ext.getCmp(a.id+"labelPass").update('<span class="err">'+b.errorMsg+"</span>",!1)},this.changeEmailSuccess=function(b){a.panel.setLoading(!1),""===b.errorMsg?(Ext.getCmp(a.id+"fldEmail").setValue(null),Ext.getCmp(a.id+"fldEmail").setFieldLabel("e-mail",!1),Ext.getCmp(a.id+"labelPass").update('<span class="info">'+b.result[0].msg+"</span>",!1)):Ext.getCmp(a.id+"labelPass").update('<span class="err">'+b.errorMsg+"</span>",!1)},this.rendered=!0},draw:function(){return this.rendered?void(this.panel=this._createPanel(this.targetId)):void console.info("Login Widget is not rendered yet")},_createPanel:function(){var a=this,b=Ext.create("Ext.Component",{id:this.id+"labelPass",margin:"10 0 10 105",html:"Modify your password or email."}),c=Ext.create("Ext.form.Panel",{title:"Change password",bodyPadding:15,width:350,border:!1,items:[{id:this.id+"fldOld",name:"password",xtype:"textfield",fieldLabel:"Old password",inputType:"password"},{id:this.id+"fldNew1",name:"new_password1",xtype:"textfield",fieldLabel:"New password",inputType:"password",listeners:{scope:this,change:this.checkpass}},{id:this.id+"fldNew2",name:"new_password2",xtype:"textfield",fieldLabel:"Confirm new",inputType:"password",listeners:{scope:this,change:this.checkpass}},b,{xtype:"button",text:"Change",margin:"0 0 0 105",handler:function(){a.changePassword()}}]}),d=Ext.create("Ext.form.Panel",{title:"Change email",bodyPadding:15,width:350,border:!1,items:[{id:this.id+"fldEmail",name:"new_email",xtype:"textfield",fieldLabel:"e-mail",listeners:{change:function(){a.checkemail()}}},{xtype:"button",text:"Change",margin:"0 0 0 105",handler:function(){a.changeEmail()}}]}),e=Ext.create("Ext.panel.Panel",{width:350,border:!1,layout:"accordion",items:[c,d],listeners:{tabchange:function(){a.clearAllFields()}}}),f=Ext.create("Ext.window.Window",{title:"Profile",resizable:!1,minimizable:!0,constrain:!0,height:350,layout:"fit",closable:!1,modal:!0,items:{border:0,layout:"fit",items:[e],bbar:{layout:{pack:"center"},items:[{text:"Close",handler:function(){a.panel.hide()}}]}},listeners:{minimize:function(){a.panel.hide()}}});return f},getOldPassword:function(){return $.sha1(Ext.getCmp(this.id+"fldOld").getValue())},getNewPassword:function(){return $.sha1(Ext.getCmp(this.id+"fldNew1").getValue())},getLogin:function(){return Ext.getCmp(this.id+"fldEmail").getValue()},clearAllFields:function(){Ext.getCmp(this.id+"fldOld").setValue(null),Ext.getCmp(this.id+"fldNew1").setValue(null),Ext.getCmp(this.id+"fldNew2").setValue(null),Ext.getCmp(this.id+"fldEmail").setValue(null),Ext.getCmp(this.id+"labelPass").update("&nbsp",!1)},changeEmail:function(){this.checkemail()&&(OpencgaManager.changeEmail({accountId:$.cookie("bioinfo_account"),sessionId:$.cookie("bioinfo_sid"),new_email:this.getLogin(),success:this.changeEmailSuccess}),this.panel.setLoading("Waiting for the server to respond..."))},changePassword:function(){this.checkpass()&&(OpencgaManager.changePassword({accountId:$.cookie("bioinfo_account"),sessionId:$.cookie("bioinfo_sid"),old_password:this.getOldPassword(),new_password1:this.getNewPassword(),new_password2:this.getNewPassword(),success:this.changePasswordSuccess}),this.panel.setLoading("Waiting for the server to respond..."))},checkpass:function(){var a=Ext.getCmp(this.id+"fldNew1").getValue(),b=Ext.getCmp(this.id+"fldNew2").getValue(),c=Ext.getCmp(this.id+"fldOld").getValue(),d=new RegExp("[ *]");return""!=c?!d.test(a)&&a.length>3?a==b?(Ext.getCmp(this.id+"labelPass").update('<span class="ok">Passwords match</span>',!1),!0):(Ext.getCmp(this.id+"labelPass").update('<span class="err">Passwords does not match</span>',!1),!1):(Ext.getCmp(this.id+"labelPass").update('<span class="err">Password must be at least 4 characters</span>',!1),!1):(Ext.getCmp(this.id+"labelPass").update('<span class="err">Old password is empty</span>',!1),!1)},checkemail:function(){var a=Ext.getCmp(this.id+"fldEmail").getValue(),b=/^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/;return b.test(a)?(Ext.getCmp(this.id+"fldEmail").setFieldLabel('<span class="ok">e-mail</span>',!1),!0):(Ext.getCmp(this.id+"fldEmail").setFieldLabel('<span class="err">e-mail</span>',!1),""==a&&Ext.getCmp(this.id+"fldEmail").setFieldLabel("e-mail",!1),!1)}},ResultTable.prototype.draw=function(){this.render()},ResultTable.prototype.render=function(){var a=this,b=null,c=new Array,d=new Array;this.tableSkel=this.tableLayout,this.colNames=this.tableSkel.colNames,this.colVisibilty=this.tableSkel.colVisibility,this.colTypes=this.tableSkel.colTypes,b=this.tableSkel.numRows,c=new Array,d=new Array;for(var e=0;e<this.colNames.length;e++)1==this.colVisibilty[e]&&(c.push({header:this.colNames[e],dataIndex:this.colNames[e],width:10*this.colNames[e].length+30}),d.push({name:this.colNames[e],type:this.colTypes[e]}));if("text"==this.tableSkel.type){var f=new WumAdapter;f.onPoll.addEventListener(function(b,c){for(var d=a.parse(c),e=[],f=0;f<d.length;f++){var g=Ext.create("Ext.container.Container",{data:d[0],tpl:a.getTemplate(a.tableSkel.colNames)});e.push(g)}this.table=Ext.create("Ext.container.Container",{items:e,margin:"0 0 0 50",renderTo:a.targetId})}),f.poll(this.jobId,this.fileName,!1,$.cookie("bioinfo_sid"))}else{var g=OpencgaManager.tableurl({accountId:$.cookie("bioinfo_account"),sessionId:$.cookie("bioinfo_sid"),jobId:this.jobId,filename:this.fileName});console.log(g),null==b&&(b=this.numRows);var h=b;this.st=Ext.create("Ext.data.Store",{fields:d,pageSize:h,remoteSort:!1,proxy:{url:g,type:"ajax",reader:{type:"json",root:"items",totalProperty:"total"},extraParams:{colNames:this.colNames.join(","),colVisibility:this.colVisibilty.join(",")},actionMethods:{read:"POST"}}}),this.st.loadPage(1);var i=75+30*h;this.table=Ext.create("Ext.grid.Panel",{title:this.fileName,collapsible:this.collapsible,flex:this.flex,store:this.st,border:this.border,cls:this.cls,columns:c,height:i,dockedItems:[{xtype:"pagingtoolbar",store:this.st,dock:"top",displayInfo:!0}],renderTo:this.targetId})}},ResultTable.prototype.parse=function(a){for(var b=this,c=a.split("\n"),d=[],e=0;e<c.length;e++)if("#"!=c[e].charAt(0)&&""!=c[e]){for(var f=c[e].split("	"),g={},h=0;h<f.length;h++)""!=f[h]&&(g[b.tableSkel.colNames[h].replace(/ /g,"_")]=f[h]);d.push(g)}return d},ResultTable.prototype.getTemplate=function(a){for(var b="<p>",c=0;c<a.length;c++)b+='<span class="dis s90">'+a[c]+" </span> {"+a[c].replace(/ /g,"_")+"} &nbsp; &nbsp; &nbsp;";return b+="</p>",new Ext.XTemplate(b)},ResultWidget.prototype={id:"ResultWidget"+Math.round(1e4*Math.random()),draw:function(a,b){var c=this;this.job=b.data,this.job.command=Utils.parseJobCommand(this.job),this.jobId=this.job.id,this.id=this.jobId+this.id,this.panelId="ResultWidget_"+this.jobId,this.panel=Ext.getCmp(this.panelId);var d=this.title;if(d=""===this.title?this.job.name:this.title+" - "+this.job.name,null==this.panel)if("window"==this.type?this.panel=Ext.create("Ext.window.Window",{id:this.panelId,bodyStyle:"background:white;",title:d,closable:!0,autoScroll:!0,overflowY:"auto",maximizable:!0,layout:{type:"vbox",align:"stretch"}}):(this.panel=Ext.create("Ext.panel.Panel",{id:this.panelId,border:0,title:d,closable:!0,autoScroll:!0,layout:{type:"vbox",align:"stretch"}}),Ext.getCmp(this.targetId).add(this.panel)),this.panel.setLoading("Loading job info..."),-1!==this.job.status.indexOf("error"))this.panel.add(this._getJobInfo()),this.panel.add(this._getErrorInfo()),OpencgaManager.jobInfo({accountId:$.cookie("bioinfo_account"),sessionId:a,jobId:this.jobId,success:function(){}}),this.panel.setLoading(!1);
else{var e=OpencgaManager.jobResultUrl({accountId:$.cookie("bioinfo_account"),sessionId:a,jobId:this.jobId,format:"json"});console.log(e),$.getScript(e,function(){c.panel.setLoading(!1),c.result=RESULT;var a=c.result[c.layoutName].layout;a.outputItems=c.job.outputData.sort(a.sortOutputItems),a.job=c.job,"undefined"!=typeof a.oldXML&&c._parseOldXML(a),c.render(c.result),"window"==c.type?c.panel.show():Ext.getCmp(c.targetId).setActiveTab(c.panel)})}else"window"==this.type?this.panel.show():Ext.getCmp(this.targetId).setActiveTab(this.panel)},render:function(a){var b=this;console.log(this.application);var c=function(a){for(var c=[],d=0;d<a.length;d++)c.push(Ext.create("Ext.Component",{cls:"ocb-pointer",overCls:"u err",resultId:b.jobId+a[d].title.replace(/ /g,""),html:a[d].title,listeners:{afterrender:function(a){this.getEl().on("click",function(){var c=$("#"+a.resultId).position();if("undefined"!=typeof c){var d=c.top;$(b.panel.getEl().dom).children().scrollTop(d-10)}var e=Ext.getCmp(a.resultId),f=e.up();f.isXType("tabpanel")&&f.setActiveTab(e)})}}}));return Ext.create("Ext.panel.Panel",{title:"Result index",header:{baseCls:"ocb-panel-title"},border:!1,collapsible:!0,titleCollapse:!0,margin:10,bodyPadding:10,items:c})},d=new Ext.XTemplate('<span class="s120">{title}</span>','<span class="ok"> {pathi} </span>','<span class="info"> {date}</span><br>'),e=function(a){for(var c,d=[],e=0;e<a.renderers.length;e++){var f=a.renderers[e];switch(f.type){case"note":c=Ext.create("Ext.Component",{html:f.html,item:a,cls:"inlineblock whiteborder"});break;case"message":c=Ext.create("Ext.Component",{html:'<div class="alert alert-'+a.type+'" style="text-align: center;font-size: 20px">'+a.title+"</div>",item:a,padding:3});break;case"text":c=Ext.create("Ext.Component",{html:'<span class="key">'+a.title+': </span> <span class="emph">'+a.file+"</span>",item:a,cls:"inlineblock whiteborder"});break;case"file":c=Ext.create("Ext.Component",{html:'<span class="key">'+a.title+'</span><span class="file">'+a.file+"</span>",item:a,padding:3,overCls:"encima",cls:"inlineblock whiteborder",listeners:{afterrender:function(){var a=this.item;this.getEl().on("click",function(){console.log(a),OpencgaManager.poll({accountId:$.cookie("bioinfo_account"),sessionId:$.cookie("bioinfo_sid"),jobId:b.jobId,filename:a.file,zip:!0})})}}});break;case"image":var g=OpencgaManager.pollurl({accountId:$.cookie("bioinfo_account"),sessionId:$.cookie("bioinfo_sid"),jobId:b.jobId,filename:a.file});c=Ext.create("Ext.Img",{src:g,listeners:{render:function(a){this.mon(this.getEl(),"load",function(){a.setWidth(this.getWidth()),a.setHeight(this.getHeight())})}}});break;case"piechart":var h,g=OpencgaManager.pollurl({accountId:$.cookie("bioinfo_account"),sessionId:$.cookie("bioinfo_sid"),jobId:b.jobId,filename:a.file});$.ajax({type:"GET",async:!1,url:g,success:function(a){if(""!=a){for(var b=a.split("\n"),c=[],d=[],e=[],f=[],g=0,i=0;i<b.length;i++)c.push(b[i].split("	")),""!=c[i][0]&&d.push(c[i][0]),null!=c[i][1]&&(g+=parseFloat(c[i][1]),e.push(c[i][1]));for(var i=0;i<e.length;i++)f.push(Math.round(parseFloat(e[i])/g*100));d=d.toString().replace(/,/gi,"|"),h="https://chart.googleapis.com/chart?cht=p&chs=600x300&chd=t:"+f+"&chl="+d+"&chtt=Consequence+types&chts=000000,14.5"}}}),c=Ext.create("Ext.Img",{src:h,listeners:{render:function(a){this.mon(this.getEl(),"load",function(){a.setWidth(this.getWidth()),a.setHeight(this.getHeight())})}}});break;case"scatter":var g=OpencgaManager.pollurl({accountId:$.cookie("bioinfo_account"),sessionId:$.cookie("bioinfo_sid"),jobId:b.jobId,filename:a.file}),i=[];$.ajax({type:"GET",async:!1,url:g,success:function(a){var a=JSON.parse(a);i="function"==typeof f.processData?f.processData(a):a}});var j=Ext.create("Ext.data.JsonStore",{fields:f.fields,data:i}),k=Ext.create("Ext.chart.Chart",{renderTo:Ext.getBody(),width:500,height:200,animate:!1,store:j,axes:[{type:"Numeric",position:"left",fields:f.y.fields,title:f.y.title,grid:!0,maximum:f.y.max},{type:"Numeric",position:"bottom",fields:f.x.fields,title:f.x.title,grid:!0}],series:[{tips:{trackMouse:!0,style:{backgroundColor:"white"},renderer:function(a,b){var c=b.storeItem.get(f.x.field),d=b.storeItem.get(f.y.field),e="<div>"+f.x.field+': <span style="font-weight: bold">'+c+"</span></div><div>"+f.y.field+': <span style="font-weight: bold">'+d+"</span></div>";this.update(e)}},type:"scatter",renderer:function(a,b,c){return"undefined"!=typeof f.config?Ext.apply(c,f.config(b.data)):void 0},markerConfig:{type:"circle",radius:2,size:5},axis:"left",xField:f.x.field,yField:f.y.field}]});c=Ext.create("Ext.container.Container",{margin:"10 0 0 0",items:[{xtype:"box",html:'<span class="key s120">'+a.title+"</span>"},k]});break;case"memory-grid":var g=OpencgaManager.pollurl({accountId:$.cookie("bioinfo_account"),sessionId:$.cookie("bioinfo_sid"),jobId:b.jobId,filename:a.file}),i=[],l=[];$.ajax({type:"GET",async:!1,url:g,success:function(a){var a=JSON.parse(a);i=f.data(a),l=f.fields(a)}});for(var j=Ext.create("Ext.data.Store",{pageSize:50,proxy:{type:"memory"},fields:["0","1","2","3"],data:i}),m=[],n=0;n<l.length;n++)m.push({header:l[n],dataIndex:n,flex:1});c=Ext.create("Ext.grid.Panel",{title:a.title,flex:1,store:j,height:200,width:400,loadMask:!0,plugins:["bufferedrenderer"],columns:m});break;case"grid":var o="resultTable_"+b.jobId+a.file,p=new ResultTable(b.jobId,a.file,a.tags,{targetId:o,tableLayout:f.tableLayout});c=Ext.create("Ext.Component",{flex:1,resultTable:p,html:'<div id="'+o+'" style="padding:5px;"> </div>',listeners:{afterrender:function(a){a.resultTable.draw()}}});break;case"vcf-grid":var o="resultTable_"+b.jobId+a.file,q={name:"Stats Samples Table",colNames:["CHROM","POS","ID","REF","ALT","QUAL","FILTER","INFO","FORMAT"],colTypes:["string","int","string","string","string","string","string","string","string"],colVisibility:[1,1,1,1,1,1,1,1,1],colOrder:[0,1,2,3,,4,5,6,7,8,9]},r=$.cookie("bioinfo_sid"),s=$.cookie("bioinfo_account");OpencgaManager.jobFileGrep({pattern:"^#CHR.*",ignoreCase:"true",multi:!1,filename:a.file,sessionId:r,accountId:s,jobId:b.jobId,async:!1,success:function(d){for(var e=d.trim().split("	"),f=9;f<e.length;f++)q.colNames.push(e[f]),q.colTypes.push("string"),q.colVisibility.push(1),q.colOrder.push(e[f-1]+1);var g=new ResultTable(b.jobId,a.file,a.tags,{targetId:o,tableLayout:q});c=Ext.create("Ext.Component",{flex:1,resultTable:g,html:'<div id="'+o+'" style="padding:5px;"> </div>',listeners:{afterrender:function(a){a.resultTable.draw()}}})}});break;case"table":var g=OpencgaManager.pollurl({accountId:$.cookie("bioinfo_account"),sessionId:$.cookie("bioinfo_sid"),jobId:b.jobId,filename:a.file});$.ajax({type:"GET",async:!1,url:g,success:function(a){for(var b='<table cellspacing="0" style="border-collapse: collapse;border:1px solid #ccc;"><tbody>',d=a.split("\n"),e=0,g=0;g<d.length;g++){var h=d[g];if("#"!=h.charAt(0)&&""!=h.trim()){e++,b+=f.header&&1==e?'<tr style="border-collapse: collapse;border:1px solid #ccc;font-weight:bold;">':'<tr style="border-collapse: collapse;border:1px solid #ccc;">';for(var i=h.split("	"),j=0;j<i.length;j++){var k=i[j];b+='<td style="border-collapse: collapse;border:1px solid #ccc;padding: 5px;background-color: whiteSmoke;">'+k+"</td>"}b+="</tr>"}}b+="</tbody></table>",c=Ext.create("Ext.Component",{flex:1,html:b})}});break;case"genome-viewer":var t=document.createElement("div");$(t).css({height:"1200px"});var u=document.createElement("div");$(u).css({width:"1500px",marginTop:"10px",border:"1px solid lightgray"});var v=document.createElement("div");$(v).css({width:"1500px",height:"300px"}),t.appendChild(v),t.appendChild(u),c=Ext.create("Ext.Component",{flex:1,contentEl:t,listeners:{afterrender:function(){var a=b._createGenomeViewer(u);b._createVariantFilterWidget(v,a,b.result[b.layoutName].layout.variantFilterFiles,f.tableLayout)}}});break;case"variant-stats-widget":var w=800;c=Ext.create("Ext.container.Container",{height:w,width:"95%",style:{position:"relative"},listeners:{afterrender:function(){var a=new VariantStatsWidget({targetId:c,height:w,closable:!1,border:!0,job:b.job,autoRender:!0});a.draw()}}});break;case"variant-widget":var w=800;c=Ext.create("Ext.container.Container",{height:w,width:"95%",style:{position:"relative"},listeners:{afterrender:function(){var a=OpencgaManager.getJobAnalysisUrl($.cookie("bioinfo_account"),b.job.id)+"/variantsMongo";console.log("URL: "+a);var d=new VariantWidget({targetId:c,height:w,closable:!1,border:!0,url:a,job:b.job,autoRender:!0});d.draw()}}})}d.push(c)}return Ext.create("Ext.container.Container",{title:a.title,margin:"0 0 5 0",items:d})},f=function(a,c){var g;if("undefined"!=typeof a.children){"function"==typeof a.children&&(a.children=a.children()),g=[];for(var h=0;h<a.children.length;h++)g.push(f(a.children[h]));if(1==c){var i;return i="tabs"==a.presentation?Ext.create("Ext.tab.Panel",{plain:!0,border:0,layout:{type:"vbox",align:"stretch"},defaults:{overflowX:"scroll",padding:10},items:g}):Ext.create("Ext.container.Container",{items:g}),Ext.create("Ext.panel.Panel",{title:"Result details",header:{baseCls:"ocb-panel-title"},border:!1,collapsible:!0,titleCollapse:!0,margin:10,bodyPadding:10,items:[i]})}return _.isUndefined(a.title),Ext.create("Ext.container.Container",{id:b.jobId+a.title.replace(/ /g,""),title:a.title,margin:"0 0 20 0",items:[{xtype:"box",overCls:"ocb-pointer",cls:"panel-border-bottom",margin:"0 20 10 0",data:a,tpl:d,listeners:{afterrender:function(){this.getEl().on("click",function(){$(b.panel.getEl().dom).children().scrollTop(0)})}}},{xtype:"container",items:g}]})}return e(a)},g=f(a[this.layoutName].layout,!0);if(this.panel.add(this._getJobInfo({items:this.args})),this.drawIndex===!0){var h=c(a[this.layoutName].layout.children);this.panel.insert(h)}this.panel.add(g)},_getErrorInfo:function(){var a=Ext.create("Ext.container.Container",{margin:10});return $.ajax({type:"GET",async:!1,url:OpencgaManager.pollurl({accountId:$.cookie("bioinfo_account"),sessionId:$.cookie("bioinfo_sid"),jobId:this.jobId,filename:"sge_err.log"}),success:function(b){a.add({title:"Error log",bodyPadding:"0 10",border:!1,header:{baseCls:"ocb-panel-title"},style:{borderBottom:"1px solid lightgray"},maxHeight:400,overflowY:!0,html:"<pre>"+b+"</pre>"})}}),$.ajax({type:"GET",async:!1,url:OpencgaManager.pollurl({accountId:$.cookie("bioinfo_account"),sessionId:$.cookie("bioinfo_sid"),jobId:this.jobId,filename:"sge_out.log"}),success:function(b){a.add({title:"Out log",bodyPadding:"0 10",margin:"20 0 0 0",border:!1,header:{baseCls:"ocb-panel-title"},style:{borderBottom:"1px solid lightgray"},maxHeight:400,overflowY:!0,html:"<pre>"+b+"</pre>"})}}),a},_getJobInfo:function(a){var b=this,a=a||{},c=new Ext.XTemplate('<div class="s110">','<div style="display:inline-block;color:steelblue;width: 45px;">Id: </div>{id}<br>','<div style="display:inline-block;color:steelblue;width: 45px;">Name: </div>{name}<br>','<div style="display:inline-block;color:steelblue;width: 45px;">Tool: </div>{toolName}<br>','<div style="display:inline-block;color:steelblue;width: 45px;">Date: </div>{date}<br>',"</div>",'<p class="tip emph">{description}</p>','<p class="">{command.html}</p>'),d=Ext.create("Ext.panel.Panel",{title:"Information",header:{baseCls:"ocb-panel-title"},border:!1,collapsible:!0,titleCollapse:!0,collapsed:this.collapseInformation,margin:10,bodyPadding:10,items:[{xtype:"box",data:this.job,tpl:c},{xtype:"container",layout:"hbox",margin:"10 0 0 0",defaults:{margin:"0 5 0 5"},items:[{xtype:"button",text:"download",handler:function(){OpencgaManager.downloadJob({accountId:$.cookie("bioinfo_account"),sessionId:$.cookie("bioinfo_sid"),jobId:b.jobId})}},{xtype:"button",text:"delete",handler:function(){Ext.Msg.confirm("Delete job","Are you sure you want to delete this job?",function(a){"yes"==a&&OpencgaManager.deleteJob({accountId:$.cookie("bioinfo_account"),sessionId:$.cookie("bioinfo_sid"),jobId:this.jobId,success:function(a){""===a.errorMsg?Utils.msg("Delete job",'</span class="emph">'+a.result[0].msg+"</span>"):Ext.Msg.alert("Delete job, try again later.",a.errorMsg)}})})}}]}]});return"undefined"!=typeof a.items&&d.child("container").add(a.items),d},_createGenomeViewer:function(a){var b=this,c=new GenomeViewer({cellBaseHost:"http://www.ebi.ac.uk/cellbase/webservices/rest",cellBaseVersion:"v3",target:a,width:$(a).width(),region:new Region(DEFAULT_SPECIES.region),availableSpecies:AVAILABLE_SPECIES,species:DEFAULT_SPECIES,sidePanel:!1,resizable:!1,karyotypePanelConfig:{collapsed:!1,collapsible:!0},chromosomePanelConfig:{collapsed:!1,collapsible:!0},navigationBarConfig:{componentsConfig:{}},handlers:{"region:change":function(a){console.log(a)}}}),d=[];this.sequence=new SequenceTrack({height:30,visibleRegionSize:200,renderer:new SequenceRenderer,dataAdapter:new SequenceAdapter({category:"genomic",subCategory:"region",resource:"sequence",species:c.species})}),d.push(this.sequence),this.gene=new GeneTrack({title:"Gene",minHistogramRegionSize:2e7,maxLabelRegionSize:1e7,minTranscriptRegionSize:2e5,height:140,renderer:new GeneRenderer,dataAdapter:new CellBaseAdapter({category:"genomic",subCategory:"region",resource:"gene",species:c.species,params:{exclude:"transcripts.tfbs,transcripts.xrefs,transcripts.exons.sequence"},cacheConfig:{chunkSize:1e5}})}),d.push(this.gene);var e=new FeatureRenderer(FEATURE_TYPES.gene);e.on({"feature:click":function(a){console.log(a)}});var f=new FeatureTrack({minHistogramRegionSize:2e7,maxLabelRegionSize:1e7,height:100,renderer:e,dataAdapter:new CellBaseAdapter({category:"genomic",subCategory:"region",resource:"gene",params:{exclude:"transcripts,chunkIds"},species:c.species,cacheConfig:{chunkSize:1e5}})});c.addOverviewTrack(f),this.snp=new FeatureTrack({title:"SNP",featureType:"SNP",minHistogramRegionSize:1e4,maxLabelRegionSize:3e3,height:100,renderer:new FeatureRenderer(FEATURE_TYPES.snp),dataAdapter:new CellBaseAdapter({category:"genomic",subCategory:"region",resource:"snp",params:{exclude:"transcriptVariations,xrefs,samples"},species:c.species,cacheConfig:{chunkSize:1e4}})}),d.push(this.snp),c.addTrack(d),c.draw(),c.chromosomePanel.hide(),c.karyotypePanel.hide();var g=this.result[b.layoutName].layout.filteredFile;return _.isUndefined(g)?console.log("No filtered VCF file."):OpencgaManager.poll({accountId:$.cookie("bioinfo_account"),sessionId:$.cookie("bioinfo_sid"),jobId:b.jobId,filename:g,zip:!1,success:function(a){-1!=a.indexOf("ERROR")&&console.error(a);var b=new VCFDataAdapter(new StringDataSource(a),{async:!1,species:c.species}),d=new FeatureTrack({targetId:null,id:"VCF file",title:g,height:150,minHistogramRegionSize:12e3,maxLabelRegionSize:3e3,renderer:new FeatureRenderer(FEATURE_TYPES.vcf),dataAdapter:b});c.addTrack(d)}}),c},_createVariantFilterWidget:function(a,b,c,d){var e=new VariantFilterWidget(this.jobId,{width:$(a).width(),height:$(a).height(),targetId:a,viewer:b,fileNames:c,tableLayout:d});return e.getPanel(a),e},_parseOldXML:function(a){OpencgaManager.poll({accountId:$.cookie("bioinfo_account"),sessionId:$.cookie("bioinfo_sid"),jobId:a.job.id,filename:a.oldXML,zip:!1,async:!1,success:function(b){var c=$.parseXML(b);a.xml=$(c)}})}},UploadWidget.prototype={getTypeValidation:function(a){return function(b){var c=new RegExp("^.*\\.("+a+")$","i");return c.test(b)}}},UploadWidget.prototype.draw=function(a){this.opencgaLocation=a;var b={9:[{text:"ID List",children:[{text:"SNP",tag:"idlist:snp"},{text:"Gene/Transcript",tag:"idlist:gene:transcript"}]},{text:"Feature",children:[{text:"VCF 4.0",tag:"vcf",validate:this.getTypeValidation("vcf")},{text:"GFF2",tag:"gff2"},{text:"GFF3",tag:"gff3"},{text:"GTF",tag:"gtf"},{text:"BED",tag:"bed"},{text:"BAM",tag:"bam",validate:this.getTypeValidation("bam")},{text:"BAI",tag:"bai",validate:this.getTypeValidation("bai")},{text:"Expression",tag:"expression"}]}],6:[{text:"Feature",children:[{text:"VCF 4.0",tag:"vcf"},{text:"GFF2",tag:"gff2"},{text:"GFF3",tag:"gff3"},{text:"GTF",tag:"gtf"},{text:"BED",tag:"bed"},{text:"PED",tag:"ped"}]}],11:[{text:"Annotation",tag:"annotation"},{text:"ID List",children:[{text:"Gene",tag:"idlist:gene"},{text:"Ranked",tag:"ranked"}]}],12:[{text:"Abundances",tag:"abundances"}],100:[{text:"Sequence",tag:"sequence"}],22:[{text:"Tabbed text file",tag:"txt",validate:this.getTypeValidation("txt|text")},{text:"CEL compressed file",tag:"cel",validate:this.getTypeValidation("zip|tar|tar.gz|tgz")}],85:[{text:"Feature",children:[{text:"VCF 4.0",tag:"vcf",validate:this.getTypeValidation("vcf")},{text:"PED",tag:"ped",validate:this.getTypeValidation("ped")}]}],cellmaps:[{text:"Network",children:[{text:"SIF",tag:"sif",validate:this.getTypeValidation("sif")},{text:"Expresion matrix",tag:"txt",validate:this.getTypeValidation("txt")},{text:"Text",tag:"txt",validate:this.getTypeValidation("txt")}]}]};"undefined"==typeof b[this.suiteId]?this.render([{text:"No data types defined"}]):(this.checkDataTypes(b[this.suiteId]),this.render(b[this.suiteId]))},UploadWidget.prototype.clean=function(){null!=this.panel&&(this.panel.destroy(),delete this.panel,console.log(this.id+" PANEL DELETED"))},UploadWidget.prototype.checkDataTypes=function(a){for(var b=0;b<a.length;b++)null!=a[b].children?(a[b].expanded=!0,this.checkDataTypes(a[b].children)):a[b].leaf=!0},UploadWidget.prototype.render=function(a){var b=this;if(null==this.panel){var c=Ext.create("Ext.data.TreeStore",{root:{expanded:!0,text:"Data type",children:a}}),d=400,e=250,f=Ext.create("Ext.tree.Panel",{header:{baseCls:"header-form"},title:'Select your data type <span style="color:gray">(req)</span>',bodyPadding:"10 0 0 0",height:d,border:!1,width:e,store:c,useArrows:!0,rootVisible:!1,listeners:{scope:this,itemclick:function(a,b){b.data.leaf?(this.selectedDataType=b.data.tag,this.selectedDataTypeObj=b.data,this.dataTypeLabel.update('<span class="info">Type:</span><span class="ok"> OK </span>')):(this.selectedDataType=void 0,this.selectedDataTypeObj=void 0,this.dataTypeLabel.update('<span class="info">Select a data type</span><span class="err"> !!!</span>')),this.validate()}}});this.nameField=Ext.create("Ext.form.field.Text",{name:"datalabel",fieldLabel:"Data name",labelWidth:110,msgTarget:"side",enableKeyEvents:!0,listeners:{scope:this,change:function(a){this.dataNameLabel.update(""!=a.getValue()?'<span class="info">Name:</span><span class="ok"> OK </span>':'<span class="info">Enter the data name</span><span class="err"> !!!</span>'),this.validate()}}}),this.textArea=Ext.create("Ext.form.field.TextArea",{name:"datadescription",fieldLabel:"Data description",labelWidth:110,msgTarget:"side"}),this.organizationField=Ext.create("Ext.form.field.Text",{name:"organization",fieldLabel:"Organization",labelWidth:110,msgTarget:"side"}),this.responsableField=Ext.create("Ext.form.field.Text",{name:"responsable",fieldLabel:"Responsible",labelWidth:110,msgTarget:"side"}),this.acquisitiondate=Ext.create("Ext.form.field.Text",{name:"acquisitiondate",fieldLabel:"Acquisition date",labelWidth:110,msgTarget:"side"});var g=350,h=Ext.create("Ext.panel.Panel",{title:"Aditional information",header:{baseCls:"header-form"},width:g,border:!1,height:d,bodyPadding:15,items:[this.nameField,this.textArea,this.organizationField,this.responsableField,this.acquisitiondate]});this.dataTypeLabel=Ext.create("Ext.Component",{html:'<span class="info">Select a data type</span>'}),this.dataNameLabel=Ext.create("Ext.Component",{html:'<span class="info">Enter the data name</span>'}),this.dataFieldLabel=Ext.create("Ext.Component",{html:'<span class="info">Select a data file</span>'}),this.originCheck=Ext.create("Ext.form.field.Checkbox",{xtype:"checkbox",hidden:!this.enableTextMode,boxLabel:"Text mode",margin:"0 0 0 0",listeners:{scope:this,change:function(){this.originCheck.getValue()?(this.dataFieldLabel.update('<span class="ok">'+this.editor.getValue().length+'</span><span class="info"> chars</span>'),this.uploadField.hide(),this.editor.show(),this.uploadField.setRawValue(null)):(this.dataFieldLabel.update('<span class="info">Select a data file</span>'),this.editor.hide(),this.uploadField.show(),this.editor.setRawValue(null)),this.validate()}}});var i=Ext.create("Ext.button.Button",{id:this.uploadButtonId,text:"Upload",disabled:!0,handler:function(){b.chunkedUpload?b.uploadFile2():b.uploadFile()}});this.editor=Ext.create("Ext.form.field.TextArea",{xtype:"textarea",emptyText:"Paste or write your file directly",hidden:!0,name:"file",width:"100%",height:100,enableKeyEvents:!0,listeners:{scope:this,change:function(){this.dataFieldLabel.update('<span class="ok">'+this.editor.getValue().length+'</span> <span class="info"> chars</span>'),this.validate()}}}),this.createUploadField(),this.pan3=Ext.create("Ext.panel.Panel",{title:"Data file",header:{baseCls:"header-form"},colspan:2,border:!1,padding:5,bodyPadding:15,width:e+g,items:[this.editor,this.uploadField]}),this.panel=Ext.create("Ext.window.Window",{title:"Upload a data file",iconCls:"icon-upload",resizable:!1,constrain:!0,closable:!1,modal:!0,items:{border:0,layout:{type:"vbox",align:"stretch"},items:[this.pan3,{xtype:"container",padding:5,layout:{type:"hbox",align:"stretch"},items:[f,h]}],dockedItems:[{xtype:"toolbar",dock:"bottom",layout:{pack:"end"},defaults:{width:100},items:[{text:"Close",handler:function(){b.panel.minimize()}},i]},{xtype:"toolbar",dock:"bottom",items:[this.originCheck,"->",this.dataTypeLabel,this.dataFieldLabel]}]},listeners:{scope:this,minimize:function(){this.panel.hide(),this.uploadField.setRawValue(null),this.editor.setRawValue(null),this.originCheck.setValue(!1)}}})}this.panel.show()},UploadWidget.prototype.createUploadField=function(){this.uploadField=Ext.create("Ext.form.field.File",{id:this.uploadFieldId,xtype:"filefield",name:"file",msgTarget:"side",emptyText:"Choose a file",width:500,allowBlank:!1,buttonText:"Upload local file...",buttonAlign:"left",rtl:!1,listeners:{scope:this,change:function(){this.fileSelected(),this.validate()}}})},UploadWidget.prototype.validate=function(){var a=!0;"undefined"!=typeof this.selectedDataTypeObj&&"undefined"!=typeof this.selectedDataTypeObj.validate&&(a=this.selectedDataTypeObj.validate(Ext.getCmp(this.uploadFieldId).getValue())),!a||null==this.selectedDataType||""==this.uploadField.getRawValue()&&""==this.editor.getValue()?(Ext.getCmp(this.uploadButtonId).disable(),this.dataTypeLabel.update('<span class="info">Type:</span><span class="err"> Not valid </span>')):(Ext.getCmp(this.uploadButtonId).enable(),this.dataTypeLabel.update('<span class="info">Type:</span><span class="ok"> OK </span>')),this.originCheck.getValue()&&(""==this.nameField.getValue()?Ext.getCmp(this.uploadButtonId).disable():Ext.getCmp(this.uploadButtonId).enable())},UploadWidget.prototype.fileSelected=function(){var a=this.uploadField.fileInputEl.id,b=document.getElementById(a).files[0];if(b){var c=0;c=b.size>1048576?(Math.round(100*b.size/1048576)/100).toString()+"MB":(Math.round(100*b.size/1024)/100).toString()+"KB",this.dataFieldLabel.update('<span class="info">Size: </span><span class="ok">'+c+"</span>")}},UploadWidget.prototype.uploadFile=function(){Ext.getBody().mask("Uploading file..."),this.panel.disable();var a=new FormData,b=null;if(this.originCheck.getValue())b=this.nameField.getValue(),a.append("file",this.editor.getValue());else{var c=document.getElementById(Ext.getCmp(this.uploadFieldId).fileInputEl.id).files[0];b=c.name,a.append("file",c)}var d=$.cookie("bioinfo_sid"),e=this.opencgaLocation.directory+b;e=e.replace(new RegExp("/","gi"),":"),a.append("name",this.nameField.getValue()),a.append("fileFormat",this.selectedDataType),a.append("responsible",this.responsableField.getValue()),a.append("organization",this.organizationField.getValue()),a.append("date",this.acquisitiondate.getValue()),a.append("description",this.textArea.getValue()),a.append("objectid",e),a.append("sessionid",d),this.objectID=this.opencgaLocation.bucketId+":"+e,OpencgaManager.uploadObjectToBucket({accountId:$.cookie("bioinfo_account"),sessionId:d,bucketId:this.opencgaLocation.bucketId,objectId:e,formData:a,success:this.uploadObjectToBucketSuccess})},UploadWidget.prototype.uploadFile2=function(){var a=document.getElementById(Ext.getCmp(this.uploadFieldId).fileInputEl.id).files[0],b=this.opencgaLocation.directory+a.name;b=b.replace(new RegExp("/","gi"),":");var c=new Worker(WORKERS_PATH+"worker-fileupload.js");this.opencgaBrowserWidget.addUpload(a,c),c.postMessage({host:OPENCGA_HOST,accountId:$.cookie("bioinfo_account"),sessionId:$.cookie("bioinfo_sid"),file:a,objectId:b,fileFormat:this.selectedDataType,bucketId:this.opencgaLocation.bucketId,resume:!0}),this.panel.hide()},UploadWidget.prototype.uploadComplete=function(a){Ext.Msg.show({title:"Upload status",msg:a}),this.panel.enable(),Ext.getBody().unmask(),this.panel.hide()},UploadWidget.prototype.uploadFailed=function(){Ext.Msg.show({title:"Upload status",msg:"There was an error attempting to upload the file."}),this.panel.enable(),Ext.getBody().unmask()},AttributeManagerIDB.prototype={_createDatabase:function(){var a=indexedDB.open(this.dbName);a.onerror=function(a){console.log(a)},a.onsuccess=function(a){console.log(a)},a.onupgradeneeded=function(a){var b=a.target.result,c=b.createObjectStore("attribute",{autoIncrement:!0}),d=b.createObjectStore("attributeNameId",{autoIncrement:!0});c.createIndex("name","name",{unique:!1}),c.createIndex("attrId","attrId",{unique:!1}),d.createIndex("name","name",{unique:!0})}},_deleteDatabase:function(){var a=indexedDB.deleteDatabase(this.dbName);a.onsuccess=function(a){console.log(a)},a.onerror=function(a){console.log(a)}},addAttribute:function(a,b,c,d){var e=indexedDB.open(this.dbName);e.onerror=function(a){console.log(a)},e.onsuccess=function(){var f=e.result,g=f.transaction(["attribute","attributeNameId"],"readwrite"),h=g.objectStore("attribute"),i=g.objectStore("attributeNameId"),j=i.add({name:b,type:c});j.onsuccess=function(b){for(var c=b.target.result,e=0;e<a.length;e++){var f=a[e];h.add({name:f.name,attrId:c,value:d})}}}},removeAttribute:function(a){var b=indexedDB.open(this.dbName);b.onerror=function(a){console.log(a)},b.onsuccess=function(){var c=b.result,d=c.transaction(["attribute","attributeNameId"],"readwrite"),e=d.objectStore("attribute"),f=d.objectStore("attributeNameId"),g=f.index("name");g.getKey(a).onsuccess=function(a){var b=a.target.result;f.delete(b);var c=e.index("attrId"),d=IDBKeyRange.only(b);c.openKeyCursor(d).onsuccess=function(a){var b=a.target.result;console.log(b),b&&(e.delete(b.primaryKey),b.continue())}}}},getVertexAttributes:function(a,b){var c={},d=indexedDB.open(this.dbName);d.onerror=function(a){console.log(a)},d.onsuccess=function(){var e=d.result,f=e.transaction(["attribute","attributeNameId"]),g=f.objectStore("attribute"),h=f.objectStore("attributeNameId"),i=g.index("name"),j=IDBKeyRange.only(a.name);i.openCursor(j).onsuccess=function(a){var d=a.target.result;if(d){var e=a.target.result.value.attrId,f=a.target.result.value.value;h.get(e).onsuccess=function(a){var b=a.target.result.name;c[b]=f},d.continue()}else b(c)}}}},AttributeManagerStore.prototype={containsAttribute:function(a){for(var b=0;b<this.attributes.length;b++)if(this.attributes[b].name==a.name)return!0;return!1},isAttributeLocked:function(a){for(var b=0;b<this.attributes.length;b++)if(this.attributes[b].name==a&&this.attributes[b].locked===!0)return!0;return!1},addAttribute:function(a,b){return this.containsAttribute(a)?!1:(this.attributes.push(a),this._processAttribute(a),b!==!1&&(console.log("addAttribute - change:attributes"),this.trigger("change:attributes",{sender:this})),!0)},_processAttribute:function(a){a.id=a.name;var b;"id"!==a.name&&(b={xtype:"textfield",allowBlank:!0});var c={text:a.name,dataIndex:a.name,editor:b};"Selected"!==a.name&&this.columnsGrid.push(c),this.store.setFields(this.attributes)},addAttributes:function(a){for(var b=0;b<a.length;b++)this.addAttribute(a[b],!1);console.log("addAttributes - change:attributes"),this.trigger("change:attributes",{sender:this})},removeAttribute:function(a){for(var b=0;b<this.attributes.length;b++)if(this.attributes[b].name===a&&this.attributes[b].locked!==!0&&"Selected"!==this.attributes[b].name)return this.columnsGrid.splice(b,1),this.attributes.splice(b,1),this.store.setFields(this.attributes),console.log("removeAttribute - change:attributes"),this.trigger("change:attributes",{sender:this}),!0;return!1},updateAttribute:function(){console.log("TODO")},getAttribute:function(a){for(var b=0;b<this.attributes.length;b++)if(this.attributes[b].name==a)return this.attributes[b]},getAttributeNames:function(){for(var a=[],b=0;b<this.attributes.length;b++)a.push(this.attributes[b].name);return a},setRecordAttributeById:function(a,b,c){if(this.isAttributeLocked(b))return!1;var d=this.store.getById(a);d&&(d.set(b,c),d.commit())},setRecordAttributeByIds:function(a){this.store.suspendEvents();for(var b=0;b<a.length;b++){var c=a[b];if(!this.isAttributeLocked(c.attributeName)){var d=this.store.getById(c.id);if(d){d.beginEdit();for(var e in c)"id"!==e&&d.set(e,c[e]);d.commit(),d.endEdit()}}}this.store.resumeEvents(),this.store.fireEvent("refresh");for(var e in c)this.trigger("change:recordsAttribute",{records:a,attributeName:e,sender:this})},setRecordsAttribute:function(a,b,c){if(this.isAttributeLocked(b))return!1;this.store.suspendEvents();for(var d=0;d<a.length;d++){var e=a[d];e.set(b,c),e.commit()}this.store.resumeEvents(),this.store.fireEvent("refresh"),this.trigger("change:recordsAttribute",{records:a,attributeName:b,sender:this})},addRecord:function(a){this.store.add(a)},removeRecordById:function(a){var b=this.store.getById(a);b&&this.store.remove(b)},getValueByAttributeAndId:function(a,b){var c=this.store.getById(a);if(c){var d=c.get(b);return d?d:""}},getOrderedIdsByAttribute:function(a){for(var b=this.store.query().items,c=[],d="float",e=!0,f=0;f<b.length;f++){var g=b[f],h=g.get("id"),i=g.get(a);if(i||(i=""),e){var j=parseFloat(i);if(isNaN(j)){var d="string";e=!1}}c.push({id:h,value:i})}switch(d){case"float":c.sort(function(a,b){return a.value-b.value});break;default:c.sort(function(a,b){return a.value.localeCompare(b.value)})}return c},getIdsByAttributeValue:function(a,b){for(var c={},d=[],e=this.store.query(a,b,!1,!1,!0),f=0;f<e.items.length;f++){var g=e.items[f],h=g.data.id;c[h]!==!0&&d.push(g.data.id),c[h]=!0}return d},eachRecord:function(a){for(var b=this.store.query().items,c=0;c<b.length;c++){var d=b[c];a(d)}},getRecords:function(){var a=this.store.query().items;return a},getValuesByAttribute:function(a){for(var b=this.store.query().items,c=[],d=0;d<b.length;d++){var e=b[d],f=e.get(a),g=e.get("id");null!=f&&""!==f&&c.push({value:f,id:g})}return c},getSelectedValuesByAttribute:function(a){for(var b=this.store.query().items,c=[],d=0;d<b.length;d++){var e=b[d],f=e.get(a),g=e.get("id"),h=e.get("Selected");h===!0&&null!=f&&""!==f&&c.push({value:f,id:g})}return c},selectByItems:function(a){this.store.suspendEvents();for(var b=0;b<a.length;b++){var c=a[b],d=this.store.getById(c.id);d&&(d.set("Selected",!0),d.commit())}this.store.resumeEvents(),this.store.fireEvent("refresh")},deselectByItems:function(a){this.store.suspendEvents();for(var b=0;b<a.length;b++){var c=a[b],d=this.store.getById(c.id);d&&(d.set("Selected",!1),d.commit())}this.store.resumeEvents(),this.store.fireEvent("refresh")},selectAll:function(){this.store.suspendEvents();for(var a=this.store.query().items,b=0;b<a.length;b++){var c=a[b];c.set("Selected",!0),c.commit()}this.store.resumeEvents(),this.store.fireEvent("refresh")},deselectAll:function(){this.store.suspendEvents();for(var a=this.store.query().items,b=0;b<a.length;b++){var c=a[b];c.set("Selected",!1),c.commit()}this.store.resumeEvents(),this.store.fireEvent("refresh")},clean:function(){this.attributes=[],this.columnsGrid=[],this.attributes=[],this.filters={},this.store.removeAll(),this._processAttribute({name:"Selected",type:"boolean",defaultValue:!1}),this.store.setFields(this.attributes),console.log("clean - change:attributes"),this.trigger("change:attributes",{sender:this})},getAsFile:function(a){"undefined"==typeof a&&(a="	");
var b="";b+="#";for(var c=0;c<this.attributes.length;c++){var d=this.attributes[c].name;if("Selected"!==d&&(b+=d),c+1>=this.attributes.length)break;b+=a}b+="\n";for(var e=this.store.query().items,c=0;c<e.length;c++){for(var f=e[c],g=0;g<this.attributes.length;g++){var d=this.attributes[g].name;if("Selected"!==d&&(b+=f.get(d)),g+1>=this.attributes.length)break;b+=a}b+="\n"}return b},toJSON:function(){var a={};a.attributes=this.attributes,a.filters=this.filters,a.data=[];for(var b=this.store.query().items,c=0;c<b.length;c++){a.data.push([]);for(var d=0;d<this.attributes.length;d++)a.data[c].push(b[c].getData()[this.attributes[d].name])}return a},loadJSON:function(){}},AttributeManagerStore.prototype.updateAttribute=function(a,b,c,d){for(var e=0;e<this.attributes.length;e++)if(a!=b&&this.attributes[e].name==b)return!1;for(var e=0;e<this.attributes.length;e++)if(this.attributes[e].name==a)return a!=b&&(this.columnsGrid[e].text=b,this.columnsGrid[e].dataIndex=b,this.attributes[e].name=b),this.attributes[e].type=c,this.attributes[e].defaultValue=d,this.store.setFields(this.attributes),!0;return!1},AttributeManagerStore.prototype.removeRow=function(a,b){this.store.removeAt(this.store.find(a,b))},AttributeManagerStore.prototype.removeRows=function(a,b){this.store.removeAt(this.store.find(a,b));for(var c=-1;-1!=this.store.find(a,b);)c=this.store.find(a,b,c+1),this.store.removeAt(c),console.log(c)},AttributeManagerStore.prototype.removeAll=function(){this.store.removeAll(!0)},AttributeManagerStore.prototype.getNumberOfRows=function(){return this.store.count()},AttributeManagerStore.prototype.getUniqueByAttribute=function(a){return this.store.collect(a,!1,!0)},AttributeManagerStore.prototype.getPositionOfRow=function(a,b){var c=this.store.find(a,b);return c},AttributeManagerStore.prototype.getRowByIndex=function(a){var b=this.store.getAt(a);console.log(b.data)},AttributeManagerStore.prototype.getRowRangeIndex=function(a,b){for(var c=this.store.getRange(a,b),d=0;d<c.length;d++)console.log(c[d].data)},AttributeManagerStore.prototype.addFilter=function(a,b,c){return this.filters[a]||null==b||null==c?!1:(this.filters[a]={active:!1,attribute:b,value:c},this.enableFilter(a),!0)},AttributeManagerStore.prototype.removeFilter=function(a){return this.filters[a]?(this.disableFilter(a),delete this.filters[a],!0):!1},AttributeManagerStore.prototype.enableFilter=function(a){this.filters[a].active=!0;var b=new RegExp(""+this.filters[a].value);this.store.filter(Ext.create("Ext.util.Filter",{property:this.filters[a].attribute,value:b,root:"data"}))},AttributeManagerStore.prototype.disableFilter=function(a){this.filters[a].active=!1,this.store.clearFilter(!1);for(var b in this.filters)if(this.filters[b].active){var c=new RegExp(""+this.filters[b].value);this.store.filter(Ext.create("Ext.util.Filter",{property:this.filters[b].attribute,value:c,root:"data"}))}},AttributeManagerStore.prototype.checkFilters=function(){return console.log(this.store.isFiltered()),this.store.isFiltered()},AttributeManagerStore.prototype.clearFilters=function(){this.store.clearFilter(!1)},AttributeManagerStore.prototype.loadJSON=function(a){this.attributes=[],this.columnsGrid=[],console.log(a),this.filters=a.filters;for(var b=0;b<a.attributes.length;b++)this.addAttribute(a.attributes[b].name,a.attributes[b].type,a.attributes[b].defaultValue);this.addRows(a.data,!1)},AttributeManagerStore.prototype.setName=function(a,b){var c=this.store.getAt(this.store.find("id",a));c.set("Name",b),c.commit()},AttributeManagerStore.prototype.setAttributeByName=function(a,b,c){var d=this.store.getAt(this.store.find("Name",a));d&&(d.set(b,c),d.commit())},AttributeManagerStore.prototype.exportToTab=function(a,b){b&&this.store.clearFilter(!1);for(var c=[],d="",e="",f="",g=0;g<a.length;g++)d+=a[g].inputValue+"	",c.push(a[g].inputValue);for(var g=0;g<c.length;g++)for(var h=0;h<this.attributes.length;h++)if(c[g]==this.attributes[h].name){e+=this.attributes[h].type+"	",f+=this.attributes[h].defaultValue+"	";break}var i="";i+="#"+e+"\n",i+="#"+f+"\n",i+="#"+d+"\n";for(var j=this.store.getRange(),h=0;h<j.length;h++){for(var g=0;g<c.length;g++)i+=j[h].getData()[c[g]]+"	";i+="\n"}if(b)for(var k in this.filters)if(this.filters[k].active){var l=new RegExp(""+this.filters[k].value);this.store.filter(Ext.create("Ext.util.Filter",{property:this.filters[k].attribute,value:l,root:"data"}))}return i},CircosVertexRenderer.prototype={get:function(a){return this[a]},set:function(a,b,c){switch(this[a]=b,a){case"opacity":this.groupEl.setAttribute("opacity",this.opacity);break;case"labelSize":case"labelPositionY":case"labelPositionX":this.labelEl.setAttribute("font-size",this.labelSize),this._updateLabelElPosition(),this.labelEl.setAttribute("x",this.labelX),this.labelEl.setAttribute("y",this.labelY);break;case"shape":case"size":case"color":case"strokeSize":case"strokeColor":default:c!==!1&&this.update()}},setConfig:function(a){_.extend(this,a)},render:function(a){this.targetEl=a.target,this.vertex=a.vertex,this.coords=a.coords,this.labelText=this.vertex.id,this._render()},remove:function(){$(this.groupEl).remove()},update:function(){this.remove(),this._render(),console.log("update")},updateComplex:function(a,b){this.shape="circle",this.color=b.pieSlices.color,this.size=b.pieSlices.size,this.strokeColor=b.donutSlices.color,this.strokeSize=b.donutSlices.size,this.pieSlices=a.pieSlices,this.donutSlices=a.donutSlices,"undefined"==typeof this.pieSlices&&(this.pieSlices=[{size:b.pieSlices.size,area:b.pieSlices.area,color:b.pieSlices.color,labelSize:this.labelSize,labelOffset:0}]),"undefined"==typeof this.donutSlices&&(this.donutSlices=[{size:b.donutSlices.size,area:b.donutSlices.area,color:b.donutSlices.color,labelSize:this.labelSize,labelOffset:0}]),"undefined"==typeof a.pieSlices&&"undefined"==typeof a.donutSlices?this.update():(this.complex=!0,this.update(),this.complex=!1)},select:function(){$(this.groupEl).prepend(this.selectEl),this.selected=!0},deselect:function(){this._removeSelect(),this.selected=!1},move:function(){this.groupEl.setAttribute("transform","translate("+[this.coords.x-this.mid,this.coords.y-this.mid].join(",")+")")},setLabelContent:function(a){this.labelText=a,this.labelEl&&(this._updateLabelElPosition(),this.labelEl.setAttribute("x",this.labelX),this.labelEl.setAttribute("y",this.labelY),this.labelEl.textContent=this.labelText)},getSize:function(){return this._updateDrawParameters(),this.figureSize},toJSON:function(){return{shape:this.shape,size:this.size,color:this.color,strokeSize:this.strokeSize,strokeColor:this.strokeColor,opacity:this.opacity,labelSize:this.labelSize,labelColor:this.labelColor,labelPositionX:this.labelPositionX,labelPositionY:this.labelPositionY,labelText:this.labelText,pieSlices:this.pieSlices,donutSlices:this.donutSlices,donutSlices:this.donutSlices}},_updateDrawParameters:function(){var a=this.size+this.strokeSize;this.mid=a/2,this.figureSize=this.size+2*this.strokeSize,this._updateLabelElPosition()},_updateComplexDrawParameters:function(){var a=this.size+this.strokeSize;this.mid=a/2,this.maxPieSize=this._slicesMax(this.pieSlices),this.maxDonutSize=this._slicesMax(this.donutSlices),this.figureSize=this.maxPieSize+2*this.maxDonutSize,this._updateLabelElPosition()},_updateLabelElPosition:function(){var a=this._textWidthBySize(this.labelText,this.labelSize);this.labelX=this.labelPositionX+this.mid-a/2,this.labelY=this.labelPositionY+this.mid+this.labelSize/3},_textWidthBySize:function(a,b){return a.length*b/2+.5|0},_drawSelectShape:function(){if(this.complex===!0)this._drawSelectCircleShape();else switch(this.shape){case"circle":this._drawSelectCircleShape();break;case"ellipse":this._drawSelectEllipseShape();break;case"square":this._drawSelectSquareShape();break;case"rectangle":this._drawSelectRectangleShape()}},_drawSelectCircleShape:function(){this.selectEl=SVG.create("circle",{r:this.figureSize/2*1.3,cx:this.mid,cy:this.mid,opacity:"0.5",fill:"#999999","network-type":"select-vertex"})},_drawSelectEllipseShape:function(){this.selectEl=SVG.create("ellipse",{cx:this.mid,cy:this.mid,rx:this.figureSize,ry:.65*this.figureSize,opacity:"0.5",fill:"#999999","network-type":"select-vertex"})},_drawSelectSquareShape:function(){this.selectEl=SVG.create("rect",{x:.3*-this.mid,y:.3*-this.mid,width:2.6*this.mid,height:2.6*this.mid,stroke:"#999999","stroke-width":this.strokeSize,opacity:"0.5",fill:"#999999","network-type":"select-vertex"})},_drawSelectRectangleShape:function(){this.selectEl=SVG.create("rect",{x:.8*-this.mid,y:.3*-this.mid,width:3.6*this.mid,height:2.6*this.mid,stroke:"#999999","stroke-width":this.strokeSize,opacity:"0.5",fill:"#999999","network-type":"select-vertex"})},_removeSelect:function(){$(this.groupEl).find('[network-type="select-vertex"]').remove()},_render:function(){if(this.complex===!0)this._renderSlices(),this._drawSelectShape();else switch(this._updateDrawParameters(),this._drawSelectShape(),this.groupEl=SVG.create("g",{id:this.vertex.id,transform:"translate("+[this.coords.x-this.mid,this.coords.y-this.mid].join(",")+")",cursor:"pointer",opacity:this.opacity,"network-type":"vertex-svg"}),this.shape){case"circle":{SVG.addChild(this.groupEl,"circle",{r:this.mid,cx:this.mid,cy:this.mid,stroke:this.strokeColor,"stroke-width":this.strokeSize,fill:this.color,"network-type":"vertex"})}break;case"ellipse":{SVG.addChild(this.groupEl,"ellipse",{cx:this.mid,cy:this.mid,rx:1.5*this.mid,ry:this.mid,stroke:this.strokeColor,"stroke-width":this.strokeSize,fill:this.color,"network-type":"vertex"})}break;case"square":{SVG.addChild(this.groupEl,"rect",{x:0,y:0,width:2*this.mid,height:2*this.mid,stroke:this.strokeColor,"stroke-width":this.strokeSize,fill:this.color,"network-type":"vertex"})}break;case"rectangle":{SVG.addChild(this.groupEl,"rect",{x:.5*-this.mid,y:0,width:3*this.mid,height:2*this.mid,stroke:this.strokeColor,"stroke-width":this.strokeSize,fill:this.color,"network-type":"vertex"})}}this.labelEl=SVG.addChild(this.groupEl,"text",{x:this.labelX,y:this.labelY,"font-size":this.labelSize,fill:this.labelColor,"network-type":"vertex-label"}),this.labelEl.textContent=this.labelText,this.targetEl.appendChild(this.groupEl),this.selected&&this.select()},_renderSlices:function(){this._updateComplexDrawParameters(),this.groupEl=SVG.create("g",{id:this.vertex.id,transform:"translate("+[this.coords.x-this.mid,this.coords.y-this.mid].join(",")+")",cursor:"pointer",opacity:this.opacity,"network-type":"vertex-svg"});for(var a=this._sumAreas(this.pieSlices),b=359.999/a,c=0,d=0;d<this.pieSlices.length;d++){var e=this.pieSlices[d],f=e.area*b,g=c,h=g+f;c+=f;{var i=SVG.describeArc(this.mid,this.mid,e.size/2+.2,g,h);SVG.addChild(this.groupEl,"path",{d:i+["L",this.mid,this.mid].join(" "),fill:e.color,"network-type":"vertex"})}if("undefined"!=typeof e.text){var j,k,l=g+f/2,m=SVG._polarToCartesian(this.mid,this.mid,this.maxPieSize/2,l),n=SVG._polarToCartesian(this.mid,this.mid,this.mid+e.labelOffset,l),o=this._textWidthBySize(e.text,e.labelSize);if(n.x>m.x?m.y>n.y?(j=n.x,k=n.y):(j=n.x,k=n.y+.7*e.labelSize):m.y>n.y?(j=n.x-o-1,k=n.y):(j=n.x-o-1,k=n.y+.7*e.labelSize),e.labelOffset>=0){SVG.addChild(this.groupEl,"line",{x1:m.x,y1:m.y,x2:n.x,y2:n.y,stroke:"#999999","stroke-width":"0.7","network-type":"vertex-label"})}var p=SVG.addChild(this.groupEl,"text",{x:j,y:k,"font-size":e.labelSize,fill:this.labelColor,"network-type":"vertex-label"});p.textContent=e.text}}for(var a=this._sumAreas(this.donutSlices),b=359.9999/a,c=0,d=0;d<this.donutSlices.length;d++){var e=this.donutSlices[d],f=e.area*b,g=c,h=g+f;c+=f;{var i=SVG.describeArc(this.mid,this.mid,this.maxPieSize/2+e.size/2,g,h);SVG.addChild(this.groupEl,"path",{d:i,stroke:e.color,"stroke-width":e.size,fill:"none","network-type":"vertex"},0)}if("undefined"!=typeof e.text){var j,k,l=g+f/2,m=SVG._polarToCartesian(this.mid,this.mid,this.mid+e.labelOffset,l),n=SVG._polarToCartesian(this.mid,this.mid,this.mid+e.labelOffset,l),o=this._textWidthBySize(e.text,e.labelSize);if(n.x>m.x?m.y>n.y?(j=n.x,k=n.y):(j=n.x,k=n.y+e.labelSize/2):m.y>n.y?(j=n.x-o-3,k=n.y):(j=n.x-o-3,k=n.y+e.labelSize/2),e.labelOffset>=0){SVG.addChild(this.groupEl,"line",{x1:m.x,y1:m.y,x2:n.x,y2:n.y,stroke:"#999999","stroke-width":"0.7","network-type":"vertex-label"})}var p=SVG.addChild(this.groupEl,"text",{x:j,y:k,"font-size":e.labelSize,fill:this.labelColor,"network-type":"vertex-label"});p.textContent=e.text}}},_sumAreas:function(a){for(var b=0,c=0;c<a.length;c++){var d=a[c];b+=d.area}return b},_slicesMax:function(a){for(var b=0,c=0;c<a.length;c++)b=Math.max(b,a[c].size);return b},drawLink:function(a){var b=30,c=60,d=270,e=290,f=a.coords,g=a.target,h="",i=this.radius-10,j=(SVG._polarToCartesian(f.x,f.y,i,b),SVG._polarToCartesian(f.x,f.y,i,c)),k=(SVG._polarToCartesian(f.x,f.y,i,d),SVG._polarToCartesian(f.x,f.y,i,e));h+=SVG.describeArc(f.x,f.y,i,b,c)+" ",h+=["Q",f.x,f.y,k.x,k.y," "].join(" "),h+=SVG.describeArc(f.x,f.y,i,d,e)+" ",h+=["Q",f.x,f.y,j.x,j.y," "].join(" ");SVG.addChild(g,"path",{d:h,stroke:"red","stroke-width":2,opacity:1,fill:"crimson",visibility:"visible",opacity:.7,"z-index":10,"network-type":"vertex"})},drawSectors:function(a){for(var b,c=a.coords,d=(a.color,a.target),e=4,f=360*e/(2*Math.PI*this.radius),g=this._calculateTotalSize(this.sectors),h=360/g,i=0,j=[],k=0;k<this.sectors.length;k++)b=this.sectors[k],b.angleSize=b.size*h-f,b.angleStart=i+f/2,b.angleEnd=b.angleStart+b.angleSize,i+=b.angleSize+f,j.push(SVG.describeArc(c.x,c.y,this.radius,b.angleStart,b.angleEnd)+" ");for(var k=0;k<j.length;k++){SVG.addChild(d,"path",{d:j[k],stroke:this.sectors[k].color,"stroke-width":10,fill:"none","network-type":"vertex"})}}},DefaultEdgeRenderer.prototype={get:function(a){return this[a]},set:function(a,b){switch(this[a]=b,a){case"color":this.edgeEl.setAttribute("stroke",this.color),this.updateShape();break;case"size":this.edgeEl.setAttribute("stroke-width",this.size),this.updateShape();break;case"shape":this.updateShape();break;case"labelSize":this.labelEl.setAttribute("font-size",this.labelSize);break;case"opacity":this.edgeEl.setAttribute("opacity",this.opacity);break;default:this.update()}},setConfig:function(a){_.extend(this,a)},render:function(a){this.edge=a.edge,this.targetEl=a.target,this.sourceCoords=a.sourceCoords,this.targetCoords=a.targetCoords,this.sourceRenderer=a.sourceRenderer,this.targetRenderer=a.targetRenderer,this._render()},remove:function(){$(this.el).remove()},update:function(){this.edgeEl.setAttribute("stroke",this.color),this.edgeEl.setAttribute("stroke-width",this.size),this.labelEl.setAttribute("font-size",this.labelSize),this.updateShape()},updateShape:function(){"undirected"===this.shape?this.edgeEl.removeAttribute("marker-end"):this.edgeEl.setAttribute("marker-end","url("+this._getMarkerArrowId()+")"),this.move()},select:function(){this.selected||this._renderSelect()},deselect:function(){this.selected&&this._removeSelect()},setLabelContent:function(a){this.labelText=a;var b=$(this.el).find('text[network-type="edge-label"]')[0],c="";"string"===$.type(this.labelText)&&this.labelText.length>0&&(c=this.labelText),b.textContent=c},move:function(){var a=this._calculateEdgePath();this.edgeEl.setAttribute("d",a.d),this.labelEl.setAttribute("x",a.xl),this.labelEl.setAttribute("y",a.yl)},_calculateEdgePath:function(){var a,b,c;if(this.edge.source===this.edge.target){var d=.6*this.sourceRenderer.getSize(),e=1.8*this.sourceRenderer.getSize();b=this.sourceCoords.x-this.sourceRenderer.getSize(),c=this.sourceCoords.y-this.sourceRenderer.getSize();var f=this.sourceRenderer.getSize()/2;a=["M",this.sourceCoords.x-f,this.sourceCoords.y,"L",this.sourceCoords.x-d,this.sourceCoords.y,"C",this.sourceCoords.x-e,this.sourceCoords.y,this.sourceCoords.x,this.sourceCoords.y-e,this.sourceCoords.x,this.sourceCoords.y-d,"L",this.targetCoords.x,this.targetCoords.y-f].join(" ")}else{var g=this.targetCoords.x-this.sourceCoords.x,h=this.targetCoords.y-this.sourceCoords.y,i=Math.atan(h/g);isNaN(i)&&(i=0);var j=(this.sourceCoords.x+this.targetCoords.x)/2,k=(this.sourceCoords.y+this.targetCoords.y)/2,l="";if(0===this.edge.overlapCount)b=j-Math.sin(i),c=k+Math.cos(i);else{var m=15,n=this.edge.overlapCount%2,o=1,p=1;0===n&&(o=0,p=-1);var q=(this.edge.overlapCount+o)/2*m*p,r=q/1.33,s=j-Math.sin(i)*q,t=k+Math.cos(i)*q;b=j-Math.sin(i)*r,c=k+Math.cos(i)*r,l=["C",s,t,s,t].join(" ")}var u=this._getPerimeterPositions(i);a=["M",u.sx,u.sy,l,u.tx,u.ty].join(" ")}return{d:a,xl:b,yl:c}},_getPerimeterPositions:function(a){var b=this.targetCoords.x>this.sourceCoords.x?1:-1,c=this.sourceRenderer.getSize()/2,d=0;"undirected"!==this.shape&&(d=2*this.size);var e,f,g,h,i,j,k,l=d+this.targetRenderer.getSize()/2,m=Math.cos(a),n=Math.sin(a),o=Math.abs(m),p=Math.abs(n);switch(this.sourceRenderer.shape){case"square":i=c/o,j=c/p,k=j>=i?i:j,e=this.sourceCoords.x+b*m*k,f=this.sourceCoords.y+b*n*k;break;case"rectangle":i=1.4*c/o,j=c/p,k=j>=i?i:j,e=this.sourceCoords.x+b*m*k,f=this.sourceCoords.y+b*n*k;break;case"ellipse":e=this.sourceCoords.x+b*m*c*1.4,f=this.sourceCoords.y+b*n*c;break;case"circle":default:e=this.sourceCoords.x+b*m*c,f=this.sourceCoords.y+b*n*c}switch(this.targetRenderer.shape){case"square":i=l/o,j=l/p,k=j>=i?i:j,g=this.targetCoords.x-b*m*k,h=this.targetCoords.y-b*n*k;break;case"rectangle":i=1.4*l/o,j=l/p,k=j>=i?i:j,g=this.targetCoords.x-b*m*k,h=this.targetCoords.y-b*n*k;break;case"ellipse":g=this.targetCoords.x-b*m*l*1.4,h=this.targetCoords.y-b*n*l;break;case"circle":default:g=this.targetCoords.x-b*m*l,h=this.targetCoords.y-b*n*l}return{sx:e,sy:f,tx:g,ty:h}},_render:function(){var a=SVG.create("g",{cursor:"pointer",id:this.edge.id,opacity:this.opacity,"network-type":"edge-g"}),b=this._calculateEdgePath(),c=SVG.addChild(a,"path",{d:b.d,opacity:this.opacity,stroke:this.color,"stroke-width":this.size,cursor:"pointer",fill:"none","network-type":"edge"},0);"undirected"!==this.shape&&c.setAttribute("marker-end","url("+this._getMarkerArrowId()+")");var d=(this.sourceRenderer.getSize(),SVG.addChild(a,"text",{x:b.xl,y:b.yl,"font-size":this.labelSize,fill:this.labelColor,"network-type":"edge-label"}));d.textContent=this.edge.id,this.el=a,this.edgeEl=c,this.labelEl=d,SVG._insert(this.targetEl,a,0),this.selected&&this._renderSelect()},_renderSelect:function(){this.edgeEl.setAttribute("stroke-dasharray","5, 2"),this.selected=!0},_removeSelect:function(){this.edgeEl.removeAttribute("stroke-dasharray"),this.selected=!1},_getMarkerArrowId:function(){var a=-2*this.size-1,b="arrow-"+this.shape+"-"+a.toString().replace(".","_")+"-"+this.size.toString().replace(".","_")+"-"+this.color.replace("#",""),c="#"+b;return 0==$(c).length&&this._addArrowShape(this.shape,a,this.color,this.size,this.targetEl,b),c},_addArrowShape:function(a,b,c,d,e,f){if(0===d)var g=0;else var g=1/d;var h=g*(1+d/2),i=4*h,j=5*h,k=3*h;b=g*b;var l=$(e).find("defs"),m=l[0];0==l.length&&(m=SVG.addChild(e,"defs",{},0)),"undefined"==typeof c&&(c="#000000");var n=SVG.addChild(m,"marker",{id:f,orient:"auto",refX:b+j,refY:i/2,angle:10,style:"overflow:visible;"});switch(a){case"directed":{SVG.addChild(n,"path",{fill:c,d:["M0,0","V",i,"L",j,i/2,"Z"].join(" ")})}break;case"inhibited":{SVG.addChild(n,"path",{fill:c,d:["M",j,0,"V",j,"L",j/2,j,"L",j/2,0,"Z"].join(" ")})}break;case"dot":{SVG.addChild(n,"circle",{fill:c,cx:i/2,cy:j/2,r:k})}break;case"odot":{SVG.addChild(n,"circle",{fill:c,cx:i/2,cy:j/2,r:k}),SVG.addChild(n,"circle",{fill:"white",cx:i/2,cy:j/2,r:k-2})}}},toJSON:function(){return{shape:this.shape,size:this.size,color:this.color,strokeSize:this.strokeSize,strokeColor:this.strokeColor,opacity:this.opacity,labelSize:this.labelSize,labelColor:this.labelColor,labelText:this.labelText}}},DefaultVertexRenderer.prototype={get:function(a){return this[a]},set:function(a,b){switch(this[a]=b,a){case"color":this.vertexEl.setAttribute("fill",this.color);break;case"strokeColor":this.vertexEl.setAttribute("stroke",this.strokeColor);break;case"opacity":this.groupEl.setAttribute("opacity",this.opacity);break;case"labelSize":this.labelEl.setAttribute("font-size",this.labelSize),this._calculateLabelX();break;case"size":case"strokeSize":switch(this.shape){case"circle":this._updateCircleSize();break;case"ellipse":this._updateEllipseSize();break;case"square":this._updateSquareSize();break;case"rectangle":this._updateRectangleSize()}break;default:console.log("update"),this.update()}},setConfig:function(a){_.extend(this,a)},render:function(a){this.targetEl=a.target,this.vertex=a.vertex,this.coords=a.coords,this._render()},remove:function(){$(this.el).remove()},update:function(){this.remove(),this._render()},select:function(){this.selected||this._renderSelect()},deselect:function(){this.selected&&this._removeSelect()},move:function(a,b){var c=parseFloat(this.el.getAttribute("x")),d=parseFloat(this.el.getAttribute("y"));this.el.setAttribute("x",c+a),this.el.setAttribute("y",d+b)},setLabelContent:function(a){"undefined"!=typeof this.labelEl&&("string"===$.type(a)&&a.length>0&&(this.labelText=a,this.labelEl.textContent=a),this._calculateLabelX())},getSize:function(){return this.size+this.strokeSize},_render:function(){switch(this.shape){case"circle":this._drawCircleShape();break;case"ellipse":this._drawEllipseShape();break;case"square":this._drawSquareShape();break;case"rectangle":this._drawRectangleShape()}this.selected&&this._renderSelect()},_renderSelect:function(){switch(this.shape){case"circle":this._drawSelectCircleShape();break;case"ellipse":this._drawSelectEllipseShape();break;case"square":this._drawSelectSquareShape();break;case"rectangle":this._drawSelectRectangleShape()}this.selected=!0},_removeSelect:function(){$(this.el).find('[network-type="select-vertex"]').remove(),this.selected=!1},_calculateOffset:function(){var a=this.size+this.strokeSize,a=a+.3*a,b=a/2;return{size:a,midOffset:b}},_calculateLabelX:function(a){"undefined"==typeof a&&(a=this._calculateOffset());var b=a.midOffset-this.labelEl.textContent.length*this.labelSize/4;b=0>b?0:b;var c=a.midOffset+this.labelSize/3;this.labelEl.setAttribute("x",b),this.labelEl.setAttribute("y",c)},_drawCircleShape:function(){var a=this._calculateOffset(),b=SVG.create("svg",{id:this.vertex.id,cursor:"pointer",x:this.coords.x-a.midOffset,y:this.coords.y-a.midOffset,"network-type":"vertex-svg"}),c=SVG.addChild(b,"g",{opacity:this.opacity}),d=SVG.addChild(c,"circle",{cx:a.midOffset,cy:a.midOffset,r:this.size/2,stroke:this.strokeColor,"stroke-width":this.strokeSize,fill:this.color,"network-type":"vertex"});this.labelEl=SVG.addChild(b,"text",{x:a.midOffset,y:a.midOffset,"font-size":this.labelSize,fill:this.labelColor,"network-type":"vertex-label"});var e=this.vertex.id;"string"===$.type(this.labelText)&&this.labelText.length>0&&(e=this.labelText),this.labelEl.textContent=e,this._calculateLabelX(a),this.el=b,this.groupEl=c,this.vertexEl=d,this.targetEl.appendChild(b)},_updateCircleSize:function(){var a=this._calculateOffset();this.el.setAttribute("x",this.coords.x-a.midOffset),this.el.setAttribute("y",this.coords.y-a.midOffset),this.vertexEl.setAttribute("stroke-width",this.strokeSize),this.vertexEl.setAttribute("r",this.size/2),this.vertexEl.setAttribute("cx",a.midOffset),this.vertexEl.setAttribute("cy",a.midOffset),this.labelSize>0&&this._calculateLabelX(a),this.selected&&this._updateSelectShapeSize(a)},_drawEllipseShape:function(){var a=this._calculateOffset(),b=SVG.create("svg",{id:this.vertex.id,cursor:"pointer",x:this.coords.x-a.midOffset,y:this.coords.y-a.midOffset,"network-type":"vertex-svg"}),c=SVG.addChild(b,"g",{opacity:this.opacity}),d=SVG.addChild(c,"ellipse",{cx:a.midOffset,cy:a.midOffset,rx:this.size/1.7,ry:this.size/2.5,stroke:this.strokeColor,"stroke-width":this.strokeSize,fill:this.color,"network-type":"vertex"});this.labelEl=SVG.addChild(b,"text",{x:5,y:this.labelSize+a.size,"font-size":this.labelSize,fill:this.labelColor,"network-type":"vertex-label"});var e=this.vertex.id;"string"===$.type(this.labelText)&&this.labelText.length>0&&(e=this.labelText),this.labelEl.textContent=e,this._calculateLabelX(a),this.el=b,this.groupEl=c,this.vertexEl=d,this.targetEl.appendChild(b)},_updateEllipseSize:function(){var a=this._calculateOffset();this.el.setAttribute("x",this.coords.x-a.midOffset),this.el.setAttribute("y",this.coords.y-a.midOffset),this.vertexEl.setAttribute("stroke-width",this.strokeSize),this.vertexEl.setAttribute("cx",a.midOffset),this.vertexEl.setAttribute("cy",a.midOffset),this.vertexEl.setAttribute("rx",this.size/1.7),this.vertexEl.setAttribute("ry",this.size/2.5),this.labelSize>0&&this._calculateLabelX(a),this.selected&&this._updateSelectShapeSize(a)},_drawSquareShape:function(){var a=this._calculateOffset(),b=SVG.create("svg",{id:this.vertex.id,cursor:"pointer",x:this.coords.x-a.midOffset,y:this.coords.y-a.midOffset,"network-type":"vertex-svg"}),c=SVG.addChild(b,"g",{opacity:this.opacity}),d=SVG.addChild(c,"rect",{x:a.midOffset-this.size/2,y:a.midOffset-this.size/2,width:this.size,height:this.size,stroke:this.strokeColor,"stroke-width":this.strokeSize,fill:this.color,"network-type":"vertex"});this.labelEl=SVG.addChild(b,"text",{x:5,y:this.labelSize+a.size,"font-size":this.labelSize,fill:this.labelColor,"network-type":"vertex-label"});var e=this.vertex.id;"string"===$.type(this.labelText)&&this.labelText.length>0&&(e=this.labelText),this.labelEl.textContent=e,this._calculateLabelX(a),this.el=b,this.groupEl=c,this.vertexEl=d,this.targetEl.appendChild(b)},_updateSquareSize:function(){var a=this._calculateOffset();this.el.setAttribute("x",this.coords.x-a.midOffset),this.el.setAttribute("y",this.coords.y-a.midOffset),this.vertexEl.setAttribute("stroke-width",this.strokeSize),this.vertexEl.setAttribute("x",a.midOffset-this.size/2),this.vertexEl.setAttribute("y",a.midOffset-this.size/2),this.vertexEl.setAttribute("width",this.size),this.vertexEl.setAttribute("height",this.size),this.labelSize>0&&this._calculateLabelX(a),this.selected&&this._updateSelectShapeSize(a)},_drawRectangleShape:function(){var a=this._calculateOffset(),b=.3*this.size,c=b/2,d=SVG.create("svg",{id:this.vertex.id,cursor:"pointer",x:this.coords.x-a.midOffset,y:this.coords.y-a.midOffset,"network-type":"vertex-svg"}),e=SVG.addChild(d,"g",{opacity:this.opacity}),f=SVG.addChild(e,"rect",{x:a.midOffset-this.size/2-c,y:a.midOffset-this.size/2+c,width:this.size+b,height:this.size-b,stroke:this.strokeColor,"stroke-width":this.strokeSize,fill:this.color,"network-type":"vertex"});this.labelEl=SVG.addChild(d,"text",{x:5,y:this.labelSize+a.size,"font-size":this.labelSize,fill:this.labelColor,"network-type":"vertex-label"});var g=this.vertex.id;"string"===$.type(this.labelText)&&this.labelText.length>0&&(g=this.labelText),this.labelEl.textContent=g,this._calculateLabelX(a),this.el=d,this.groupEl=e,this.vertexEl=f,this.targetEl.appendChild(d)},_updateRectangleSize:function(){var a=this._calculateOffset(),b=.3*this.size,c=b/2;this.el.setAttribute("x",this.coords.x-a.midOffset),this.el.setAttribute("y",this.coords.y-a.midOffset),this.vertexEl.setAttribute("stroke-width",this.strokeSize),this.vertexEl.setAttribute("x",a.midOffset-this.size/2-c),this.vertexEl.setAttribute("y",a.midOffset-this.size/2+c),this.vertexEl.setAttribute("width",this.size+b),this.vertexEl.setAttribute("height",this.size-b),this.labelSize>0&&this._calculateLabelX(a),this.selected&&this._updateSelectShapeSize(a)},_drawSelectCircleShape:function(){var a=this._calculateOffset();this.selectEl=SVG.addChild(this.el,"circle",{r:a.midOffset,cx:a.midOffset,cy:a.midOffset,opacity:"0.5",fill:"#777777","network-type":"select-vertex"},0)},_updateSelectShapeSize:function(a){this.selectEl.setAttribute("r",a.midOffset),this.selectEl.setAttribute("cx",a.midOffset),this.selectEl.setAttribute("cy",a.midOffset)},_drawSelectEllipseShape:function(){this._drawSelectCircleShape()},_drawSelectSquareShape:function(){this._drawSelectCircleShape()},_drawSelectRectangleShape:function(){this._drawSelectCircleShape()},toJSON:function(){return{shape:this.shape,size:this.size,color:this.color,strokeSize:this.strokeSize,strokeColor:this.strokeColor,opacity:this.opacity,labelSize:this.labelSize,labelColor:this.labelColor,labelText:this.labelText}}},EdgeConfig.prototype={render:function(a){this.renderer.render(a)},toJSON:function(){return{id:this.id,renderer:this.renderer,type:this.type,visible:this.visible}}},Edge.prototype={getSource:function(){return this.source},setSource:function(a){this.source=a},getTarget:function(){return this.target},setTarget:function(a){this.target=a},toJSON:function(){return{id:this.id,source:this.source,target:this.target,weight:this.weight,directed:this.directed,relation:this.relation}}},GraphLayout={_init:function(){for(var a in this.verticesList){var b=this.verticesList[a];"undefined"==typeof b.x&&(b.x=0),"undefined"==typeof b.y&&(b.y=0),"undefined"==typeof b.z&&(b.z=0),this.vertices[b.id]=b}},getRandomArbitrary:function(a,b){return Math.random()*(b-a)+a},applyRandom3d:function(){for(var a in this.vertices){var b=this.vertices[a];b.x=this.getRandomArbitrary(-300,300),b.y=this.getRandomArbitrary(-300,300),b.z=this.getRandomArbitrary(10,600)}},sphereSurface:function(a,b,c,d){for(var e=a.length,f=0;f<a.length;f++){var g=a[f],h=b.config.getVertexConfig(g),i=h.coords,j=Math.acos(-1+2*f/e),k=Math.sqrt(e*Math.PI)*j;i.x=c*Math.cos(k)*Math.sin(j),i.y=c*Math.sin(k)*Math.sin(j),i.z=c*Math.cos(j)+d}},random2d:function(a,b,c){for(var d,e,f=a.graph.vertices,g=0,h=f.length;h>g;g++){var i=f[g];"undefined"!=typeof i&&(d=this.getRandomArbitrary(0,b),e=this.getRandomArbitrary(0,c),a.setVertexCoords(i,d,e))}},circle:function(a,b,c,d){var e=a.graph.vertices;"undefined"!=typeof d&&(e=d);for(var f,g,h=c/2,i=b/2,j=c/2,k=0,l=e.length;l>k;k++){var m=e[k];"undefined"!=typeof m&&(f=i+h*Math.sin(2*k*Math.PI/e.length),g=j+h*Math.cos(2*k*Math.PI/e.length),a.setVertexCoords(m,f,g))}},force:function(a){{var b=a.network,c=a.width,d=a.height,e=a.friction,f=a.gravity,g=a.chargeDistance,h=a.linkStrength,i=a.linkDistance,j=a.charge,k=a.multipliers,l=a.end,m=a.simulation;"undefined"==typeof a.config?{vertices:{},edges:{}}:a.config}if("undefined"==typeof b)return void console.log("graph not defined");var n=[],o=[],p=[],q=d3.layout.force();q.size([c,d]),"undefined"!=typeof e&&q.friction(e),"undefined"!=typeof f&&q.gravity(f),"undefined"!=typeof g&&q.chargeDistance(g);var r=b.graph.vertices,s=b.graph.edges;console.time("Force directed preload");for(var t=0,u=r.length;u>t;t++){var v=r[t];if("undefined"!=typeof v){var w=b.config.getVertexConfig(v),x={id:v.id,index:t,x:w.coords.x,y:w.coords.y};n.push(x),o[v.id]=x}}q.nodes(n);for(var t=0,u=s.length;u>t;t++){var y=s[t];"undefined"!=typeof y&&p.push({source:o[y.source.id],target:o[y.target.id]})}if(q.links(p),q.linkDistance("undefined"!=typeof i?isNaN(i)?function(a){var c=b.config.getVertexConfig(a.source),d=b.config.getVertexConfig(a.target),e=b.edgeAttributeManager.getValueByAttributeAndId(a.id,i),f=isNaN(e)?1.5*(c.renderer.size+d.renderer.size):e*k.linkDistance;return f}:i:function(a){var c=b.config.getVertexConfig(a.source),d=b.config.getVertexConfig(a.target);return c.renderer.size+1.5*d.renderer.size}),"undefined"!=typeof h&&q.linkStrength(isNaN(h)?function(a){var c=b.edgeAttributeManager.getValueByAttributeAndId(a.id,h),d=isNaN(c)?1:c*k.linkStrength;return d}:h),q.charge("undefined"!=typeof j?isNaN(j)?function(a){var c=b.config.getVertexConfig(a),d=parseFloat(b.vertexAttributeManager.getValueByAttributeAndId(v.id,j)),e=isNaN(d)?-10*c.renderer.getSize():d*k.charge;return e}:j:function(a){var c=b.config.getVertexConfig(a);return-10*c.renderer.getSize()}),console.timeEnd("Force directed preload"),q.on("end",function(a){console.log(a),l(n)}),m===!0)q.on("tick",function(){l(n),console.log(q.alpha()),q.alpha()<.025&&q.stop()}),q.start();else{console.time("D3 Force directed layout"),q.start();for(var z=0;q.alpha()>.025&&(q.tick(),!(z++>1e3)););q.stop(),console.timeEnd("D3 Force directed layout")}}},Graph.prototype={setType:function(a){this.graphType=a},clean:function(){this.numberOfVertices=0,this.numberOfEdges=0,this.vertices=[],this.edges=[],this.verticesIndex={},this.edgesIndex={},this.edgeDraw={}
},addEdge:function(a){if(null==a.source||null==a.target)return!1;if(this.containsEdge(a))return!1;this.addVertex(a.source),this.addVertex(a.target);var b=this.edges.push(a),c=b-1;this.edgesIndex[a.id]=c,a.source.addEdge(a),a.source!==a.target&&a.target.addEdge(a),this.trigger("edge:add",{edge:a,graph:this});var d=a.source.id+a.target.id,e=a.target.id+a.source.id;return"undefined"==typeof this.edgeDraw[d]&&(this.edgeDraw[d]=-1),"undefined"==typeof this.edgeDraw[e]&&(this.edgeDraw[e]=-1),this.edgeDraw[d]++,this.edgeDraw[e]++,a.overlapCount=this.edgeDraw[d],this.numberOfEdges++,!0},addVertex:function(a){if(null==a)return!1;if(this.containsVertex(a))return!1;var b=this.vertices.push(a),c=b-1;return this.verticesIndex[a.id]=c,this.trigger("vertex:add",{vertex:a,graph:this}),this.numberOfVertices++,!0},removeEdge:function(a){if(null==a)return!1;if(!this.containsEdge(a))return!1;a.source.removeEdge(a),a.target.removeEdge(a);var b=this.edgesIndex[a.id];return delete this.edgesIndex[a.id],delete this.edges[b],this.trigger("edge:remove",{edge:a,graph:this}),this.numberOfEdges--,!0},removeVertex:function(a){if(null==a)return!1;if(!this.containsVertex(a))return!1;for(var b=0;b<a.edges.length;b++){var c=a.edges[b];c.source!==a&&c.source.removeEdge(c),c.target!==a&&c.target.removeEdge(c);var d=this.edgesIndex[c.id];delete this.edgesIndex[c.id],delete this.edges[d],this.trigger("edge:remove",{edge:c,graph:this}),this.numberOfEdges--}a.removeEdges();var d=this.verticesIndex[a.id];return delete this.verticesIndex[a.id],delete this.vertices[d],this.trigger("vertex:remove",{vertex:a,graph:this}),this.numberOfVertices--,!0},containsEdge:function(a){return"undefined"!=typeof this.edgesIndex[a.id]?!0:!1},containsVertex:function(a){return"undefined"!=typeof this.verticesIndex[a.id]?!0:!1},getVertexById:function(a){return this.vertices[this.verticesIndex[a]]},getEdgeById:function(a){return this.edges[this.edgesIndex[a]]},addLayout:function(a){this.display.layouts[a.id]=a},getAsSIF:function(a){"undefined"==typeof a&&(a="	");for(var b="",c=0;c<this.edges.length;c++){var d=this.edges[c];if("undefined"!=typeof d){var e="";e=d.source.id+a+d.relation+a+d.target.id+"\n",b+=e}}for(var c=0;c<this.vertices.length;c++){var f=this.vertices[c];if("undefined"!=typeof f){var e="";0==f.edges.length&&(e=f.id+a+a+"\n"),b+=e}}return b},getAsDOT:function(){var a="graph network {\n"+this.getAsSIF(" ")+"}";return a},toJSON:function(){for(var a=[],b=0;b<this.vertices.length;b++)"undefined"!=typeof this.vertices[b]&&a.push(this.vertices[b]);for(var c=[],b=0;b<this.edges.length;b++)"undefined"!=typeof this.edges[b]&&c.push(this.edges[b]);return{vertices:a,edges:c}}},NetworkConfig.prototype={clean:function(){this.vertices={},this.edges={},this.general={}},setVertexConfig:function(a){this.vertices[a.id]=a},getVertexConfig:function(a){var b=this.vertices[a.id];return"undefined"==typeof b&&this.setVertexConfig(new VertexConfig({id:a.id})),this.vertices[a.id]},setEdgeConfig:function(a){this.edges[a.id]=a},getEdgeConfig:function(a){var b=this.edges[a.id];return"undefined"==typeof b&&this.setEdgeConfig(new EdgeConfig({id:a.id})),this.edges[a.id]},removeVertex:function(a){delete this.vertices[a.id]},removeEdge:function(a){delete this.edges[a.id]},toJSON:function(){return{vertices:this.vertices,edges:this.edges}}},NetworkSession.prototype={loadGraph:function(a){this.graph=a.toJSON()},loadConfig:function(a){this.config=a},loadVertexAttributes:function(a){this.attributes.vertices=a.toJSON()},loadEdgeAttributes:function(a){this.attributes.edges=a.toJSON()},getBackgroundImages:function(){return this.general.backgroundImages},setBackgroundImages:function(a){this.general.backgroundImages=a},getBackgroundColor:function(){return this.general.backgroundColor},setBackgroundColor:function(a){this.general.backgroundColor=a},setVertexDefault:function(a,b){this.general.vertexDefaults[a]=b},setEdgeDefault:function(a,b){this.general.edgeDefaults[a]=b},getVertexDefault:function(a){return this.general.vertexDefaults[a]},getEdgeDefault:function(a){return this.general.edgeDefaults[a]},getVertexDefaults:function(){return this.general.vertexDefaults},getEdgeDefaults:function(){return this.general.edgeDefaults},getVisualSets:function(){return this.general.visualSets},loadVisualSets:function(a){this.general.visualSets=a},setVisualSet:function(a,b){this.general.visualSets[a]=b},setCenter:function(a){this.general.center=a},getCenter:function(){return this.general.center},getZoom:function(){return this.general.zoom},setZoom:function(a){this.general.zoom=a},loadJSON:function(a){a.version===this.version?_.extend(this,a):(console.log("Could not load session, does not match with current version"),localStorage.removeItem("CELLMAPS_SESSION"))},toJSON:function(){return{general:this.general,config:this.config,graph:this.graph,attributes:this.attributes,version:this.version}}},Network.prototype={setGraph:function(a){console.time("Network.setGraph"),this.batchStart(),this.clean();for(var b=a.edges,c=a.vertices,d=0,e=c.length;e>d;d++){var f=c[d];"undefined"!=typeof f&&this.addVertex({vertex:f,vertexConfig:new VertexConfig({rendererConfig:this.session.getVertexDefaults()})})}for(var d=0,e=b.length;e>d;d++){var g=b[d];"undefined"!=typeof g&&this.addEdge({edge:g,edgeConfig:new EdgeConfig({rendererConfig:this.session.getEdgeDefaults()})})}this.batchEnd(),console.timeEnd("Network.setGraph")},getGraph:function(){return this.graph},draw:function(a){console.time("Network.draw");var b=a.parentNode;b.removeChild(a),this.batchStart();for(var c=this.graph.edges,d=this.graph.vertices,e=0,f=d.length;f>e;e++){var g=d[e];"undefined"!=typeof g&&this.renderVertex(g,a)}for(var e=0,f=c.length;f>e;e++){var h=c[e];"undefined"!=typeof h&&this.renderEdge(h,a)}this.batchEnd(),console.timeEnd("Network.draw"),b.appendChild(a),this.trigger("draw")},addVertex:function(a){var b=a.vertex,c=a.vertexConfig,d=a.target,e=a.name,f=this.graph.addVertex(b);if(f){"undefined"==typeof c&&(c=new VertexConfig({rendererConfig:this.session.getVertexDefaults()})),c.id=b.id,this.setVertexConfig(c),"undefined"!=typeof d&&this.renderVertex(b,d);var g=b.id;"undefined"!=typeof e&&(g=e),this.vertexAttributeManager.addRecord({id:b.id,Name:g}),0==this.batchFlag&&(this.vertexAttributeManager.trigger("change:data",{sender:this}),this.trigger("add:vertex"))}return f},addEdge:function(a){var b=a.edge,c=a.edgeConfig,d=a.target,e=this.graph.addEdge(b);return e&&("undefined"==typeof c&&(c=new EdgeConfig({rendererConfig:this.session.getEdgeDefaults()})),c.id=b.id,this.setEdgeConfig(c),"undefined"!=typeof d&&this.renderEdge(b,d),this.edgeAttributeManager.addRecord({id:b.id,Name:b.id,Relation:b.relation}),0==this.batchFlag&&(this.edgeAttributeManager.trigger("change:data",{sender:this}),this.trigger("add:edge"))),e},setVertexConfig:function(a){this.config.setVertexConfig(a)},setEdgeConfig:function(a){this.config.setEdgeConfig(a)},getVertexConfig:function(a){return this.config.getVertexConfig(a)},getEdgeConfig:function(a){return this.config.getEdgeConfig(a)},getVertexById:function(a){return this.graph.getVertexById(a)},getEdgeById:function(a){return this.graph.getEdgeById(a)},removeVertex:function(a){var b=this.config.getVertexConfig(a);b.renderer.remove();for(var c=0;c<a.edges.length;c++){var d=a.edges[c],e=this.config.getEdgeConfig(d);e.renderer.remove(),this.config.removeEdge(d),this.edgeAttributeManager.removeRecordById(d.id)}this.graph.removeVertex(a),this.config.removeVertex(a),this.vertexAttributeManager.removeRecordById(a.id),0==this.batchFlag&&this.trigger("remove:vertex")},removeEdge:function(a){var b=this.config.getEdgeConfig(a);b.renderer.remove(),this.graph.removeEdge(a),this.config.removeEdge(a),this.edgeAttributeManager.removeRecordById(a.id),0==this.batchFlag&&this.trigger("remove:edge")},removeVertices:function(a){this.batchStart();for(var b=0,c=a.length;c>b;b++){var d=a[b];"undefined"!=typeof d&&this.removeVertex(d)}this.batchEnd(),this.trigger("remove:vertices")},renderVertex:function(a,b){var c=this.config.getVertexConfig(a);c.render({coords:c.coords,vertex:a,target:b})},renderEdge:function(a,b){var c=this.config.getEdgeConfig(a),d=this.config.getVertexConfig(a.source),e=this.config.getVertexConfig(a.target);c.render({sourceCoords:d.coords,targetCoords:e.coords,sourceRenderer:d.renderer,targetRenderer:e.renderer,edge:a,target:b})},setVertexLabel:function(a,b){this.vertexAttributeManager.setRecordAttributeById(a.id,"Name",b)},setVertexLabelByAttribute:function(a){for(var b=this.graph.vertices,c=0,d=b.length;d>c;c++){var e=b[c];if("undefined"!=typeof e){var f=this.getVertexConfig(e),g=e.id,h=this.vertexAttributeManager.getValueByAttributeAndId(g,a);f.renderer.setLabelContent(h)}}},setEdgeLabel:function(a,b){this.edgeAttributeManager.setRecordAttributeById(a.id,"Name",b)},setEdgeLabelByAttribute:function(a){for(var b=this.graph.edges,c=0,d=b.length;d>c;c++){var e=b[c];if("undefined"!=typeof e){var f=this.getEdgeConfig(e),g=e.id,h=this.edgeAttributeManager.getValueByAttributeAndId(g,a);f.renderer.setLabelContent(h)}}},selectVertex:function(a){var b=this.config.getVertexConfig(a);b.renderer.select(),this.vertexAttributeManager.setRecordAttributeById(a.id,"Selected",!0)},selectEdge:function(a){var b=this.config.getEdgeConfig(a);b.renderer.select(),this.edgeAttributeManager.setRecordAttributeById(a.id,"Selected",!0)},selectVerticesByIds:function(a){for(var b=[],c=0,d=a.length;d>c;c++){var e=a[c],f=this.getVertexById(e),g=this.config.getVertexConfig(f);g.renderer.select(),b.push(f)}return this.vertexAttributeManager.selectByItems(b),b},selectByArea:function(a,b,c,d){for(var e=[],f=[],g=this.graph.vertices,h=0,i=g.length;i>h;h++){var j=g[h];if("undefined"!=typeof j){var k=this.getVertexConfig(j);if(k.coords.x>=a&&k.coords.x<=a+c&&k.coords.y>=b&&k.coords.y<=b+d){k.renderer.select(),e.push(j);for(var l=0;l<j.edges.length;l++){var m=j.edges[l],n=this.config.getEdgeConfig(m);n.renderer.selected===!1&&(n.renderer.select(),f.push(m))}}}}return this.vertexAttributeManager.selectByItems(e),this.edgeAttributeManager.selectByItems(f),{vertices:e,edges:f}},deselectVertex:function(a){var b=this.config.getVertexConfig(a);b.renderer.deselect(),this.vertexAttributeManager.setRecordAttributeById(a.id,"Selected",!1)},deselectEdge:function(a){var b=this.config.getEdgeConfig(a);b.renderer.deselect(),this.edgeAttributeManager.setRecordAttributeById(a.id,"Selected",!1)},deselectAllVertices:function(){for(var a=this.graph.vertices,b=0,c=a.length;c>b;b++){var d=a[b];if("undefined"!=typeof d){var e=this.config.getVertexConfig(d);e.renderer.deselect()}}this.vertexAttributeManager.deselectAll()},deselectAllEdges:function(){for(var a=this.graph.edges,b=0,c=a.length;c>b;b++){var d=a[b];if("undefined"!=typeof d){var e=this.config.getEdgeConfig(d);e.renderer.deselect()}}this.edgeAttributeManager.deselectAll()},selectAllVertices:function(){for(var a=[],b=this.graph.vertices,c=0,d=b.length;d>c;c++){var e=b[c];if("undefined"!=typeof e){var f=this.config.getVertexConfig(e);f.renderer.select(),a.push(e)}}return this.vertexAttributeManager.selectAll(),a},selectVerticesNeighbour:function(a){for(var b=[],c={},d=0,e=a.length;e>d;d++){var f=a[d];if("undefined"!=typeof f){c[f.id]=f,b.push(f);var g=this.config.getVertexConfig(f);g.renderer.select();for(var h=0;h<f.edges.length;h++){var i=f.edges[h];if("undefined"==typeof c[i.source.id]){c[i.source.id]=i.source,b.push(i.source);var g=this.config.getVertexConfig(i.source);g.renderer.select()}if("undefined"==typeof c[i.target.id]){c[i.target.id]=i.target,b.push(i.target);var g=this.config.getVertexConfig(i.target);g.renderer.select()}}}}return this.vertexAttributeManager.selectByItems(b),b},selectEdgesNeighbour:function(a){for(var b=[],c={},d=0,e=a.length;e>d;d++){var f=a[d];if("undefined"!=typeof f)for(var g=0;g<f.edges.length;g++){var h=f.edges[g];if("undefined"==typeof c[h.id]){c[h.id]=h,b.push(h);var i=this.config.getEdgeConfig(h);i.renderer.select()}}}return this.edgeAttributeManager.selectByItems(b),b},selectVerticesInvert:function(){for(var a=[],b=this.graph.vertices,c=0,d=b.length;d>c;c++){var e=b[c];if("undefined"!=typeof e){var f=this.config.getVertexConfig(e);f.renderer.selected?f.renderer.deselect():(a.push(e),f.renderer.select())}}return this.vertexAttributeManager.selectByItems(a),a},selectAllEdges:function(){for(var a=[],b=this.graph.edges,c=0,d=b.length;d>c;c++){var e=b[c];if("undefined"!=typeof e){var f=this.config.getEdgeConfig(e);f.renderer.select(),a.push(e)}}return this.edgeAttributeManager.selectAll(),a},selectVerticesByAttribute:function(a,b){for(var c=[],d=this.vertexAttributeManager.getIdsByAttributeValue(a,b),e=0,f=d.length;f>e;e++){var g=d[e],h=this.graph.getVertexById(g),i=this.config.getVertexConfig(h);i.renderer.select(),c.push(h)}return this.vertexAttributeManager.selectByItems(c),c},selectEdgesByAttribute:function(a,b){for(var c=[],d=this.edgeAttributeManager.getIdsByAttributeValue(a,b),e=0,f=d.length;f>e;e++){var g=d[e],h=this.graph.getEdgeById(g),i=this.config.getEdgeConfig(h);i.renderer.select(),c.push(h)}return this.vertexAttributeManager.selectByItems(c),c},moveVertex:function(a,b,c,d){var e=this.config.getVertexConfig(a);e.move(b,c,d),this._updateEdgeCoords(a)},_updateEdgeCoords:function(a){for(var b=0;b<a.edges.length;b++){var c=a.edges[b],d=this.getEdgeConfig(c),e=this.getVertexConfig(c.source),f=this.getVertexConfig(c.target);a===c.source&&d.renderer.move(e.coords),a===c.target&&d.renderer.move(f.coords)}},setVertexCoords:function(a,b,c,d){var e=this.config.getVertexConfig(a);e.setCoords(b,c,d),this._updateEdgeCoords(a)},setVertexCoordsById:function(a,b,c,d){var e=this.getVertexById(a);this.setVertexCoords(e,b,c,d)},getVertexCoords:function(a){var b=this.config.getVertexConfig(a);return b.getCoords()},isVertexSelected:function(a){var b=this.config.getVertexConfig(a);return b.renderer.selected},isEdgeSelected:function(a){var b=this.config.getEdgeConfig(a);return b.renderer.selected},setVertexRendererAttribute:function(a,b,c,d){var e=this.config.getVertexConfig(a);e.renderer.set(b,c),d===!0&&this._updateVertexEdgesRenderer(a)},_updateVertexEdgesRenderer:function(a){for(var b=0;b<a.edges.length;b++){var c=a.edges[b];if("undefined"!=typeof c){var d=this.getEdgeConfig(c);d.renderer.updateShape()}}},setVerticesRendererAttribute:function(a,b,c){for(var d=this.graph.vertices,e=0,f=d.length;f>e;e++){var g=d[e];"undefined"!=typeof g&&this.setVertexRendererAttribute(g,a,b,c)}},setVerticesRendererAttributeMap:function(a,b,c){for(var d in c)for(var e=c[d],f=this.vertexAttributeManager.getIdsByAttributeValue(b,d),g=0,h=f.length;h>g;g++){var i=f[g],j=this.graph.getVertexById(i);this.setVertexRendererAttribute(j,a,e)}},setVerticesRendererAttributeListMap:function(a){var b=this,c=a.settings,d=a.defaults;if(c.length>0){var e=function(a,b){return b.values.length-a.values.length},f=function(a){if(1==a.length)return!0;for(var b=a[0].values.length,c=1;c<a.length;c++)if(a[c].values.length!==b)return!1;return!0},g=function(a){if(a.length>1){for(var b=1;b<a.length;b++){var c=a[b].values.length;if(c>1)return!1}return!0}return!1};this.vertexAttributeManager.eachRecord(function(a){for(var h={},i=a.get("id"),j=b.graph.getVertexById(i),k=b.config.getVertexConfig(j),l=0;l<c.length;l++){var m=c[l].configs,n=c[l].label,o=c[l].slicesName,p=d[o];if(m.length>0){for(var q=[],r=0;r<m.length;r++){var s=m[r];if("undefined"!=typeof s){var t=a.get(s.attribute);if(t){var u=t.split(",");q.push({values:u,config:s})}}}q.sort(e);var v=[];if(q.length>0)if(f(q))for(var w=q[0].values.length,r=0;w>r;r++){var x={};for(var y in p)x[y]=p[y];for(var z=0;z<q.length;z++){var A=q[z],B=A.values[r],C=A.config.map[B];n.enable&&A.config.attribute===n.attribute&&(x.text=B,x.labelSize=n.size,x.labelOffset=n.offset),"undefined"!=typeof C&&(x[A.config.displayAttribute]=C)}v.push(x)}else if(g(q))for(var w=q[0].values.length,r=0;w>r;r++){var x={};for(var y in p)x[y]=p[y];var A=q[0],B=A.values[r],C=A.config.map[B];n.enable&&A.config.attribute===n.attribute&&(x.text=B,x.labelSize=n.size,x.labelOffset=n.offset),"undefined"!=typeof C&&(x[A.config.displayAttribute]=C);for(var z=1;z<q.length;z++)A=q[z],B=A.values[0],n.enable&&A.config.attribute===n.attribute&&(x.text=B,x.labelSize=n.size,x.labelOffset=n.offset),C=A.config.map[B],"undefined"!=typeof C&&(x[A.config.displayAttribute]=C);v.push(x)}else console.log(a.get("id"));v.length>0&&(h[o]=v)}}k.renderer.updateComplex(h,d),b._updateEdgeCoords(j)})}},setEdgeRendererAttribute:function(a,b,c){var d=this.config.getEdgeConfig(a);d.renderer.set(b,c)},setEdgesRendererAttribute:function(a,b){for(var c=this.graph.edges,d=0,e=c.length;e>d;d++){var f=c[d];"undefined"!=typeof f&&this.setEdgeRendererAttribute(f,a,b)}},setEdgesRendererAttributeMap:function(a,b,c){for(var d in c)for(var e=c[d],f=this.edgeAttributeManager.getIdsByAttributeValue(b,d),g=0,h=f.length;h>g;g++){var i=f[g],j=this.graph.getEdgeById(i);this.setEdgeRendererAttribute(j,a,e)}},getVerticesLength:function(){return this.graph.numberOfVertices},getEdgesLength:function(){return this.graph.numberOfEdges},getVertices:function(){for(var a=[],b=this.graph.vertices,c=0,d=b.length;d>c;c++){var e=b[c];"undefined"!=typeof e&&a.push(e)}return a},getEdges:function(){for(var a=[],b=this.graph.edges,c=0,d=b.length;d>c;c++){var e=b[c];"undefined"!=typeof e&&a.push(e)}return a},getVerticesOrdered:function(a){for(var b=[],c=this.vertexAttributeManager.getOrderedIdsByAttribute(a),d=0,e=c.length;e>d;d++){var f=c[d].id,g=this.graph.getVertexById(f);"undefined"!=typeof g&&b.push(g)}return b},clean:function(){console.time("Network.clean"),this.graph.clean(),this.config.clean(),this.vertexAttributeManager.clean(),this.edgeAttributeManager.clean();var a=[{name:"id",type:"string",defaultValue:"none",locked:!0},{name:"Name",type:"string",defaultValue:"none"}],b=[{name:"id",type:"string",defaultValue:"none",locked:!0},{name:"Name",type:"string",defaultValue:"none"},{name:"Relation",type:"string",defaultValue:"none"}];this.vertexAttributeManager.addAttributes(a),this.edgeAttributeManager.addAttributes(b),this.trigger("clean"),console.timeEnd("Network.clean")},getAsSIF:function(a){return this.graph.getAsSIF(a)},getAsSIFCustomRelation:function(a,b){"undefined"==typeof a&&(a="	");for(var c=this.graph.vertices,d=this.graph.edges,e="",f=0;f<d.length;f++){var g=d[f];if("undefined"!=typeof g){var h="",i=this.edgeAttributeManager.getValueByAttributeAndId(g.id,b);h=g.source.id+a+i+a+g.target.id+"\n",e+=h}}for(var f=0;f<c.length;f++){var j=c[f];if("undefined"!=typeof j){var h="";0==j.edges.length&&(h=j.id+a+a+"\n"),e+=h}}return e},saveSession:function(){this.session.loadGraph(this.graph),this.session.loadConfig(this.config),this.session.loadVertexAttributes(this.vertexAttributeManager),this.session.loadEdgeAttributes(this.edgeAttributeManager)},loadSession:function(){this.clean(),this.batchStart(),console.time("Network.loadJSON");for(var a=0;a<this.session.graph.vertices.length;a++){var b=this.session.graph.vertices[a],c=new Vertex({id:b.id}),d=this.session.config.vertices[b.id];if("undefined"==typeof d)var e=new VertexConfig({rendererConfig:this.session.getVertexDefaults()});else var e=new VertexConfig({id:b.id,coords:this.session.config.vertices[b.id].coords,rendererConfig:d.renderer});this.addVertex({vertex:c,vertexConfig:e})}for(var a=0;a<this.session.graph.edges.length;a++){var f=this.session.graph.edges[a],g=this.getVertexById(f.source.id),h=this.getVertexById(f.target.id),i=new Edge({id:f.id,relation:f.relation,source:g,target:h}),d=this.session.config.edges[f.id];if("undefined"==typeof d)var j=new EdgeConfig({rendererConfig:this.session.getEdgeDefaults()});else var j=new EdgeConfig({id:f.id,coords:this.session.config.edges[f.id].coords,rendererConfig:d.renderer});this.addEdge({edge:i,edgeConfig:j})}this._importAttributes(this.session.attributes.vertices,this.vertexAttributeManager),this._importAttributes(this.session.attributes.edges,this.edgeAttributeManager),this.batchEnd(),this.trigger("load:json"),console.timeEnd("Network.loadJSON")},importVertexWithAttributes:function(a){if(console.time("Network.importVertexWithAttributes"),this.batchStart(),a.createVertices)for(var b=0;b<a.content.data.length;b++){var c=a.content.data[b][0],d=new Vertex({id:c});this.addVertex({vertex:d})}this._importAttributes(a.content,this.vertexAttributeManager),this.batchEnd(),this.trigger("import:attributes"),console.timeEnd("Network.importVertexWithAttributes")},_importAttributes:function(a,b){if(a.attributes&&a.attributes.length>1){var c=a.attributes;b.addAttributes(c);for(var d,e,f,g=[],h=0;h<a.data.length;h++){d={id:a.data[h][0]};for(var i=1;i<a.data[h].length;i++)e=c[i].name,f=a.data[h][i],d[e]=f;g.push(d)}b.setRecordAttributeByIds(g)}},importEdgesWithAttributes:function(a){console.time("Network.importEdgesWithAttributes"),this.batchStart(),this._importAttributes(a.content,this.edgeAttributeManager),this.batchEnd(),this.trigger("import:attributes"),console.timeEnd("Network.importEdgesWithAttributes")},batchStart:function(){this.batchFlag=!0,this.vertexAttributeManager.store.suspendEvents(),this.edgeAttributeManager.store.suspendEvents()},batchEnd:function(){this.vertexAttributeManager.store.resumeEvents(),this.edgeAttributeManager.store.resumeEvents(),this.vertexAttributeManager.store.fireEvent("refresh"),this.edgeAttributeManager.store.fireEvent("refresh"),this.vertexAttributeManager.trigger("change:data",{sender:this}),this.edgeAttributeManager.trigger("change:data",{sender:this}),this.batchFlag=!1,this.trigger("batch:end")}},VertexConfig.prototype={setCoords:function(a,b,c){var d=a-this.coords.x,e=b-this.coords.y,f=c-this.coords.z;this.coords.x=a,this.coords.y=b,this.coords.z=c,this.renderer.move(d,e,f)},move:function(a,b,c){this.coords.x+=a,this.coords.y+=b,"undefined"!=typeof c&&(this.coords.z+=c),this.renderer.move(a,b,c)},getCoords:function(){return this.coords},render:function(a){this.renderer.render(a)},toJSON:function(){return{id:this.id,coords:this.coords,renderer:this.renderer,type:this.type,visible:this.visible}}},Vertex.prototype={removeEdge:function(a){for(var b=0;b<this.edges.length;b++)if(this.edges[b].id===a.id){this.edges.splice(b,1),delete this.edgesIndex[a.id];break}},removeEdges:function(){this.edges=[],this.edgesIndex={}},addEdge:function(a){this.containsEdge(a)===!1&&(this.edges.push(a),this.edgesIndex[a.id]=a)},containsEdge:function(a){return"undefined"!=typeof this.edgesIndex[a.id]?!0:!1},toJSON:function(){return{id:this.id}}},DataSource.prototype.fetch=function(){},FileDataSource.prototype.fetch=DataSource.prototype.fetch,FileDataSource.prototype.error=function(){alert("File is too big. Max file size is "+this.maxSize+" bytes")},FileDataSource.prototype.fetch=function(a){var b=this;if(this.file.size<=this.maxSize){if(a){var c=new FileReader;return c.onload=function(a){b.trigger("success",a.target.result)},this.readAs(this.type,c)}var c=new FileReaderSync;return this.readAs(this.type,c)}b.error(),b.trigger("error",{sender:this})},FileDataSource.prototype.readAs=function(a,b){switch(a){case"binary":return b.readAsBinaryString(this.file);case"text":default:return b.readAsText(this.file,"UTF-8")}},StringDataSource.prototype.fetch=DataSource.prototype.fetch,StringDataSource.prototype.fetch=function(a){return a?void this.trigger("success",this.str):this.str},TabularDataAdapter.prototype.getLines=function(){return this.fileLines},TabularDataAdapter.prototype.parse=function(a){for(var b=a.split("\n"),c=0;c<b.length;c++){var d=b[c].replace(/^\s+|\s+$/g,"");if(d=d.replace(/\//gi,""),null!=d&&d.length>0&&"#"!=d.charAt(0)){var e=d.split("	");this.fileLines.push(e)}}},TabularDataAdapter.prototype.getLinesCount=function(){return this.fileLines.length},TabularDataAdapter.prototype.getValuesByColumnIndex=function(a){for(var b=new Array,c=0;c<this.getLinesCount();c++)null!=this.getLines()[c][a]&&b.push(this.getLines()[c][a]);return b},TabularDataAdapter.prototype.getHeuristicTypeByColumnIndex=function(a){return this.getHeuristicTypeByValues(this.getValuesByColumnIndex(a))},TabularDataAdapter.prototype.getHeuristicTypeByValues=function(a){for(var b=/^[-+]?[0-9]*\.?[0-9]+$/,c=0;c<a.length;c++)if(!b.test(new String(a[c]).replace(",",".")))return"string";return"numeric"},UrlDataSource.prototype.fetch=DataSource.prototype.fetch,UrlDataSource.prototype.fetch=function(a){var b=this,c=null;return this.url?($.ajax({type:"GET",url:this.url,async:a,success:function(d){a?b.success.notify(d):c=d},error:function(a,c,d){console.log("URL Data source: Ajax call returned : "+d+"	"+c+"	"+a.statusText+" END"),b.error.notify()}}),c):void 0},FeatureDataAdapter.prototype.getData=function(a){console.log("TODO comprobar histograma"),console.log(a.region),this.params.dataType="data",this.params.chromosome=a.region.chromosome,1!=this.chromosomesLoaded[a.region.chromosome]&&(this._fetchData(a.region),this.chromosomesLoaded[a.region.chromosome]=!0);var b=this.featureCache.getFeatureChunksByRegion(a.region);null!=b&&this.trigger("data:ready",{items:b,params:this.params,chunkSize:this.featureCache.chunkSize,cached:!0,sender:this}),a.done()},FeatureDataAdapter.prototype._fetchData=function(a){var b=this;if(null!=this.dataSource)if(this.async)this.dataSource.on("success",function(c){b.parse(c,a),b.trigger("file:load",{sender:b});var d=b.featureCache.getFeatureChunksByRegion(a);null!=d&&b.trigger("data:ready",{items:d,params:b.params,chunkSize:b.featureCache.chunkSize,cached:!0,sender:b})}),this.dataSource.fetch(this.async);else{var c=this.dataSource.fetch(this.async);this.parse(c,a)}},FeatureDataAdapter.prototype.addFeatures=function(a){this.featureCache.putFeatures(a,"data")},BamAdapter.prototype={host:null,gzip:!0,params:{}},BamAdapter.prototype.clearData=function(){this.featureCache.clear()},BamAdapter.prototype.setFilters=function(a){this.clearData(),this.filters=a;for(filter in a){var b=a[filter].toString();delete this.params[filter],""!=b&&(this.params[filter]=b)}},BamAdapter.prototype.setOption=function(a,b){a.fetch&&this.clearData(),this.options[a.name]=b;for(option in this.options)null!=this.options[a.name]?this.params[a.name]=this.options[a.name]:delete this.params[a.name]},BamAdapter.prototype.getData=function(a){var b=this;this.params.histogram=a.histogram,this.params.histogramLogarithm=a.histogramLogarithm,this.params.histogramMax=a.histogramMax,this.params.interval=a.interval,this.params.transcript=a.transcript,this.params.chromosome=a.chromosome,this.params.resource=this.resource.id,this.params.category=this.category,this.params.species=Utils.getSpeciesCode(this.species.text),a.start<1&&(a.start=1),a.end>3e8&&(a.end=3e8);var c="data";a.histogram&&(c="histogram"+a.interval),this.params.dataType=c;for(var d=this.featureCache._getChunk(a.start),e=this.featureCache._getChunk(a.end),f=[],g=[],h=d;e>=h;h++){var i=a.chromosome+":"+h;if(null==this.featureCache.cache[i]||null==this.featureCache.cache[i][c])f.push(h);else{var j=this.featureCache.getFeatureChunk(i);g.push(j)}}var k=function(a){var c=a.query.split(":"),d=c[1].split("-"),e={chromosome:c[0],start:d[0],end:d[1]},f="data";a.params.histogram?(f="histogram"+a.params.interval,b.featureCache.putHistogramFeaturesByRegion(a.result,e,a.resource,f)):b.featureCache.putFeaturesByRegion(a.result,e,a.resource,f);var h=b.featureCache.getFeatureChunksByRegion(e,f);g=g.concat(h),g.length>0&&b.trigger("data:ready",{items:g,params:b.params,cached:!1,sender:b})},l=[],m=!0,n=!0;if(f.length>0){for(var h=0;h<f.length;h++){if(m){var o=parseInt(f[h]*this.featureCache.chunkSize);m=!1}if(n){var p=parseInt(f[h]*this.featureCache.chunkSize+this.featureCache.chunkSize-1);n=!1}if(null!=f[h+1])if(f[h]+1==f[h+1])n=!0;else{var q=a.chromosome+":"+o+"-"+p;l.push(q),m=!0,n=!0}else{var q=a.chromosome+":"+o+"-"+p;l.push(q),m=!0,n=!0}}for(var h=0,r=l.length;r>h;h++){console.time("dqs");var s=$.cookie("bioinfo_sid");s=""!=s&&null!=s?s:"dummycookie",OpencgaManager.region({accountId:this.resource.account,sessionId:s,bucketId:this.resource.bucketId,objectId:this.resource.oid,region:l[h],queryParams:this.params,success:k})}}else g.length>0&&b.trigger("data:ready",{items:g,params:this.params,cached:!1,sender:this})},BEDDataAdapter.prototype.getData=FeatureDataAdapter.prototype.getData,BEDDataAdapter.prototype._fetchData=FeatureDataAdapter.prototype._fetchData,BEDDataAdapter.prototype.parse=function(a,b){this.parseFunction?this.parseFunction(a,b):this._defaultParse(a,b)},BEDDataAdapter.prototype._defaultParse=function(a,b){for(var c="value",d=a.split("\n"),e=0;e<d.length;e++){var f=d[e].replace(/^\s+|\s+$/g,"");if(null!=f&&f.length>0){var g=f.split("	"),h=g[0].replace("chr","");if(h==b.chromosome){var i={label:g[3],chromosome:h,start:parseFloat(g[1]),end:parseFloat(g[2]),score:g[4],strand:g[5],thickStart:g[6],thickEnd:g[7],itemRgb:g[8],blockCount:g[9],blockSizes:g[10],blockStarts:g[11],featureType:"bed"};this.featureCache.putFeatures(i,c),null==this.featuresByChromosome[h]&&(this.featuresByChromosome[h]=0),this.featuresByChromosome[h]++,this.featuresCount++}}}},CellBaseAdapter.prototype={getData:function(a){var b=this;a.webServiceCallCount=0;var c=a.region;if(!(c.start>3e8||c.end<1)){c.start=c.start<1?1:c.start,c.end=c.end>3e8?3e8:c.end;var d={};_.extend(d,this.params),_.extend(d,a.params);var e=a.dataType;_.isUndefined(e)&&console.log("dataType must be provided!!!");var f;if("histogram"==e){var g=e+"_"+d.interval;_.isUndefined(this.cache[g])&&(this.cache[g]=new FeatureChunkCache({chunkSize:d.interval})),f=this.cache[g].chunkSize;var h=this.cache[g].getAdjustedRegions(c);h.length>0&&(a.webServiceCallCount++,CellBaseManager.get({host:this.host,version:this.version,species:this.species,category:this.category,subCategory:this.subCategory,query:h,resource:this.resource,params:d,success:function(c){b._cellbaseHistogramSuccess(c,e,g,a)}}));var i=this.cache[g].getCachedByRegion(c),j=this.cache[g].getByRegions(i.cached);this.trigger("data:ready",{items:j,dataType:e,chunkSize:f,sender:this})}else{_.isUndefined(this.cache[e])&&(this.cache[e]=new FeatureChunkCache(this.cacheConfig)),f=this.cache[e].chunkSize;var i=this.cache[e].getCachedByRegion(c);if(i.notCached.length>0)for(var k=_.map(i.notCached,function(a){return new Region(a).toString()}),l=50,m=_.groupBy(k,function(a,b){return Math.floor(b/l)}),n=_.toArray(m),o=0;o<n.length;o++)a.webServiceCallCount++,CellBaseManager.get({host:this.host,version:this.version,species:this.species,category:this.category,subCategory:this.subCategory,query:n[o],resource:this.resource,params:d,success:function(c){b._cellbaseSuccess(c,e,a)}});if(i.cached.length>0){var j=this.cache[e].getByRegions(i.cached);this.trigger("data:ready",{items:j,dataType:e,chunkSize:f,sender:this})}}0===a.webServiceCallCount&&a.done()}},_cellbaseSuccess:function(a,b,c){c.webServiceCallCount--;var d=this.resource+" save "+Utils.randomString(4);console.time(d);for(var e=this.cache[b].chunkSize,f=[],g=0;g<a.response.length;g++){var h=a.response[g],i=new Region(h.id),j=h.result,k=this.cache[b].putByRegion(i,j);f.push(k)}console.timeEnd(d),f.length>0&&this.trigger("data:ready",{items:f,dataType:b,chunkSize:e,sender:this}),0===c.webServiceCallCount&&c.done()},_cellbaseHistogramSuccess:function(a,b,c,d){d.webServiceCallCount--;var e=Utils.randomString(4);console.time(this.resource+" save "+e);for(var f=this.cache[c].chunkSize,g=[],h=0;h<a.response.length;h++)for(var i=a.response[h],j=0;j<i.result.length;j++){var k=i.result[j],l=new Region(i.id);l.load(k),g.push(this.cache[c].putByRegion(l,k))}this.trigger("data:ready",{items:g,dataType:b,chunkSize:f,sender:this}),0===d.webServiceCallCount&&d.done(),console.timeEnd(this.resource+" get and save "+e)}},DasAdapter.prototype.getData=function(a){var b=this;this.params.histogram=a.histogram,this.params.interval=a.interval,this.params.transcript=a.transcript,a.start<1&&(a.start=1),a.end>3e8&&(a.end=3e8);var c="data";a.histogram&&(c="histogram"+a.interval),this.params.dataType=c;for(var d=this.featureCache._getChunk(a.start),e=this.featureCache._getChunk(a.end),f=[],g=[],h=d;e>=h;h++){var i=a.chromosome+":"+h;
if(null==this.featureCache.cache[i]||null==this.featureCache.cache[i][c])f.push(h);else{var j=this.featureCache.getFeatureChunk(i);g.push(j)}}g.length>0&&this.trigger("data:ready",{items:g,params:this.params,cached:!0});var k=!0,l=!0;if(f.length>0)for(var h=0;h<f.length;h++){var m=null;if(k){var n=parseInt(f[h]*this.featureCache.chunkSize);k=!1}if(l){var o=parseInt(f[h]*this.featureCache.chunkSize+this.featureCache.chunkSize-1);l=!1}if(null!=f[h+1]&&f[h]+1==f[h+1]?l=!0:(m=a.chromosome+":"+n+","+o,k=!0,l=!0),m){var p=this.proxy+this.url+"?segment="+m;console.log("fullURL: "+p),$.ajax({url:p,type:"GET",dataType:"xml",error:function(){alert("error"),b.trigger("error","It is not allowed by Access-Control-Allow-Origin ")},success:function(d){b.xml=(new XMLSerializer).serializeToString(d);var e=(new XMLSerializer).serializeToString(d),d=xml2json.parser(e);if(null!=d.dasgff){var f=new Array;if("undefined"!=typeof d.dasgff.gff.segment)if("undefined"!=typeof d.dasgff.gff.segment.feature)f=d.dasgff.gff.segment.feature;else if("undefined"!=typeof d.dasgff.gff.segment[0])if(null!=d.dasgff.gff.segment[0].feature)for(var g=0;g<d.dasgff.gff.segment.length;g++)for(var h=0;h<d.dasgff.gff.segment[g].feature.length;h++)d.dasgff.gff.segment[g].feature[h].chromosome=a.chromosome,f.push(d.dasgff.gff.segment[g].feature[h]);else f.push([]);var i={chromosome:a.chromosome,start:n,end:o},j="das";b.featureCache.putFeaturesByRegion(f,i,j,c),console.log(b.featureCache.cache);var k=b.featureCache.getFeatureChunksByRegion(i);null!=k&&b.trigger("data:ready",{items:k,params:b.params,cached:!1})}}})}}},DasAdapter.prototype.checkUrl=function(){var a=this,b=this.proxy+this.url+"?segment=1:1,1";console.log("Checking URL: "+b),$.ajax({url:b,type:"GET",dataType:"xml",error:function(){alert("error"),a.trigger("error","It is not allowed by Access-Control-Allow-Origin ")},success:function(b){a.xml=(new XMLSerializer).serializeToString(b),a.trigger("url:check",{data:a.xml})}})},EnsemblAdapter.prototype={getData:function(a){var b=a.region;if(!(b.start>3e8||b.end<1)){b.start=b.start<1?1:b.start,b.end=b.end>3e8?3e8:b.end;var c={};_.extend(c,this.params),_.extend(c,a.params);var d=a.dataType;_.isUndefined(d)&&console.log("dataType must be provided!!!");var e;if("histogram"==d);else{_.isUndefined(this.cache[d])&&(this.cache[d]=new FeatureChunkCache(this.cacheConfig)),e=this.cache[d].chunkSize;var f=this.cache[d].getCachedByRegion(b);if(f.notCached.length>0)for(var g=_.map(f.notCached,function(a){return new Region(a).toString()}),h=0;h<g.length;h++)this._get(g[h],c,d);if(f.cached.length>0){var i=this.cache[d].getByRegions(f.cached);this.trigger("data:ready",{items:i,dataType:d,chunkSize:e,sender:this})}}}},_get:function(a,b,c){var d=this;EnsemblManager.get({host:this.host,species:this.species,category:this.category,subCategory:this.subCategory,query:a,params:b,success:function(b){var b=d._transformResponse(b,a);d._success(b,c)}})},_success:function(a,b){var c=this.resource+" save "+Utils.randomString(4);console.time(c);for(var d=this.cache[b].chunkSize,e=[],f=0;f<a.response.length;f++){var g=a.response[f],h=new Region(g.id),i=g.result,j=this.cache[b].putByRegion(h,i);e.push(j)}console.timeEnd(c),e.length>0&&this.trigger("data:ready",{items:e,dataType:b,chunkSize:d,sender:this})},_transformResponse:function(a,b){for(var c=0;c<a.length;c++){var d=a[c];d.id=d.ID,delete d.ID,d.name=d.external_name,delete d.external_name,d.chromosome=d.seq_region_name,delete d.seq_region_name}var e={response:[]},f={id:b,result:a};return e.response.push(f),e}},GFF2DataAdapter.prototype.getData=FeatureDataAdapter.prototype.getData,GFF2DataAdapter.prototype._fetchData=FeatureDataAdapter.prototype._fetchData,GFF2DataAdapter.prototype.parse=function(a,b){for(var c="value",d=a.split("\n"),e=0;e<d.length;e++){var f=d[e].replace(/^\s+|\s+$/g,"");if(null!=f&&f.length>0){var g=f.split("	"),h=g[0].replace("chr","");if(h==b.chromosome){var i={chromosome:h,label:g[2],start:parseInt(g[3]),end:parseInt(g[4]),score:g[5],strand:g[6],frame:g[7],group:g[8],featureType:"gff2"};this.featureCache.putFeatures(i,c),null==this.featuresByChromosome[h]&&(this.featuresByChromosome[h]=0),this.featuresByChromosome[h]++,this.featuresCount++}}}},GFF3DataAdapter.prototype.getData=FeatureDataAdapter.prototype.getData,GFF3DataAdapter.prototype._fetchData=FeatureDataAdapter.prototype._fetchData,GFF3DataAdapter.prototype.parse=function(a,b){for(var c=function(a){var b={};if("undefined"!=typeof a)for(var c=a.replace(/ /g,"").split(";"),d=0,e=c.length;e>d;d++){var f=c[d].split("=");b[f[0]]=f[1]}return b},d="value",e=a.split("\n"),f=0;f<e.length;f++){var g=e[f].replace(/^\s+|\s+$/g,"");if(null!=g&&g.length>0){var h=g.split("	"),i=h[0].replace("chr","");if(i==b.chromosome){var j={chromosome:i,label:h[2],start:parseInt(h[3]),end:parseInt(h[4]),score:h[5],strand:h[6],frame:h[7],attributes:c(h[8]),featureType:"gff3"};this.featureCache.putFeatures(j,d),null==this.featuresByChromosome[i]&&(this.featuresByChromosome[i]=0),this.featuresByChromosome[i]++,this.featuresCount++}}}},GTFDataAdapter.prototype.getData=FeatureDataAdapter.prototype.getData,GTFDataAdapter.prototype._fetchData=FeatureDataAdapter.prototype._fetchData,GTFDataAdapter.prototype.parse=function(a,b){for(var c=function(a){for(var b=a.split(";"),c={},d=0,e=b.length;e>d;d++){var f=b[d].split("=");c[f[0]]=f[1]}return c},d="value",e=a.split("\n"),f=0;f<e.length;f++){var g=e[f].replace(/^\s+|\s+$/g,"");if(null!=g&&g.length>0){var h=g.split("	"),i=h[0].replace("chr","");if(i==b.chromosome){var j={chromosome:i,label:h[2],start:parseInt(h[3]),end:parseInt(h[4]),score:h[5],strand:h[6],frame:h[7],attributes:c(h[8]),featureType:"gtf"};this.featureCache.putFeatures(j,d),null==this.featuresByChromosome[i]&&(this.featuresByChromosome[i]=0),this.featuresByChromosome[i]++,this.featuresCount++}}}},OpencgaAdapter.prototype={getData:function(a){var b=this,c=a.region;if(!(c.start>3e8||c.end<1)){c.start=c.start<1?1:c.start,c.end=c.end>3e8?3e8:c.end;var d={species:Utils.getSpeciesCode(this.species.text)};_.extend(d,this.params),_.extend(d,a.params);var e=a.dataType;_.isUndefined(e)&&console.log("dataType must be provided!!!");var f;if("histogram"==e);else{_.isUndefined(this.cache[e])&&(this.cache[e]=new FeatureChunkCache(this.cacheConfig)),f=this.cache[e].chunkSize;var g=this.cache[e].getCachedByRegion(c);if(g.notCached.length>0)for(var h=_.map(g.notCached,function(a){return new Region(a).toString()}),i=50,j=_.groupBy(h,function(a,b){return Math.floor(b/i)}),k=_.toArray(j),l=0;l<k.length;l++){var m=$.cookie("bioinfo_sid");m=""!=m&&null!=m?m:"dummycookie",OpencgaManager.region({accountId:this.resource.account,sessionId:m,bucketId:this.resource.bucketId,objectId:this.resource.oid,region:k[l],queryParams:d,success:function(a){b._opencgaSuccess(a,e)}})}if(g.cached.length>0){var n=this.cache[e].getByRegions(g.cached);this.trigger("data:ready",{items:n,dataType:e,chunkSize:f,sender:this})}}}},_opencgaSuccess:function(a,b){var c=this.resource+" save "+Utils.randomString(4);console.time(c);for(var d=this.cache[b].chunkSize,e=[],f=0;f<a.response.length;f++){var g=a.response[f],h=new Region(g.id),i=g.result,j=this.cache[b].putByRegion(h,i);e.push(j)}console.timeEnd(c),e.length>0&&this.trigger("data:ready",{items:e,dataType:b,chunkSize:d,sender:this})}},OpencgaAdapter.prototype.getDataOld=function(a){var b=this;this.params.histogram=a.histogram,this.params.histogramLogarithm=a.histogramLogarithm,this.params.histogramMax=a.histogramMax,this.params.interval=a.interval,this.params.transcript=a.transcript,a.start<1&&(a.start=1),a.end>3e8&&(a.end=3e8);var c="data";a.histogram&&(c="histogram"+a.interval);for(var d=this.featureCache._getChunk(a.start),e=this.featureCache._getChunk(a.end),f=[],g=[],h=d;e>=h;h++){var i=a.chromosome+":"+h;if(null==this.featureCache.cache[i]||null==this.featureCache.cache[i][c])f.push(h);else{var j=this.featureCache.getFeatureChunk(i,c);g=g.concat(j)}}var k=0,l=[];regionSuccess=function(a){console.timeEnd("dqs"),console.time("dqs-cache");var c="data";a.params.histogram&&(c="histogram"+a.params.interval),b.params.dataType=c;var d=a.query.split(":"),e=d[1].split("-"),f={chromosome:d[0],start:e[0],end:e[1]};if(null!=a.result[0]&&null!=a.result[0].position)for(var h=0;h<a.result.length;h++)a.result[h].start=a.result[h].position,a.result[h].end=a.result[h].position;b.featureCache.putFeaturesByRegion(a.result,f,b.category,c);var i=b.featureCache.getFeatureChunksByRegion(f,c);console.timeEnd("dqs-cache"),null!=i&&(g=g.concat(i)),k==l.length&&b.trigger("data:ready",{items:g,params:b.params,cached:!1,sender:b})};var m=!0,n=!0;if(f.length>0){for(var h=0;h<f.length;h++){if(m){var o=parseInt(f[h]*this.featureCache.chunkSize);m=!1}if(n){var p=parseInt(f[h]*this.featureCache.chunkSize+this.featureCache.chunkSize-1);n=!1}if(null!=f[h+1])if(f[h]+1==f[h+1])n=!0;else{var q=a.chromosome+":"+o+"-"+p;l.push(q),m=!0,n=!0}else{var q=a.chromosome+":"+o+"-"+p;l.push(q),m=!0,n=!0}}for(var h=0,r=l.length;r>h;h++){console.time("dqs"),k++;var s=$.cookie("bioinfo_sid");s=""!=s&&null!=s?s:"dummycookie",OpencgaManager.region({accountId:this.resource.account,sessionId:s,bucketId:this.resource.bucketId,objectId:this.resource.oid,region:l[h],queryParams:this.params,success:regionSuccess})}}else g.length>0&&this.trigger("data:ready",{items:g,params:this.params,cached:!1,sender:this})},SequenceAdapter.prototype.clearData=function(){this.sequence={},this.start={},this.end={}},SequenceAdapter.prototype.getData=function(a){var b=this;this.sender=a.sender;var c=a.region,d=c.chromosome;c.start=c.start<1?1:c.start,c.end=c.end>3e8?3e8:c.end,(c.start<this.start[d]-5e3||c.end>this.end[d]+5e3)&&this.clearData();var e={};_.extend(e,this.params);var f=this._getSequenceQuery(c);""!=f?CellBaseManager.get({host:this.host,version:this.version,species:this.species,category:this.category,subCategory:this.subCategory,query:f,resource:this.resource,params:e,success:function(a){b._processSequenceQuery(a,!0)}}):"move"!=this.sender&&this.trigger("data:ready",{items:{sequence:this.sequence[d],start:this.start[d],end:this.end[d]},params:e,sender:this})},SequenceAdapter.prototype._getSequenceQuery=function(a){var b,c,d,e=this,f=a.chromosome,g=[];return null==e.start[f]&&null==e.end[f]?(e.start[f]=a.start,e.end[f]=a.end,b=a.start,c=a.end,d=f+":"+b+"-"+c,g.push(d)):(a.start<e.start[f]&&(b=a.start,c=e.start[f]-1,c=1>c?a.end=1:c,e.start[f]=b,d=a.chromosome+":"+b+"-"+c,g.push(d)),a.end>e.end[f]&&(c=a.end,b=e.end[f]+1,e.end[f]=c,d=a.chromosome+":"+b+"-"+c,g.push(d))),g.toString()},SequenceAdapter.prototype._processSequenceQuery=function(a,b){for(var c=a.params,d=0;d<a.response.length;d++){var e=a.response[d],f=e.id.split(":"),g=f[1].split("-"),h=parseInt(g[0]),i=parseInt(g[1]),j=(e.id,e.result),k=j.chromosome;"undefined"==typeof k&&(k=j.sequenceName),this.sequence[k]=null==this.sequence[k]?j.sequence:h==this.start[k]?j.sequence+this.sequence[k]:this.sequence[k]+j.sequence,"move"==this.sender&&1==b&&this.trigger("data:ready",{items:{sequence:j.sequence,start:h,end:i},params:c,sender:this})}"move"!=this.sender&&1==b&&this.trigger("data:ready",{items:{sequence:this.sequence[k],start:this.start[k],end:this.end[k]},params:c,sender:this})},SequenceAdapter.prototype.getNucleotidByPosition=function(a){var b=this;if(a.start>0&&a.end>0){var c=this._getSequenceQuery(a),d=a.chromosome;if(""!=c){var e=CellBaseManager.get({host:this.host,version:this.version,species:this.species,category:this.category,subCategory:this.subCategory,query:c,resource:this.resource,params:this.params,async:!1});b._processSequenceQuery(e)}if(null!=this.sequence[d]){var f=this.sequence[d].substr(a.start-this.start[d],1);return f}return console.log("SequenceRender: this.sequence[chromosome] is undefined"),""}},VCFDataAdapter.prototype.getData=FeatureDataAdapter.prototype.getData,VCFDataAdapter.prototype._fetchData=FeatureDataAdapter.prototype._fetchData,VCFDataAdapter.prototype.parse=function(a,b){for(var c="value",d=a.split("\n"),e=0;e<d.length;e++){var f=d[e].replace(/^\s+|\s+$/g,"");if(null!=f&&f.length>0){var g=f.split("	"),h=g[0].replace(/chr/gi,"");if(h==b.chromosome)if("#"===f.substr(0,1))"#"===f.substr(1,1)?this.header+=f.replace(/</gi,"&#60;").replace(/>/gi,"&#62;")+"<br>":this.samples=g.slice(9);else{var i={chromosome:h,position:parseInt(g[1]),start:parseInt(g[1]),end:parseInt(g[1]),id:g[2],reference:g[3],alternate:g[4],quality:g[5],filter:g[6],info:g[7].replace(/;/gi,"<br>"),format:g[8],sampleData:f,featureType:"vcf"};this.featureCache.putFeatures(i,c),null==this.featuresByChromosome[h]&&(this.featuresByChromosome[h]=0),this.featuresByChromosome[h]++,this.featuresCount++}}}},AttributeNetworkDataAdapter.prototype.parse=function(a){try{var b=a.split("\n"),c=b[0].replace(/^\s+|\s+$/g,""),d=[];if("#"===c.substr(0,1)){d=c.split("	");for(var e=0;e<b.length;e++){var f=b[e].replace(/^\s+|\s+$/g,"");if("#"!==f.substr(0,1)){c=f;break}}}for(var g=c.split("	").length,e=0;g>e;e++){var h=d[e]?d[e]:"Column"+e;0==e&&(h="id"),this.ignoreColumns[e]!==!0&&this.attributes.push({name:h,type:"string",defaultValue:""})}if(Object.keys(this.ignoreColumns).length>0)for(var e=0;e<b.length;e++){var f=b[e].replace(/^\s+|\s+$/g,"");if(null!=f&&f.length>0&&"#"!=f.substr(0,1)){for(var i=f.split("	"),j=[],k=0;k<i.length;k++)this.ignoreColumns[k]!==!0&&j.push(i[k]);this.data.push(j)}}else for(var e=0;e<b.length;e++){var f=b[e].replace(/^\s+|\s+$/g,"");if(null!=f&&f.length>0&&"#"!=f.substr(0,1)){var i=f.split("	");this.data.push(i)}}this.trigger("data:load",{sender:this})}catch(l){console.log(l),console.log(l.stack),this.trigger("error:parse",{errorMsg:"Parse error",sender:this})}},AttributeNetworkDataAdapter.prototype.getAttributesJSON=function(){var a={};return a.attributes=this.attributes,a.data=this.data,a},DOTDataAdapter.prototype.parse=function(a){for(var b,c,d,e,f,g,h,i,j,k,l,m=a.split("\n"),n=0;n<m.length;n++){var o=m[n].replace(/^\s+|\s+$/g,"");if("#"!=o.substr(0,1)&&"/*"!=o.substr(0,2)&&"//"!=o.substr(0,2)){var p=o.substr(o.length-1,o.length);if((-1!=o.indexOf("graph")||-1!=o.indexOf("digraph")||-1!=o.indexOf("subgraph"))&&"{"==p){-1!=o.indexOf("digraph")&&this.graph.setType("directed");for(var q=n;q<m.length;q++)if(n++,o=m[q].replace(/^\s+|\s+$/g,""),"#"!=o.substr(0,1)&&"/*"!=o.substr(0,2)&&"//"!=o.substr(0,2))if(-1!=o.indexOf("->")||-1!=o.indexOf("--")){if(-1!=o.indexOf("->")?(d="->",e="directed"):(d="--",e="undirected"),i={},-1!=o.indexOf("[")&&-1!=o.indexOf("]")){g=o.substring(o.indexOf("[")+1,o.indexOf("]")).split(",");for(var r=0,s=g.length;s>r;r++)h=g[r].split("="),i[h[0].replace(/^\s+|\s+$/g,"")]=h[1].replace(/^\s+|\s+$/g,"");o=o.substring(0,o.indexOf("["))}else o=o.substring(0,o.indexOf(";"));f=o.split(d);for(var t=0,u=f.length;u-1>t;t++){if(b=f[t].replace(/^\s+|\s+$/g,"").replace(/"/g,""),c=f[t+1].replace(/^\s+|\s+$/g,"").replace(/"/g,""),"undefined"==typeof this.addedVertex[b]){var v=new Vertex({name:b});this.network.addVertex({vertex:v,vertexConfig:new VertexConfig({})}),this.addedVertex[b]=v}if("undefined"==typeof this.addedVertex[c]){var w=new Vertex({name:c});this.network.addVertex({vertex:w,vertexConfig:new VertexConfig({})}),this.addedVertex[c]=w}var x=new Edge({source:this.addedVertex[b],target:this.addedVertex[c]});this.network.addEdge({edge:x,edgeConfig:new EdgeConfig({type:e,renderer:new DefaultEdgeRenderer({shape:e})})})}}else if(-1!=o.indexOf("[")&&-1!=o.indexOf("]")){g=o.substring(o.indexOf("[")+1,o.indexOf("]")).split(","),i={};for(var r=0,s=g.length;s>r;r++)h=g[r].split("="),i[h[0].replace(/^\s+|\s+$/g,"")]=h[1].replace(/^\s+|\s+$/g,"").replace(/"/g,"").replace(/'/g,"");if(-1!=o.indexOf("graph"))j=i;else if(-1!=o.indexOf("node "))k=i;else if(-1!=o.indexOf("edge"))l=i;else{var y=o.split("[")[0].replace(/^\s+|\s+$/g,"").replace(/"/g,"");if(i.color&&"#"!=i.color.slice(0,1)&&!isNaN(i.color.slice(-1))&&(i.color=i.color.slice(0,-1)),i.fillcolor&&"#"!=i.fillcolor.slice(0,1)&&!isNaN(i.fillcolor.slice(-1))&&(i.fillcolor=i.fillcolor.slice(0,-1)),"undefined"==typeof this.addedVertex[y]){var z=new Vertex({name:y});this.network.addVertex({vertex:z,vertexConfig:new VertexConfig({})}),this.addedVertex[y]=z}}}else if(-1!=o.indexOf("subgraph")){m[q]=m[q].replace("subgraph","graph");for(var A,B=m[q].replace(/^\s+|\s+$/g,"").split(" ")[1],C="",D=q,E=m.length;E>D;D++){C+=m[D]+"\n";var F=m[q].replace(/^\s+|\s+$/g,"");if("#"!=F.substr(0,1)&&"/*"!=F.substr(0,2)&&"//"!=F.substr(0,2)&&(-1!=F.indexOf("->")||-1!=F.indexOf("--"))){A=-1!=F.indexOf("->")?"->":"--";for(var G=F.replace(/;/g,"").split(A),t=0,u=G.length;u-1>t;t++)source=G[t].replace(/^\s+|\s+$/g,"").replace(/"/g,""),target=G[t+1].replace(/^\s+|\s+$/g,"").replace(/"/g,""),this.nodeSubgraph[source]=B,this.nodeSubgraph[target]=B}if(-1!=m[D].indexOf("}")){this.parse(C);break}q++,n++}}}}}},JSONNetworkDataAdapter.prototype.getJSON=function(){return this.jsonObject},JSONNetworkDataAdapter.prototype.parse=function(a){try{this.jsonObject=JSON.parse(a),this.trigger("data:load",{jsonObject:this.jsonObject})}catch(b){console.log(b),this.trigger("error:parse",{errorMsg:"Parse error",sender:this})}},SIFNetworkDataAdapter.prototype.getGraph=function(){return this.graph},SIFNetworkDataAdapter.prototype.parse=function(a){try{console.time("SIFParse"),this.addedVertex={},this.addedEdges={};for(var b=a.split("\n"),c=0;c<b.length;c++){var d=b[c].replace(/^\s+|\s+$/g,"");if(null!=d&&d.length>0){var e=d.split(this.separator);if("#"!=e[0].substr(0,1)){var f,g=e[0],h=e[1];if("undefined"==typeof this.addedVertex[g]){var i=new Vertex({id:g});this.graph.addVertex(i),this.addedVertex[g]=i}for(var j=2,k=e.length;k>j;j++){if(f=e[j],"undefined"==typeof this.addedVertex[f]){var l=new Vertex({id:f});this.graph.addVertex(l),this.addedVertex[f]=l}var m=g+"_"+h+"_"+f;if("undefined"==typeof this.addedEdges[m]){var n=new Edge({id:m,relation:h,source:this.addedVertex[g],target:this.addedVertex[f],weight:1,directed:!0});this.graph.addEdge(n),this.addedEdges[m]=n}}}}}console.timeEnd("SIFParse"),this.trigger("data:load",{graph:this.graph,sender:this})}catch(o){console.log(o),this.trigger("error:parse",{errorMsg:"Parse error",sender:this})}},TextNetworkDataAdapter.prototype.getGraph=function(){return this.graph},TextNetworkDataAdapter.prototype.parse=function(a){try{"undefined"==typeof a&&(a=this.rawData);var b=a.split("\n");this.lines=[],this.columnLength=0;for(var c=0,d=0;d<b.length;d++){var e=b[d].replace(/^\s+|\s+$/g,"");if(null!=e&&e.length>0){var f=e.split(this.separator);"#"!=f[0].substr(0,1)&&(this.lines.push(f),0===c&&(c=f.length,this.columnLength=c),f.length!==c&&this.trigger("error:parse",{errorMsg:"Different number of columns.",sender:this}))}}this.trigger("data:load",{graph:this.lines,sender:this})}catch(g){console.log(g),this.trigger("error:parse",{errorMsg:"Parse error",sender:this})}},TextNetworkDataAdapter.prototype.parseColumns=function(a,b,c,d){this.graph=new Graph,this.addedVertex={},this.addedEdges={};for(var e=0;e<this.lines.length;e++){var f,g=this.lines[e],h=g[a],i=g[b];if(f=0>c?d:g[c],"undefined"==typeof this.addedVertex[h]){var j=new Vertex({id:h});this.graph.addVertex(j),this.addedVertex[h]=j}if("undefined"==typeof this.addedVertex[i]){var k=new Vertex({id:i});this.graph.addVertex(k),this.addedVertex[i]=k}var l=h+"_"+f+"_"+i;if("undefined"==typeof this.addedEdges[l]){var m=new Edge({id:l,relation:f,source:this.addedVertex[h],target:this.addedVertex[i],weight:1,directed:!0});this.graph.addEdge(m),this.addedEdges[l]=m}}return this.graph},XLSXNetworkDataAdapter.prototype.parse=function(a){try{this.xlsx=XLSX.read(a,{type:"binary"}),this.trigger("data:load",{workbook:this.xlsx,sender:this})}catch(b){console.log(b),this.trigger("error:parse",{errorMsg:"Parse error",sender:this})}},XLSXNetworkDataAdapter.prototype.parseSheet=function(a){var b=XLSX.utils.sheet_to_csv(this.xlsx.Sheets[a]);return b},MemoryStore.prototype={add:function(a,b){"undefined"==typeof this.store&&(this.store={});var c={key:a,value:b};this.store[a]=c,this.tail?(this.tail.newer=c,c.older=this.tail):this.head=c,this.tail=c,this.size++},shift:function(){var a=this.head;a&&(this.head.newer?(this.head=this.head.newer,this.head.older=void 0):this.head=void 0,a.newer=a.older=void 0,delete this.store[a.key])},get:function(a){var b=this.store[a];if(void 0!==b)return b===this.tail?b.value:(b.newer&&(b===this.head&&(this.head=b.newer),b.newer.older=b.older),b.older&&(b.older.newer=b.newer),b.newer=void 0,b.older=this.tail,this.tail&&(this.tail.newer=b),this.tail=b,b.value)},init:function(){this.size=0,this.store={},this.head=void 0,this.tail=void 0},clear:function(){this.store=null,this.init()}},FeatureChunkCache.prototype={getChunk:function(a){return this.store.get(a)},getAdjustedRegion:function(a){var b=this.getChunkId(a.start)*this.chunkSize,c=this.getChunkId(a.end)*this.chunkSize+this.chunkSize-1;return new Region({chromosome:a.chromosome,start:b,end:c})},getAdjustedRegions:function(a){for(var b,c,d=this.getChunkId(a.start),e=this.getChunkId(a.end),f=[],g=!0,h=!0,i=d;e>=i;i++){var j=this.getChunkKey(a.chromosome,i),k=this.getChunkKey(a.chromosome,i+1),l=this.getChunk(j),m=this.getChunk(k);if(g&&(b=parseInt(i*this.chunkSize),g=!1),h&&(c=parseInt(i*this.chunkSize+this.chunkSize-1),h=!1),l)g=!0,h=!0;else{if(h=!0,m&&e>i){var n=new Region({chromosome:a.chromosome,start:b,end:c});f.push(n),g=!0}if(i==e){var n=new Region({chromosome:a.chromosome,start:b,end:c});f.push(n)}}}return f},getByRegions:function(a){var b=[];for(var c in a){var d=this.getChunkId(a[c].start),e=this.getChunkKey(a[c].chromosome,d);b.push(this.getChunk(e))}return b},getCachedByRegion:function(a){for(var b={cached:[],notCached:[]},c=this.getChunkId(a.start),d=this.getChunkId(a.end),e=c;d>=e;e++){var f=this.getChunkKey(a.chromosome,e),g=this.getChunk(f),h=parseInt(e*this.chunkSize)||1,i=parseInt(e*this.chunkSize+this.chunkSize-1),j=new Region({chromosome:a.chromosome,start:h,end:i});_.isUndefined(g)?b.notCached.push(j):b.cached.push(j),this.verbose&&console.log(b)}return b},putChunk:function(a,b){var b={value:b,chunkKey:a};return this.store.add(a,b),b},putByRegion:function(a,b){var c=this.getChunkId(a.start),d=this.getChunkKey(a.chromosome,c);return this.putChunk(d,b)},getChunkKey:function(a,b){return a+":"+b},getChunkId:function(a){return Math.floor(a/this.chunkSize)},getChunkSize:function(){return this.chunkSize}},FileFeatureCache.prototype._getChunk=function(a){return Math.floor(a/this.chunkSize)},FileFeatureCache.prototype.getChunkRegion=function(a){return start=this._getChunk(a.start)*this.chunkSize,end=this._getChunk(a.end)*this.chunkSize+this.chunkSize-1,{start:start,end:end}},FileFeatureCache.prototype.getFirstFeature=function(){var a;return a=this.gzip?JSON.parse(RawDeflate.inflate(this.cache[Object.keys(this.cache)[0]].data[0])):this.cache[Object.keys(this.cache)[0]].data[0]},FileFeatureCache.prototype.getFeatureChunk=function(a){return null!=this.cache[a]?this.cache[a]:null},FileFeatureCache.prototype.getFeatureChunkByDataType=function(a,b){return null!=this.cache[a]&&null!=this.cache[a][b]?this.cache[a][b]:null},FileFeatureCache.prototype.getFeatureChunksByRegion=function(a){var b,c,d,e=[];b=this._getChunk(a.start),c=this._getChunk(a.end);for(var f=b;c>=f;f++)d=a.chromosome+":"+f,null!=this.cache[d]&&e.push(this.cache[d]);return e},FileFeatureCache.prototype.putFeaturesByRegion=function(a,b,c,d){var e,f,g,h,i,j,k;f=this._getChunk(b.start),g=this._getChunk(b.end);for(var l=f;g>=l;l++)e=b.chromosome+":"+l,null==this.cache[e]&&(this.cache[e]={},this.cache[e].key=e),null==this.cache[e][d]&&(this.cache[e][d]=[]);a.constructor!=Array&&(a=[a]);for(var m=0,n=a.length;n>m;m++){j=a[m],j.featureType=c,h=this._getChunk(j.start),i=this._getChunk(j.end),k=this.gzip?RawDeflate.deflate(JSON.stringify(j)):j;for(var l=h;i>=l;l++)l>=f&&g>=l&&(e=b.chromosome+":"+l,this.cache[e][d].push(k))}},FileFeatureCache.prototype.putFeatures=function(a,b){var c,d,e,f;a.constructor!=Array&&(a=[a]);for(var g=0,h=a.length;h>g;g++){c=a[g],e=this._getChunk(c.start),f=this._getChunk(c.end);for(var i=e;f>=i;i++)d=c.chromosome+":"+i,null==this.cache[d]&&(this.cache[d]=[],this.cache[d].key=d),null==this.cache[d][b]&&(this.cache[d][b]=[]),this.cache[d][b].push(this.gzip?RawDeflate.deflate(JSON.stringify(c)):c)}},FileFeatureCache.prototype.putChunk=function(a,b){this.cache[a]=b},FileFeatureCache.prototype.getChunk=function(a){return this.cache[a]},FileFeatureCache.prototype.putCustom=function(a){a(this)},FileFeatureCache.prototype.getCustom=function(a){a(this)},FileFeatureCache.prototype.remove=function(a){for(var b=this._getChunk(a.start),c=this._getChunk(a.end),d=b;c>=d;d++){var e=a.chromosome+":"+d;this.cache[e]=null}},FileFeatureCache.prototype.clear=function(){this.size=0,this.cache={}},BamCache.prototype.putHistogramFeaturesByRegion=FileFeatureCache.prototype.putFeaturesByRegion,BamCache.prototype._getChunk=function(a){return Math.floor(a/this.chunkSize)},BamCache.prototype.getFeatureChunk=function(a){return null!=this.cache[a]?this.cache[a]:null},BamCache.prototype.getFeatureChunksByRegion=function(a){var b,c,d,e=[];b=this._getChunk(a.start),c=this._getChunk(a.end);for(var f=b;c>=f;f++)d=a.chromosome+":"+f,null!=this.cache[d]&&e.push(this.cache[d]);return e},BamCache.prototype.putFeaturesByRegion=function(a,b,c,d){var e,f,g,h,i,j,k,l=a.reads,m=a.coverage;h=this._getChunk(b.start),i=this._getChunk(b.end);var n=0;console.time("BamCache.prototype.putFeaturesByRegion1");for(var o=h,p=0;i>=o;o++,p++){if(e=b.chromosome+":"+o,(null==this.cache[e]||null==this.cache[e][d])&&(this.cache[e]={},this.cache[e][d]=[],this.cache[e].key=e,this.cache[e].start=parseInt(b.start)+p*this.chunkSize,this.cache[e].end=parseInt(b.start)+(p+1)*this.chunkSize-1),"data"===d)var q=m.all.slice(n,n+this.chunkSize),r=m.a.slice(n,n+this.chunkSize),s=m.c.slice(n,n+this.chunkSize),t=m.g.slice(n,n+this.chunkSize),u=m.t.slice(n,n+this.chunkSize),v={all:q,a:r,c:s,g:t,t:u};this.cache[e].coverage=this.gzip?RawDeflate.deflate(JSON.stringify(v)):v,n+=this.chunkSize}console.timeEnd("BamCache.prototype.putFeaturesByRegion1"),console.time("BamCache.prototype.putFeaturesByRegion");var w=0;if("data"===d)for(var x=0,y=l.length;y>x;x++){j=l[x],j.featureType="bam",f=this._getChunk(j.start),g=this._getChunk(0==j.end?j.end=-1:j.end),k=this.gzip?RawDeflate.deflate(JSON.stringify(j)):j;for(var o=f,p=0;g>=o;o++,p++)o>=h&&i>=o&&(e=j.chromosome+":"+o,this.cache[e][d].push(k))}console.timeEnd("BamCache.prototype.putFeaturesByRegion"),console.log("BamCache.prototype.putFeaturesByRegion"+w)},BamCache.prototype.clear=function(){this.size=0,this.cache={},console.log("bamCache cleared")},NavigationBar.prototype={render:function(a){var b=this;if(this.targetId=a?a:this.targetId,this.targetDiv=this.targetId instanceof HTMLElement?this.targetId:$("#"+this.targetId)[0],"undefined"===this.targetDiv)return void console.log("targetId not found");var c='<div style="width: 1350px">   <div class="btn-group">       <button id="leftSideButton" class="btn btn-default btn-xs custom-xs" type="button"><span class="glyphicon glyphicon glyphicon-th-list"></span></button>   </div>   <div class="btn-group">       <button id="restoreDefaultRegionButton" class="btn btn-default btn-xs custom-xs" type="button"><span class="glyphicon glyphicon-repeat"></span></button>   </div>   <div class="btn-group">       <button id="regionHistoryButton" class="btn btn-default btn-xs custom-xs dropdown-toggle" data-toggle="dropdown"  type="button" ><span class="glyphicon glyphicon-time"></span> <span class="caret"></button>       <ul id="regionHistoryMenu" class="dropdown-menu" role="menu">       </ul>   </div>   <div class="btn-group">       <button id="speciesButton" class="btn btn-default btn-xs custom-xs dropdown-toggle" data-toggle="dropdown"  type="button" >           <span id="speciesText"></span>&nbsp;<span class="caret"></span>       </button>       <ul id="speciesMenu" class="dropdown-menu" role="menu">       </ul>   </div>   <div class="btn-group">       <button id="chromosomesButton" class="btn btn-default btn-xs custom-xs dropdown-toggle" data-toggle="dropdown"  type="button" >           <span id="chromosomesText"></span>&nbsp;<span class="caret"></span>       </button>       <ul id="chromosomesMenu" class="dropdown-menu" role="menu">       </ul>   </div>   <div class="btn-group" data-toggle="buttons">       <button id="karyotypeButton" class="btn btn-default btn-xs custom-xs" type="button"><span class="ocb-icon ocb-icon-karyotype"></span></button>       <button id="chromosomeButton" class="btn btn-default btn-xs custom-xs" type="button"><span class="ocb-icon ocb-icon-chromosome"></span></button>       <button id="regionButton" class="btn btn-default btn-xs custom-xs" type="button"><span class="ocb-icon ocb-icon-region"></span></button>   </div>   <div id="zoomControl" class="btn-group" style="margin-left:5px;">       <button id="zoomMinButton" class="btn btn-default custom-xs" type="button" style="width:31px"> 0 </button>       <button id="zoomOutButton" class="btn btn-default custom-xs" type="button"><span class="glyphicon glyphicon-minus"></span></button>       <div id="progressBarCont" class="progress pull-left" style="width:120px;height:22px;margin:0px;background-color: #d5d5d5;border-radius: 0px;">           <div id="progressBar" class="progress-bar" role="progressbar" aria-valuenow="45" aria-valuemin="0" aria-valuemax="100" style="width: '+this.zoom+'%">           </div>       </div>       <button id="zoomInButton" class="btn btn-default custom-xs" type="button"><span class="glyphicon glyphicon-plus"></span></button>       <button id="zoomMaxButton" class="btn btn-default custom-xs" type="button" style="width:40px"> 100 </button>   </div>   <div id="windowSizeControl" class="btn-group" style="width:150px">   <div class="input-group input-group-sm">       <span class="input-group-addon custom-xs"> Window size: </span>       <input id="windowSizeField" type="text" class="form-control custom-xs" placeholder="Window size">   </div>   </div>   <div id="positionControl" class="btn-group" style="width:250px">   <div class="input-group input-group-sm">       <span class="input-group-addon custom-xs"> Position: </span>       <input id="regionField" type="text" class="form-control custom-xs" placeholder="1:10000-20000">       <div class="input-group-btn">           <button id="goButton" class="btn btn-default btn-sm custom-xs" type="button">Go!</button>       </div>   </div>   </div>   <div id="moveControl" class="btn-group">       <button id="moveFurtherLeftButton" class="btn btn-default btn-xs custom-xs" type="button"><span class="ocb-icon ocb-icon-arrow-w-bold"></span></button>       <button id="moveLeftButton" class="btn btn-default btn-xs custom-xs" type="button"><span class="ocb-icon ocb-icon-arrow-w"></span></button>       <button id="moveRightButton" class="btn btn-default btn-xs custom-xs" type="button"><span class="ocb-icon ocb-icon-arrow-e"></span></button>       <button id="moveFurtherRightButton" class="btn btn-default btn-xs custom-xs" type="button"><span class="ocb-icon ocb-icon-arrow-e-bold"></span></button>   </div>   <div class="btn-group">       <button id="autoheightButton" class="btn btn-default btn-xs custom-xs" type="button"><span class="ocb-icon ocb-icon-track-autoheight"></span></button>   </div>    <div class="btn-group">       <button id="compactButton" class="btn btn-default btn-xs custom-xs" type="button"><span class="ocb-icon glyphicon glyphicon-compressed"></span></button>   </div>   <div id="searchControl" class="btn-group" style="width:250px">   <div class="input-group input-group-sm">       <span class="input-group-addon custom-xs"> Search: </span>       <input id="searchField" list="searchDataList" type="text" class="form-control custom-xs" placeholder="gene, snp...">       <datalist id="searchDataList">       </datalist>       <div class="input-group-btn">           <button id="quickSearchButton" class="btn btn-default btn-sm custom-xs" type="button"><span class="glyphicon glyphicon-search"></span></button>       </div>   </div>   </div></div>';
this.div=$('<div id="navigation-bar" class="ocb-gv-navigation-bar unselectable">'+c+"</div>")[0],$(this.div).css({height:"32px"}),$(this.targetDiv).append(this.div),$(this.div).find(".custom-xs").css({padding:"2px 4px",height:"22px",lineHeight:"16px",fontSize:"13px"});for(var d=$(this.div).find("*[id]"),e=0;e<d.length;e++){var f=d[e].getAttribute("id");f&&(this.els[f]=d[e])}for(var g in this.componentsConfig)this.componentsConfig[g]||$(this.els[g]).hide();$(this.els.leftSideButton).click(function(a){b.trigger("leftSideButton:click",{clickEvent:a,sender:{}})}),$(this.els.restoreDefaultRegionButton).click(function(a){b.trigger("restoreDefaultRegion:click",{clickEvent:a,sender:{}})}),this._addRegionHistoryMenuItem(this.region),this._setChromosomeMenu(),this._setSpeciesMenu(),$(this.els.chromosomesText).text(this.region.chromosome),$(this.els.speciesText).text(this.species.text),$(this.els.karyotypeButton).click(function(){b.trigger("karyotype-button:change",{selected:$(this).hasClass("active"),sender:b})}),$(this.els.chromosomeButton).click(function(){b.trigger("chromosome-button:change",{selected:$(this).hasClass("active"),sender:b})}),$(this.els.regionButton).click(function(){b.trigger("region-button:change",{selected:$(this).hasClass("active"),sender:b})}),$(this.els.zoomOutButton).click(function(){b._handleZoomOutButton()}),$(this.els.zoomInButton).click(function(){b._handleZoomInButton()}),$(this.els.zoomMaxButton).click(function(){b._handleZoomSlider(100)}),$(this.els.zoomMinButton).click(function(){b._handleZoomSlider(0)}),$(this.els.progressBarCont).click(function(a){var c=a.clientX-$(this).offset().left;console.log("offsetX "+c),console.log("e.offsetX "+a.offsetX);var d=100/$(this).width()*c;b._handleZoomSlider(d)}),$(this.els.regionField).val(this.region.toString()),$(this.els.regionField).bind("keyup",function(a){13===a.which&&b._triggerRegionChange({region:new Region($(b.els.regionField).val()),sender:b})}),$(this.els.goButton).click(function(){b._triggerRegionChange({region:new Region($(b.els.regionField).val()),sender:b})}),$(this.els.moveFurtherLeftButton).click(function(){b._handleMoveRegion(10)}),$(this.els.moveFurtherRightButton).click(function(){b._handleMoveRegion(-10)}),$(this.els.moveLeftButton).click(function(){b._handleMoveRegion(1)}),$(this.els.moveRightButton).click(function(){b._handleMoveRegion(-1)}),$(this.els.autoheightButton).click(function(a){b.trigger("autoHeight-button:click",{clickEvent:a,sender:b})}),$(this.els.compactButton).click(function(a){b.trigger("autoHeight-button:click",{clickEvent:a,sender:b}),$(".ocb-compactable").toggle()});var h="";$(this.els.searchField).bind("keyup",function(a){var c=$(this).val();if(c.length>2&&h!==c&&13!==a.which&&(b._setQuickSearchMenu(c),h=c),13===a.which){var d=b.quickSearchDataset[c];b.trigger("quickSearch:select",{item:d,sender:b})}}),$(this.els.quickSearchButton).click(function(){var a=$(b.els.searchField).val(),c=b.quickSearchDataset[a];b.trigger("quickSearch:go",{item:c,sender:b})}),$(this.els.windowSizeField).val(this.region.length()),$(this.els.windowSizeField).bind("keyup",function(a){var c=$(this).val(),d=/^([0-9])+$/;if(13===a.which&&d.test(c)){var e=parseInt(c),f=Math.floor(e/2),g=new Region({chromosome:b.region.chromosome,start:b.region.center()-f,end:b.region.center()+f});b._triggerRegionChange({region:g,sender:b})}}),this.rendered=!0},_addRegionHistoryMenuItem:function(a){var b=this,c=$('<li role="presentation"><a tabindex="-1" role="menuitem">'+a.toString()+"</a></li>")[0];$(this.els.regionHistoryMenu).append(c),$(c).click(function(){var a=new Region($(this).text());b._triggerRegionChange({region:a,sender:b})})},_setQuickSearchMenu:function(a){if("function"==typeof this.quickSearchResultFn){$(this.els.searchDataList).empty(),this.quickSearchDataset={};for(var b=this.quickSearchResultFn(a),c=0;c<b.length;c++){var d=b[c],e=d;"string"===$.type(this.quickSearchDisplayKey)&&(e=d[this.quickSearchDisplayKey]),this.quickSearchDataset[e]=d;var f=$('<option value="'+e+'">')[0];$(this.els.searchDataList).append(f)}}else console.log("the quickSearchResultFn function is not valid")},_setChromosomeMenu:function(){var a=this;$(this.els.chromosomesMenu).empty();var b=[];for(var c in this.availableSpecies.items)for(var d in this.availableSpecies.items[c].items){var e=this.availableSpecies.items[c].items[d];if(e.text===this.species.text){b=e.chromosomes;break}}this.currentChromosomeList=b;for(var c in b){var f=$('<li role="presentation"><a tabindex="-1" role="menuitem">'+b[c]+"</a></li>")[0];$(this.els.chromosomesMenu).append(f),$(f).click(function(){var b=new Region({chromosome:$(this).text(),start:a.region.start,end:a.region.end});a._triggerRegionChange({region:b,sender:a})})}},_setSpeciesMenu:function(){var a=this,b=function(b){var c=$('<li role="presentation"><a tabindex="-1" role="menuitem">'+b.text+"</a></li>")[0];$(a.els.speciesMenu).append(c),$(c).click(function(){a.species=b,$(a.els.speciesText).text($(this).text()),a._setChromosomeMenu(),a.trigger("species:change",{species:b,sender:a})})};for(var c in this.availableSpecies.items)for(var d in this.availableSpecies.items[c].items){var e=this.availableSpecies.items[c].items[d];b(e)}},_goRegion:function(a){var b=new Region;!b.parse(a)||b.start<0||b.end<0||-1==_.indexOf(this.currentChromosomeList,b.chromosome)?($(this.els.regionField).css({opacity:0}),$(this.els.regionField).animate({opacity:1},700)):this._triggerRegionChange({region:b,sender:this})},_handleZoomOutButton:function(){this._handleZoomSlider(Math.max(0,this.zoom-1))},_handleZoomSlider:function(a){var b=this;this.zoomChanging||(this.zoomChanging=!0,this.zoom=a,this.trigger("zoom:change",{zoom:this.zoom,sender:this}),setTimeout(function(){b.zoomChanging=!1},700))},_handleZoomInButton:function(){this._handleZoomSlider(Math.min(100,this.zoom+1))},_handleMoveRegion:function(a){var b=(this.width-this.svgCanvasWidthOffset)/this.region.length(),c=Math.round(10*a/b);this.region.start-=c,this.region.end-=c,$(this.regionField).val(this.region.toString()),this.trigger("region:move",{region:this.region,disp:c,sender:this})},setVisible:function(a){for(key in a){var b=$(this.els[key]);a[key]?b.show():b.hide()}},setRegion:function(a,b){this.region.load(a),b&&(this.zoom=b),this.updateRegionControls(),this._addRegionHistoryMenuItem(a)},moveRegion:function(a){this.region.load(a),$(this.els.chromosomesText).text(this.region.chromosome),$(this.els.regionField).val(this.region.toString())},setWidth:function(a){this.width=a},draw:function(){return this.rendered?void 0:void console.info(this.id+" is not rendered yet")},_triggerRegionChange:function(a){var b=this;this.regionChanging?this.updateRegionControls():(this.regionChanging=!0,this.trigger("region:change",a),setTimeout(function(){b.regionChanging=!1},700))},updateRegionControls:function(){$(this.els.chromosomesText).text(this.region.chromosome),$(this.els.regionField).val(this.region.toString()),$(this.els.windowSizeField).val(this.region.length()),$(this.els.progressBar).css("width",this.zoom+"%")}},ChromosomePanel.prototype={show:function(){$(this.div).css({display:"block"})},hide:function(){$(this.div).css({display:"none"})},showContent:function(){$(this.svg).css({display:"inline"}),this.collapsed=!1,$(this.collapseDiv).removeClass("active"),$(this.collapseDiv).children().first().removeClass("glyphicon-plus"),$(this.collapseDiv).children().first().addClass("glyphicon-minus")},hideContent:function(){$(this.svg).css({display:"none"}),this.collapsed=!0,$(this.collapseDiv).addClass("active"),$(this.collapseDiv).children().first().removeClass("glyphicon-minus"),$(this.collapseDiv).children().first().addClass("glyphicon-plus")},setVisible:function(a){$(this.div).css(a?{display:"block"}:{display:"none"})},setTitle:function(a){"titleDiv"in this&&$(this.titleTextDiv).html(a)},setWidth:function(a){this.width=a,this.svg.setAttribute("width",a),"undefined"!=typeof this.data&&(this.clean(),this._drawSvg(this.data))},render:function(){var a=this;if(this.div=$('<div id="chromosome-panel"></div>')[0],"title"in this&&""!==this.title){var b=$('<div id="tl-title" class="ocb-gv-panel-title unselectable"></div>')[0];$(this.div).append(b),1==this.collapsible&&(this.collapseDiv=$('<div class="ocb-gv-panel-collapse-control"><span class="glyphicon glyphicon-minus"></span></div>'),$(b).dblclick(function(){a.collapsed?a.showContent():a.hideContent()}),$(this.collapseDiv).click(function(){a.collapsed?a.showContent():a.hideContent()}),$(b).append(this.collapseDiv)),this.titleTextDiv=$('<div class="ocb-gv-panel-text">'+this.title+"</div>"),$(b).append(this.titleTextDiv)}this.svg=SVG.init(this.div,{width:this.width,height:this.height}),$(this.div).addClass("unselectable"),this.colors={gneg:"#eeeeee",stalk:"#666666",gvar:"#CCCCCC",gpos25:"silver",gpos33:"lightgrey",gpos50:"gray",gpos66:"dimgray",gpos75:"darkgray",gpos100:"black",gpos:"gray",acen:"blue",clementina:"#ffc967"},this.rendered=!0},setSpecies:function(a){this.species=a},clean:function(){$(this.svg).empty()},draw:function(){var a=this;return this.targetDiv=this.target instanceof HTMLElement?this.target:document.querySelector("#"+this.target),this.targetDiv?(this.targetDiv.appendChild(this.div),this.clean(),CellBaseManager.get({host:this.cellBaseHost,version:this.cellBaseVersion,species:this.species,category:"genomic",subCategory:"chromosome",query:this.region.chromosome,resource:"info",async:!1,success:function(b){a.data=b.response[0].result.chromosomes,a.data.cytobands.sort(function(a,b){return a.start-b.start}),a._drawSvg(a.data)}}),this.lastChromosome=this.region.chromosome,void(this.collapsed&&a.hideContent())):void console.log("target not found")},_drawSvg:function(a){var b=this,c=20,d=SVG.addChild(b.svg,"g",{cursor:"pointer"});this.chromosomeLength=a.size,this.pixelBase=(this.width-40)/this.chromosomeLength;for(var e=(SVG.addChild(d,"rect",{x:c,y:4,width:this.width-40+1,height:22,fill:"#555555"}),{}),f=c,g=0;g<a.cytobands.length;g++){var h=a.cytobands[g];h.pixelStart=h.start*this.pixelBase,h.pixelEnd=h.end*this.pixelBase,h.pixelSize=h.pixelEnd-h.pixelStart,"undefined"==typeof e[h.stain]&&(e[h.stain]=[]),e[h.stain].push(h);var i=f+h.pixelSize/2,j=28,k=SVG.addChild(d,"text",{x:i,y:j,"font-size":10,transform:"rotate(90, "+i+", "+j+")",fill:"black"});k.textContent=h.name,f+=h.pixelSize}for(var l in e){var m="";if("acen"!=l){for(var n=0;n<e[l].length;n++){var h=e[l][n];m+="M"+(h.pixelStart+c+1)+",15 L"+(h.pixelEnd+c)+",15 "}{SVG.addChild(d,"path",{d:m,stroke:this.colors[l],"stroke-width":20,fill:"none"})}}}if("undefined"!=typeof e.acen){var o=e.acen[0],p=e.acen[1],q=(SVG.addChild(d,"rect",{x:o.pixelStart+c+1,y:4,width:p.pixelEnd+c-(o.pixelStart+c+1),height:22,fill:"white"}),o.pixelStart+c+1),r=o.pixelEnd+c,s=p.pixelStart+c+1,t=p.pixelEnd+c;SVG.addChild(d,"path",{d:"M"+q+",4 L"+(r-5)+",4  L"+r+",15  L "+(r-5)+",26  L "+q+",26 z",fill:this.colors.acen}),SVG.addChild(d,"path",{d:"M"+s+",15 L"+(s+5)+",4  L"+t+",4  L "+t+",26  L "+(s+5)+",26 z",fill:this.colors.acen})}var u="",v=b.region.center(),w=v*b.pixelBase+c;$(this.svg).on("mousedown",function(){u="setRegion"}),this.selBox=SVG.addChild(this.svg,"rect",{x:0,y:2,"stroke-width":"2",stroke:"deepskyblue",opacity:"0.5",fill:"honeydew"});var x=b.region.length()*b.pixelBase,y=SVG.addChild(d,"g");this.positionBox=SVG.addChild(y,"rect",{x:w-x/2,y:2,width:x,height:b.height-3,stroke:"orangered","stroke-width":2,opacity:.5,fill:"navajowhite",cursor:"move"}),$(this.positionBox).on("mousedown",function(){u="movePositionBox"}),this.resizeLeft=SVG.addChild(y,"rect",{x:w-x/2,y:2,width:7,height:b.height-3,opacity:.5,fill:"orangered",visibility:"hidden"}),$(this.resizeLeft).on("mousedown",function(){u="resizePositionBoxLeft"}),this.resizeRight=SVG.addChild(y,"rect",{x:x-5,y:2,width:7,height:b.height-3,opacity:.5,fill:"orangered",visibility:"hidden"}),$(this.resizeRight).on("mousedown",function(){u="resizePositionBoxRight"}),$(this.positionBox).off("mouseenter"),$(this.positionBox).off("mouseleave"),$(y).mouseenter(function(){b._recalculateResizeControls(),b._showResizeControls()}),$(y).mouseleave(function(){b._hideResizeControls()}),$(this.svg).off("contextmenu"),$(this.svg).off("mousedown"),$(this.svg).off("mouseup"),$(this.svg).off("mousemove"),$(this.svg).off("mouseleave"),$(this.svg).contextmenu(function(a){a.preventDefault()});var z,A,B;$(this.svg).mousedown(function(a){z=a.clientX-$(this).parent().offset().left,b.selBox.setAttribute("x",z),B=b.positionBox.getAttribute("x"),""==u&&(u="setRegion"),b._hideResizeControls(),$(this).mousemove(function(a){switch(A=a.clientX-$(this).parent().offset().left,b._hideResizeControls(),u){case"resizePositionBoxLeft":var c=A-z,d=parseInt(b.positionBox.getAttribute("width"))-c;d>0&&(b.positionBox.setAttribute("x",parseInt(b.positionBox.getAttribute("x"))+c),b.positionBox.setAttribute("width",d)),z=A;break;case"resizePositionBoxRight":var c=A-z,d=parseInt(b.positionBox.getAttribute("width"))+c;d>0&&b.positionBox.setAttribute("width",d),z=A;break;case"movePositionBox":var c=A-z;b.positionBox.setAttribute("x",parseInt(b.positionBox.getAttribute("x"))+c),z=A;break;case"setRegion":case"selectingRegion":u="selectingRegion",z>A&&b.selBox.setAttribute("x",A),b.selBox.setAttribute("width",Math.abs(A-z)),b.selBox.setAttribute("height",b.height-3)}})}),$(this.svg).mouseup(function(){if($(this).off("mousemove"),null!=z){switch(u){case"resizePositionBoxLeft":case"resizePositionBoxRight":case"movePositionBox":if(null!=A){var a=parseInt(b.positionBox.getAttribute("width")),d=parseInt(b.positionBox.getAttribute("x")),e=d,f=d+a,g=(e-c)/b.pixelBase,h=(f-c)/b.pixelBase;b._triggerRegionChange({region:new Region({chromosome:b.region.chromosome,start:g,end:h}),sender:b})}break;case"setRegion":if(z>c&&z<b.width-c){var a=b.positionBox.getAttribute("width"),e=z-a/2,f=z+a/2,g=(e-c)/b.pixelBase,h=(f-c)/b.pixelBase;b._triggerRegionChange({region:new Region({chromosome:b.region.chromosome,start:g,end:h}),sender:b})}break;case"selectingRegion":var g=(z-c)/b.pixelBase,h=(A-c)/b.pixelBase,i=Math.min(g,h),j=Math.max(g,h);b.selBox.setAttribute("width",0),b.selBox.setAttribute("height",0),b._triggerRegionChange({region:new Region({chromosome:b.region.chromosome,start:i,end:j}),sender:b})}u=""}z=null,A=null,B=b.positionBox.getAttribute("x")}),$(this.svg).mouseleave(function(){$(this).off("mousemove"),null!=B&&b.positionBox.setAttribute("x",B),b.selBox.setAttribute("width",0),b.selBox.setAttribute("height",0),z=null,A=null,B=null,overPositionBox=!1,movingPositionBox=!1,selectingRegion=!1})},_triggerRegionChange:function(a){var b=this;this.regionChanging?this.updateRegionControls():(this.regionChanging=!0,this._limitRegionToChromosome(a.region),this.trigger("region:change",a),setTimeout(function(){b.regionChanging=!1},700))},_recalculatePositionBox:function(a){var b=a.length(),c=b*this.pixelBase,d=a.start*this.pixelBase+20;this.positionBox.setAttribute("x",d),this.positionBox.setAttribute("width",c)},_recalculateSelectionBox:function(a){var b=a.length(),c=b*this.pixelBase,d=a.start*this.pixelBase+20;this.selBox.setAttribute("x",d),this.selBox.setAttribute("width",c)},_recalculateResizeControls:function(){var a=parseInt(this.positionBox.getAttribute("x")),b=parseInt(this.positionBox.getAttribute("width"));this.resizeLeft.setAttribute("x",a-5),this.resizeRight.setAttribute("x",a+b),$(this.resizeLeft).css({cursor:"ew-resize"}),$(this.resizeRight).css({cursor:"ew-resize"})},_hideResizeControls:function(){this.resizeLeft.setAttribute("visibility","hidden"),this.resizeRight.setAttribute("visibility","hidden")},_showResizeControls:function(){this.resizeLeft.setAttribute("visibility","visible"),this.resizeRight.setAttribute("visibility","visible")},_limitRegionToChromosome:function(a){a.start=a.start<1?1:a.start,a.end=a.end>this.chromosomeLength?this.chromosomeLength:a.end},updateRegionControls:function(){this.selBox.setAttribute("width",0),this.selBox.setAttribute("height",0),this._recalculatePositionBox(this.region),this._recalculateResizeControls()},setRegion:function(a){console.log("region modified chromosome"),this.region.load(a);var b=!1;this.lastChromosome!=this.region.chromosome&&(b=!0),b&&this.draw(),this.updateRegionControls()}},KaryotypePanel.prototype={show:function(){$(this.div).css({display:"block"})},hide:function(){$(this.div).css({display:"none"})},showContent:function(){$(this.svg).css({display:"inline"}),this.collapsed=!1,$(this.collapseDiv).removeClass("active"),$(this.collapseDiv).children().first().removeClass("glyphicon-plus"),$(this.collapseDiv).children().first().addClass("glyphicon-minus")},hideContent:function(){$(this.svg).css({display:"none"}),this.collapsed=!0,$(this.collapseDiv).addClass("active"),$(this.collapseDiv).children().first().removeClass("glyphicon-minus"),$(this.collapseDiv).children().first().addClass("glyphicon-plus")},setVisible:function(a){$(this.div).css(a?{display:"block"}:{display:"none"})},setTitle:function(a){"titleDiv"in this&&$(this.titleTextDiv).html(a)},setWidth:function(a){this.width=a,this.svg.setAttribute("width",a),"undefined"!=typeof this.chromosomeList&&(this.clean(),this._drawSvg(this.chromosomeList,this.data2))},render:function(){var a=this;if(this.div=$('<div id="karyotype-panel"></div>')[0],"title"in this&&""!==this.title){var b=$('<div id="tl-title" class="ocb-gv-panel-title unselectable"></div>')[0];$(this.div).append(b),1==this.collapsible&&(this.collapseDiv=$('<div class="ocb-gv-panel-collapse-control"><span class="glyphicon glyphicon-minus"></span></div>'),$(b).dblclick(function(){a.collapsed?a.showContent():a.hideContent()}),$(this.collapseDiv).click(function(){a.collapsed?a.showContent():a.hideContent()}),$(b).append(this.collapseDiv)),this.titleTextDiv=$('<div class="ocb-gv-panel-text">'+this.title+"</div>"),$(b).append(this.titleTextDiv)}this.svg=SVG.init(this.div,{width:this.width,height:this.height}),this.markGroup=SVG.addChild(this.svg,"g",{cursor:"pointer"}),$(this.div).addClass("unselectable"),this.colors={gneg:"white",stalk:"#666666",gvar:"#CCCCCC",gpos25:"silver",gpos33:"lightgrey",gpos50:"gray",gpos66:"dimgray",gpos75:"darkgray",gpos100:"black",gpos:"gray",acen:"blue"},this.rendered=!0},setSpecies:function(a){this.lastSpecies=this.species,this.species=a},clean:function(){$(this.svg).empty()},draw:function(){var a=this;if(this.targetDiv=this.target instanceof HTMLElement?this.target:document.querySelector("#"+this.target),!this.targetDiv)return void console.log("target not found");this.targetDiv.appendChild(this.div),this.clean();var b=function(a,b){for(var c=!0,d=0;d<a.name.length&&1==c;d++)isNaN(a.name[d])&&(c=!1);return c?a.name-b.name:1};CellBaseManager.get({host:this.cellBaseHost,version:this.cellBaseVersion,species:this.species,category:"genomic",subCategory:"chromosome",resource:"all",async:!1,success:function(c){a.chromosomeList=c.response.result.chromosomes,a.chromosomeList.sort(b),a._drawSvg(a.chromosomeList)}}),this.collapsed&&a.hideContent()},_drawSvg:function(a){for(var b=this,c=20,d=b.width/a.length,e=2,f=0,g=0,h=a.length;h>g;g++){var i=a[g].size;i>f&&(f=i)}b.pixelBase=(b.height-10)/f,b.chrOffsetY={},b.chrOffsetX={};for(var g=0,h=a.length;h>g;g++){var j=a[g],k=j.size*b.pixelBase,l=e+f*b.pixelBase-k;b.chrOffsetY[j.name]=l;var m=!0,n=SVG.addChild(b.svg,"g",{cursor:"pointer",chr:j.name});$(n).click(function(a){var c=this.getAttribute("chr"),d=a.pageY-$(b.svg).offset().top,e=parseInt((d-b.chrOffsetY[c])/b.pixelBase),f=new Region({chromosome:c,start:e,end:e});b._triggerRegionChange({region:f,sender:b})});for(var o=0,p=j.cytobands.length;p>o;o++){var q=j.cytobands[o],r=b.pixelBase*(q.end-q.start),s=13,t=b.colors[q.stain];if(null==t&&(t="purple"),"acen"==q.stain){var u="",v=c+s/2,w=l+r/2,x=c+s,y=l+r;m?(u=c+","+l+" "+x+","+l+" "+x+","+w+" "+v+","+y+" "+c+","+w,m=!1):u=c+","+y+" "+c+","+w+" "+v+","+l+" "+x+","+w+" "+x+","+y,SVG.addChild(n,"polyline",{points:u,stroke:"black",opacity:.8,fill:t})}else SVG.addChild(n,"rect",{x:c,y:l,width:s,height:r,stroke:"grey",opacity:.8,fill:t});l+=r}var z=SVG.addChild(b.svg,"text",{x:c+1,y:b.height,"font-size":9,fill:"black"});z.textContent=j.name,b.chrOffsetX[j.name]=c,c+=d}this.positionBox=SVG.addChild(this.svg,"line",{x1:0,y1:0,x2:0,y2:0,stroke:"orangered","stroke-width":2,opacity:.5}),this._recalculatePositionBox(this.region),this.rendered=!0,this.trigger("after:render",{sender:this})},_triggerRegionChange:function(a){var b=this;this.regionChanging?this.updateRegionControls():(this.regionChanging=!0,this.trigger("region:change",a),setTimeout(function(){b.regionChanging=!1},700))},_recalculatePositionBox:function(a){var b=a.center(),c=b*this.pixelBase+this.chrOffsetY[a.chromosome];this.positionBox.setAttribute("x1",this.chrOffsetX[a.chromosome]-10),this.positionBox.setAttribute("x2",this.chrOffsetX[a.chromosome]+23),this.positionBox.setAttribute("y1",c),this.positionBox.setAttribute("y2",c)},updateRegionControls:function(){this._recalculatePositionBox(this.region)},setRegion:function(a){this.region.load(a);var b=!1;this.lastSpecies!=this.species&&(b=!0,this.lastSpecies=this.species),this.updateRegionControls(),b&&this.draw()},addMark:function(){var a=this,b=function(){if(null!=a.region.chromosome&&null!=a.region.start&&null!=a.chrOffsetX[a.region.chromosome]){var b=a.chrOffsetX[a.region.chromosome]-10,c=a.chrOffsetX[a.region.chromosome],d=a.region.start*a.pixelBase+a.chrOffsetY[a.region.chromosome]-4,e=a.region.start*a.pixelBase+a.chrOffsetY[a.region.chromosome],f=a.region.start*a.pixelBase+a.chrOffsetY[a.region.chromosome]+4,g=b+","+d+" "+c+","+e+" "+b+","+f+" "+b+","+d;SVG.addChild(a.markGroup,"polyline",{points:g,stroke:"black",opacity:.8,fill:"#33FF33"})}};this.rendered?b():a.on("after:render",function(){b()})},unmark:function(){$(this.markGroup).empty()}},StatusBar.prototype={render:function(){this.div=$('<div id="'+this.id+'" class="ocb-gv-status-bar"></div>')[0],this.rightDiv=$('<div class="ocb-gv-status-right" id="'+this.id+'position"</div>')[0],this.leftDiv=$('<div class="ocb-gv-status-left" id="'+this.id+'position"></div>')[0],$(this.div).append(this.leftDiv),$(this.div).append(this.rightDiv),this.mousePositionEl=$('<span id="'+this.id+'position">&nbsp;</span>')[0],this.versionEl=$('<span id="'+this.id+'version">'+this.version+"</span>")[0],$(this.rightDiv).append(this.mousePositionEl),$(this.leftDiv).append(this.versionEl),this.rendered=!0},draw:function(){return this.targetDiv=this.target instanceof HTMLElement?this.target:document.querySelector("#"+this.target),this.targetDiv?void this.targetDiv.appendChild(this.div):void console.log("target not found")},setRegion:function(a){this.region.load(a.region),$(this.mousePositionEl).html(Utils.formatNumber(a.region.center()))},setMousePosition:function(a){$(this.mousePositionEl).html(a.baseHtml+" "+this.region.chromosome+":"+Utils.formatNumber(a.mousePos))}},TrackListPanel.prototype={show:function(){$(this.div).css({display:"block"})},hide:function(){$(this.div).css({display:"none"})},setVisible:function(a){$(this.div).css(a?{display:"block"}:{display:"none"})},setTitle:function(a){"titleDiv"in this&&$(this.titleDiv).html(a)},showContent:function(){$(this.tlHeaderDiv).css({display:"block"}),$(this.panelDiv).css({display:"block"}),this.collapsed=!1,$(this.collapseDiv).removeClass("active"),$(this.collapseDiv).children().first().removeClass("glyphicon-plus"),$(this.collapseDiv).children().first().addClass("glyphicon-minus")},hideContent:function(){$(this.tlHeaderDiv).css({display:"none"}),$(this.panelDiv).css({display:"none"}),this.collapsed=!0,$(this.collapseDiv).addClass("active"),$(this.collapseDiv).children().first().removeClass("glyphicon-minus"),$(this.collapseDiv).children().first().addClass("glyphicon-plus")},render:function(){var a=this;if(this.div=$('<div id="tracklist-panel" style="height:100%;position: relative;"></div>')[0],"title"in this&&""!==this.title){var b=$('<div id="tl-title" class="ocb-gv-panel-title unselectable"></div>')[0];$(this.div).append(b);var c=$('<div class="ocb-gv-tracklist-windowsize" id="windowSizeSpan"></div>');$(b).append(c),1==this.collapsible&&(this.collapseDiv=$('<div class="ocb-gv-panel-collapse-control"><span class="glyphicon glyphicon-minus"></span></div>'),$(b).dblclick(function(){a.collapsed?a.showContent():a.hideContent()}),$(this.collapseDiv).click(function(){a.collapsed?a.showContent():a.hideContent()}),$(b).append(this.collapseDiv));var d=$('<div class="ocb-gv-panel-text">'+this.title+"</div>");$(b).append(d)}var e=$('<div id="tl-header" class="unselectable"></div>')[0],f=$('<div id="tl-panel"></div>')[0];$(f).css({position:"relative",width:"100%"}),this.tlTracksDiv=$('<div id="tl-tracks"></div>')[0],$(this.tlTracksDiv).css({position:"relative","z-index":3}),$(this.div).append(e),$(this.div).append(f),$(f).append(this.tlTracksDiv),this.svgTop=SVG.init(e,{width:this.width,height:12});var g=this.width/2,h=11;this.positionText=SVG.addChild(this.svgTop,"text",{x:g-30,y:h,fill:"steelblue","class":this.fontClass}),this.nucleotidText=SVG.addChild(this.svgTop,"text",{x:g+35,y:h,"class":this.fontClass}),this.firstPositionText=SVG.addChild(this.svgTop,"text",{x:0,y:h,fill:"steelblue","class":this.fontClass}),this.lastPositionText=SVG.addChild(this.svgTop,"text",{x:this.width-70,y:h,fill:"steelblue","class":this.fontClass}),this.windowSize="Window size: "+Utils.formatNumber(this.region.length())+" nts",this.viewNtsText=SVG.addChild(this.svgTop,"text",{x:g-7*this.windowSize.length/2,y:11,fill:"black","class":this.fontClass}),this.viewNtsText.setAttribute("visibility","hidden"),this.viewNtsText.textContent=this.windowSize,$(this.div).find("#windowSizeSpan").html(this.windowSize),this._setTextPosition(),this.centerLine=$('<div id="'+this.id+'centerLine"></div>')[0],$(f).append(this.centerLine),$(this.centerLine).css({"z-index":2,position:"absolute",left:g-1,top:0,width:this.pixelBase+1,height:"calc(100% - 8px)",opacity:.5,border:"1px solid orangered","background-color":"orange"}),this.mouseLine=$('<div id="'+this.id+'mouseLine"></div>')[0],$(f).append(this.mouseLine),$(this.mouseLine).css({"z-index":1,position:"absolute",left:-20,top:0,width:this.pixelBase+2,height:"calc(100% - 8px)",border:"1px solid lightgray",opacity:.7,visibility:"hidden","background-color":"gainsboro"});var i=$('<div id="'+this.id+'selBox"></div>')[0];if($(f).append(i),$(i).css({"z-index":0,position:"absolute",left:0,top:0,height:"100%",border:"2px solid deepskyblue",opacity:.5,visibility:"hidden","background-color":"honeydew"}),this.showRegionOverviewBox){var j=$('<div id="'+this.id+'regionOverviewBoxLeft"></div>')[0],k=$('<div id="'+this.id+'regionOverviewBoxRight"></div>')[0];$(f).append(j),$(f).append(k);var l=this.region.length()*this.pixelBase,m=(this.width-l)/2;$(j).css({"z-index":0,position:"absolute",left:1,top:0,width:m,height:"calc(100% - 8px)",opacity:.5,"background-color":"lightgray"}),$(k).css({"z-index":0,position:"absolute",left:m+l,top:0,width:m,height:"calc(100% - 8px)",opacity:.5,"background-color":"lightgray"}),this.regionOverviewBoxLeft=j,this.regionOverviewBoxRight=k}$(this.div).mousemove(function(b){var c=a.region.center(),d=a.width/2,e=a.pixelBase/2,f=b.clientX-$(a.tlTracksDiv).offset().left,g=f-e,h=g/a.pixelBase|0,i=h*a.pixelBase+d%a.pixelBase-1;$(a.mouseLine).css({left:i});var j=d/a.pixelBase|0;a.mousePosition=c+h-j,a.trigger("mousePosition:change",{mousePos:a.mousePosition,baseHtml:a.getMousePosition(a.mousePosition)})}),$(this.tlTracksDiv).dblclick(function(){if(!a.regionChanging){a.regionChanging=!0;var b=a.region.length()/2,c=new Region({chromosome:a.region.chromosome,start:a.mousePosition-b,end:a.mousePosition+b});a.trigger("region:change",{region:c,sender:a}),setTimeout(function(){a.regionChanging=!1},700)}});var n,o;$(this.tlTracksDiv).mousedown(function(b){$("html").addClass("unselectable"),$(a.mouseLine).css({visibility:"hidden"});var c=b.which;switch(b.ctrlKey&&(c="ctrlKey"+b.which),c){case 1:$(this).css({cursor:"move"}),n=b.clientX;var d=0;$(this).mousemove(function(b){var c=(n-b.clientX)/a.pixelBase|0;if(c!=d){var e=d-c,f=a.region.center(),g=f-e;g>0&&(a.region.start-=e,a.region.end-=e,a._setTextPosition(),a.trigger("region:move",{region:a.region,disp:e,sender:a}),a.trigger("trackRegion:move",{region:a.region,disp:e,sender:a}),d=c,a.setNucleotidPosition(g))}});break;case 2:case"ctrlKey1":$(i).css({visibility:"visible"}),$(i).css({width:0}),n=b.pageX-$(a.tlTracksDiv).offset().left,$(i).css({left:n}),$(this).mousemove(function(b){o=b.pageX-$(a.tlTracksDiv).offset().left,n>o&&$(i).css({left:o}),$(i).css({width:Math.abs(o-n)})});break;case 3:}}),$(this.tlTracksDiv).mouseup(function(b){$("html").removeClass("unselectable"),$(this).css({cursor:"default"}),$(a.mouseLine).css({visibility:"visible"}),$(this).off("mousemove");var c=b.which;switch(b.ctrlKey&&(c="ctrlKey"+b.which),c){case 1:break;case 2:case"ctrlKey1":if($(i).css({visibility:"hidden"}),$(this).off("mousemove"),null!=n&&null!=o){var d=n/a.pixelBase,e=o/a.pixelBase;d+=a.visualRegion.start,e+=a.visualRegion.start,a.region.start=parseInt(Math.min(d,e)),a.region.end=parseInt(Math.max(d,e)),a.trigger("region:change",{region:a.region,sender:a}),o=null}else if(null!=n&&null==o){var f=new Region({chromosome:a.region.chromosome,start:a.mousePosition,end:a.mousePosition});a.trigger("region:change",{region:f,sender:a})}break;case 3:}}),$(this.tlTracksDiv).mouseleave(function(){$(this).css({cursor:"default"}),$(a.mouseLine).css({visibility:"hidden"}),$(this).off("mousemove"),$("body").off("keydown.genomeViewer"),$(i).css({visibility:"hidden"}),n=null,o=null}),$(this.tlTracksDiv).mouseenter(function(){$(a.mouseLine).css({visibility:"visible"}),$("body").off("keydown.genomeViewer"),p()});var p=function(){$("body").bind("keydown.genomeViewer",function(b){var c=0;switch(b.keyCode){case 37:c=Math.round(b.ctrlKey?100/a.pixelBase:10/a.pixelBase);break;case 39:c=Math.round(b.ctrlKey?-100/a.pixelBase:-10/a.pixelBase)}0!=c&&(a.region.start-=c,a.region.end-=c,a._setTextPosition(),a.trigger("region:move",{region:a.region,disp:c,sender:a}),a.trigger("trackRegion:move",{region:a.region,disp:c,sender:a}))})};this.tlHeaderDiv=e,this.panelDiv=f,this.rendered=!0},setHeight:function(){},setWidth:function(a){console.log(a),this.width=a-18;var b=this.width/2;if(this._setPixelBase(),$(this.centerLine).css({left:b-1,width:this.pixelBase+2}),$(this.mouseLine).css({width:this.pixelBase}),this.svgTop.setAttribute("width",this.width),this.positionText.setAttribute("x",b-30),this.nucleotidText.setAttribute("x",b+35),this.lastPositionText.setAttribute("x",this.width-70),this.viewNtsText.setAttribute("x",b-7*this.windowSize.length/2),this.trigger("trackWidth:change",{width:this.width,sender:this}),this._setTextPosition(),this.showRegionOverviewBox){var c=this.region.length()*this.pixelBase,d=(this.width-c)/2;$(this.regionOverviewBoxLeft).css({width:d}),$(this.regionOverviewBoxRight).css({left:d+c,width:d})}},highlight:function(a){this.trigger("trackFeature:highlight",a)},moveRegion:function(a){this.region.load(a.region),this.visualRegion.load(a.region),this._setTextPosition(),this.trigger("trackRegion:move",a)},setSpecies:function(a){this.species=a,this.trigger("trackSpecies:change",{species:a,sender:this})},setRegion:function(a){this.region.load(a),this.visualRegion.load(a),this._setPixelBase(),$(this.centerLine).css({width:this.pixelBase+2}),$(this.mouseLine).css({width:this.pixelBase+2}),this.windowSize="Window size: "+Utils.formatNumber(this.region.length())+" nts",this.viewNtsText.textContent=this.viewNtsText.textContent,$(this.div).find("#windowSizeSpan").html(this.windowSize),this._setTextPosition(),this.trigger("window:size",{windowSize:this.windowSize}),this.trigger("trackRegion:change",{region:this.visualRegion,sender:this}),this.nucleotidText.textContent="",this.status="rendering"},draw:function(){return this.targetDiv=this.target instanceof HTMLElement?this.target:document.querySelector("#"+this.target),this.targetDiv?(this.targetDiv.appendChild(this.div),void this.trigger("track:draw",{sender:this})):void console.log("target not found")
},_checkAllTrackStatus:function(a){for(var b in this.tracks)if(this.tracks[b].status!=a)return!1;return!0},checkTracksReady:function(){return this._checkAllTrackStatus("ready")},addTrack:function(a){if(_.isArray(a))for(var b in a)this._addTrack(a[b]);else this._addTrack(a)},_addTrack:function(a){if(!this.rendered)return void console.info(this.id+" is not rendered yet");var b=this;if(null==a)return!1;if(this.containsTrack(a))return!1;var c=this.tracks.push(a),d=c-1;this.tracksIndex[a.id]=d,"undefined"==typeof a.dataAdapter.host&&(a.dataAdapter.host=this.cellBaseHost),"undefined"==typeof a.dataAdapter.version&&(a.dataAdapter.version=this.cellBaseVersion),a.set("pixelBase",this.pixelBase),a.set("region",this.visualRegion),a.set("width",this.width),a.rendered||a.render(this.tlTracksDiv),a.draw(),a.set("track:draw",function(){a.draw()}),a.set("trackSpecies:change",function(b){a.setSpecies(b.species)}),a.set("trackRegion:change",function(c){a.set("pixelBase",b.pixelBase),a.set("region",c.region),a.draw()}),a.set("trackRegion:move",function(c){a.set("region",c.region),a.set("pixelBase",b.pixelBase),a.move(c.disp)}),a.set("trackWidth:change",function(c){a.setWidth(c.width),a.set("pixelBase",b.pixelBase),a.draw()}),a.set("trackFeature:highlight",function(b){var c=b.attrName||"feature_id";if("attrValue"in b){b.attrValue=$.isArray(b.attrValue)?b.attrValue:[b.attrValue];for(var d in b.attrValue){var e=c+"~="+b.attrValue[d],f=$(a.svgdiv).find("g["+e+"]");$(f).each(function(){var b=$(this).find("animate");b=0==b.length?SVG.addChild(this,"animate",{attributeName:"opacity",attributeType:"XML",begin:"indefinite",from:"0.0",to:"1",begin:"0s",dur:"0.5s",repeatCount:"5"}):b[0];var c=$(f).find("rect").attr("y");$(a.svgdiv).scrollTop(c),b.beginElement()})}}}),a.on("track:close",function(a){b.removeTrack(a.sender)}),a.on("track:up",function(a){b._reallocateAbove(a.sender)}),a.on("track:down",function(a){b._reallocateUnder(a.sender)}),this.on("track:draw",a.get("track:draw")),this.on("trackSpecies:change",a.get("trackSpecies:change")),this.on("trackRegion:change",a.get("trackRegion:change")),this.on("trackRegion:move",a.get("trackRegion:move")),this.on("trackWidth:change",a.get("trackWidth:change")),this.on("trackFeature:highlight",a.get("trackFeature:highlight"))},enableAutoHeight:function(){for(var a=0;a<this.tracks.length;a++){var b=this.tracks[a];b.enableAutoHeight()}},updateHeight:function(){for(var a=0;a<this.tracks.length;a++){var b=this.tracks[a];b.updateHeight(!0)}},containsTrack:function(a){return"undefined"!=typeof this.tracksIndex[a.id]?!0:!1},getTrackIndex:function(a){return this.tracksIndex[a.id]},_updateTracksIndex:function(){for(var a=0;a<this.tracks.length;a++){var b=this.tracks[a];this.tracksIndex[b.id]=a}},refreshTracksDom:function(){for(var a=0;a<this.tracks.length;a++){var b=this.tracks[a];$(b.div).detach(),b.visible&&$(this.tlTracksDiv).append(b.div)}},removeTrack:function(a){if(!this.containsTrack(a))return!1;this.hideTrack(a);var b=this.getTrackIndex(a);return this.tracks.splice(b,1)[0],delete this.tracksIndex[a.id],this._updateTracksIndex(),this.off("track:draw",a.get("track:draw")),this.off("trackSpecies:change",a.get("trackSpecies:change")),this.off("trackRegion:change",a.get("trackRegion:change")),this.off("trackRegion:move",a.get("trackRegion:move")),this.off("trackWidth:change",a.set("trackWidth:change")),this.off("trackFeature:highlight",a.get("trackFeature:highlight")),this.refreshTracksDom(),a},restoreTrack:function(a,b){return this.containsTrack(a)?!1:(this.addTrack(a),"undefined"!=typeof b&&this.setTrackIndex(a,b),a.show(),void this.refreshTracksDom())},_reallocateAbove:function(a){if(!this.containsTrack(a))return!1;var b=this.getTrackIndex(a);if(console.log(b+" wants to move up"),b>0){var c=this.tracks[b-1],d=this.tracks[b],e=parseInt(c.main.getAttribute("y")),f=parseInt(d.main.getAttribute("height"));c.main.setAttribute("y",e+f),d.main.setAttribute("y",e),this.tracks[b]=c,this.tracks[b-1]=d,this.tracksIndex[c.id]=b,this.tracksIndex[d.id]=b-1,this.refreshTracksDom()}else console.log("is at top")},_reallocateUnder:function(a){if(!this.containsTrack(a))return!1;var b=this.getTrackIndex(a);if(console.log(b+" wants to move down"),b+1<this.tracks.length){var c=this.tracks[b],d=this.tracks[b+1],e=parseInt(c.main.getAttribute("y")),f=parseInt(d.main.getAttribute("height"));c.main.setAttribute("y",e+f),d.main.setAttribute("y",e),this.tracks[b]=d,this.tracks[b+1]=c,this.tracksIndex[d.id]=b,this.tracksIndex[c.id]=b+1,this.refreshTracksDom()}else console.log("is at bottom")},setTrackIndex:function(a,b){if(!this.containsTrack(a))return!1;var c=this.getTrackIndex(a);this.tracks.splice(c,1)[0],this.tracks.splice(b,0,a),this._updateTracksIndex(),this.refreshTracksDom()},scrollToTrack:function(a){if(!this.containsTrack(a))return!1;var b=$(a.div).position().top;$(this.tlTracksDiv).scrollTop(b)},hideTrack:function(a){return this.containsTrack(a)?(a.hide(),void this.refreshTracksDom()):!1},showTrack:function(a){return this.containsTrack(a)?(a.show(),void this.refreshTracksDom()):!1},_setPixelBase:function(){this.pixelBase=this.width/this.region.length(),this.pixelBase=this.pixelBase/this.zoomMultiplier,this.halfVirtualBase=3*this.width/2/this.pixelBase},_setTextPosition:function(){var a=this.region.center(),b=parseInt(this.width/this.pixelBase),c=Math.ceil(b/2-1);this.visualRegion.start=Math.floor(a-c),this.visualRegion.end=Math.floor(a+c),this.positionText.textContent=Utils.formatNumber(a),this.firstPositionText.textContent=Utils.formatNumber(this.visualRegion.start),this.lastPositionText.textContent=Utils.formatNumber(this.visualRegion.end),this.windowSize="Window size: "+Utils.formatNumber(this.visualRegion.length())+" nts",this.viewNtsText.textContent=this.windowSize,$(this.div).find("#windowSizeSpan").html(this.windowSize)},getTrackById:function(a){if("undefined"!=typeof this.tracksIndex[a]){var b=this.tracksIndex[a];return this.tracks[b]}},getSequenceTrack:function(){for(var a=0;a<this.tracks.length;a++){var b=this.tracks[a];if(b instanceof SequenceTrack)return b}},getMousePosition:function(a){var b="",c="";return a>0&&(b=this.getSequenceNucleotid(a),c="color:"+SEQUENCE_COLORS[b]),'<span style="'+c+'">'+b+"</span>"},getSequenceNucleotid:function(a){var b=this.getSequenceTrack();if(null!=b&&this.visualRegion.length()<=b.visibleRegionSize){var c=b.dataAdapter.getNucleotidByPosition({start:a,end:a,chromosome:this.region.chromosome});return c}return""},setNucleotidPosition:function(a){var b=this.getSequenceNucleotid(a);this.nucleotidText.setAttribute("fill",SEQUENCE_COLORS[b]),this.nucleotidText.textContent=b}},Track.prototype={get:function(a){return this[a]},set:function(a,b){this[a]=b},hide:function(){this.visible=!1,$(this.div).css({display:"hidden"})},show:function(){this.visible=!0,$(this.div).css({display:"auto"})},hideContent:function(){$(this.svgdiv).css({display:"hidden"}),$(this.titlediv).css({display:"hidden"})},showContent:function(){$(this.svgdiv).css({display:"auto"}),$(this.titlediv).css({display:"auto"})},toggleContent:function(){$(this.svgdiv).toggle("hidden"),$(this.resizeDiv).toggle("hidden"),$(this.configBtn).toggle("hidden")},close:function(){this.trigger("track:close",{sender:this})},up:function(){this.trigger("track:up",{sender:this})},down:function(){this.trigger("track:down",{sender:this})},setSpecies:function(a){this.species=a,this.dataAdapter.species=this.species},setWidth:function(a){this.width=a,this.main.setAttribute("width",a)},_updateDIVHeight:function(){if(this.resizable&&!this.histogram){var a=this.pixelPosition,b=this.width,c=0;for(var d in this.renderedArea)this.renderedArea[d].contains({start:a,end:a+b})&&(c=d);var e=parseInt(c)+20;$(this.svgdiv).css({height:e+25})}this.histogram&&$(this.svgdiv).css({height:this.height+10})},_updateSVGHeight:function(){if(this.resizable&&!this.histogram){var a=20*Object.keys(this.renderedArea).length;this.main.setAttribute("height",a),this.svgCanvasFeatures.setAttribute("height",a),this.hoverRect.setAttribute("height",a)}this.histogram&&(this.main.setAttribute("height",this.height),this.svgCanvasFeatures.setAttribute("height",this.height),this.hoverRect.setAttribute("height",this.height))},updateHeight:function(a){this._updateSVGHeight(),(this.autoHeight||a)&&this._updateDIVHeight()},enableAutoHeight:function(){this.autoHeight=!0,this.updateHeight()},setTitle:function(a){$(this.titleText).html(a)},setLoading:function(a){a?(this.status="rendering",$(this.loadingEl).html('&nbsp; &nbsp;<i class="fa fa-spinner fa-spin"></i> <span class="ocb-light">Loading...</span></span>')):(this.status="ready",$(this.loadingEl).html(""))},updateHistogramParams:function(){this.region.length()>this.minHistogramRegionSize?(this.histogram=!0,this.histogramLogarithm=!0,this.histogramMax=500,this.interval=Math.ceil(10/this.pixelBase),$(this.histogramEl).html('&nbsp;<i class="fa fa-signal"></i>')):(this.histogram=void 0,this.histogramLogarithm=void 0,this.histogramMax=void 0,this.interval=void 0,$(this.histogramEl).html(""))},cleanSvg:function(){for(;this.svgCanvasFeatures.firstChild;)this.svgCanvasFeatures.removeChild(this.svgCanvasFeatures.firstChild);this.chunksDisplayed={},this.renderedArea={}},initializeDom:function(a){var b=this,c=$('<div id="'+this.id+'-div"></div>')[0],d="";d+='   <div class="ocb-gv-track-title">',d+='   <div class="ocb-gv-track-title-el">',d+='       <span class="ocb-gv-track-title-text">'+this.title+"</span>",d+='       <span class="ocb-gv-track-title-histogram"></span>',d+='       <span class="ocb-gv-track-title-down"><i class="fa fa-chevron-down"></i></span>',d+='       <span class="ocb-gv-track-title-up"><i class="fa fa-chevron-up"></i></span>',1==this.closable&&(d+='       <span class="ocb-gv-track-title-close"><i class="fa fa-times"></i></span>'),d+='       <span class="ocb-gv-track-title-loading"></span>',d+="   </div>",d+="   </div>";var e=$(d)[0];"undefined"==typeof this.title&&$(e).addClass("hidden");var f=$(e).find(".ocb-gv-track-title")[0];this.titleEl=$(e).find(".ocb-gv-track-title-el")[0],this.titleText=$(e).find(".ocb-gv-track-title-text")[0],this.histogramEl=$(e).find(".ocb-gv-track-title-histogram")[0],this.loadingEl=$(e).find(".ocb-gv-track-title-loading")[0],this.closeEl=$(e).find(".ocb-gv-track-title-close")[0],this.upEl=$(e).find(".ocb-gv-track-title-up")[0],this.downEl=$(e).find(".ocb-gv-track-title-down")[0];var g=$('<div id="'+this.id+'-svgdiv"></div>')[0],h=$('<div id="'+this.id+'-resizediv" class="ocb-track-resize"></div>')[0];$(a).addClass("unselectable"),$(a).append(c),$(c).append(e),$(c).append(g),$(c).append(h),$(e).css({padding:"4px"}).on("dblclick",function(a){a.stopPropagation()}),$(this.titleText).click(function(){b.toggleContent()}),$(this.closeEl).click(function(){b.close()}),$(this.upEl).click(function(){b.up()}),$(this.downEl).click(function(){b.down()}),$(g).css({"z-index":3,height:this.height,"overflow-y":this.resizable?"auto":"hidden","overflow-x":"hidden"});var i=SVG.addChild(g,"svg",{id:this.id,"class":"trackSvg",x:0,y:0,width:this.width,height:this.height});this.resizable&&($(h).mousedown(function(a){$("html").addClass("unselectable"),a.stopPropagation();var c=a.clientY;$("html").bind("mousemove.genomeViewer",function(a){var d=a.clientY-c,e=$(g).outerHeight();$(g).css({height:e+d}),c=a.clientY,b.autoHeight=!1})}),$("html").bind("mouseup.genomeViewer",function(){$("html").removeClass("unselectable"),$("html").off("mousemove.genomeViewer")}),$(g).closest(".trackListPanels").mouseup(function(){b.updateHeight()}),$(h).mouseenter(function(){$(this).css({cursor:"ns-resize"}),$(this).css({opacity:1})}),$(h).mouseleave(function(){$(this).css({cursor:"default"}),$(this).css({opacity:.3})})),this.svgGroup=SVG.addChild(i,"g",{});var j=(this.title,SVG.addChild(this.svgGroup,"rect",{x:0,y:0,width:this.width,height:this.height,opacity:"0.6",fill:"transparent"}));this.svgCanvasFeatures=SVG.addChild(this.svgGroup,"svg",{"class":"features",x:-this.pixelPosition,width:this.svgCanvasWidth,height:this.height}),this.fnTitleMouseEnter=function(){j.setAttribute("opacity","0.1"),j.setAttribute("fill","lightblue")},this.fnTitleMouseLeave=function(){j.setAttribute("opacity","0.6"),j.setAttribute("fill","transparent")},$(this.svgGroup).off("mouseenter"),$(this.svgGroup).off("mouseleave"),$(this.svgGroup).mouseenter(this.fnTitleMouseEnter),$(this.svgGroup).mouseleave(this.fnTitleMouseLeave),this.invalidZoomText=SVG.addChild(this.svgGroup,"text",{x:154,y:18,opacity:"0.6",fill:"black",visibility:"hidden","class":this.fontClass}),this.invalidZoomText.textContent="Zoom in to view the sequence",this.div=c,this.svgdiv=g,this.titlediv=f,this.resizeDiv=h,this.main=i,this.hoverRect=j,this.rendered=!0,this.status="ready"},_drawHistogramLegend:function(){var a=this.histogramRenderer.histogramHeight,b=this.histogramRenderer.multiplier;this.histogramGroup=SVG.addChild(this.svgGroup,"g",{"class":"histogramGroup",visibility:"hidden"});var c=SVG.addChild(this.histogramGroup,"text",{x:21,y:a+4,"font-size":12,opacity:"0.9",fill:"orangered","class":this.fontClass});c.textContent="0-";var c=SVG.addChild(this.histogramGroup,"text",{x:14,y:a+4-Math.log(10)*b,"font-size":12,opacity:"0.9",fill:"orangered","class":this.fontClass});c.textContent="10-";var c=SVG.addChild(this.histogramGroup,"text",{x:7,y:a+4-Math.log(100)*b,"font-size":12,opacity:"0.9",fill:"orangered","class":this.fontClass});c.textContent="100-";var c=SVG.addChild(this.histogramGroup,"text",{x:0,y:a+4-Math.log(1e3)*b,"font-size":12,opacity:"0.9",fill:"orangered","class":this.fontClass});c.textContent="1000-"},draw:function(){},getFeaturesToRenderByChunk:function(a){for(var b,c,d,e,f=function(b){return Math.floor(b/a.chunkSize)},g=function(a,b){return a+":"+b},h=a.items,i=[],i=[],j=0,k=h.length;k>j;j++)if(1!=this.chunksDisplayed[h[j].chunkKey]){for(var l=0,m=h[j].value.length;m>l;l++){b=h[j].value[l],c=!1,d=f(b.start),e=f(b.end);for(var n=d;e>=n;n++){var o=g(b.chromosome,n);if(1==this.chunksDisplayed[o]){c=!0;break}}c||i.push(b)}this.chunksDisplayed[h[j].chunkKey]=!0}return i}},BamTrack.prototype=new Track({}),BamTrack.prototype.render=function(a){var b=this;this.initializeDom(a),this.svgCanvasOffset=3*this.width/2/this.pixelBase,this.svgCanvasLeftLimit=this.region.start-2*this.svgCanvasOffset,this.svgCanvasRightLimit=this.region.start+2*this.svgCanvasOffset,this.dataAdapter.on("data:ready",function(a){var c;"histogram"==a.dataType?(b.renderer=b.histogramRenderer,c=a.items):(b.renderer=b.defaultRenderer,c=b._removeDisplayedChunks(a)),b.renderer.render(c,{svgCanvasFeatures:b.svgCanvasFeatures,featureTypes:b.featureTypes,renderedArea:b.renderedArea,pixelBase:b.pixelBase,position:b.region.center(),region:b.region,width:b.width,regionSize:b.region.length(),maxLabelRegionSize:b.maxLabelRegionSize,pixelPosition:b.pixelPosition}),b.updateHeight(),b.setLoading(!1)})},BamTrack.prototype.draw=function(){var a=this;this.svgCanvasOffset=3*this.width/2/this.pixelBase,this.svgCanvasLeftLimit=this.region.start-2*this.svgCanvasOffset,this.svgCanvasRightLimit=this.region.start+2*this.svgCanvasOffset,this.updateHistogramParams(),this.cleanSvg(),this.dataType="features",this.histogram&&(this.dataType="histogram"),"undefined"==typeof this.visibleRegionSize||this.region.length()<this.visibleRegionSize?(this.setLoading(!0),this.dataAdapter.getData({dataType:this.dataType,region:new Region({chromosome:this.region.chromosome,start:this.region.start-2*this.svgCanvasOffset,end:this.region.end+2*this.svgCanvasOffset}),params:{histogram:this.histogram,histogramLogarithm:this.histogramLogarithm,histogramMax:this.histogramMax,interval:this.interval}}),this.invalidZoomText.setAttribute("visibility","hidden")):this.invalidZoomText.setAttribute("visibility","visible"),a.updateHeight()},BamTrack.prototype.move=function(a){var b=this;this.dataType="features",this.histogram&&(this.dataType="histogram"),b.region.center();var c=a*b.pixelBase;this.pixelPosition-=c;var d=parseFloat(this.svgCanvasFeatures.getAttribute("x"))+c;this.svgCanvasFeatures.setAttribute("x",d);var e=parseInt(this.region.start-this.svgCanvasOffset),f=parseInt(this.region.end+this.svgCanvasOffset);("undefined"==typeof this.visibleRegionSize||this.region.length()<this.visibleRegionSize)&&(a>0&&e<this.svgCanvasLeftLimit&&(this.dataAdapter.getData({dataType:this.dataType,region:new Region({chromosome:b.region.chromosome,start:parseInt(this.svgCanvasLeftLimit-this.svgCanvasOffset),end:this.svgCanvasLeftLimit}),params:{histogram:this.histogram,histogramLogarithm:this.histogramLogarithm,histogramMax:this.histogramMax,interval:this.interval}}),this.svgCanvasLeftLimit=parseInt(this.svgCanvasLeftLimit-this.svgCanvasOffset)),0>a&&f>this.svgCanvasRightLimit&&(this.dataAdapter.getData({dataType:this.dataType,region:new Region({chromosome:b.region.chromosome,start:this.svgCanvasRightLimit,end:parseInt(this.svgCanvasRightLimit+this.svgCanvasOffset)}),params:{histogram:this.histogram,histogramLogarithm:this.histogramLogarithm,histogramMax:this.histogramMax,interval:this.interval}}),this.svgCanvasRightLimit=parseInt(this.svgCanvasRightLimit+this.svgCanvasOffset)))},BamTrack.prototype._removeDisplayedChunks=function(a){for(var b,c,d,e,f=a.items,g=a.dataType,h=[],i=[],j=0,k=f.length;k>j;j++)if(1!=this.chunksDisplayed[f[j].chunkKey]){i=[];for(var l=0,m=f[j].value.reads.length;m>l;l++){b=f[j].value.reads[l];var n=this.dataAdapter.cache[g];c=!1,d=n.getChunkId(b.start),e=n.getChunkId(b.end);for(var o=d;e>=o;o++){var p=n.getChunkKey(b.chromosome,o);if(1==this.chunksDisplayed[p]){c=!0;break}}c||i.push(b)}this.chunksDisplayed[f[j].chunkKey]=!0,f[j].value.reads=i,h.push(f[j])}return a.items=h,a},FeatureTrack.prototype=new Track({}),FeatureTrack.prototype.render=function(a){var b=this;this.initializeDom(a),this.svgCanvasOffset=3*this.width/2/this.pixelBase,this.svgCanvasLeftLimit=this.region.start-2*this.svgCanvasOffset,this.svgCanvasRightLimit=this.region.start+2*this.svgCanvasOffset,this.dataAdapter.on("data:ready",function(a){var c;"histogram"==a.dataType?(b.renderer=b.histogramRenderer,c=a.items):(b.renderer=b.defaultRenderer,c=b.getFeaturesToRenderByChunk(a)),b.renderer.render(c,{svgCanvasFeatures:b.svgCanvasFeatures,featureTypes:b.featureTypes,renderedArea:b.renderedArea,pixelBase:b.pixelBase,position:b.region.center(),regionSize:b.region.length(),maxLabelRegionSize:b.maxLabelRegionSize,width:b.width,pixelPosition:b.pixelPosition,resource:b.resource,species:b.species,featureType:b.featureType}),b.updateHeight()})},FeatureTrack.prototype.draw=function(){var a=this;this.svgCanvasOffset=3*this.width/2/this.pixelBase,this.svgCanvasLeftLimit=this.region.start-2*this.svgCanvasOffset,this.svgCanvasRightLimit=this.region.start+2*this.svgCanvasOffset,this.updateHistogramParams(),this.cleanSvg(),this.dataType="features",this.histogram&&(this.dataType="histogram"),"undefined"==typeof this.visibleRegionSize||this.region.length()<this.visibleRegionSize?(this.setLoading(!0),this.dataAdapter.getData({dataType:this.dataType,region:new Region({chromosome:this.region.chromosome,start:this.region.start-2*this.svgCanvasOffset,end:this.region.end+2*this.svgCanvasOffset}),params:{histogram:this.histogram,histogramLogarithm:this.histogramLogarithm,histogramMax:this.histogramMax,interval:this.interval},done:function(){a.setLoading(!1)}}),this.invalidZoomText.setAttribute("visibility","hidden")):this.invalidZoomText.setAttribute("visibility","visible"),a.updateHeight()},FeatureTrack.prototype.move=function(a){var b=this;this.dataType="features",this.histogram&&(this.dataType="histogram"),b.region.center();var c=a*b.pixelBase;this.pixelPosition-=c;var d=parseFloat(this.svgCanvasFeatures.getAttribute("x"))+c;this.svgCanvasFeatures.setAttribute("x",d);var e=parseInt(this.region.start-this.svgCanvasOffset),f=parseInt(this.region.end+this.svgCanvasOffset);("undefined"==typeof this.visibleRegionSize||this.region.length()<this.visibleRegionSize)&&(a>0&&e<this.svgCanvasLeftLimit&&(this.dataAdapter.getData({dataType:this.dataType,region:new Region({chromosome:b.region.chromosome,start:parseInt(this.svgCanvasLeftLimit-this.svgCanvasOffset),end:this.svgCanvasLeftLimit}),params:{histogram:this.histogram,histogramLogarithm:this.histogramLogarithm,histogramMax:this.histogramMax,interval:this.interval},done:function(){}}),this.svgCanvasLeftLimit=parseInt(this.svgCanvasLeftLimit-this.svgCanvasOffset)),0>a&&f>this.svgCanvasRightLimit&&(this.dataAdapter.getData({dataType:this.dataType,region:new Region({chromosome:b.region.chromosome,start:this.svgCanvasRightLimit,end:parseInt(this.svgCanvasRightLimit+this.svgCanvasOffset)}),params:{histogram:this.histogram,histogramLogarithm:this.histogramLogarithm,histogramMax:this.histogramMax,interval:this.interval},done:function(){}}),this.svgCanvasRightLimit=parseInt(this.svgCanvasRightLimit+this.svgCanvasOffset)))},GeneTrack.prototype=new Track({}),GeneTrack.prototype.render=function(a){var b=this;this.initializeDom(a),this.svgCanvasOffset=3*this.width/2/this.pixelBase,this.svgCanvasLeftLimit=this.region.start-2*this.svgCanvasOffset,this.svgCanvasRightLimit=this.region.start+2*this.svgCanvasOffset,this.dataAdapter.on("data:ready",function(a){var c;"histogram"==a.dataType?(b.renderer=b.histogramRenderer,c=a.items):(b.renderer=b.defaultRenderer,c=b.getFeaturesToRenderByChunk(a)),b.renderer.render(c,{svgCanvasFeatures:b.svgCanvasFeatures,renderedArea:b.renderedArea,pixelBase:b.pixelBase,position:b.region.center(),regionSize:b.region.length(),maxLabelRegionSize:b.maxLabelRegionSize,width:b.width,pixelPosition:b.pixelPosition}),b.updateHeight()})},GeneTrack.prototype.updateTranscriptParams=function(){this.exclude=this.region.length()<this.minTranscriptRegionSize?this.dataAdapter.params.exclude:"transcripts"},GeneTrack.prototype.draw=function(){var a=this;this.svgCanvasOffset=3*this.width/2/this.pixelBase,this.svgCanvasLeftLimit=this.region.start-2*this.svgCanvasOffset,this.svgCanvasRightLimit=this.region.start+2*this.svgCanvasOffset,this.updateTranscriptParams(),this.updateHistogramParams(),this.cleanSvg();var b="features";if(_.isUndefined(this.exclude)||(b="features"+this.exclude),this.histogram&&(b="histogram"),"undefined"==typeof this.visibleRegionSize||this.region.length()<this.visibleRegionSize){this.setLoading(!0);{this.dataAdapter.getData({dataType:b,region:new Region({chromosome:this.region.chromosome,start:this.region.start-2*this.svgCanvasOffset,end:this.region.end+2*this.svgCanvasOffset}),params:{histogram:this.histogram,histogramLogarithm:this.histogramLogarithm,histogramMax:this.histogramMax,interval:this.interval,exclude:this.exclude},done:function(){a.setLoading(!1)}})}this.invalidZoomText.setAttribute("visibility","hidden")}else this.invalidZoomText.setAttribute("visibility","visible");a.updateHeight()},GeneTrack.prototype.move=function(a){var b=this;this.dataType="features",_.isUndefined(this.exclude)||(dataType="features"+this.exclude),this.histogram&&(this.dataType="histogram"),b.region.center();var c=a*b.pixelBase;this.pixelPosition-=c;var d=parseFloat(this.svgCanvasFeatures.getAttribute("x"))+c;this.svgCanvasFeatures.setAttribute("x",d);var e=parseInt(this.region.start-this.svgCanvasOffset),f=parseInt(this.region.end+this.svgCanvasOffset);("undefined"==typeof this.visibleRegionSize||this.region.length()<this.visibleRegionSize)&&(a>0&&e<this.svgCanvasLeftLimit&&(this.dataAdapter.getData({dataType:this.dataType,region:new Region({chromosome:b.region.chromosome,start:parseInt(this.svgCanvasLeftLimit-this.svgCanvasOffset),end:this.svgCanvasLeftLimit}),params:{histogram:this.histogram,histogramLogarithm:this.histogramLogarithm,histogramMax:this.histogramMax,interval:this.interval,exclude:this.exclude},done:function(){}}),this.svgCanvasLeftLimit=parseInt(this.svgCanvasLeftLimit-this.svgCanvasOffset)),0>a&&f>this.svgCanvasRightLimit&&(this.dataAdapter.getData({dataType:this.dataType,region:new Region({chromosome:b.region.chromosome,start:this.svgCanvasRightLimit,end:parseInt(this.svgCanvasRightLimit+this.svgCanvasOffset)}),params:{histogram:this.histogram,histogramLogarithm:this.histogramLogarithm,histogramMax:this.histogramMax,interval:this.interval,exclude:this.exclude},done:function(){}}),this.svgCanvasRightLimit=parseInt(this.svgCanvasRightLimit+this.svgCanvasOffset)))},SequenceTrack.prototype=new Track({}),SequenceTrack.prototype.render=function(a){var b=this;this.initializeDom(a),this.svgCanvasOffset=3*this.width/2/this.pixelBase,this.svgCanvasLeftLimit=this.region.start-2*this.svgCanvasOffset,this.svgCanvasRightLimit=this.region.start+2*this.svgCanvasOffset,this.dataAdapter.on("data:ready",function(a){b.renderer.render(a,{svgCanvasFeatures:b.svgCanvasFeatures,pixelBase:b.pixelBase,position:b.region.center(),width:b.width,pixelPosition:b.pixelPosition}),b.setLoading(!1)})},SequenceTrack.prototype.draw=function(){if(this.svgCanvasOffset=3*this.width/2/this.pixelBase,this.svgCanvasLeftLimit=this.region.start-2*this.svgCanvasOffset,this.svgCanvasRightLimit=this.region.start+2*this.svgCanvasOffset,this.cleanSvg(),"undefined"==typeof this.visibleRegionSize||this.region.length()<this.visibleRegionSize){this.setLoading(!0);{this.dataAdapter.getData({region:new Region({chromosome:this.region.chromosome,start:this.region.start-2*this.svgCanvasOffset,end:this.region.end+2*this.svgCanvasOffset})})}this.invalidZoomText.setAttribute("visibility","hidden")}else this.invalidZoomText.setAttribute("visibility","visible")},SequenceTrack.prototype.move=function(a){var b=this,c=a*b.pixelBase;this.pixelPosition-=c;var d=parseFloat(this.svgCanvasFeatures.getAttribute("x"))+c;this.svgCanvasFeatures.setAttribute("x",d);var e=parseInt(this.region.start-this.svgCanvasOffset),f=parseInt(this.region.end+this.svgCanvasOffset);("undefined"==typeof this.visibleRegionSize||this.region.length()<this.visibleRegionSize)&&(a>0&&e<this.svgCanvasLeftLimit&&(this.dataAdapter.getData({region:new Region({chromosome:b.region.chromosome,start:parseInt(this.svgCanvasLeftLimit-this.svgCanvasOffset),end:this.svgCanvasLeftLimit}),sender:"move"}),this.svgCanvasLeftLimit=parseInt(this.svgCanvasLeftLimit-this.svgCanvasOffset)),0>a&&f>this.svgCanvasRightLimit&&(this.dataAdapter.getData({region:new Region({chromosome:b.region.chromosome,start:this.svgCanvasRightLimit,end:parseInt(this.svgCanvasRightLimit+this.svgCanvasOffset)}),sender:"move"}),this.svgCanvasRightLimit=parseInt(this.svgCanvasRightLimit+this.svgCanvasOffset)))},Renderer.prototype={render:function(){},getFeatureX:function(a,b){var c=b.width/2,d=b.pixelPosition+c-(b.position-a.start)*b.pixelBase;return d},getDefaultConfig:function(a){return FEATURE_TYPES[a]},getLabelWidth:function(a,b){var c=SVG.create("text",{"font-weight":400,"class":this.fontClass});c.textContent=a,$(b.svgCanvasFeatures).append(c);var d=$(c).width();return $(c).remove(),d}},BamRenderer.prototype=new Renderer({}),BamRenderer.prototype.render=function(a,b){var c=this;_.isUndefined(a.params)&&(a.params={});var d=!1;null!=a.params.view_as_pairs&&(d=!0),console.log("viewAsPairs "+d);var e=0,f=0,g="orangered";null!=a.params.insert_size_interval&&(e=a.params.insert_size_interval.split(",")[0],f=a.params.insert_size_interval.split(",")[1]),console.log("insertSizeMin "+e),console.log("insertSizeMin "+f),$(b.svgCanvasFeatures).contextmenu(function(a){console.log("click derecho"),a.preventDefault()}),console.time("BamRender "+a.params.resource);var h=a.items,i=SVG.addChild(b.svgCanvasFeatures,"g",{"class":"bamCoverage",cursor:"pointer"}),j=SVG.addChild(b.svgCanvasFeatures,"g",{"class":"bamReads",cursor:"pointer"}),k=function(a){for(var d,e=a.coverage.all,f=a.coverage.a,g=a.coverage.c,h=a.coverage.g,j=a.coverage.t,k=parseInt(a.start),l=parseInt(a.end),m=(l-k+1)*b.pixelBase,n=b.width/2,o=b.pixelBase/2-.5,p=parseInt(a.start),q="",r="",s="",t="",u=200,v=50,w=0;w<e.length;w++)d=b.pixelPosition+n-(b.position-p)*b.pixelBase,xx=b.pixelPosition+n-(b.position-p)*b.pixelBase+b.pixelBase,q+=d+","+f[w]/u*v+" ",q+=xx+","+f[w]/u*v+" ",r+=d+","+(g[w]+f[w])/u*v+" ",r+=xx+","+(g[w]+f[w])/u*v+" ",s+=d+","+(h[w]+g[w]+f[w])/u*v+" ",s+=xx+","+(h[w]+g[w]+f[w])/u*v+" ",t+=d+","+(j[w]+h[w]+g[w]+f[w])/u*v+" ",t+=xx+","+(j[w]+h[w]+g[w]+f[w])/u*v+" ",p++;var x=r.split(" ").reverse().join(" ").trim(),y=s.split(" ").reverse().join(" ").trim(),z=t.split(" ").reverse().join(" ").trim(),A=b.pixelPosition+n-(b.position-parseInt(a.start))*b.pixelBase+o,B=b.pixelPosition+n-(b.position-parseInt(a.end))*b.pixelBase+o,C=(SVG.addChild(i,"polyline",{points:A+",0 "+q+B+",0",fill:"green"}),SVG.addChild(i,"polyline",{points:q+" "+x,fill:"blue"}),SVG.addChild(i,"polyline",{points:r+" "+y,fill:"gold"}),SVG.addChild(i,"polyline",{points:s+" "+z,fill:"red"}),SVG.addChild(i,"rect",{x:b.pixelPosition+n-(b.position-k)*b.pixelBase,y:0,width:m,height:v,opacity:"0.5",fill:"lightgray",cursor:"pointer"}));$(C).qtip({content:" ",position:{target:"mouse",adjust:{x:15,y:0},viewport:$(window),effect:!1},style:{width:!0,classes:c.toolTipfontClass+" ui-tooltip-shadow"}})},l=function(a){{var d=a.unclippedStart,h=a.unclippedEnd,i=h-d+1,k=a.diff,l=_.isFunction(c.color)?c.color(a,b.region.chromosome):c.color,m=_.isFunction(c.strokeColor)?c.strokeColor(a,b.region.chromosome):c.strokeColor,n=(_.isFunction(c.label)?c.label(a):c.label,_.isFunction(c.height)?c.height(a):c.height),o=_.isFunction(c.tooltipTitle)?c.tooltipTitle(a):c.tooltipTitle,p=_.isFunction(c.tooltipText)?c.tooltipText(a):c.tooltipText,q=_.isFunction(c.strand)?c.strand(a):c.strand,r=_.isFunction(c.mateUnmappedFlag)?c.mateUnmappedFlag(a):c.mateUnmappedFlag;_.isFunction(c.infoWidgetId)?c.infoWidgetId(a):c.infoWidgetId}0==e||0==f||r||(Math.abs(a.inferredInsertSize)>f&&(l="maroon"),Math.abs(a.inferredInsertSize)<e&&(l="navy"));var s=i*b.pixelBase,t=c.getFeatureX(a,b);maxWidth=s;for(var u=12,v=70;;){null==b.renderedArea[v]&&(b.renderedArea[v]=new FeatureBinarySearchTree);var w=b.renderedArea[v].add({start:t,end:t+maxWidth-1});if(w){{var x=SVG.addChild(j,"g",{feature_id:a.name}),y={Reverse:t+","+(v+n/2)+" "+(t+5)+","+v+" "+(t+s-5)+","+v+" "+(t+s-5)+","+(v+n)+" "+(t+5)+","+(v+n),Forward:t+","+v+" "+(t+s-5)+","+v+" "+(t+s)+","+(v+n/2)+" "+(t+s-5)+","+(v+n)+" "+t+","+(v+n)};SVG.addChild(x,"polygon",{points:y[q],stroke:m,"stroke-width":1,fill:l,cursor:"pointer"})}if(null!=k&&b.regionSize<400){SVG.addChild(x,"path",{d:Utils.genBamVariants(k,b.pixelBase,t,v),fill:g})}$(x).qtip({content:{text:p,title:o},position:{target:"mouse",adjust:{x:25,y:15}},style:{width:300,classes:c.toolTipfontClass+" ui-tooltip ui-tooltip-shadow"},show:"click",hide:"click mouseleave"});break}v+=u}},m=function(a,d){var h=a.unclippedStart,i=a.unclippedEnd,k=d.unclippedStart,l=d.unclippedEnd,m=a.diff,n=d.diff,o=c.types[a.featureType],p=c.types[d.featureType],q=o.getColor(a,c.region.chromosome),r=p.getColor(d,c.region.chromosome),s=o.getStrand(a),t=p.getStrand(d);0!=e&&0!=f&&(Math.abs(a.inferredInsertSize)>f&&(q="maroon",r="maroon"),Math.abs(a.inferredInsertSize)<e&&(q="navy",r="navy"));var u=h,v=l;h>=k&&(u=k),i>=l&&(v=i);for(var w=(v-u+1)*c.pixelBase,x=c.pixelPosition+middle-(c.position-u)*c.pixelBase,y=(i-h+1)*c.pixelBase,z=c.pixelPosition+middle-(c.position-h)*c.pixelBase,A=(l-k+1)*c.pixelBase,B=c.pixelPosition+middle-(c.position-k)*c.pixelBase,C=12,D=70;;){null==b.renderedArea[D]&&(b.renderedArea[D]=new FeatureBinarySearchTree);var E=b.renderedArea[D].add({start:x,end:x+w-1});if(E){var F=[],G=[],H={Reverse:z+","+(D+o.height/2)+" "+(z+5)+","+D+" "+(z+y-5)+","+D+" "+(z+y-5)+","+(D+o.height)+" "+(z+5)+","+(D+o.height),Forward:z+","+D+" "+(z+y-5)+","+D+" "+(z+y)+","+(D+o.height/2)+" "+(z+y-5)+","+(D+o.height)+" "+z+","+(D+o.height)},I=SVG.addChild(j,"polygon",{points:H[s],stroke:o.getStrokeColor(a),"stroke-width":1,fill:q,cursor:"pointer"});F.push(I);var J={Reverse:B+","+(D+p.height/2)+" "+(B+5)+","+D+" "+(B+A-5)+","+D+" "+(B+A-5)+","+(D+p.height)+" "+(B+5)+","+(D+p.height),Forward:B+","+D+" "+(B+A-5)+","+D+" "+(B+A)+","+(D+p.height/2)+" "+(B+A-5)+","+(D+p.height)+" "+B+","+(D+p.height)},K=SVG.addChild(j,"polygon",{points:J[t],stroke:p.getStrokeColor(d),"stroke-width":1,fill:r,cursor:"pointer"});
G.push(K);{SVG.addChild(j,"line",{x1:z+y,y1:D+o.height/2,x2:B,y2:D+o.height/2,"stroke-width":"1",stroke:"gray",cursor:"pointer"})}if(b.regionSize<400){if(null!=m){var L=SVG.addChild(j,"path",{d:Utils.genBamVariants(m,c.pixelBase,z,D),fill:g});F.push(L)}if(null!=n){var M=SVG.addChild(j,"path",{d:Utils.genBamVariants(n,c.pixelBase,B,D),fill:g});G.push(M)}}$(F).qtip({content:{text:o.getTipText(a),title:o.getTipTitle(a)},position:{target:"mouse",adjust:{x:15,y:0},viewport:$(window),effect:!1},style:{width:280,classes:c.toolTipfontClass+" ui-tooltip ui-tooltip-shadow"},show:"click",hide:"click mouseleave"}),$(F).click(function(){console.log(a),c.showInfoWidget({query:a[o.infoWidgetId],feature:a,featureType:a.featureType,adapter:c.trackData.adapter})}),$(G).qtip({content:{text:p.getTipText(d),title:p.getTipTitle(d)},position:{target:"mouse",adjust:{x:15,y:0},viewport:$(window),effect:!1},style:{width:280,classes:c.toolTipfontClass+" ui-tooltip ui-tooltip-shadow"},show:"click",hide:"click mouseleave"}),$(G).click(function(){console.log(d),c.showInfoWidget({query:d[p.infoWidgetId],feature:d,featureType:d.featureType,adapter:c.trackData.adapter})});break}D+=C}},n=function(a){k(a.value);for(var b=a.value.reads,c=0,e=b.length;e>c;c++){var f=b[c];if(d){var g=b[c+1];null!=g&&(f.name==g.name?(m(f,g),c++):l(f))}else l(f)}};if(h.length>0)for(var o=0,p=h.length;p>o;o++)n(h[o]);console.timeEnd("BamRender "+a.params.resource)},ConservedRenderer.prototype=new Renderer({}),ConservedRenderer.prototype.render=function(a,b){var c=b.width/2,d=20,e=75,f="",g=b.pixelBase,h=a[0],i=b.pixelPosition+c-(b.position-parseInt(h.start))*b.pixelBase;f=i+g/2+","+e+" ";for(var j=0,k=a.length;k>j;j++){var l=a[j];l.start=parseInt(l.start),l.end=parseInt(l.end);for(var m=0,k=l.values;k>m;m++){var n=l.values[m],o=n*d,p=start+m,i=b.pixelPosition+c-(b.position-p)*b.pixelBase;f+=i+g/2+","+(e-o)+" "}}f+=i+g/2+","+e+" ";SVG.addChild(b.svgCanvasFeatures,"polyline",{points:f,stroke:"#000000","stroke-width":.2,fill:"salmon",cursor:"pointer"})},FeatureClusterRenderer.prototype=new Renderer({}),FeatureClusterRenderer.prototype.render=function(a,b){for(var c=this,d=(b.width/2,function(d){d.start=parseInt(d.start),d.end=parseInt(d.end);var f=d.end-d.start;f*=b.pixelBase;var g=c.getFeatureX(d,b);null==d.features_count&&(d.features_count=0!=d.absolute?Math.log(a[e].absolute):0);var h=d.features_count*c.multiplier,i=SVG.addChild(b.svgCanvasFeatures,"rect",{x:g+1,y:0,width:f-1,height:h,stroke:"smokewhite","stroke-width":1,fill:"#9493b1",cursor:"pointer"}),j=CellBaseManager.url({species:b.species,category:"genomic",subCategory:"region",query:new Region(d).toString(),resource:b.resource,params:{include:"chromosome,start,end,id",limit:20},async:!1});$(i).qtip({content:{text:"Loading...",ajax:{url:j,type:"GET",success:function(a){for(var b=a.response[0].result,c="",e=0;e<b.length;e++){var f=b[e],g=new Region(f);c+='<span class="emph">'+f.id+'</span> <span class="info">'+g.toString()+"</span><br>"}var h=Math.round(Math.exp(d.features_count));20>=h?(this.set("content.title","Count: "+b.length),this.set("content.text",c)):(this.set("content.title","Count: "+h),this.set("content.text",c+"..."))}}},position:{target:"mouse",adjust:{x:25,y:15}},style:{width:!0,classes:c.toolTipfontClass+" ui-tooltip ui-tooltip-shadow"}})}),e=0,f=a.length;f>e;e++)d(a[e].value)},FeatureRenderer.prototype=new Renderer({}),FeatureRenderer.prototype.render=function(a,b){var c=this,d=function(a,d){"undefined"==typeof a.featureType&&(a.featureType=b.featureType);var e=_.isFunction(c.color)?c.color(a):c.color,f=_.isFunction(c.label)?c.label(a):c.label,h=_.isFunction(c.height)?c.height(a):c.height,i=_.isFunction(c.tooltipTitle)?c.tooltipTitle(a):c.tooltipTitle,j=_.isFunction(c.tooltipText)?c.tooltipText(a):c.tooltipText,k=_.isFunction(c.infoWidgetId)?c.infoWidgetId(a):c.infoWidgetId,l=a.start,m=a.end,n=m-l+1;n=0>n?Math.abs(n):n,n=0==n?1:n;var o=n*b.pixelBase,p=6.4*f.length,q=c.getFeatureX(a,b),r=Math.max(o,2),s=0;b.maxLabelRegionSize>b.regionSize&&(s=9,r=Math.max(o,p));for(var t=0,u=s+h,v=s+h+2;;){t in b.renderedArea||(b.renderedArea[t]=new FeatureBinarySearchTree);var w=b.renderedArea[t].add({start:q,end:q+r-1});if(w){{var x=SVG.addChild(d,"g",{feature_id:a.id});SVG.addChild(x,"rect",{x:q,y:t,width:o,height:h,stroke:"#3B0B0B","stroke-width":1,"stroke-opacity":.7,fill:e,cursor:"pointer"})}if(b.maxLabelRegionSize>b.regionSize){var y=SVG.addChild(x,"text",{i:g,x:q,y:u,"font-weight":400,opacity:null,fill:"black",cursor:"pointer","class":c.fontClass});y.textContent=f}"tooltipText"in c&&$(x).qtip({content:{text:j,title:i},position:{target:"mouse",adjust:{x:25,y:15}},style:{width:!0,classes:c.toolTipfontClass+" ui-tooltip ui-tooltip-shadow"}}),$(x).mouseover(function(b){c.trigger("feature:mouseover",{query:a[k],feature:a,featureType:a.featureType,mouseoverEvent:b})}),$(x).click(function(b){c.trigger("feature:click",{query:a[k],feature:a,featureType:a.featureType,clickEvent:b})});break}t+=v,u+=v}},e="write dom "+Utils.randomString(4);console.time(e),console.log(a.length);for(var f=SVG.create("g"),g=0,h=a.length;h>g;g++)d(a[g],f);b.svgCanvasFeatures.appendChild(f),console.timeEnd(e)},GeneRenderer.prototype=new Renderer({}),GeneRenderer.prototype.setFeatureConfig=function(a){_.extend(this,a)},GeneRenderer.prototype.render=function(a,b){for(var c=this,d=(function(a){c.setFeatureConfig(FEATURE_TYPES.gene);var d=_.isFunction(c.color)?c.color(a):c.color,e=_.isFunction(c.label)?c.label(a):c.label,f=_.isFunction(c.height)?c.height(a):c.height,g=_.isFunction(c.tooltipTitle)?c.tooltipTitle(a):c.tooltipTitle,h=_.isFunction(c.tooltipText)?c.tooltipText(a):c.tooltipText,i=_.isFunction(c.infoWidgetId)?c.infoWidgetId(a):c.infoWidgetId,j=a.start,k=a.end,l=k-j+1,m=l*b.pixelBase,n=6.4*e.length,o=c.getFeatureX(a,b),p=Math.max(m,2),q=0;b.maxLabelRegionSize>b.regionSize&&(q=9,p=Math.max(m,n));for(var r=0,s=q+f+1,t=q+f+5;;){r in b.renderedArea||(b.renderedArea[r]=new FeatureBinarySearchTree);var u,v=r,w=!0;if(_.isEmpty(a.transcripts))u=b.renderedArea[r].add({start:o,end:o+p-1});else{for(var x=0,y=a.transcripts.length+1;y>x;x++){if(v in b.renderedArea||(b.renderedArea[v]=new FeatureBinarySearchTree),b.renderedArea[v].contains({start:o,end:o+p-1})){w=!1;break}v+=t}1==w&&(u=b.renderedArea[r].add({start:o,end:o+p-1}))}if(u){{var z=SVG.addChild(b.svgCanvasFeatures,"g",{feature_id:a.id});SVG.addChild(z,"rect",{x:o,y:r,width:m,height:f,stroke:"#3B0B0B","stroke-width":.5,fill:d,cursor:"pointer"})}if(b.maxLabelRegionSize>b.regionSize){var A=SVG.addChild(z,"text",{i:x,x:o,y:s,fill:"black",cursor:"pointer","class":c.fontClass});A.textContent=e}$(z).qtip({content:{text:h,title:g},position:{target:"mouse",adjust:{x:25,y:15}},style:{width:!0,classes:c.toolTipfontClass+" ui-tooltip ui-tooltip-shadow"}}),$(z).click(function(b){c.trigger("feature:click",{query:a[i],feature:a,featureType:"gene",clickEvent:b})});var v=r+t,B=s+t;if(!_.isEmpty(a.transcripts))for(var x=0,y=a.transcripts.length;y>x;x++){v in b.renderedArea||(b.renderedArea[v]=new FeatureBinarySearchTree);var C=a.transcripts[x],D=c.getFeatureX(C,b),E=(C.end-C.start+1)*b.pixelBase;c.setFeatureConfig(FEATURE_TYPES.transcript);var F=_.isFunction(c.color)?c.color(C):c.color,e=_.isFunction(c.label)?c.label(C):c.label,f=_.isFunction(c.height)?c.height(C):c.height,g=_.isFunction(c.tooltipTitle)?c.tooltipTitle(C):c.tooltipTitle,h=_.isFunction(c.tooltipText)?c.tooltipText(C):c.tooltipText,i=_.isFunction(c.infoWidgetId)?c.infoWidgetId(C):c.infoWidgetId,n=6.4*e.length,p=Math.max(m,m-(a.end-C.start)*b.pixelBase+n);b.renderedArea[v].add({start:o,end:o+p-1});var G=SVG.addChild(b.svgCanvasFeatures,"g",{widgetId:C[i]}),A=(SVG.addChild(G,"rect",{x:D,y:v+1,width:E,height:f,fill:"gray",cursor:"pointer",feature_id:C.id}),SVG.addChild(G,"text",{x:D,y:B,opacity:null,fill:"black",cursor:"pointer","class":c.fontClass}));A.textContent=e,$(G).qtip({content:{text:h,title:g},position:{target:"mouse",adjust:{x:25,y:15}},style:{width:!0,classes:c.toolTipfontClass+" ui-tooltip ui-tooltip-shadow"}}),$(G).click(function(a){var b=this.getAttribute("widgetId");c.trigger("feature:click",{query:b,feature:C,featureType:"transcript",clickEvent:a})});for(var H=0,I=a.transcripts[x].exons.length;I>H;H++){var J=a.transcripts[x].exons[H],K=parseInt(J.start),L=parseInt(J.end),M=b.width/2,N=b.pixelPosition+M-(b.position-K)*b.pixelBase,O=(L-K+1)*b.pixelBase;c.setFeatureConfig(FEATURE_TYPES.exon);var d=_.isFunction(c.color)?c.color(J):c.color,e=_.isFunction(c.label)?c.label(J):c.label,f=_.isFunction(c.height)?c.height(J):c.height,g=_.isFunction(c.tooltipTitle)?c.tooltipTitle(J):c.tooltipTitle,h=_.isFunction(c.tooltipText)?c.tooltipText(J,C):c.tooltipText,i=_.isFunction(c.infoWidgetId)?c.infoWidgetId(J):c.infoWidgetId,P=SVG.addChild(b.svgCanvasFeatures,"g");$(P).qtip({content:{text:h,title:g},position:{target:"mouse",adjust:{x:25,y:15}},style:{width:!0,classes:c.toolTipfontClass+" ui-tooltip ui-tooltip-shadow"}});var Q=(SVG.addChild(P,"rect",{i:x,x:N,y:v-1,width:O,height:f,stroke:"gray","stroke-width":1,fill:"white",cursor:"pointer"}),0),R=0;C.genomicCodingStart>K&&C.genomicCodingStart<L?(Q=parseInt(C.genomicCodingStart),R=L):C.genomicCodingEnd>K&&C.genomicCodingEnd<L?(Q=K,R=parseInt(C.genomicCodingEnd)):C.genomicCodingStart<K&&C.genomicCodingEnd>L&&(Q=K,R=L);var S=R-Q,T=b.pixelPosition+M-(b.position-Q)*b.pixelBase,U=(S+1)*b.pixelBase;if(S>0)for(var V=(SVG.addChild(P,"rect",{i:x,x:T,y:v-1,width:U,height:f,stroke:F,"stroke-width":1,fill:F,cursor:"pointer"}),0),W=3-J.phase;W>V&&10==Math.round(b.pixelBase)&&-1!=J.phase&&null!=J.phase;V++)SVG.addChild(P,"rect",{i:x,x:T+10*V,y:v-1,width:b.pixelBase,height:f,stroke:d,"stroke-width":1,fill:"white",cursor:"pointer"})}v+=t,B+=t}break}r+=t,s+=t}}),e=0,f=a.length;f>e;e++)d(a[e])},HistogramRenderer.prototype=new Renderer({}),HistogramRenderer.prototype._checkFeatureValue=function(a){null==a.features_count&&(a.features_count=0!=a.absolute?Math.log(a.absolute):0)},HistogramRenderer.prototype.render=function(a,b){var c=b.width/2;console.log(c);var d="";if(a.length>0){var e=a[0].value,f=(e.end-e.start+1)*b.pixelBase,g=b.pixelPosition+c-(b.position-parseInt(e.start))*b.pixelBase;this._checkFeatureValue(e);var h=e.features_count*this.multiplier;d=g-f/2+","+this.histogramHeight+" ",d+=g-f/2+","+(this.histogramHeight-h)+" "}for(var i=0,j=a.length;j>i;i++){var k=a[i].value;k.start=parseInt(k.start),k.end=parseInt(k.end);var f=(k.end-k.start+1)*b.pixelBase,g=b.pixelPosition+c-(b.position-k.start)*b.pixelBase;this._checkFeatureValue(k);var h=k.features_count*this.multiplier;d+=g+f/2+","+(this.histogramHeight-h)+" "}if(a.length>0){var l=a[a.length-1].value,f=(l.end-l.start+1)*b.pixelBase,g=b.pixelPosition+c-(b.position-parseInt(l.start))*b.pixelBase;this._checkFeatureValue(l);var h=l.features_count*this.multiplier;d+=g+f+","+(this.histogramHeight-h)+" ",d+=g+f+","+this.histogramHeight+" "}""!==d&&SVG.addChild(b.svgCanvasFeatures,"polyline",{points:d,fill:"#428bca",cursor:"pointer"})},SequenceRenderer.prototype=new Renderer({}),SequenceRenderer.prototype.render=function(a,b){console.time("Sequence render "+a.items.sequence.length);for(var c=b.width/2,d=a.items.start,e=a.items.start,f=a.items.sequence,g=0;g<f.length;g++){var h=b.pixelPosition+c-(b.position-d)*b.pixelBase;d++;var i=SVG.addChild(b.svgCanvasFeatures,"text",{x:h+1,y:12,fill:SEQUENCE_COLORS[f.charAt(g)],"class":this.fontClass});i.textContent=f.charAt(g),$(i).qtip({content:f.charAt(g)+" "+(e+g).toString().replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1,"),position:{target:"mouse",adjust:{x:15,y:0},viewport:$(window),effect:!1},style:{width:!0,classes:this.toolTipfontClass+" qtip-light qtip-shadow"}})}console.timeEnd("Sequence render "+a.items.sequence.length)},VcfMultisampleRenderer.prototype=new Renderer({}),VcfMultisampleRenderer.prototype.render=function(a,b){for(var c=this,d=function(a){var d=(_.isFunction(c.color)?c.color(a):c.color,_.isFunction(c.label)?c.label(a):c.label),e=(_.isFunction(c.height)?c.height(a):c.height,_.isFunction(c.tooltipTitle)?c.tooltipTitle(a):c.tooltipTitle),f=_.isFunction(c.tooltipText)?c.tooltipText(a):c.tooltipText,g=(_.isFunction(c.infoWidgetId)?c.infoWidgetId(a):c.infoWidgetId,a.start),h=a.end,i=h-g+1;i=0>i?Math.abs(i):i,i=0==i?1:i;var j=i*b.pixelBase,k=c.getLabelWidth(d,b),l=c.getFeatureX(a,b),m=Math.max(j,2),n=0;b.regionSize<b.maxLabelRegionSize&&(n=9,m=Math.max(j,k));for(var o="",p="",q="",r="",s=l,t=l+j,u=1,v=6,w=10,x=0,y=a.samples.length;y>x;x++){b.renderedArea[u]=new FeatureBinarySearchTree,b.renderedArea[u].add({start:s,end:t});var z=a.samples[x].split(":")[0];switch(z){case"0|0":case"0/0":o+="M"+s+","+u+" L"+t+","+u+" ",o+="L"+t+","+(u+v)+" L"+s+","+(u+v)+" z ";break;case".|.":case"./.":p+="M"+s+","+u+" L"+t+","+u+" ",p+="L"+t+","+(u+v)+" L"+s+","+(u+v)+" z ";break;case"1|1":case"1/1":q+="M"+s+","+u+" L"+t+","+u+" ",q+="L"+t+","+(u+v)+" L"+s+","+(u+v)+" z ";break;case"0|1":case"0/1":case"1|0":case"1/0":r+="M"+s+","+u+" L"+t+","+u+" ",r+="L"+t+","+(u+v)+" L"+s+","+(u+v)+" z "}u+=w}{var A=SVG.addChild(b.svgCanvasFeatures,"g",{feature_id:a.id});SVG.addChild(A,"rect",{x:s,y:1,width:j,height:u,fill:"transparent",cursor:"pointer"})}if(""!=o){SVG.addChild(A,"path",{d:o,fill:"blue",cursor:"pointer"})}if(""!=p){SVG.addChild(A,"path",{d:p,fill:"black",cursor:"pointer"})}if(""!=q){SVG.addChild(A,"path",{d:q,fill:"red",cursor:"pointer"})}if(""!=r){SVG.addChild(A,"path",{d:r,fill:"orange",cursor:"pointer"})}var B=0;$(A).qtip({content:{text:f+"<br>"+a.samples[B],title:e},position:{target:"mouse",adjust:{x:25,y:15}},style:{width:!0,classes:c.toolTipfontClass+" ui-tooltip ui-tooltip-shadow"}}),$(A).mousemove(function(b){var c=parseInt(b.offsetY/w);c!=B&&(console.log(c),$(A).qtip("option","content.text",f+"<br>"+a.samples[c])),B=c})},e=0,f=a.length;f>e;e++){var g=a[e];d(g)}},GenomeViewer.prototype={render:function(){var a=this;console.log("Initializing Genome Viewer"),this.div=document.createElement("div"),this.div.setAttribute("id",this.id),this.div.setAttribute("class","ocb-gv ocb-box-vertical"),this.navigationbarDiv=document.createElement("div"),this.navigationbarDiv.setAttribute("class","bootstrap ocb-gv-navigation"),this.div.appendChild(this.navigationbarDiv),this.centerPanelDiv=document.createElement("div"),this.centerPanelDiv.setAttribute("class","ocb-gv-center"),this.div.appendChild(this.centerPanelDiv),this.statusbarDiv=document.createElement("div"),this.statusbarDiv.setAttribute("class","ocb-gv-status"),this.div.appendChild(this.statusbarDiv),this.rightSidebarDiv=document.createElement("div"),this.rightSidebarDiv.setAttribute("class","ocb-gv-right-side"),this.centerPanelDiv.appendChild(this.rightSidebarDiv),this.leftSidebarDiv=document.createElement("div"),this.leftSidebarDiv.setAttribute("class","ocb-gv-left-side"),this.centerPanelDiv.appendChild(this.leftSidebarDiv),this.karyotypeDiv=document.createElement("div"),this.karyotypeDiv.setAttribute("class","ocb-gv-karyotype"),this.centerPanelDiv.appendChild(this.karyotypeDiv),this.chromosomeDiv=document.createElement("div"),this.chromosomeDiv.setAttribute("class","ocb-gv-chromosome"),this.centerPanelDiv.appendChild(this.chromosomeDiv),this.trackListPanelsDiv=document.createElement("div"),this.trackListPanelsDiv.setAttribute("class","ocb-gv-track"),this.centerPanelDiv.appendChild(this.trackListPanelsDiv),this.regionDiv=document.createElement("div"),this.regionDiv.setAttribute("class","ocb-gv-overview"),this.trackListPanelsDiv.appendChild(this.regionDiv),this.tracksDiv=document.createElement("div"),this.tracksDiv.setAttribute("class","ocb-gv-detailed"),this.trackListPanelsDiv.appendChild(this.tracksDiv),this.chromosomes=this.getChromosomes(),this._checkAndSetMinimumRegion(this.region,this.getSVGCanvasWidth()),this.zoom=this._calculateZoomByRegion(this.region),this.resizable&&$(window).resize(function(b){b.target==window&&(a.resizing||(a.resizing=!0,a.setWidth($(a.targetDiv).width()),setTimeout(function(){a.resizing=!1},400)))}),this.drawNavigationBar&&(this.navigationBar=this._createNavigationBar(this.navigationbarDiv)),this.drawKaryotypePanel&&(this.karyotypePanel=this._drawKaryotypePanel(this.karyotypeDiv)),this.drawChromosomePanel&&(this.chromosomePanel=this._drawChromosomePanel(this.chromosomeDiv)),this.drawOverviewTrackListPanel&&(this.overviewTrackListPanel=this._createOverviewTrackListPanel(this.regionDiv)),this.trackListPanel=this._createTrackListPanel(this.tracksDiv),this.drawStatusBar&&(this.statusBar=this._createStatusBar(this.statusbarDiv)),this.on("region:change region:move",function(b){b.sender!=a&&a.region.load(b.region)}),this.on("width:change",function(b){b.sender!=a&&(a.width=b.width,$(a.div).width(b.width),$(a.targetDiv).width(b.width))}),this.on("species:change",function(b){a.species=b.species,a.chromosomes=a.getChromosomes()}),$("html").bind("keydown.genomeViewer",function(b){switch(b.keyCode){case 40:case 109:b.shiftKey&&a.increaseZoom(-10);break;case 38:case 107:b.shiftKey&&a.increaseZoom(10)}}),this.rendered=!0},draw:function(){return this.targetDiv=this.target instanceof HTMLElement?this.target:document.querySelector("#"+this.target),this.targetDiv?void this.targetDiv.appendChild(this.div):void console.log("target not found")},destroy:function(){$(this.div).remove(),this.off(),this.rendered=!1,$("html").unbind(".genomeViewer"),$("body").unbind(".genomeViewer"),delete this},getChromosomes:function(){var a,b=function(a){for(var b={},c=0;c<a.length;c++){var d=a[c];b[d.name]=d}return b};return"undefined"!=typeof this.chromosomeList?a=b(this.chromosomeList):CellBaseManager.get({host:this.cellBaseHost,version:this.cellBaseVersion,species:this.species,category:"genomic",subCategory:"chromosome",resource:"all",async:!1,success:function(c){a=b(c.response.result.chromosomes)},error:function(){console.log("Could not get chromosome list")}}),a},_createNavigationBar:function(a){var b=this;$.isFunction(this.quickSearchResultFn)||(this.quickSearchResultFn=function(a){var c=[],d=Utils.getSpeciesCode(this.species.text).substr(0,3);return CellBaseManager.get({host:b.cellBaseHost,version:b.cellBaseVersion,species:d,version:"latest",category:"feature",subCategory:"id",query:a,resource:"starts_with",params:{of:"json"},async:!1,success:function(a){for(var b in a[0])c.push(a[0][b].displayId)}}),c});var c=function(a){null!=a&&("rs"==a.slice(0,"rs".length)||"AFFY_"==a.slice(0,"AFFY_".length)||"SNP_"==a.slice(0,"SNP_".length)||"VAR_"==a.slice(0,"VAR_".length)||"CRTAP_"==a.slice(0,"CRTAP_".length)||"FKBP10_"==a.slice(0,"FKBP10_".length)||"LEPRE1_"==a.slice(0,"LEPRE1_".length)||"PPIB_"==a.slice(0,"PPIB_".length)?this.openSNPListWidget(a):(console.log(a),CellBaseManager.get({host:b.cellBaseHost,version:b.cellBaseVersion,species:b.species,category:"feature",subCategory:"gene",query:a,resource:"info",params:{include:"chromosome,start,end"},success:function(a){var c=a.response[0].result[0],d=new Region(c);b._regionChangeHandler({region:d})}})))},d=new NavigationBar({targetId:a,cellBaseHost:this.cellBaseHost,cellBaseVersion:this.cellBaseVersion,availableSpecies:this.availableSpecies,species:this.species,region:this.region,width:this.width,svgCanvasWidthOffset:this.trackPanelScrollWidth+this.sidePanelWidth,autoRender:!0,zoom:this.zoom,quickSearchResultFn:this.quickSearchResultFn,quickSearchDisplayKey:this.quickSearchDisplayKey,componentsConfig:this.navigationBarConfig.componentsConfig,handlers:{"region:change":function(a){b._regionChangeHandler(a)},"region:move":function(a){b._regionMoveHandler(a)},"zoom:change":function(a){b._zoomChangeHandler(a)},"species:change":function(a){b._speciesChangeHandler(a)},"karyotype-button:change":function(a){a.selected?b.karyotypePanel.show():b.karyotypePanel.hide()},"chromosome-button:change":function(a){a.selected?b.chromosomePanel.show():b.chromosomePanel.hide()},"region-button:change":function(a){a.selected?b.overviewTrackListPanel.show():b.overviewTrackListPanel.hide()},"fullscreen:click":function(){b.fullscreen?($(b.div).css({width:"auto"}),Utils.cancelFullscreen(),b.fullscreen=!1):($(b.div).css({width:screen.width}),Utils.launchFullScreen(b.div),b.fullscreen=!0)},"restoreDefaultRegion:click":function(a){b._regionChangeHandler(a)},"autoHeight-button:click":function(){b.enableAutoHeight()},"quickSearch:select":function(a){c(a.item),b.trigger("quickSearch:select",a)},"quickSearch:go":function(a){c(a.item)}}});return this.on("region:change",function(a){b.navigationBar.setRegion(a.region,b.zoom)}),this.on("region:move",function(a){a.sender!=d&&b.navigationBar.moveRegion(a.region)}),this.on("width:change",function(a){b.navigationBar.setWidth(a.width)}),d.draw(),d},_drawKaryotypePanel:function(a){var b=this;return karyotypePanel=new KaryotypePanel({target:a,cellBaseHost:this.cellBaseHost,cellBaseVersion:this.cellBaseVersion,width:this.width-this.sidePanelWidth,height:125,species:this.species,title:"Karyotype",collapsed:this.karyotypePanelConfig.collapsed,collapsible:this.karyotypePanelConfig.collapsible,region:this.region,autoRender:!0,handlers:{"region:change":function(a){b._regionChangeHandler(a)}}}),this.on("region:change region:move",function(a){karyotypePanel.setRegion(a.region)}),this.on("width:change",function(a){karyotypePanel.setWidth(a.width-b.sidePanelWidth)}),this.on("species:change",function(a){karyotypePanel.setSpecies(a.species)}),karyotypePanel.draw(),karyotypePanel},_drawChromosomePanel:function(a){var b=this,c=new ChromosomePanel({target:a,cellBaseHost:this.cellBaseHost,cellBaseVersion:this.cellBaseVersion,autoRender:!0,width:this.width-this.sidePanelWidth,height:65,species:this.species,title:"Chromosome",collapsed:this.chromosomePanelConfig.collapsed,collapsible:this.chromosomePanelConfig.collapsible,region:this.region,handlers:{"region:change":function(a){b._regionChangeHandler(a)}}});return this.on("region:change region:move",function(a){c.setRegion(a.region)}),this.on("width:change",function(a){c.setWidth(a.width-b.sidePanelWidth)}),this.on("species:change",function(a){c.setSpecies(a.species)}),c.draw(),c},_createOverviewTrackListPanel:function(a){var b=this,c=new TrackListPanel({cellBaseHost:this.cellBaseHost,cellBaseVersion:this.cellBaseVersion,target:a,autoRender:!0,width:this.width-this.sidePanelWidth,zoomMultiplier:this.overviewZoomMultiplier,title:"Region overview",showRegionOverviewBox:!0,collapsible:this.regionPanelConfig.collapsible,region:this.region,handlers:{"region:change":function(a){a.sender=void 0,b._regionChangeHandler(a)},"region:move":function(a){b._regionMoveHandler(a)}}});return this.on("region:change",function(a){a.sender!=c&&c.setRegion(a.region)}),this.on("region:move",function(a){a.sender!=c&&c.moveRegion(a)}),this.on("width:change",function(a){c.setWidth(a.width-b.sidePanelWidth)}),this.on("species:change",function(a){c.setSpecies(a.species)}),c.draw(),c},_createTrackListPanel:function(a){var b=this,c=new TrackListPanel({target:a,cellBaseHost:this.cellBaseHost,cellBaseVersion:this.cellBaseVersion,autoRender:!0,width:this.width-this.sidePanelWidth,title:this.trackListTitle,region:this.region,handlers:{"region:change":function(a){a.sender=void 0,b._regionChangeHandler(a)},"region:move":function(a){b._regionMoveHandler(a)}}});return this.on("region:change",function(a){a.sender!=c&&c.setRegion(a.region)}),this.on("region:move",function(a){a.sender!=c&&c.moveRegion(a)}),this.on("width:change",function(a){c.setWidth(a.width-b.sidePanelWidth)}),this.on("species:change",function(a){c.setSpecies(a.species)}),this.on("feature:highlight",function(a){c.highlight(a)}),c.draw(),c},_createStatusBar:function(a){var b=new StatusBar({target:a,autoRender:!0,region:this.region,width:this.width,version:this.version});return this.on("region:change",function(a){b.setRegion(a)}),this.trackListPanel.on("mousePosition:change",function(a){b.setMousePosition(a)}),b.draw(),b},_checkAndSetNewChromosomeRegion:function(a){var b=this.chromosomes[a.chromosome];a.chromosome!==this.region.chromosome&&(a.start>b.size||a.end>b.size)&&(a.start=Math.round(b.size/2),a.end=Math.round(b.size/2))},_checkAndSetMinimumRegion:function(a,b){var c=Math.floor(b/10);if(a.length()<c){var d=a.center(),e=Math.ceil(c/2-1);a.start=Math.floor(d-e),a.end=Math.floor(d+e)}},_calculateRegionByZoom:function(a){var b=10,c=this.chromosomes[this.region.chromosome],d=this.getSVGCanvasWidth()/b,e=Math.pow(c.size/d,.01),f=d*Math.pow(e,100-a),g=this.region.center(),h=Math.ceil(f/2-1),i=Math.floor(g-h),j=Math.floor(g+h);return{start:i,end:j}},_calculateZoomByRegion:function(a){var b=10,c=this.chromosomes[this.region.chromosome],d=this.getSVGCanvasWidth()/b,e=Math.pow(c.size/d,.01),f=a.length(),g=Math.log(f/d)/Math.log(e);return 100-g},_checkChangingRegion:function(){return("undefined"==typeof this.overviewTrackListPanel||this.overviewTrackListPanel.checkTracksReady())&&("undefined"==typeof this.trackListPanel||this.trackListPanel.checkTracksReady())?!0:!1},_regionChangeHandler:function(a){return this._checkChangingRegion()?(this._checkAndSetNewChromosomeRegion(a.region),this._checkAndSetMinimumRegion(a.region,this.getSVGCanvasWidth()),this.zoom=this._calculateZoomByRegion(a.region),this.trigger("region:change",a),!0):(a.sender&&a.sender.updateRegionControls&&a.sender.updateRegionControls(),console.log("****************************"),console.log("**************************** region change already in progress"),console.log("****************************"),!1)},_regionMoveHandler:function(a){this.trigger("region:move",a)},_zoomChangeHandler:function(a){a.zoom=Math.min(100,a.zoom),a.zoom=Math.max(0,a.zoom),this.zoom=a.zoom,this.region.load(this._calculateRegionByZoom(a.zoom)),this.setRegion(this.region)},_speciesChangeHandler:function(a){this.trigger("species:change",a),this.setRegion(a.species.region)},setRegion:function(a){return this._regionChangeHandler({region:new Region(a)})},moveRegion:function(a){this.region.start+=a,this.region.end+=a,this.trigger("region:move",{region:this.region,disp:-a,sender:this})},setWidth:function(a){this.trigger("width:change",{width:a})},setZoom:function(a){a=Math.min(100,a),a=Math.max(0,a),this.zoom=a,this.region.load(this._calculateRegionByZoom(a)),this.setRegion(this.region)},increaseZoom:function(a){var b=this.zoom+a;this.setZoom(b)},getSVGCanvasWidth:function(){return this.width-this.trackPanelScrollWidth-this.sidePanelWidth},mark:function(a){var b=a.attrName||"feature_id",c=a.class||"ocb-feature-mark";if("attrValues"in a){a.attrValues=$.isArray(a.attrValues)?a.attrValues:[a.attrValues];for(var d in a.attrValues)$("rect["+b+"~="+a.attrValues[d]+"]").attr("class",c)}},unmark:function(a){var b=a.attrName||"feature_id";if("attrValues"in a){a.attrValues=$.isArray(a.attrValues)?a.attrValues:[a.attrValues];for(var c in a.attrValues)$("rect["+b+"~="+a.attrValues[c]+"]").attr("class","")}},highlight:function(a){this.trigger("feature:highlight",a)},getRightSidePanelId:function(){return $(this.rightSidebarDiv).attr("id")},getLeftSidePanelId:function(){return $(this.leftSidebarDiv).attr("id")},getNavigationPanelId:function(){return $(this.navigationbarDiv).attr("id")},getStatusPanelId:function(){return $(this.statusbarDiv).attr("id")},setNavigationBar:function(a){this.navigationBar=a;var b={availableSpecies:this.availableSpecies,species:this.species,region:this.region,width:this.width,svgCanvasWidthOffset:this.trackPanelScrollWidth+this.sidePanelWidth};_.extend(this.navigationBar,b),a.render(this.getNavigationPanelId())},enableAutoHeight:function(){this.trackListPanel.enableAutoHeight(),this.overviewTrackListPanel.enableAutoHeight()},updateHeight:function(){this.trackListPanel.updateHeight(),this.overviewTrackListPanel.updateHeight()},setSpeciesVisible:function(a){this.navigationBar.setSpeciesVisible(a)},setChromosomesVisible:function(a){this.navigationBar.setChromosomeMenuVisible(a)},setKaryotypePanelVisible:function(a){this.karyotypePanel.setVisible(a),this.navigationBar.setVisible({karyotype:a})},setChromosomePanelVisible:function(a){this.chromosomePanel.setVisible(a),this.navigationBar.setVisible({chromosome:a})},setRegionOverviewPanelVisible:function(a){this.overviewTrackListPanel.setVisible(a),this.navigationBar.setVisible({region:a})},setRegionTextBoxVisible:function(a){this.navigationBar.setRegionTextBoxVisible(a)},setSearchVisible:function(a){this.navigationBar.setSearchVisible(a)},setFullScreenVisible:function(a){this.navigationBar.setFullScreenButtonVisible(a)},addOverviewTrack:function(a){this.overviewTrackListPanel.addTrack(a)},addTrack:function(a){this.trackListPanel.addTrack(a)},getTrackById:function(a){return this.trackListPanel.getTrackById(a)},removeTrack:function(a){return this.trackListPanel.removeTrack(a)},restoreTrack:function(a,b){return this.trackListPanel.restoreTrack(a,b)},setTrackIndex:function(a,b){return this.trackListPanel.setTrackIndex(a,b)},scrollToTrack:function(a){return this.trackListPanel.scrollToTrack(a)},showTrack:function(a){this.trackListPanel.showTrack(a)},hideTrack:function(a){this.trackListPanel.hideTrack(a)},containsTrack:function(a){return this.trackListPanel.containsTrack(a)},checkRenderedTrack:function(a){console.log("DEPRECATED METHOD"),console.log(this.checkRenderedTrack),this.trackExists(a)}};